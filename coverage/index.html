<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>Code coverage for Fat free crm</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <script src='./assets/0.12.3/application.js' type='text/javascript'></script>
    <link href='./assets/0.12.3/application.css' media='screen, projection, print' rel='stylesheet' type='text/css' />
    <link rel="shortcut icon" type="image/png" href="./assets/0.12.3/favicon_red.png" />
    <link rel="icon" type="image/png" href="./assets/0.12.3/favicon.png" />
  </head>

  <body>
    <div id="loading">
      <img src="./assets/0.12.3/loading.gif" alt="loading"/>
    </div>
    <div id="wrapper" class="hide">
      <div class="timestamp">Generated <abbr class="timeago" title="2024-07-16T16:26:10+05:30">2024-07-16T16:26:10+05:30</abbr></div>
      <ul class="group_tabs"></ul>

      <div id="content">
        <div class="file_list_container" id="AllFiles">
  <h2>
    <span class="group_name">All Files</span>
    (<span class="covered_percent">
      <span class="red">
  34.92%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         16.39
       </span>
    </span> hits/line
    )
  </h2>

  <a name="AllFiles"></a>

  <div>
    <b>129</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>4737</b> relevant lines,
    <span class="green"><b>1654</b> lines covered</span> and
    <span class="red"><b>3083</b> lines missed. </span>
    (<span class="red">
  34.92%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#81e6fa94eb7b6a932892d3a5ad9e6cc023b874a8" class="src_link" title="app/controllers/admin/application_controller.rb">app/controllers/admin/application_controller.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">85.71 %</td>
            <td class="cell--number">32</td>
            <td class="cell--number">14</td>
            <td class="cell--number">12</td>
            <td class="cell--number">2</td>
            <td class="cell--number">5.43</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#af5666a45b3f9716d12691cd519c6c67cf560825" class="src_link" title="app/controllers/admin/field_groups_controller.rb">app/controllers/admin/field_groups_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">36.67 %</td>
            <td class="cell--number">88</td>
            <td class="cell--number">30</td>
            <td class="cell--number">11</td>
            <td class="cell--number">19</td>
            <td class="cell--number">0.37</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#3a6f6b8e67df9fca029c9bfe0a5e8da4bb44969f" class="src_link" title="app/controllers/admin/fields_controller.rb">app/controllers/admin/fields_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">123</td>
            <td class="cell--number">73</td>
            <td class="cell--number">0</td>
            <td class="cell--number">73</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#a55c45cdd5b1ba1e0ddc411213dd3457086ccfb0" class="src_link" title="app/controllers/admin/groups_controller.rb">app/controllers/admin/groups_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">76.92 %</td>
            <td class="cell--number">71</td>
            <td class="cell--number">26</td>
            <td class="cell--number">20</td>
            <td class="cell--number">6</td>
            <td class="cell--number">0.81</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#f99c1051813b417f31a7f99ee3656add788db22a" class="src_link" title="app/controllers/admin/plugins_controller.rb">app/controllers/admin/plugins_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">25</td>
            <td class="cell--number">11</td>
            <td class="cell--number">0</td>
            <td class="cell--number">11</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#552b3d422be1a1965d50b78e3445b69147228f7a" class="src_link" title="app/controllers/admin/settings_controller.rb">app/controllers/admin/settings_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">20</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#7d512ef398159d7a18d66a007d9368774ff737aa" class="src_link" title="app/controllers/admin/tags_controller.rb">app/controllers/admin/tags_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">75</td>
            <td class="cell--number">35</td>
            <td class="cell--number">0</td>
            <td class="cell--number">35</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#6601dd165412b3194128219f9efc7302f46afab0" class="src_link" title="app/controllers/admin/users_controller.rb">app/controllers/admin/users_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">153</td>
            <td class="cell--number">55</td>
            <td class="cell--number">55</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2.15</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#a033bec11bb44b7311642ace370f8394b23a0214" class="src_link" title="app/controllers/application_controller.rb">app/controllers/application_controller.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">87.50 %</td>
            <td class="cell--number">282</td>
            <td class="cell--number">144</td>
            <td class="cell--number">126</td>
            <td class="cell--number">18</td>
            <td class="cell--number">113.85</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4fab948a800ea00b60a180bd1a593bfc824ef80f" class="src_link" title="app/controllers/comments_controller.rb">app/controllers/comments_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">90.48 %</td>
            <td class="cell--number">104</td>
            <td class="cell--number">42</td>
            <td class="cell--number">38</td>
            <td class="cell--number">4</td>
            <td class="cell--number">9.98</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#75c9fd4ba9b31be93dcf8c17ffd5a58cbde5fde3" class="src_link" title="app/controllers/confirmations_controller.rb">app/controllers/confirmations_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">10</td>
            <td class="cell--number">3</td>
            <td class="cell--number">3</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#b069120845397193c5166a3079d24202f440e71b" class="src_link" title="app/controllers/emails_controller.rb">app/controllers/emails_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">20</td>
            <td class="cell--number">6</td>
            <td class="cell--number">6</td>
            <td class="cell--number">0</td>
            <td class="cell--number">3.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#68420f19d6cd2c6b6cec60b62d65ac24d11ad36e" class="src_link" title="app/controllers/entities/accounts_controller.rb">app/controllers/entities/accounts_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">165</td>
            <td class="cell--number">70</td>
            <td class="cell--number">70</td>
            <td class="cell--number">0</td>
            <td class="cell--number">9.36</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#cd4fff59e15d17072ae179b526ac4fe99d7df51f" class="src_link" title="app/controllers/entities/campaigns_controller.rb">app/controllers/entities/campaigns_controller.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">87.91 %</td>
            <td class="cell--number">209</td>
            <td class="cell--number">91</td>
            <td class="cell--number">80</td>
            <td class="cell--number">11</td>
            <td class="cell--number">7.73</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#112920e7de4bf30babb1fc5310f335a989a5bf12" class="src_link" title="app/controllers/entities/contacts_controller.rb">app/controllers/entities/contacts_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">169</td>
            <td class="cell--number">74</td>
            <td class="cell--number">74</td>
            <td class="cell--number">0</td>
            <td class="cell--number">5.64</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#52a92c665a3552a42fd9038367d847df31130da5" class="src_link" title="app/controllers/entities/leads_controller.rb">app/controllers/entities/leads_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">273</td>
            <td class="cell--number">124</td>
            <td class="cell--number">124</td>
            <td class="cell--number">0</td>
            <td class="cell--number">8.05</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#14e2e233337c500d2dab3787f8d47d1745ad1be4" class="src_link" title="app/controllers/entities/opportunities_controller.rb">app/controllers/entities/opportunities_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">99.13 %</td>
            <td class="cell--number">232</td>
            <td class="cell--number">115</td>
            <td class="cell--number">114</td>
            <td class="cell--number">1</td>
            <td class="cell--number">13.21</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#ae1de5bf6f86f737179981ded79852c26a59c337" class="src_link" title="app/controllers/entities_controller.rb">app/controllers/entities_controller.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">89.74 %</td>
            <td class="cell--number">250</td>
            <td class="cell--number">117</td>
            <td class="cell--number">105</td>
            <td class="cell--number">12</td>
            <td class="cell--number">55.12</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4f5ce7ccd4d1bacdff6d177cc5925ab9a6ba004a" class="src_link" title="app/controllers/home_controller.rb">app/controllers/home_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">98.82 %</td>
            <td class="cell--number">170</td>
            <td class="cell--number">85</td>
            <td class="cell--number">84</td>
            <td class="cell--number">1</td>
            <td class="cell--number">11.12</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#41aeface8ad6e11762caf233e62ad8cdb09e1058" class="src_link" title="app/controllers/lists_controller.rb">app/controllers/lists_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">40.00 %</td>
            <td class="cell--number">44</td>
            <td class="cell--number">15</td>
            <td class="cell--number">6</td>
            <td class="cell--number">9</td>
            <td class="cell--number">0.40</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#8004bf4687d96d44226fb939ae2bea13c195081a" class="src_link" title="app/controllers/passwords_controller.rb">app/controllers/passwords_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">11</td>
            <td class="cell--number">3</td>
            <td class="cell--number">3</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#b2508b1443cedc1b73fbcee47f09bd2d3a14eec5" class="src_link" title="app/controllers/registrations_controller.rb">app/controllers/registrations_controller.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">85.71 %</td>
            <td class="cell--number">19</td>
            <td class="cell--number">7</td>
            <td class="cell--number">6</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0.86</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#faa649fe77dfb608a3daaf14015e6cca52b6163f" class="src_link" title="app/controllers/sessions_controller.rb">app/controllers/sessions_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">80.00 %</td>
            <td class="cell--number">15</td>
            <td class="cell--number">5</td>
            <td class="cell--number">4</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0.80</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#687b3ea204385fc370946b711f430aa56d4a8cd4" class="src_link" title="app/controllers/tasks_controller.rb">app/controllers/tasks_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">99.04 %</td>
            <td class="cell--number">229</td>
            <td class="cell--number">104</td>
            <td class="cell--number">103</td>
            <td class="cell--number">1</td>
            <td class="cell--number">11.44</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#ac18fc5a701fcf938184bbc6f6934bb0f51e00ac" class="src_link" title="app/controllers/users_controller.rb">app/controllers/users_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">92.98 %</td>
            <td class="cell--number">148</td>
            <td class="cell--number">57</td>
            <td class="cell--number">53</td>
            <td class="cell--number">4</td>
            <td class="cell--number">2.11</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#9c9a30c03665ca1cf4e31ca746c8afd1b99edff2" class="src_link" title="app/helpers/accounts_helper.rb">app/helpers/accounts_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">121</td>
            <td class="cell--number">81</td>
            <td class="cell--number">0</td>
            <td class="cell--number">81</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#be249e6055436738be47028d9734e468af9c1a54" class="src_link" title="app/helpers/addresses_helper.rb">app/helpers/addresses_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">19</td>
            <td class="cell--number">9</td>
            <td class="cell--number">0</td>
            <td class="cell--number">9</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#25770e5616114c170b30547bfe45f44fb0745659" class="src_link" title="app/helpers/admin/application_helper.rb">app/helpers/admin/application_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">16</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#264ca494dc75534b0288a4cabab81a8cccb854d4" class="src_link" title="app/helpers/admin/field_groups_helper.rb">app/helpers/admin/field_groups_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">27</td>
            <td class="cell--number">18</td>
            <td class="cell--number">0</td>
            <td class="cell--number">18</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#6c7d4db4dd5b288ec97763803e245a9973814b53" class="src_link" title="app/helpers/admin/fields_helper.rb">app/helpers/admin/fields_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">20</td>
            <td class="cell--number">9</td>
            <td class="cell--number">0</td>
            <td class="cell--number">9</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#04b27418e947ada1f74730032ecc3ae5b50e8d5c" class="src_link" title="app/helpers/admin/plugins_helper.rb">app/helpers/admin/plugins_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">9</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#16d328f47f2f99b365580073e0ee2b03af2adef5" class="src_link" title="app/helpers/admin/settings_helper.rb">app/helpers/admin/settings_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">9</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#798a3ed05c0296cd670cdea2ab63ae39ef396685" class="src_link" title="app/helpers/admin/tags_helper.rb">app/helpers/admin/tags_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">12</td>
            <td class="cell--number">5</td>
            <td class="cell--number">0</td>
            <td class="cell--number">5</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#a2cea9205fa423c487cf15351bc739856f40f565" class="src_link" title="app/helpers/admin/users_helper.rb">app/helpers/admin/users_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">71</td>
            <td class="cell--number">50</td>
            <td class="cell--number">0</td>
            <td class="cell--number">50</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#c11927e86c4c0fda4a3b2a57fe8e28deab663c66" class="src_link" title="app/helpers/application_helper.rb">app/helpers/application_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">534</td>
            <td class="cell--number">384</td>
            <td class="cell--number">0</td>
            <td class="cell--number">384</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#7154fa4a212c06b52eb83dcd0d4eac77ba0c9d45" class="src_link" title="app/helpers/authentications_helper.rb">app/helpers/authentications_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">9</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#950f1bd5a4a706063ff453dc64bcc57736c48574" class="src_link" title="app/helpers/campaigns_helper.rb">app/helpers/campaigns_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">36</td>
            <td class="cell--number">22</td>
            <td class="cell--number">0</td>
            <td class="cell--number">22</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#3fe902205f00e2135ddd23764d1a7acf40717e60" class="src_link" title="app/helpers/comments_helper.rb">app/helpers/comments_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">13</td>
            <td class="cell--number">6</td>
            <td class="cell--number">0</td>
            <td class="cell--number">6</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#dc6f6ee8e644a18b2c32518404a4c5e0e284c7d3" class="src_link" title="app/helpers/contacts_helper.rb">app/helpers/contacts_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">21</td>
            <td class="cell--number">12</td>
            <td class="cell--number">0</td>
            <td class="cell--number">12</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#6ed067454c5da284c2e66e80fe349aedbad390bc" class="src_link" title="app/helpers/emails_helper.rb">app/helpers/emails_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">9</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#f0361ca5aedfe5c3781c609034fd3ca035c9e99f" class="src_link" title="app/helpers/fields_helper.rb">app/helpers/fields_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">9</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#c638742ade6584593069543b6b0533da884a74d1" class="src_link" title="app/helpers/groups_helper.rb">app/helpers/groups_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">9</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#cdf8ff408a41519a5173c6e552e7e2288b8d6f8c" class="src_link" title="app/helpers/home_helper.rb">app/helpers/home_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">68</td>
            <td class="cell--number">49</td>
            <td class="cell--number">0</td>
            <td class="cell--number">49</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#1095a84f5dcc0522d2c94e2efd3093f806e70f58" class="src_link" title="app/helpers/javascript_helper.rb">app/helpers/javascript_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">37</td>
            <td class="cell--number">9</td>
            <td class="cell--number">0</td>
            <td class="cell--number">9</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#5e1a41ef2c03d310603bce8537aa0e823c104c5f" class="src_link" title="app/helpers/leads_helper.rb">app/helpers/leads_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">86</td>
            <td class="cell--number">57</td>
            <td class="cell--number">0</td>
            <td class="cell--number">57</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#db404918440086aa04300998e312500e1d3dbcbe" class="src_link" title="app/helpers/lists_helper.rb">app/helpers/lists_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">9</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#767ab31a97bf4d62ebc4fa7cd4f493be03e02bfb" class="src_link" title="app/helpers/opportunities_helper.rb">app/helpers/opportunities_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">92</td>
            <td class="cell--number">65</td>
            <td class="cell--number">0</td>
            <td class="cell--number">65</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#ccb09cb3fdf22f1a0cf5288a59c1daf7f1a2d9d0" class="src_link" title="app/helpers/passwords_helper.rb">app/helpers/passwords_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">9</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#332505e0382a8c99957cf4c90b33956f5ac8ed23" class="src_link" title="app/helpers/remote_link_pagination_helper.rb">app/helpers/remote_link_pagination_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">15</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#3a43a8538cdf796ca62ef5fbbc63abbb4287de7c" class="src_link" title="app/helpers/tags_helper.rb">app/helpers/tags_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">31</td>
            <td class="cell--number">21</td>
            <td class="cell--number">0</td>
            <td class="cell--number">21</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#7458f999a7eda6ff016b569506abf849663c62b8" class="src_link" title="app/helpers/tasks_helper.rb">app/helpers/tasks_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">141</td>
            <td class="cell--number">106</td>
            <td class="cell--number">0</td>
            <td class="cell--number">106</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#b7ee12dc01ce7942093e03fa6f22056464dea569" class="src_link" title="app/helpers/users_helper.rb">app/helpers/users_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">35</td>
            <td class="cell--number">24</td>
            <td class="cell--number">0</td>
            <td class="cell--number">24</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#c19f7fb1c0a6e88e9ef880b918bf7061bf09a584" class="src_link" title="app/helpers/versions_helper.rb">app/helpers/versions_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">34</td>
            <td class="cell--number">22</td>
            <td class="cell--number">0</td>
            <td class="cell--number">22</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#756519ed6f79b62531f65ea58fe5a3623c7745b9" class="src_link" title="app/inputs/date_pair_input.rb">app/inputs/date_pair_input.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">67</td>
            <td class="cell--number">38</td>
            <td class="cell--number">0</td>
            <td class="cell--number">38</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#39d79c838240be884b4de1b484f0d5381a649de7" class="src_link" title="app/inputs/date_time_input.rb">app/inputs/date_time_input.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">38</td>
            <td class="cell--number">23</td>
            <td class="cell--number">0</td>
            <td class="cell--number">23</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#ee8442d0521c93a18dae4f7c6915401c6c2a10a0" class="src_link" title="app/inputs/datetime_pair_input.rb">app/inputs/datetime_pair_input.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">27</td>
            <td class="cell--number">13</td>
            <td class="cell--number">0</td>
            <td class="cell--number">13</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#fcf410a573759741145f518d877c7b0a889db93c" class="src_link" title="app/inputs/text_input.rb">app/inputs/text_input.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">14</td>
            <td class="cell--number">6</td>
            <td class="cell--number">0</td>
            <td class="cell--number">6</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#af99db8f598d35b19aff0f6c9080fa4515530853" class="src_link" title="app/mailers/devise_mailer.rb">app/mailers/devise_mailer.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">12</td>
            <td class="cell--number">3</td>
            <td class="cell--number">3</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1148.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#06d834ceef65da758c55530cb921d16a9d1cbc4b" class="src_link" title="app/mailers/dropbox_mailer.rb">app/mailers/dropbox_mailer.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">20</td>
            <td class="cell--number">12</td>
            <td class="cell--number">0</td>
            <td class="cell--number">12</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#3d313ddf91806b84359c4a46a8ace1637be3e017" class="src_link" title="app/mailers/subscription_mailer.rb">app/mailers/subscription_mailer.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">36</td>
            <td class="cell--number">15</td>
            <td class="cell--number">15</td>
            <td class="cell--number">0</td>
            <td class="cell--number">4.67</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#6bb27bccb2057b9b2885e92e4a4ca6c642190bae" class="src_link" title="app/mailers/user_mailer.rb">app/mailers/user_mailer.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">24</td>
            <td class="cell--number">10</td>
            <td class="cell--number">10</td>
            <td class="cell--number">0</td>
            <td class="cell--number">12.40</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#b3190e1acd6b47eadc4c3beaf1a3b0ba3fb1fc4a" class="src_link" title="app/models/entities/account.rb">app/models/entities/account.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">150</td>
            <td class="cell--number">84</td>
            <td class="cell--number">0</td>
            <td class="cell--number">84</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#42f121fdc7f89c3e7f10358982eda365240f4918" class="src_link" title="app/models/entities/account_contact.rb">app/models/entities/account_contact.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">30</td>
            <td class="cell--number">6</td>
            <td class="cell--number">6</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#d886a657b7885c91a35c22df717bfe38bcf36744" class="src_link" title="app/models/entities/account_opportunity.rb">app/models/entities/account_opportunity.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">28</td>
            <td class="cell--number">6</td>
            <td class="cell--number">6</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#54523023897f661e80322c55aa801a98b89529f5" class="src_link" title="app/models/entities/campaign.rb">app/models/entities/campaign.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">116</td>
            <td class="cell--number">48</td>
            <td class="cell--number">48</td>
            <td class="cell--number">0</td>
            <td class="cell--number">154.38</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#8cc50694f028c8ad9b55612a84515c012d6182d0" class="src_link" title="app/models/entities/contact.rb">app/models/entities/contact.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">230</td>
            <td class="cell--number">139</td>
            <td class="cell--number">0</td>
            <td class="cell--number">139</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#9f4c373f3fdfc75e103e21c39a3369610ab5c511" class="src_link" title="app/models/entities/contact_opportunity.rb">app/models/entities/contact_opportunity.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">29</td>
            <td class="cell--number">5</td>
            <td class="cell--number">5</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#b6a52687d74edeb646dc2ef58bc5f441b84ec1d3" class="src_link" title="app/models/entities/lead.rb">app/models/entities/lead.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">187</td>
            <td class="cell--number">102</td>
            <td class="cell--number">0</td>
            <td class="cell--number">102</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#2da15aef42629cb5b053ca67365727fbd5c011e3" class="src_link" title="app/models/entities/opportunity.rb">app/models/entities/opportunity.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">188</td>
            <td class="cell--number">113</td>
            <td class="cell--number">0</td>
            <td class="cell--number">113</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#01c5a1446d33a9024d0f891503534d4f9a2ea286" class="src_link" title="app/models/fields/core_field.rb">app/models/fields/core_field.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">40</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#b8cad087d4ed4a60bd083abcd7cb6d44bfd79a29" class="src_link" title="app/models/fields/custom_field.rb">app/models/fields/custom_field.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">152</td>
            <td class="cell--number">44</td>
            <td class="cell--number">44</td>
            <td class="cell--number">0</td>
            <td class="cell--number">11.89</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#0c05b241b5cc91c427b8c170d37dcdbdd84b049a" class="src_link" title="app/models/fields/custom_field_date_pair.rb">app/models/fields/custom_field_date_pair.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">46</td>
            <td class="cell--number">23</td>
            <td class="cell--number">23</td>
            <td class="cell--number">0</td>
            <td class="cell--number">3.04</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#880162bc5a47ca4d6124bbc1f4c979a5ec650fe1" class="src_link" title="app/models/fields/custom_field_datetime_pair.rb">app/models/fields/custom_field_datetime_pair.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">14</td>
            <td class="cell--number">6</td>
            <td class="cell--number">0</td>
            <td class="cell--number">6</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#29c5bf28325b97421ff54f53f9b755ceabdcb640" class="src_link" title="app/models/fields/custom_field_pair.rb">app/models/fields/custom_field_pair.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">44</td>
            <td class="cell--number">23</td>
            <td class="cell--number">23</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.30</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#b3aa2c72a1f16ffff3a5cfb7e22132910c4a1631" class="src_link" title="app/models/fields/field.rb">app/models/fields/field.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">88.89 %</td>
            <td class="cell--number">131</td>
            <td class="cell--number">45</td>
            <td class="cell--number">40</td>
            <td class="cell--number">5</td>
            <td class="cell--number">5.56</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#e42cfbff64c4ceab0c1dd299a2d0414be225af88" class="src_link" title="app/models/fields/field_group.rb">app/models/fields/field_group.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">65</td>
            <td class="cell--number">31</td>
            <td class="cell--number">0</td>
            <td class="cell--number">31</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#de1259f86b5cefecb2afb355069e195792b1a8ab" class="src_link" title="app/models/list.rb">app/models/list.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">19</td>
            <td class="cell--number">7</td>
            <td class="cell--number">7</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.29</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#6b3d88bd003a9e1f9ff0be83194c0b420452f408" class="src_link" title="app/models/observers/entity_observer.rb">app/models/observers/entity_observer.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">41</td>
            <td class="cell--number">25</td>
            <td class="cell--number">0</td>
            <td class="cell--number">25</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#2d94f1aa15d78b448daf8ea9b6e4c3b607fa1598" class="src_link" title="app/models/observers/lead_observer.rb">app/models/observers/lead_observer.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">29</td>
            <td class="cell--number">16</td>
            <td class="cell--number">0</td>
            <td class="cell--number">16</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4a534cd95e4b769eff0af54d168079156582dc43" class="src_link" title="app/models/observers/opportunity_observer.rb">app/models/observers/opportunity_observer.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">47</td>
            <td class="cell--number">32</td>
            <td class="cell--number">0</td>
            <td class="cell--number">32</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#dc5f35793edcdb2f0ac91300e9fde796afabf470" class="src_link" title="app/models/observers/task_observer.rb">app/models/observers/task_observer.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">33</td>
            <td class="cell--number">20</td>
            <td class="cell--number">0</td>
            <td class="cell--number">20</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#f61a48b999baeb768b2e011765586d403e67141c" class="src_link" title="app/models/polymorphic/address.rb">app/models/polymorphic/address.rb</a></td>
            <td class="green strong cell--number t-file__coverage">93.75 %</td>
            <td class="cell--number">61</td>
            <td class="cell--number">16</td>
            <td class="cell--number">15</td>
            <td class="cell--number">1</td>
            <td class="cell--number">22.25</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#78b5c42a122e0210b1833dfb28d409e932aafdd5" class="src_link" title="app/models/polymorphic/avatar.rb">app/models/polymorphic/avatar.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">30</td>
            <td class="cell--number">5</td>
            <td class="cell--number">5</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#8b6c7531a221e68c3922dd64d4b3228f5382de03" class="src_link" title="app/models/polymorphic/comment.rb">app/models/polymorphic/comment.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">75</td>
            <td class="cell--number">25</td>
            <td class="cell--number">25</td>
            <td class="cell--number">0</td>
            <td class="cell--number">15.08</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#967a4de76ddb5c0aaa4be5741799f0c922474b54" class="src_link" title="app/models/polymorphic/email.rb">app/models/polymorphic/email.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">84.62 %</td>
            <td class="cell--number">56</td>
            <td class="cell--number">13</td>
            <td class="cell--number">11</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0.85</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#cbc7955106b4554ccd24914039aaa133948d5288" class="src_link" title="app/models/polymorphic/tag.rb">app/models/polymorphic/tag.rb</a></td>
            <td class="red strong cell--number t-file__coverage">71.43 %</td>
            <td class="cell--number">23</td>
            <td class="cell--number">7</td>
            <td class="cell--number">5</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0.71</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#cb1aa12ef61d4ed45591155b5b158814b45135da" class="src_link" title="app/models/polymorphic/tagging.rb">app/models/polymorphic/tagging.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">10</td>
            <td class="cell--number">3</td>
            <td class="cell--number">0</td>
            <td class="cell--number">3</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4164333929c60a89b46dd2994b744a703af19d65" class="src_link" title="app/models/polymorphic/task.rb">app/models/polymorphic/task.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">292</td>
            <td class="cell--number">180</td>
            <td class="cell--number">0</td>
            <td class="cell--number">180</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#6c240699a86bbed2746e59537b7cbc324b99e8fb" class="src_link" title="app/models/polymorphic/version.rb">app/models/polymorphic/version.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">84</td>
            <td class="cell--number">62</td>
            <td class="cell--number">0</td>
            <td class="cell--number">62</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#5394a224d1f2e949adf1d8e327c281da8920f031" class="src_link" title="app/models/setting.rb">app/models/setting.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">121</td>
            <td class="cell--number">59</td>
            <td class="cell--number">0</td>
            <td class="cell--number">59</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#29a9f704c4194fa13d6d2270b03782b4e0035d0e" class="src_link" title="app/models/users/ability.rb">app/models/users/ability.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">60</td>
            <td class="cell--number">24</td>
            <td class="cell--number">24</td>
            <td class="cell--number">0</td>
            <td class="cell--number">936.17</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#0ac5aaafe553e1dffc5acaf1659ea0034a8a1aa4" class="src_link" title="app/models/users/group.rb">app/models/users/group.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">15</td>
            <td class="cell--number">5</td>
            <td class="cell--number">5</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#0ccdaa919b68a81161ac6c67f889aa7d194f4a6e" class="src_link" title="app/models/users/permission.rb">app/models/users/permission.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">31</td>
            <td class="cell--number">8</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#5521f9bd15b4b60e86d751428d346159ff37ca13" class="src_link" title="app/models/users/preference.rb">app/models/users/preference.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">53</td>
            <td class="cell--number">17</td>
            <td class="cell--number">17</td>
            <td class="cell--number">0</td>
            <td class="cell--number">596.47</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#fb6ecfed0ebc511cdf5cd31263a2aeb0e77e2986" class="src_link" title="app/models/users/user.rb">app/models/users/user.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">210</td>
            <td class="cell--number">114</td>
            <td class="cell--number">0</td>
            <td class="cell--number">114</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#3caacf91941ed11988fdd4c4377e0cf9e8dcd161" class="src_link" title="lib/fat_free_crm.rb">lib/fat_free_crm.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">58</td>
            <td class="cell--number">37</td>
            <td class="cell--number">0</td>
            <td class="cell--number">37</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#66aa9776f777a4cbda1adb9c6fa354907cdb15d0" class="src_link" title="lib/fat_free_crm/callback.rb">lib/fat_free_crm/callback.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">146</td>
            <td class="cell--number">83</td>
            <td class="cell--number">0</td>
            <td class="cell--number">83</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#7beadb898c0fd7f17fe6541d40ca5fbb0143c3d1" class="src_link" title="lib/fat_free_crm/comment_extensions.rb">lib/fat_free_crm/comment_extensions.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">28</td>
            <td class="cell--number">18</td>
            <td class="cell--number">0</td>
            <td class="cell--number">18</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#23538a0bb46d0666e3000c361b5c1b8342177832" class="src_link" title="lib/fat_free_crm/core_ext.rb">lib/fat_free_crm/core_ext.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">8</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#9565eb831e551260a15b9522cba6326aa5aa48ea" class="src_link" title="lib/fat_free_crm/core_ext/alias_method_chain.rb">lib/fat_free_crm/core_ext/alias_method_chain.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">25</td>
            <td class="cell--number">18</td>
            <td class="cell--number">0</td>
            <td class="cell--number">18</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#eabfe41b758964aa346c457317b1a0e048448fdb" class="src_link" title="lib/fat_free_crm/core_ext/nil.rb">lib/fat_free_crm/core_ext/nil.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">16</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#95af1b965979017afaa8d781e4a48bc5d88d0ddd" class="src_link" title="lib/fat_free_crm/core_ext/string.rb">lib/fat_free_crm/core_ext/string.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">50</td>
            <td class="cell--number">31</td>
            <td class="cell--number">0</td>
            <td class="cell--number">31</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#bd4c731b7c154a70f8c7630cf3729ca08c967a6d" class="src_link" title="lib/fat_free_crm/custom_fields.rb">lib/fat_free_crm/custom_fields.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">14</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#bf15d31f2eaba8e56b5e13fa7f2482599b624b48" class="src_link" title="lib/fat_free_crm/engine.rb">lib/fat_free_crm/engine.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">34</td>
            <td class="cell--number">23</td>
            <td class="cell--number">0</td>
            <td class="cell--number">23</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#0542703a1a97575dc6845405325e6485a8030181" class="src_link" title="lib/fat_free_crm/errors.rb">lib/fat_free_crm/errors.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">31</td>
            <td class="cell--number">15</td>
            <td class="cell--number">0</td>
            <td class="cell--number">15</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#df721cab87c653d1cb79ccf5f81ce55e1ec3c522" class="src_link" title="lib/fat_free_crm/exceptions.rb">lib/fat_free_crm/exceptions.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">24</td>
            <td class="cell--number">13</td>
            <td class="cell--number">0</td>
            <td class="cell--number">13</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#9ad0382c18bbe1348e24a2b869af30d4b8ef9454" class="src_link" title="lib/fat_free_crm/export_csv.rb">lib/fat_free_crm/export_csv.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">36</td>
            <td class="cell--number">23</td>
            <td class="cell--number">0</td>
            <td class="cell--number">23</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#9b9cfe0fb6583f8f1b68d605a80e76b50c522750" class="src_link" title="lib/fat_free_crm/exportable.rb">lib/fat_free_crm/exportable.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">51</td>
            <td class="cell--number">38</td>
            <td class="cell--number">0</td>
            <td class="cell--number">38</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#50c1a49de6a132aa0097d700103676abe61e70e5" class="src_link" title="lib/fat_free_crm/fields.rb">lib/fat_free_crm/fields.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">94</td>
            <td class="cell--number">67</td>
            <td class="cell--number">0</td>
            <td class="cell--number">67</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#36f4686c647fb03c839a62065a68d6b854a65286" class="src_link" title="lib/fat_free_crm/gem_dependencies.rb">lib/fat_free_crm/gem_dependencies.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">41</td>
            <td class="cell--number">32</td>
            <td class="cell--number">0</td>
            <td class="cell--number">32</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#6bab3c2fed05643752635b4246c2f3be8b015ba7" class="src_link" title="lib/fat_free_crm/gem_ext.rb">lib/fat_free_crm/gem_ext.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">10</td>
            <td class="cell--number">3</td>
            <td class="cell--number">0</td>
            <td class="cell--number">3</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#abd7e18c9e9262b070bd907eca20b2d8d3568f23" class="src_link" title="lib/fat_free_crm/gem_ext/action_controller/base.rb">lib/fat_free_crm/gem_ext/action_controller/base.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">18</td>
            <td class="cell--number">7</td>
            <td class="cell--number">0</td>
            <td class="cell--number">7</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#0505a8eb292ed1925cea6eb4bf691726f4fc0469" class="src_link" title="lib/fat_free_crm/gem_ext/active_support/buffered_logger.rb">lib/fat_free_crm/gem_ext/active_support/buffered_logger.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">19</td>
            <td class="cell--number">10</td>
            <td class="cell--number">0</td>
            <td class="cell--number">10</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#0b832f4045d41d7cc62cc3b48f42d8f721527457" class="src_link" title="lib/fat_free_crm/gem_ext/rails/engine.rb">lib/fat_free_crm/gem_ext/rails/engine.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">16</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#7add5f39b722a45897a49982a5af878689281768" class="src_link" title="lib/fat_free_crm/gem_ext/rake/task.rb">lib/fat_free_crm/gem_ext/rake/task.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">17</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#f21d226db5895b026180a2823d8437ba9103aee2" class="src_link" title="lib/fat_free_crm/i18n.rb">lib/fat_free_crm/i18n.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">44</td>
            <td class="cell--number">24</td>
            <td class="cell--number">0</td>
            <td class="cell--number">24</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#482760fcdb86187e2b5c6b52c2d0acc7f040ea86" class="src_link" title="lib/fat_free_crm/load_settings.rb">lib/fat_free_crm/load_settings.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">20</td>
            <td class="cell--number">7</td>
            <td class="cell--number">0</td>
            <td class="cell--number">7</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#b7c78b9b641a30d2008fbcf801789a4d1afff272" class="src_link" title="lib/fat_free_crm/mail_processor/base.rb">lib/fat_free_crm/mail_processor/base.rb</a></td>
            <td class="red strong cell--number t-file__coverage">73.91 %</td>
            <td class="cell--number">230</td>
            <td class="cell--number">115</td>
            <td class="cell--number">85</td>
            <td class="cell--number">30</td>
            <td class="cell--number">12.71</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#6ac460522ef46880505eedc0d4cfa80f3e729b1d" class="src_link" title="lib/fat_free_crm/mail_processor/comment_replies.rb">lib/fat_free_crm/mail_processor/comment_replies.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">72</td>
            <td class="cell--number">25</td>
            <td class="cell--number">25</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.48</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#93695a8cb6e0ec385a373c23d82bd05c176021d9" class="src_link" title="lib/fat_free_crm/mail_processor/dropbox.rb">lib/fat_free_crm/mail_processor/dropbox.rb</a></td>
            <td class="green strong cell--number t-file__coverage">94.44 %</td>
            <td class="cell--number">265</td>
            <td class="cell--number">108</td>
            <td class="cell--number">102</td>
            <td class="cell--number">6</td>
            <td class="cell--number">6.67</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#1014b6cd8b7647688a9e96c38b95ef852ff4f788" class="src_link" title="lib/fat_free_crm/permissions.rb">lib/fat_free_crm/permissions.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">97</td>
            <td class="cell--number">63</td>
            <td class="cell--number">0</td>
            <td class="cell--number">63</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#084273e394b2d1ab056a3a4104b8e4fe1e9edaaa" class="src_link" title="lib/fat_free_crm/renderers.rb">lib/fat_free_crm/renderers.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">13</td>
            <td class="cell--number">6</td>
            <td class="cell--number">0</td>
            <td class="cell--number">6</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#db6abb78a47bb3596b3f632b9aad9284e91ee632" class="src_link" title="lib/fat_free_crm/secret_token_generator.rb">lib/fat_free_crm/secret_token_generator.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">61</td>
            <td class="cell--number">35</td>
            <td class="cell--number">0</td>
            <td class="cell--number">35</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#aef9aa5ef9133724b554da227999886872c593f9" class="src_link" title="lib/fat_free_crm/sortable.rb">lib/fat_free_crm/sortable.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">45</td>
            <td class="cell--number">25</td>
            <td class="cell--number">0</td>
            <td class="cell--number">25</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#7ed19853aaad3a9eba50907f7f698c735bd9f604" class="src_link" title="lib/fat_free_crm/tabs.rb">lib/fat_free_crm/tabs.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">25</td>
            <td class="cell--number">14</td>
            <td class="cell--number">0</td>
            <td class="cell--number">14</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#356957b8f9616bf57c328b3ac532c34083832ee0" class="src_link" title="lib/fat_free_crm/version.rb">lib/fat_free_crm/version.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">17</td>
            <td class="cell--number">9</td>
            <td class="cell--number">0</td>
            <td class="cell--number">9</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#b943c4a0d54efd0a691865a504111d9ca93b1838" class="src_link" title="lib/fat_free_crm/view_factory.rb">lib/fat_free_crm/view_factory.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">83</td>
            <td class="cell--number">42</td>
            <td class="cell--number">0</td>
            <td class="cell--number">42</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#3b574877c1cb7cff079514fb8bd5528a8c951700" class="src_link" title="lib/gravatar_image_tag.rb">lib/gravatar_image_tag.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">60</td>
            <td class="cell--number">46</td>
            <td class="cell--number">0</td>
            <td class="cell--number">46</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#f7e9bd413e4a51cdb4fff313c0b2e0dbe2f5aed9" class="src_link" title="lib/missing_translation_detector.rb">lib/missing_translation_detector.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">53</td>
            <td class="cell--number">35</td>
            <td class="cell--number">0</td>
            <td class="cell--number">35</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>


        
          <div class="file_list_container" id="Controllers">
  <h2>
    <span class="group_name">Controllers</span>
    (<span class="covered_percent">
      <span class="yellow">
  83.49%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         22.89
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Controllers"></a>

  <div>
    <b>25</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>1314</b> relevant lines,
    <span class="green"><b>1097</b> lines covered</span> and
    <span class="red"><b>217</b> lines missed. </span>
    (<span class="yellow">
  83.49%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#81e6fa94eb7b6a932892d3a5ad9e6cc023b874a8" class="src_link" title="app/controllers/admin/application_controller.rb">app/controllers/admin/application_controller.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">85.71 %</td>
            <td class="cell--number">32</td>
            <td class="cell--number">14</td>
            <td class="cell--number">12</td>
            <td class="cell--number">2</td>
            <td class="cell--number">5.43</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#af5666a45b3f9716d12691cd519c6c67cf560825" class="src_link" title="app/controllers/admin/field_groups_controller.rb">app/controllers/admin/field_groups_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">36.67 %</td>
            <td class="cell--number">88</td>
            <td class="cell--number">30</td>
            <td class="cell--number">11</td>
            <td class="cell--number">19</td>
            <td class="cell--number">0.37</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#3a6f6b8e67df9fca029c9bfe0a5e8da4bb44969f" class="src_link" title="app/controllers/admin/fields_controller.rb">app/controllers/admin/fields_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">123</td>
            <td class="cell--number">73</td>
            <td class="cell--number">0</td>
            <td class="cell--number">73</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#a55c45cdd5b1ba1e0ddc411213dd3457086ccfb0" class="src_link" title="app/controllers/admin/groups_controller.rb">app/controllers/admin/groups_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">76.92 %</td>
            <td class="cell--number">71</td>
            <td class="cell--number">26</td>
            <td class="cell--number">20</td>
            <td class="cell--number">6</td>
            <td class="cell--number">0.81</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#f99c1051813b417f31a7f99ee3656add788db22a" class="src_link" title="app/controllers/admin/plugins_controller.rb">app/controllers/admin/plugins_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">25</td>
            <td class="cell--number">11</td>
            <td class="cell--number">0</td>
            <td class="cell--number">11</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#552b3d422be1a1965d50b78e3445b69147228f7a" class="src_link" title="app/controllers/admin/settings_controller.rb">app/controllers/admin/settings_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">20</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#7d512ef398159d7a18d66a007d9368774ff737aa" class="src_link" title="app/controllers/admin/tags_controller.rb">app/controllers/admin/tags_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">75</td>
            <td class="cell--number">35</td>
            <td class="cell--number">0</td>
            <td class="cell--number">35</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#6601dd165412b3194128219f9efc7302f46afab0" class="src_link" title="app/controllers/admin/users_controller.rb">app/controllers/admin/users_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">153</td>
            <td class="cell--number">55</td>
            <td class="cell--number">55</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2.15</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#a033bec11bb44b7311642ace370f8394b23a0214" class="src_link" title="app/controllers/application_controller.rb">app/controllers/application_controller.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">87.50 %</td>
            <td class="cell--number">282</td>
            <td class="cell--number">144</td>
            <td class="cell--number">126</td>
            <td class="cell--number">18</td>
            <td class="cell--number">113.85</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4fab948a800ea00b60a180bd1a593bfc824ef80f" class="src_link" title="app/controllers/comments_controller.rb">app/controllers/comments_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">90.48 %</td>
            <td class="cell--number">104</td>
            <td class="cell--number">42</td>
            <td class="cell--number">38</td>
            <td class="cell--number">4</td>
            <td class="cell--number">9.98</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#75c9fd4ba9b31be93dcf8c17ffd5a58cbde5fde3" class="src_link" title="app/controllers/confirmations_controller.rb">app/controllers/confirmations_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">10</td>
            <td class="cell--number">3</td>
            <td class="cell--number">3</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#b069120845397193c5166a3079d24202f440e71b" class="src_link" title="app/controllers/emails_controller.rb">app/controllers/emails_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">20</td>
            <td class="cell--number">6</td>
            <td class="cell--number">6</td>
            <td class="cell--number">0</td>
            <td class="cell--number">3.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#68420f19d6cd2c6b6cec60b62d65ac24d11ad36e" class="src_link" title="app/controllers/entities/accounts_controller.rb">app/controllers/entities/accounts_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">165</td>
            <td class="cell--number">70</td>
            <td class="cell--number">70</td>
            <td class="cell--number">0</td>
            <td class="cell--number">9.36</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#cd4fff59e15d17072ae179b526ac4fe99d7df51f" class="src_link" title="app/controllers/entities/campaigns_controller.rb">app/controllers/entities/campaigns_controller.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">87.91 %</td>
            <td class="cell--number">209</td>
            <td class="cell--number">91</td>
            <td class="cell--number">80</td>
            <td class="cell--number">11</td>
            <td class="cell--number">7.73</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#112920e7de4bf30babb1fc5310f335a989a5bf12" class="src_link" title="app/controllers/entities/contacts_controller.rb">app/controllers/entities/contacts_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">169</td>
            <td class="cell--number">74</td>
            <td class="cell--number">74</td>
            <td class="cell--number">0</td>
            <td class="cell--number">5.64</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#52a92c665a3552a42fd9038367d847df31130da5" class="src_link" title="app/controllers/entities/leads_controller.rb">app/controllers/entities/leads_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">273</td>
            <td class="cell--number">124</td>
            <td class="cell--number">124</td>
            <td class="cell--number">0</td>
            <td class="cell--number">8.05</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#14e2e233337c500d2dab3787f8d47d1745ad1be4" class="src_link" title="app/controllers/entities/opportunities_controller.rb">app/controllers/entities/opportunities_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">99.13 %</td>
            <td class="cell--number">232</td>
            <td class="cell--number">115</td>
            <td class="cell--number">114</td>
            <td class="cell--number">1</td>
            <td class="cell--number">13.21</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#ae1de5bf6f86f737179981ded79852c26a59c337" class="src_link" title="app/controllers/entities_controller.rb">app/controllers/entities_controller.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">89.74 %</td>
            <td class="cell--number">250</td>
            <td class="cell--number">117</td>
            <td class="cell--number">105</td>
            <td class="cell--number">12</td>
            <td class="cell--number">55.12</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4f5ce7ccd4d1bacdff6d177cc5925ab9a6ba004a" class="src_link" title="app/controllers/home_controller.rb">app/controllers/home_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">98.82 %</td>
            <td class="cell--number">170</td>
            <td class="cell--number">85</td>
            <td class="cell--number">84</td>
            <td class="cell--number">1</td>
            <td class="cell--number">11.12</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#41aeface8ad6e11762caf233e62ad8cdb09e1058" class="src_link" title="app/controllers/lists_controller.rb">app/controllers/lists_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">40.00 %</td>
            <td class="cell--number">44</td>
            <td class="cell--number">15</td>
            <td class="cell--number">6</td>
            <td class="cell--number">9</td>
            <td class="cell--number">0.40</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#8004bf4687d96d44226fb939ae2bea13c195081a" class="src_link" title="app/controllers/passwords_controller.rb">app/controllers/passwords_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">11</td>
            <td class="cell--number">3</td>
            <td class="cell--number">3</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#b2508b1443cedc1b73fbcee47f09bd2d3a14eec5" class="src_link" title="app/controllers/registrations_controller.rb">app/controllers/registrations_controller.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">85.71 %</td>
            <td class="cell--number">19</td>
            <td class="cell--number">7</td>
            <td class="cell--number">6</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0.86</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#faa649fe77dfb608a3daaf14015e6cca52b6163f" class="src_link" title="app/controllers/sessions_controller.rb">app/controllers/sessions_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">80.00 %</td>
            <td class="cell--number">15</td>
            <td class="cell--number">5</td>
            <td class="cell--number">4</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0.80</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#687b3ea204385fc370946b711f430aa56d4a8cd4" class="src_link" title="app/controllers/tasks_controller.rb">app/controllers/tasks_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">99.04 %</td>
            <td class="cell--number">229</td>
            <td class="cell--number">104</td>
            <td class="cell--number">103</td>
            <td class="cell--number">1</td>
            <td class="cell--number">11.44</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#ac18fc5a701fcf938184bbc6f6934bb0f51e00ac" class="src_link" title="app/controllers/users_controller.rb">app/controllers/users_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">92.98 %</td>
            <td class="cell--number">148</td>
            <td class="cell--number">57</td>
            <td class="cell--number">53</td>
            <td class="cell--number">4</td>
            <td class="cell--number">2.11</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Channels">
  <h2>
    <span class="group_name">Channels</span>
    (<span class="covered_percent">
      <span class="green">
  100.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Channels"></a>

  <div>
    <b>0</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>0</b> relevant lines,
    <span class="green"><b>0</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed. </span>
    (<span class="green">
  100.0%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Models">
  <h2>
    <span class="group_name">Models</span>
    (<span class="covered_percent">
      <span class="red">
  24.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         31.55
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Models"></a>

  <div>
    <b>34</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>1321</b> relevant lines,
    <span class="green"><b>317</b> lines covered</span> and
    <span class="red"><b>1004</b> lines missed. </span>
    (<span class="red">
  24.0%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#b3190e1acd6b47eadc4c3beaf1a3b0ba3fb1fc4a" class="src_link" title="app/models/entities/account.rb">app/models/entities/account.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">150</td>
            <td class="cell--number">84</td>
            <td class="cell--number">0</td>
            <td class="cell--number">84</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#42f121fdc7f89c3e7f10358982eda365240f4918" class="src_link" title="app/models/entities/account_contact.rb">app/models/entities/account_contact.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">30</td>
            <td class="cell--number">6</td>
            <td class="cell--number">6</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#d886a657b7885c91a35c22df717bfe38bcf36744" class="src_link" title="app/models/entities/account_opportunity.rb">app/models/entities/account_opportunity.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">28</td>
            <td class="cell--number">6</td>
            <td class="cell--number">6</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#54523023897f661e80322c55aa801a98b89529f5" class="src_link" title="app/models/entities/campaign.rb">app/models/entities/campaign.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">116</td>
            <td class="cell--number">48</td>
            <td class="cell--number">48</td>
            <td class="cell--number">0</td>
            <td class="cell--number">154.38</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#8cc50694f028c8ad9b55612a84515c012d6182d0" class="src_link" title="app/models/entities/contact.rb">app/models/entities/contact.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">230</td>
            <td class="cell--number">139</td>
            <td class="cell--number">0</td>
            <td class="cell--number">139</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#9f4c373f3fdfc75e103e21c39a3369610ab5c511" class="src_link" title="app/models/entities/contact_opportunity.rb">app/models/entities/contact_opportunity.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">29</td>
            <td class="cell--number">5</td>
            <td class="cell--number">5</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#b6a52687d74edeb646dc2ef58bc5f441b84ec1d3" class="src_link" title="app/models/entities/lead.rb">app/models/entities/lead.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">187</td>
            <td class="cell--number">102</td>
            <td class="cell--number">0</td>
            <td class="cell--number">102</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#2da15aef42629cb5b053ca67365727fbd5c011e3" class="src_link" title="app/models/entities/opportunity.rb">app/models/entities/opportunity.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">188</td>
            <td class="cell--number">113</td>
            <td class="cell--number">0</td>
            <td class="cell--number">113</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#01c5a1446d33a9024d0f891503534d4f9a2ea286" class="src_link" title="app/models/fields/core_field.rb">app/models/fields/core_field.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">40</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#b8cad087d4ed4a60bd083abcd7cb6d44bfd79a29" class="src_link" title="app/models/fields/custom_field.rb">app/models/fields/custom_field.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">152</td>
            <td class="cell--number">44</td>
            <td class="cell--number">44</td>
            <td class="cell--number">0</td>
            <td class="cell--number">11.89</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#0c05b241b5cc91c427b8c170d37dcdbdd84b049a" class="src_link" title="app/models/fields/custom_field_date_pair.rb">app/models/fields/custom_field_date_pair.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">46</td>
            <td class="cell--number">23</td>
            <td class="cell--number">23</td>
            <td class="cell--number">0</td>
            <td class="cell--number">3.04</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#880162bc5a47ca4d6124bbc1f4c979a5ec650fe1" class="src_link" title="app/models/fields/custom_field_datetime_pair.rb">app/models/fields/custom_field_datetime_pair.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">14</td>
            <td class="cell--number">6</td>
            <td class="cell--number">0</td>
            <td class="cell--number">6</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#29c5bf28325b97421ff54f53f9b755ceabdcb640" class="src_link" title="app/models/fields/custom_field_pair.rb">app/models/fields/custom_field_pair.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">44</td>
            <td class="cell--number">23</td>
            <td class="cell--number">23</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.30</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#b3aa2c72a1f16ffff3a5cfb7e22132910c4a1631" class="src_link" title="app/models/fields/field.rb">app/models/fields/field.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">88.89 %</td>
            <td class="cell--number">131</td>
            <td class="cell--number">45</td>
            <td class="cell--number">40</td>
            <td class="cell--number">5</td>
            <td class="cell--number">5.56</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#e42cfbff64c4ceab0c1dd299a2d0414be225af88" class="src_link" title="app/models/fields/field_group.rb">app/models/fields/field_group.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">65</td>
            <td class="cell--number">31</td>
            <td class="cell--number">0</td>
            <td class="cell--number">31</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#de1259f86b5cefecb2afb355069e195792b1a8ab" class="src_link" title="app/models/list.rb">app/models/list.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">19</td>
            <td class="cell--number">7</td>
            <td class="cell--number">7</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.29</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#6b3d88bd003a9e1f9ff0be83194c0b420452f408" class="src_link" title="app/models/observers/entity_observer.rb">app/models/observers/entity_observer.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">41</td>
            <td class="cell--number">25</td>
            <td class="cell--number">0</td>
            <td class="cell--number">25</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#2d94f1aa15d78b448daf8ea9b6e4c3b607fa1598" class="src_link" title="app/models/observers/lead_observer.rb">app/models/observers/lead_observer.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">29</td>
            <td class="cell--number">16</td>
            <td class="cell--number">0</td>
            <td class="cell--number">16</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4a534cd95e4b769eff0af54d168079156582dc43" class="src_link" title="app/models/observers/opportunity_observer.rb">app/models/observers/opportunity_observer.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">47</td>
            <td class="cell--number">32</td>
            <td class="cell--number">0</td>
            <td class="cell--number">32</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#dc5f35793edcdb2f0ac91300e9fde796afabf470" class="src_link" title="app/models/observers/task_observer.rb">app/models/observers/task_observer.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">33</td>
            <td class="cell--number">20</td>
            <td class="cell--number">0</td>
            <td class="cell--number">20</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#f61a48b999baeb768b2e011765586d403e67141c" class="src_link" title="app/models/polymorphic/address.rb">app/models/polymorphic/address.rb</a></td>
            <td class="green strong cell--number t-file__coverage">93.75 %</td>
            <td class="cell--number">61</td>
            <td class="cell--number">16</td>
            <td class="cell--number">15</td>
            <td class="cell--number">1</td>
            <td class="cell--number">22.25</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#78b5c42a122e0210b1833dfb28d409e932aafdd5" class="src_link" title="app/models/polymorphic/avatar.rb">app/models/polymorphic/avatar.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">30</td>
            <td class="cell--number">5</td>
            <td class="cell--number">5</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#8b6c7531a221e68c3922dd64d4b3228f5382de03" class="src_link" title="app/models/polymorphic/comment.rb">app/models/polymorphic/comment.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">75</td>
            <td class="cell--number">25</td>
            <td class="cell--number">25</td>
            <td class="cell--number">0</td>
            <td class="cell--number">15.08</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#967a4de76ddb5c0aaa4be5741799f0c922474b54" class="src_link" title="app/models/polymorphic/email.rb">app/models/polymorphic/email.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">84.62 %</td>
            <td class="cell--number">56</td>
            <td class="cell--number">13</td>
            <td class="cell--number">11</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0.85</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#cbc7955106b4554ccd24914039aaa133948d5288" class="src_link" title="app/models/polymorphic/tag.rb">app/models/polymorphic/tag.rb</a></td>
            <td class="red strong cell--number t-file__coverage">71.43 %</td>
            <td class="cell--number">23</td>
            <td class="cell--number">7</td>
            <td class="cell--number">5</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0.71</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#cb1aa12ef61d4ed45591155b5b158814b45135da" class="src_link" title="app/models/polymorphic/tagging.rb">app/models/polymorphic/tagging.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">10</td>
            <td class="cell--number">3</td>
            <td class="cell--number">0</td>
            <td class="cell--number">3</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4164333929c60a89b46dd2994b744a703af19d65" class="src_link" title="app/models/polymorphic/task.rb">app/models/polymorphic/task.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">292</td>
            <td class="cell--number">180</td>
            <td class="cell--number">0</td>
            <td class="cell--number">180</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#6c240699a86bbed2746e59537b7cbc324b99e8fb" class="src_link" title="app/models/polymorphic/version.rb">app/models/polymorphic/version.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">84</td>
            <td class="cell--number">62</td>
            <td class="cell--number">0</td>
            <td class="cell--number">62</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#5394a224d1f2e949adf1d8e327c281da8920f031" class="src_link" title="app/models/setting.rb">app/models/setting.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">121</td>
            <td class="cell--number">59</td>
            <td class="cell--number">0</td>
            <td class="cell--number">59</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#29a9f704c4194fa13d6d2270b03782b4e0035d0e" class="src_link" title="app/models/users/ability.rb">app/models/users/ability.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">60</td>
            <td class="cell--number">24</td>
            <td class="cell--number">24</td>
            <td class="cell--number">0</td>
            <td class="cell--number">936.17</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#0ac5aaafe553e1dffc5acaf1659ea0034a8a1aa4" class="src_link" title="app/models/users/group.rb">app/models/users/group.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">15</td>
            <td class="cell--number">5</td>
            <td class="cell--number">5</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#0ccdaa919b68a81161ac6c67f889aa7d194f4a6e" class="src_link" title="app/models/users/permission.rb">app/models/users/permission.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">31</td>
            <td class="cell--number">8</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#5521f9bd15b4b60e86d751428d346159ff37ca13" class="src_link" title="app/models/users/preference.rb">app/models/users/preference.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">53</td>
            <td class="cell--number">17</td>
            <td class="cell--number">17</td>
            <td class="cell--number">0</td>
            <td class="cell--number">596.47</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#fb6ecfed0ebc511cdf5cd31263a2aeb0e77e2986" class="src_link" title="app/models/users/user.rb">app/models/users/user.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">210</td>
            <td class="cell--number">114</td>
            <td class="cell--number">0</td>
            <td class="cell--number">114</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Mailers">
  <h2>
    <span class="group_name">Mailers</span>
    (<span class="covered_percent">
      <span class="red">
  70.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         90.95
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Mailers"></a>

  <div>
    <b>4</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>40</b> relevant lines,
    <span class="green"><b>28</b> lines covered</span> and
    <span class="red"><b>12</b> lines missed. </span>
    (<span class="red">
  70.0%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#af99db8f598d35b19aff0f6c9080fa4515530853" class="src_link" title="app/mailers/devise_mailer.rb">app/mailers/devise_mailer.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">12</td>
            <td class="cell--number">3</td>
            <td class="cell--number">3</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1148.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#06d834ceef65da758c55530cb921d16a9d1cbc4b" class="src_link" title="app/mailers/dropbox_mailer.rb">app/mailers/dropbox_mailer.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">20</td>
            <td class="cell--number">12</td>
            <td class="cell--number">0</td>
            <td class="cell--number">12</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#3d313ddf91806b84359c4a46a8ace1637be3e017" class="src_link" title="app/mailers/subscription_mailer.rb">app/mailers/subscription_mailer.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">36</td>
            <td class="cell--number">15</td>
            <td class="cell--number">15</td>
            <td class="cell--number">0</td>
            <td class="cell--number">4.67</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#6bb27bccb2057b9b2885e92e4a4ca6c642190bae" class="src_link" title="app/mailers/user_mailer.rb">app/mailers/user_mailer.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">24</td>
            <td class="cell--number">10</td>
            <td class="cell--number">10</td>
            <td class="cell--number">0</td>
            <td class="cell--number">12.40</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Helpers">
  <h2>
    <span class="group_name">Helpers</span>
    (<span class="covered_percent">
      <span class="red">
  0.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Helpers"></a>

  <div>
    <b>28</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>981</b> relevant lines,
    <span class="green"><b>0</b> lines covered</span> and
    <span class="red"><b>981</b> lines missed. </span>
    (<span class="red">
  0.0%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#9c9a30c03665ca1cf4e31ca746c8afd1b99edff2" class="src_link" title="app/helpers/accounts_helper.rb">app/helpers/accounts_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">121</td>
            <td class="cell--number">81</td>
            <td class="cell--number">0</td>
            <td class="cell--number">81</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#be249e6055436738be47028d9734e468af9c1a54" class="src_link" title="app/helpers/addresses_helper.rb">app/helpers/addresses_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">19</td>
            <td class="cell--number">9</td>
            <td class="cell--number">0</td>
            <td class="cell--number">9</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#25770e5616114c170b30547bfe45f44fb0745659" class="src_link" title="app/helpers/admin/application_helper.rb">app/helpers/admin/application_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">16</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#264ca494dc75534b0288a4cabab81a8cccb854d4" class="src_link" title="app/helpers/admin/field_groups_helper.rb">app/helpers/admin/field_groups_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">27</td>
            <td class="cell--number">18</td>
            <td class="cell--number">0</td>
            <td class="cell--number">18</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#6c7d4db4dd5b288ec97763803e245a9973814b53" class="src_link" title="app/helpers/admin/fields_helper.rb">app/helpers/admin/fields_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">20</td>
            <td class="cell--number">9</td>
            <td class="cell--number">0</td>
            <td class="cell--number">9</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#04b27418e947ada1f74730032ecc3ae5b50e8d5c" class="src_link" title="app/helpers/admin/plugins_helper.rb">app/helpers/admin/plugins_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">9</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#16d328f47f2f99b365580073e0ee2b03af2adef5" class="src_link" title="app/helpers/admin/settings_helper.rb">app/helpers/admin/settings_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">9</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#798a3ed05c0296cd670cdea2ab63ae39ef396685" class="src_link" title="app/helpers/admin/tags_helper.rb">app/helpers/admin/tags_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">12</td>
            <td class="cell--number">5</td>
            <td class="cell--number">0</td>
            <td class="cell--number">5</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#a2cea9205fa423c487cf15351bc739856f40f565" class="src_link" title="app/helpers/admin/users_helper.rb">app/helpers/admin/users_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">71</td>
            <td class="cell--number">50</td>
            <td class="cell--number">0</td>
            <td class="cell--number">50</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#c11927e86c4c0fda4a3b2a57fe8e28deab663c66" class="src_link" title="app/helpers/application_helper.rb">app/helpers/application_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">534</td>
            <td class="cell--number">384</td>
            <td class="cell--number">0</td>
            <td class="cell--number">384</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#7154fa4a212c06b52eb83dcd0d4eac77ba0c9d45" class="src_link" title="app/helpers/authentications_helper.rb">app/helpers/authentications_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">9</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#950f1bd5a4a706063ff453dc64bcc57736c48574" class="src_link" title="app/helpers/campaigns_helper.rb">app/helpers/campaigns_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">36</td>
            <td class="cell--number">22</td>
            <td class="cell--number">0</td>
            <td class="cell--number">22</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#3fe902205f00e2135ddd23764d1a7acf40717e60" class="src_link" title="app/helpers/comments_helper.rb">app/helpers/comments_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">13</td>
            <td class="cell--number">6</td>
            <td class="cell--number">0</td>
            <td class="cell--number">6</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#dc6f6ee8e644a18b2c32518404a4c5e0e284c7d3" class="src_link" title="app/helpers/contacts_helper.rb">app/helpers/contacts_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">21</td>
            <td class="cell--number">12</td>
            <td class="cell--number">0</td>
            <td class="cell--number">12</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#6ed067454c5da284c2e66e80fe349aedbad390bc" class="src_link" title="app/helpers/emails_helper.rb">app/helpers/emails_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">9</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#f0361ca5aedfe5c3781c609034fd3ca035c9e99f" class="src_link" title="app/helpers/fields_helper.rb">app/helpers/fields_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">9</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#c638742ade6584593069543b6b0533da884a74d1" class="src_link" title="app/helpers/groups_helper.rb">app/helpers/groups_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">9</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#cdf8ff408a41519a5173c6e552e7e2288b8d6f8c" class="src_link" title="app/helpers/home_helper.rb">app/helpers/home_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">68</td>
            <td class="cell--number">49</td>
            <td class="cell--number">0</td>
            <td class="cell--number">49</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#1095a84f5dcc0522d2c94e2efd3093f806e70f58" class="src_link" title="app/helpers/javascript_helper.rb">app/helpers/javascript_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">37</td>
            <td class="cell--number">9</td>
            <td class="cell--number">0</td>
            <td class="cell--number">9</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#5e1a41ef2c03d310603bce8537aa0e823c104c5f" class="src_link" title="app/helpers/leads_helper.rb">app/helpers/leads_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">86</td>
            <td class="cell--number">57</td>
            <td class="cell--number">0</td>
            <td class="cell--number">57</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#db404918440086aa04300998e312500e1d3dbcbe" class="src_link" title="app/helpers/lists_helper.rb">app/helpers/lists_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">9</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#767ab31a97bf4d62ebc4fa7cd4f493be03e02bfb" class="src_link" title="app/helpers/opportunities_helper.rb">app/helpers/opportunities_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">92</td>
            <td class="cell--number">65</td>
            <td class="cell--number">0</td>
            <td class="cell--number">65</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#ccb09cb3fdf22f1a0cf5288a59c1daf7f1a2d9d0" class="src_link" title="app/helpers/passwords_helper.rb">app/helpers/passwords_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">9</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#332505e0382a8c99957cf4c90b33956f5ac8ed23" class="src_link" title="app/helpers/remote_link_pagination_helper.rb">app/helpers/remote_link_pagination_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">15</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#3a43a8538cdf796ca62ef5fbbc63abbb4287de7c" class="src_link" title="app/helpers/tags_helper.rb">app/helpers/tags_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">31</td>
            <td class="cell--number">21</td>
            <td class="cell--number">0</td>
            <td class="cell--number">21</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#7458f999a7eda6ff016b569506abf849663c62b8" class="src_link" title="app/helpers/tasks_helper.rb">app/helpers/tasks_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">141</td>
            <td class="cell--number">106</td>
            <td class="cell--number">0</td>
            <td class="cell--number">106</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#b7ee12dc01ce7942093e03fa6f22056464dea569" class="src_link" title="app/helpers/users_helper.rb">app/helpers/users_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">35</td>
            <td class="cell--number">24</td>
            <td class="cell--number">0</td>
            <td class="cell--number">24</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#c19f7fb1c0a6e88e9ef880b918bf7061bf09a584" class="src_link" title="app/helpers/versions_helper.rb">app/helpers/versions_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">34</td>
            <td class="cell--number">22</td>
            <td class="cell--number">0</td>
            <td class="cell--number">22</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Jobs">
  <h2>
    <span class="group_name">Jobs</span>
    (<span class="covered_percent">
      <span class="green">
  100.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Jobs"></a>

  <div>
    <b>0</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>0</b> relevant lines,
    <span class="green"><b>0</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed. </span>
    (<span class="green">
  100.0%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Libraries">
  <h2>
    <span class="group_name">Libraries</span>
    (<span class="covered_percent">
      <span class="red">
  21.18%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         2.22
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Libraries"></a>

  <div>
    <b>34</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>1001</b> relevant lines,
    <span class="green"><b>212</b> lines covered</span> and
    <span class="red"><b>789</b> lines missed. </span>
    (<span class="red">
  21.18%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#3caacf91941ed11988fdd4c4377e0cf9e8dcd161" class="src_link" title="lib/fat_free_crm.rb">lib/fat_free_crm.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">58</td>
            <td class="cell--number">37</td>
            <td class="cell--number">0</td>
            <td class="cell--number">37</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#66aa9776f777a4cbda1adb9c6fa354907cdb15d0" class="src_link" title="lib/fat_free_crm/callback.rb">lib/fat_free_crm/callback.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">146</td>
            <td class="cell--number">83</td>
            <td class="cell--number">0</td>
            <td class="cell--number">83</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#7beadb898c0fd7f17fe6541d40ca5fbb0143c3d1" class="src_link" title="lib/fat_free_crm/comment_extensions.rb">lib/fat_free_crm/comment_extensions.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">28</td>
            <td class="cell--number">18</td>
            <td class="cell--number">0</td>
            <td class="cell--number">18</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#23538a0bb46d0666e3000c361b5c1b8342177832" class="src_link" title="lib/fat_free_crm/core_ext.rb">lib/fat_free_crm/core_ext.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">8</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#9565eb831e551260a15b9522cba6326aa5aa48ea" class="src_link" title="lib/fat_free_crm/core_ext/alias_method_chain.rb">lib/fat_free_crm/core_ext/alias_method_chain.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">25</td>
            <td class="cell--number">18</td>
            <td class="cell--number">0</td>
            <td class="cell--number">18</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#eabfe41b758964aa346c457317b1a0e048448fdb" class="src_link" title="lib/fat_free_crm/core_ext/nil.rb">lib/fat_free_crm/core_ext/nil.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">16</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#95af1b965979017afaa8d781e4a48bc5d88d0ddd" class="src_link" title="lib/fat_free_crm/core_ext/string.rb">lib/fat_free_crm/core_ext/string.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">50</td>
            <td class="cell--number">31</td>
            <td class="cell--number">0</td>
            <td class="cell--number">31</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#bd4c731b7c154a70f8c7630cf3729ca08c967a6d" class="src_link" title="lib/fat_free_crm/custom_fields.rb">lib/fat_free_crm/custom_fields.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">14</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#bf15d31f2eaba8e56b5e13fa7f2482599b624b48" class="src_link" title="lib/fat_free_crm/engine.rb">lib/fat_free_crm/engine.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">34</td>
            <td class="cell--number">23</td>
            <td class="cell--number">0</td>
            <td class="cell--number">23</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#0542703a1a97575dc6845405325e6485a8030181" class="src_link" title="lib/fat_free_crm/errors.rb">lib/fat_free_crm/errors.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">31</td>
            <td class="cell--number">15</td>
            <td class="cell--number">0</td>
            <td class="cell--number">15</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#df721cab87c653d1cb79ccf5f81ce55e1ec3c522" class="src_link" title="lib/fat_free_crm/exceptions.rb">lib/fat_free_crm/exceptions.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">24</td>
            <td class="cell--number">13</td>
            <td class="cell--number">0</td>
            <td class="cell--number">13</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#9ad0382c18bbe1348e24a2b869af30d4b8ef9454" class="src_link" title="lib/fat_free_crm/export_csv.rb">lib/fat_free_crm/export_csv.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">36</td>
            <td class="cell--number">23</td>
            <td class="cell--number">0</td>
            <td class="cell--number">23</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#9b9cfe0fb6583f8f1b68d605a80e76b50c522750" class="src_link" title="lib/fat_free_crm/exportable.rb">lib/fat_free_crm/exportable.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">51</td>
            <td class="cell--number">38</td>
            <td class="cell--number">0</td>
            <td class="cell--number">38</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#50c1a49de6a132aa0097d700103676abe61e70e5" class="src_link" title="lib/fat_free_crm/fields.rb">lib/fat_free_crm/fields.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">94</td>
            <td class="cell--number">67</td>
            <td class="cell--number">0</td>
            <td class="cell--number">67</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#36f4686c647fb03c839a62065a68d6b854a65286" class="src_link" title="lib/fat_free_crm/gem_dependencies.rb">lib/fat_free_crm/gem_dependencies.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">41</td>
            <td class="cell--number">32</td>
            <td class="cell--number">0</td>
            <td class="cell--number">32</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#6bab3c2fed05643752635b4246c2f3be8b015ba7" class="src_link" title="lib/fat_free_crm/gem_ext.rb">lib/fat_free_crm/gem_ext.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">10</td>
            <td class="cell--number">3</td>
            <td class="cell--number">0</td>
            <td class="cell--number">3</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#abd7e18c9e9262b070bd907eca20b2d8d3568f23" class="src_link" title="lib/fat_free_crm/gem_ext/action_controller/base.rb">lib/fat_free_crm/gem_ext/action_controller/base.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">18</td>
            <td class="cell--number">7</td>
            <td class="cell--number">0</td>
            <td class="cell--number">7</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#0505a8eb292ed1925cea6eb4bf691726f4fc0469" class="src_link" title="lib/fat_free_crm/gem_ext/active_support/buffered_logger.rb">lib/fat_free_crm/gem_ext/active_support/buffered_logger.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">19</td>
            <td class="cell--number">10</td>
            <td class="cell--number">0</td>
            <td class="cell--number">10</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#0b832f4045d41d7cc62cc3b48f42d8f721527457" class="src_link" title="lib/fat_free_crm/gem_ext/rails/engine.rb">lib/fat_free_crm/gem_ext/rails/engine.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">16</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#7add5f39b722a45897a49982a5af878689281768" class="src_link" title="lib/fat_free_crm/gem_ext/rake/task.rb">lib/fat_free_crm/gem_ext/rake/task.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">17</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#f21d226db5895b026180a2823d8437ba9103aee2" class="src_link" title="lib/fat_free_crm/i18n.rb">lib/fat_free_crm/i18n.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">44</td>
            <td class="cell--number">24</td>
            <td class="cell--number">0</td>
            <td class="cell--number">24</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#482760fcdb86187e2b5c6b52c2d0acc7f040ea86" class="src_link" title="lib/fat_free_crm/load_settings.rb">lib/fat_free_crm/load_settings.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">20</td>
            <td class="cell--number">7</td>
            <td class="cell--number">0</td>
            <td class="cell--number">7</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#b7c78b9b641a30d2008fbcf801789a4d1afff272" class="src_link" title="lib/fat_free_crm/mail_processor/base.rb">lib/fat_free_crm/mail_processor/base.rb</a></td>
            <td class="red strong cell--number t-file__coverage">73.91 %</td>
            <td class="cell--number">230</td>
            <td class="cell--number">115</td>
            <td class="cell--number">85</td>
            <td class="cell--number">30</td>
            <td class="cell--number">12.71</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#6ac460522ef46880505eedc0d4cfa80f3e729b1d" class="src_link" title="lib/fat_free_crm/mail_processor/comment_replies.rb">lib/fat_free_crm/mail_processor/comment_replies.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">72</td>
            <td class="cell--number">25</td>
            <td class="cell--number">25</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.48</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#93695a8cb6e0ec385a373c23d82bd05c176021d9" class="src_link" title="lib/fat_free_crm/mail_processor/dropbox.rb">lib/fat_free_crm/mail_processor/dropbox.rb</a></td>
            <td class="green strong cell--number t-file__coverage">94.44 %</td>
            <td class="cell--number">265</td>
            <td class="cell--number">108</td>
            <td class="cell--number">102</td>
            <td class="cell--number">6</td>
            <td class="cell--number">6.67</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#1014b6cd8b7647688a9e96c38b95ef852ff4f788" class="src_link" title="lib/fat_free_crm/permissions.rb">lib/fat_free_crm/permissions.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">97</td>
            <td class="cell--number">63</td>
            <td class="cell--number">0</td>
            <td class="cell--number">63</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#084273e394b2d1ab056a3a4104b8e4fe1e9edaaa" class="src_link" title="lib/fat_free_crm/renderers.rb">lib/fat_free_crm/renderers.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">13</td>
            <td class="cell--number">6</td>
            <td class="cell--number">0</td>
            <td class="cell--number">6</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#db6abb78a47bb3596b3f632b9aad9284e91ee632" class="src_link" title="lib/fat_free_crm/secret_token_generator.rb">lib/fat_free_crm/secret_token_generator.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">61</td>
            <td class="cell--number">35</td>
            <td class="cell--number">0</td>
            <td class="cell--number">35</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#aef9aa5ef9133724b554da227999886872c593f9" class="src_link" title="lib/fat_free_crm/sortable.rb">lib/fat_free_crm/sortable.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">45</td>
            <td class="cell--number">25</td>
            <td class="cell--number">0</td>
            <td class="cell--number">25</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#7ed19853aaad3a9eba50907f7f698c735bd9f604" class="src_link" title="lib/fat_free_crm/tabs.rb">lib/fat_free_crm/tabs.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">25</td>
            <td class="cell--number">14</td>
            <td class="cell--number">0</td>
            <td class="cell--number">14</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#356957b8f9616bf57c328b3ac532c34083832ee0" class="src_link" title="lib/fat_free_crm/version.rb">lib/fat_free_crm/version.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">17</td>
            <td class="cell--number">9</td>
            <td class="cell--number">0</td>
            <td class="cell--number">9</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#b943c4a0d54efd0a691865a504111d9ca93b1838" class="src_link" title="lib/fat_free_crm/view_factory.rb">lib/fat_free_crm/view_factory.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">83</td>
            <td class="cell--number">42</td>
            <td class="cell--number">0</td>
            <td class="cell--number">42</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#3b574877c1cb7cff079514fb8bd5528a8c951700" class="src_link" title="lib/gravatar_image_tag.rb">lib/gravatar_image_tag.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">60</td>
            <td class="cell--number">46</td>
            <td class="cell--number">0</td>
            <td class="cell--number">46</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#f7e9bd413e4a51cdb4fff313c0b2e0dbe2f5aed9" class="src_link" title="lib/missing_translation_detector.rb">lib/missing_translation_detector.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">53</td>
            <td class="cell--number">35</td>
            <td class="cell--number">0</td>
            <td class="cell--number">35</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Ungrouped">
  <h2>
    <span class="group_name">Ungrouped</span>
    (<span class="covered_percent">
      <span class="red">
  0.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Ungrouped"></a>

  <div>
    <b>4</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>80</b> relevant lines,
    <span class="green"><b>0</b> lines covered</span> and
    <span class="red"><b>80</b> lines missed. </span>
    (<span class="red">
  0.0%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#756519ed6f79b62531f65ea58fe5a3623c7745b9" class="src_link" title="app/inputs/date_pair_input.rb">app/inputs/date_pair_input.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">67</td>
            <td class="cell--number">38</td>
            <td class="cell--number">0</td>
            <td class="cell--number">38</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#39d79c838240be884b4de1b484f0d5381a649de7" class="src_link" title="app/inputs/date_time_input.rb">app/inputs/date_time_input.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">38</td>
            <td class="cell--number">23</td>
            <td class="cell--number">0</td>
            <td class="cell--number">23</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#ee8442d0521c93a18dae4f7c6915401c6c2a10a0" class="src_link" title="app/inputs/datetime_pair_input.rb">app/inputs/datetime_pair_input.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">27</td>
            <td class="cell--number">13</td>
            <td class="cell--number">0</td>
            <td class="cell--number">13</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#fcf410a573759741145f518d877c7b0a889db93c" class="src_link" title="app/inputs/text_input.rb">app/inputs/text_input.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">14</td>
            <td class="cell--number">6</td>
            <td class="cell--number">0</td>
            <td class="cell--number">6</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
      </div>

      <div id="footer">
        Generated by <a href="https://github.com/simplecov-ruby/simplecov">simplecov</a> v0.22.0
        and simplecov-html v0.12.3<br/>
        using RSpec
      </div>

      <div class="source_files">
      
        <div class="source_table" id="81e6fa94eb7b6a932892d3a5ad9e6cc023b874a8">
  <div class="header">
    <h3>app/controllers/admin/application_controller.rb</h3>
    <h4>
      <span class="yellow">
  85.71%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>14</b> relevant lines.
      <span class="green"><b>12</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            <span class="hits">1</span>
            

            

            <code class="ruby">class Admin::ApplicationController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            <span class="hits">1</span>
            

            

            <code class="ruby">  before_action :require_admin_user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="11">
            <span class="hits">1</span>
            

            

            <code class="ruby">  layout &quot;admin/application&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            <span class="hits">1</span>
            

            

            <code class="ruby">  helper &quot;admin/field_groups&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">  # Autocomplete handler for all admin controllers.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def auto_complete</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="17">
            <span class="hits">3</span>
            

            

            <code class="ruby">    @query = params[:term]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="18">
            <span class="hits">3</span>
            

            

            <code class="ruby">    @auto_complete = klass.text_search(@query).limit(10)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="19">
            <span class="hits">3</span>
            

            

            <code class="ruby">    render partial: &#39;auto_complete&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="22">
            <span class="hits">1</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="25">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def require_admin_user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="26">
            <span class="hits">30</span>
            

            

            <code class="ruby">    authenticate_user!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="27">
            <span class="hits">30</span>
            

            

            <code class="ruby">    unless current_user&amp;.admin?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">      flash[:notice] = t(:msg_require_admin)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            
            

            

            <code class="ruby">      redirect_to root_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="af5666a45b3f9716d12691cd519c6c67cf560825">
  <div class="header">
    <h3>app/controllers/admin/field_groups_controller.rb</h3>
    <h4>
      <span class="red">
  36.67%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>30</b> relevant lines.
      <span class="green"><b>11</b> lines covered</span> and
      <span class="red"><b>19</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            <span class="hits">1</span>
            

            

            <code class="ruby">class Admin::FieldGroupsController &lt; Admin::ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            <span class="hits">1</span>
            

            

            <code class="ruby">  helper &#39;admin/fields&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">  # GET /admin/field_groups/new</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">  # GET /admin/field_groups/new.xml                                        AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="14">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def new</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">    @field_group = FieldGroup.new(klass_name: params[:klass_name])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">    respond_with(@field_group)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">  # GET /admin/field_groups/1/edit                                         AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="22">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def edit</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">    @field_group = FieldGroup.find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            
            

            

            <code class="ruby">    respond_with(@field_group)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby">  # POST /admin/field_groups</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby">  # POST /admin/field_groups.xml                                           AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="31">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            
            

            

            <code class="ruby">    @field_group = FieldGroup.create(field_group_params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            
            

            

            <code class="ruby">    respond_with(@field_group)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            
            

            

            <code class="ruby">  # PUT /admin/field_groups/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            
            

            

            <code class="ruby">  # PUT /admin/field_groups/1.xml                                          AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="40">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def update</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            
            

            

            <code class="ruby">    @field_group = FieldGroup.find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="42">
            
            

            

            <code class="ruby">    @field_group.update(field_group_params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="44">
            
            

            

            <code class="ruby">    respond_with(@field_group)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            
            

            

            <code class="ruby">  # DELETE /admin/field_groups/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            
            

            

            <code class="ruby">  # DELETE /admin/field_groups/1.xml                                       AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="50">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def destroy</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            
            

            

            <code class="ruby">    @field_group = FieldGroup.find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="52">
            
            

            

            <code class="ruby">    @field_group.destroy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="54">
            
            

            

            <code class="ruby">    respond_with(@field_group)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            
            

            

            <code class="ruby">  # POST /admin/field_groups/sort</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="59">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def sort</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="60">
            
            

            

            <code class="ruby">    asset = params[:asset]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="61">
            
            

            

            <code class="ruby">    field_group_ids = params[&quot;#{asset}_field_groups&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="63">
            
            

            

            <code class="ruby">    field_group_ids.each_with_index do |id, index|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="64">
            
            

            

            <code class="ruby">      FieldGroup.where(id: id).update_all(position: index + 1)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="67">
            
            

            

            <code class="ruby">    render nothing: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            
            

            

            <code class="ruby">  # GET /admin/field_groups/1/confirm                                      AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="72">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def confirm</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="73">
            
            

            

            <code class="ruby">    @field_group = FieldGroup.find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="76">
            <span class="hits">1</span>
            

            

            <code class="ruby">  protected</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="78">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def field_group_params</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="79">
            
            

            

            <code class="ruby">    params.require(:field_group).permit(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            
            

            

            <code class="ruby">      :name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            
            

            

            <code class="ruby">      :label,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            
            

            

            <code class="ruby">      :position,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            
            

            

            <code class="ruby">      :hint,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            
            

            

            <code class="ruby">      :tag_id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            
            

            

            <code class="ruby">      :klass_name</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            
            

            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="3a6f6b8e67df9fca029c9bfe0a5e8da4bb44969f">
  <div class="header">
    <h3>app/controllers/admin/fields_controller.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>73</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>73</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">class Admin::FieldsController &lt; Admin::ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  before_action :setup_current_tab, only: [:index]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">  load_resource except: %i[create subform]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">  # GET /fields</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">  # GET /fields.xml                                                      HTML</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">  # GET /fields/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">  # GET /fields/1.xml                                                    HTML</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">  def show</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">    respond_with(@field)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">  # GET /fields/new</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby">  # GET /fields/new.xml                                                  AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">  def new</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            
            

            

            <code class="ruby">    @field = Field.new</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            
            

            

            <code class="ruby">    respond_with(@field)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            
            

            

            <code class="ruby">  # GET /fields/1/edit                                                   AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            
            

            

            <code class="ruby">  def edit</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="36">
            
            

            

            <code class="ruby">    @field = Field.find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="37">
            
            

            

            <code class="ruby">    respond_with(@field)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="38">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            
            

            

            <code class="ruby">  # POST /fields</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            
            

            

            <code class="ruby">  # POST /fields.xml                                                     AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="43">
            
            

            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="44">
            
            

            

            <code class="ruby">    as = field_params[:as]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="45">
            
            

            

            <code class="ruby">    @field =</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            
            

            

            <code class="ruby">      if as.match?(/pair/)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="47">
            
            

            

            <code class="ruby">        CustomFieldPair.create_pair(params).first</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="48">
            
            

            

            <code class="ruby">      elsif as.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="49">
            
            

            

            <code class="ruby">        klass = find_class(Field.lookup_class(as))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="50">
            
            

            

            <code class="ruby">        klass.create(field_params)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="52">
            
            

            

            <code class="ruby">        Field.new(field_params).tap(&amp;:valid?)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="53">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="55">
            
            

            

            <code class="ruby">    respond_with(@field)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="56">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            
            

            

            <code class="ruby">  # PUT /fields/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            
            

            

            <code class="ruby">  # PUT /fields/1.xml                                                    AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="61">
            
            

            

            <code class="ruby">  def update</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="62">
            
            

            

            <code class="ruby">    if field_params[:as].match?(/pair/)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="63">
            
            

            

            <code class="ruby">      @field = CustomFieldPair.update_pair(params).first</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="64">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="65">
            
            

            

            <code class="ruby">      @field = Field.find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="66">
            
            

            

            <code class="ruby">      @field.update(field_params)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="67">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="69">
            
            

            

            <code class="ruby">    respond_with(@field)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="70">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            
            

            

            <code class="ruby">  # DELETE /fields/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            
            

            

            <code class="ruby">  # DELETE /fields/1.xml                                        HTML and AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="75">
            
            

            

            <code class="ruby">  def destroy</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="76">
            
            

            

            <code class="ruby">    @field = Field.find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="77">
            
            

            

            <code class="ruby">    @field.destroy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="79">
            
            

            

            <code class="ruby">    respond_with(@field)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="80">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            
            

            

            <code class="ruby">  # POST /fields/sort</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="84">
            
            

            

            <code class="ruby">  def sort</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="85">
            
            

            

            <code class="ruby">    field_group_id = params[:field_group_id].to_i</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="86">
            
            

            

            <code class="ruby">    field_ids = params[&quot;fields_field_group_#{field_group_id}&quot;] || []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="88">
            
            

            

            <code class="ruby">    field_ids.each_with_index do |id, index|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="89">
            
            

            

            <code class="ruby">      Field.where(id: id).update_all(position: index + 1, field_group_id: field_group_id)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="90">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="92">
            
            

            

            <code class="ruby">    render nothing: true</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="93">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            
            

            

            <code class="ruby">  # GET /fields/subform</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="97">
            
            

            

            <code class="ruby">  def subform</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="98">
            
            

            

            <code class="ruby">    field = field_params</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="99">
            
            

            

            <code class="ruby">    as = field[:as]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="101">
            
            

            

            <code class="ruby">    @field = if (id = field[:id]).present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="102">
            
            

            

            <code class="ruby">               Field.find(id).tap { |f| f.as = as }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="103">
            
            

            

            <code class="ruby">             else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="104">
            
            

            

            <code class="ruby">               field_group_id = field[:field_group_id]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="105">
            
            

            

            <code class="ruby">               klass = find_class(Field.lookup_class(as))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="106">
            
            

            

            <code class="ruby">               klass.new(field_group_id: field_group_id, as: as)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="107">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="109">
            
            

            

            <code class="ruby">    respond_with(@field) do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="110">
            
            

            

            <code class="ruby">      format.html { render partial: &#39;admin/fields/subform&#39; }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="111">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="112">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="114">
            
            

            

            <code class="ruby">  protected</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="116">
            
            

            

            <code class="ruby">  def field_params</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="117">
            
            

            

            <code class="ruby">    params[:field].permit!</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="118">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="120">
            
            

            

            <code class="ruby">  def setup_current_tab</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="121">
            
            

            

            <code class="ruby">    set_current_tab(&#39;admin/fields&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="122">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="123">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="a55c45cdd5b1ba1e0ddc411213dd3457086ccfb0">
  <div class="header">
    <h3>app/controllers/admin/groups_controller.rb</h3>
    <h4>
      <span class="red">
  76.92%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>26</b> relevant lines.
      <span class="green"><b>20</b> lines covered</span> and
      <span class="red"><b>6</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            <span class="hits">1</span>
            

            

            <code class="ruby">class Admin::GroupsController &lt; Admin::ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            <span class="hits">1</span>
            

            

            <code class="ruby">  before_action :setup_current_tab, only: %i[index show]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="11">
            <span class="hits">1</span>
            

            

            <code class="ruby">  load_resource</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">  # GET /groups</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="15">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            <span class="hits">1</span>
            

            

            <code class="ruby">    @groups = @groups.unscoped.paginate(page: params[:page])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">  # GET /groups/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="21">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def show</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">    respond_with(@group)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">  # GET /groups/new</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="27">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="28">
            <span class="hits">1</span>
            

            

            <code class="ruby">    respond_with(@group)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby">  # GET /groups/1/edit</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="33">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def edit</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            
            

            

            <code class="ruby">    respond_with(@group)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            
            

            

            <code class="ruby">  # POST /groups</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="39">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="40">
            <span class="hits">1</span>
            

            

            <code class="ruby">    @group.attributes = group_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="41">
            <span class="hits">1</span>
            

            

            <code class="ruby">    @group.save</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="43">
            <span class="hits">1</span>
            

            

            <code class="ruby">    respond_with(@group)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            
            

            

            <code class="ruby">  # PUT /groups/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="48">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def update</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="49">
            
            

            

            <code class="ruby">    @group.update(group_params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            
            

            

            <code class="ruby">    respond_with(@group)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            
            

            

            <code class="ruby">  # DELETE /groups/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="56">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def destroy</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="57">
            
            

            

            <code class="ruby">    @group.destroy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="59">
            
            

            

            <code class="ruby">    respond_with(@group)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="62">
            <span class="hits">1</span>
            

            

            <code class="ruby">  protected</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="64">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def group_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="65">
            <span class="hits">2</span>
            

            

            <code class="ruby">    params.require(:group).permit(:name, user_ids: [])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="68">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def setup_current_tab</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="69">
            <span class="hits">1</span>
            

            

            <code class="ruby">    set_current_tab(&#39;admin/groups&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="f99c1051813b417f31a7f99ee3656add788db22a">
  <div class="header">
    <h3>app/controllers/admin/plugins_controller.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>11</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>11</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">class Admin::PluginsController &lt; Admin::ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  before_action :setup_current_tab, only: [:index]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">  # GET /admin/plugins</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">  # GET /admin/plugins.xml</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">    @plugins = FatFreeCRM::Plugin.list</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">    respond_with(@plugins)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">  protected</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">  def setup_current_tab</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">    set_current_tab(&#39;admin/plugins&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="552b3d422be1a1965d50b78e3445b69147228f7a">
  <div class="header">
    <h3>app/controllers/admin/settings_controller.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>8</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>8</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">class Admin::SettingsController &lt; Admin::ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  before_action :setup_current_tab, only: [:index]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">  # GET /admin/settings</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">  # GET /admin/settings.xml</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">  def setup_current_tab</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">    set_current_tab(&#39;admin/settings&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="7d512ef398159d7a18d66a007d9368774ff737aa">
  <div class="header">
    <h3>app/controllers/admin/tags_controller.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>35</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>35</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">class Admin::TagsController &lt; Admin::ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  before_action :setup_current_tab, only: %i[index show]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">  load_resource</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">  # GET /admin/tags</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">  # GET /admin/tags.xml                                                   HTML</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">    @tags = Tag.all</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">    respond_with(@tags)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby">  # GET /admin/tags/new</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby">  # GET /admin/tags/new.xml                                               AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            
            

            

            <code class="ruby">  def new</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            
            

            

            <code class="ruby">    respond_with(@tag)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby">  # GET /admin/tags/1/edit                                                AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            
            

            

            <code class="ruby">  def edit</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            
            

            

            <code class="ruby">    @previous = Tag.find_by_id(detect_previous_id) || detect_previous_id if detect_previous_id</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            
            

            

            <code class="ruby">  # POST /admin/tags</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            
            

            

            <code class="ruby">  # POST /admin/tags.xml                                                  AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="37">
            
            

            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="38">
            
            

            

            <code class="ruby">    @tag.update(tag_params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            
            

            

            <code class="ruby">    respond_with(@tag)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            
            

            

            <code class="ruby">  # PUT /admin/tags/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            
            

            

            <code class="ruby">  # PUT /admin/tags/1.xml                                                 AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            
            

            

            <code class="ruby">  def update</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="47">
            
            

            

            <code class="ruby">    @tag.update(tag_params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="49">
            
            

            

            <code class="ruby">    respond_with(@tag)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="50">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            
            

            

            <code class="ruby">  # DELETE /admin/tags/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            
            

            

            <code class="ruby">  # DELETE /admin/tags/1.xml                                              AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="55">
            
            

            

            <code class="ruby">  def destroy</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="56">
            
            

            

            <code class="ruby">    @tag.destroy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="58">
            
            

            

            <code class="ruby">    respond_with(@tag)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="59">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            
            

            

            <code class="ruby">  # GET /admin/tags/1/confirm                                             AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="63">
            
            

            

            <code class="ruby">  def confirm</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="64">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="66">
            
            

            

            <code class="ruby">  protected</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="68">
            
            

            

            <code class="ruby">  def tag_params</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="69">
            
            

            

            <code class="ruby">    params.require(:tag).permit(:name, :taggings_count)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="70">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="72">
            
            

            

            <code class="ruby">  def setup_current_tab</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="73">
            
            

            

            <code class="ruby">    set_current_tab(&#39;admin/tags&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="74">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="75">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="6601dd165412b3194128219f9efc7302f46afab0">
  <div class="header">
    <h3>app/controllers/admin/users_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>55</b> relevant lines.
      <span class="green"><b>55</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            <span class="hits">1</span>
            

            

            <code class="ruby">class Admin::UsersController &lt; Admin::ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            <span class="hits">1</span>
            

            

            <code class="ruby">  before_action :setup_current_tab, only: %i[index show]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="11">
            <span class="hits">1</span>
            

            

            <code class="ruby">  load_resource except: [:create]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">  # GET /admin/users</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">  # GET /admin/users.xml                                                   HTML</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="17">
            <span class="hits">3</span>
            

            

            <code class="ruby">    @users = get_users(page: params[:page])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="18">
            <span class="hits">3</span>
            

            

            <code class="ruby">    respond_with(@users)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby">  # GET /admin/users/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby">  # GET /admin/users/1.xml</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="24">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def show</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="25">
            <span class="hits">1</span>
            

            

            <code class="ruby">    respond_with(@user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby">  # GET /admin/users/new</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby">  # GET /admin/users/new.xml                                               AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="31">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="32">
            <span class="hits">1</span>
            

            

            <code class="ruby">    respond_with(@user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            
            

            

            <code class="ruby">  # GET /admin/users/1/edit                                                AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="37">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def edit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="38">
            <span class="hits">3</span>
            

            

            <code class="ruby">    @previous = User.find_by_id(detect_previous_id) || detect_previous_id if detect_previous_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="40">
            <span class="hits">3</span>
            

            

            <code class="ruby">    respond_with(@user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            
            

            

            <code class="ruby">  # POST /admin/users</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            
            

            

            <code class="ruby">  # POST /admin/users.xml                                                  AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="46">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="47">
            <span class="hits">1</span>
            

            

            <code class="ruby">    @user = User.new(user_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="48">
            <span class="hits">1</span>
            

            

            <code class="ruby">    @user.suspend_if_needs_approval</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="49">
            <span class="hits">1</span>
            

            

            <code class="ruby">    @user.save</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="51">
            <span class="hits">1</span>
            

            

            <code class="ruby">    respond_with(@user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            
            

            

            <code class="ruby">  # PUT /admin/users/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            
            

            

            <code class="ruby">  # PUT /admin/users/1.xml                                                 AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="57">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="58">
            <span class="hits">4</span>
            

            

            <code class="ruby">    @user = User.find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="59">
            <span class="hits">4</span>
            

            

            <code class="ruby">    @user.attributes = user_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="60">
            <span class="hits">4</span>
            

            

            <code class="ruby">    @user.save</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="62">
            <span class="hits">4</span>
            

            

            <code class="ruby">    respond_with(@user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            
            

            

            <code class="ruby">  # GET /admin/users/1/confirm                                             AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="67">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def confirm</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="68">
            <span class="hits">1</span>
            

            

            <code class="ruby">    respond_with(@user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            
            

            

            <code class="ruby">  # DELETE /admin/users/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            
            

            

            <code class="ruby">  # DELETE /admin/users/1.xml                                              AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="74">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="75">
            <span class="hits">2</span>
            

            

            <code class="ruby">    flash[:warning] = t(:msg_cant_delete_user, @user.full_name) unless @user.destroyable?(current_user) &amp;&amp; @user.destroy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="77">
            <span class="hits">2</span>
            

            

            <code class="ruby">    respond_with(@user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            
            

            

            <code class="ruby">  # POST /users/auto_complete/query                                        AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            
            

            

            <code class="ruby">  # Handled by Admin::ApplicationController :auto_complete</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            
            

            

            <code class="ruby">  # PUT /admin/users/1/suspend</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            
            

            

            <code class="ruby">  # PUT /admin/users/1/suspend.xml                                         AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="87">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def suspend</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="88">
            <span class="hits">2</span>
            

            

            <code class="ruby">    @user.update_attribute(:suspended_at, Time.now) if @user != current_user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="90">
            <span class="hits">2</span>
            

            

            <code class="ruby">    respond_with(@user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            
            

            

            <code class="ruby">  # PUT /admin/users/1/reactivate</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            
            

            

            <code class="ruby">  # PUT /admin/users/1/reactivate.xml                                      AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="96">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def reactivate</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="97">
            <span class="hits">1</span>
            

            

            <code class="ruby">    @user.update_attribute(:suspended_at, nil)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="99">
            <span class="hits">1</span>
            

            

            <code class="ruby">    respond_with(@user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="102">
            <span class="hits">1</span>
            

            

            <code class="ruby">  protected</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="104">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def user_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="105">
            <span class="hits">5</span>
            

            

            <code class="ruby">    return {} unless params[:user]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="107">
            <span class="hits">4</span>
            

            

            <code class="ruby">    params[:user][:password_confirmation] = nil if params[:user][:password_confirmation].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="108">
            <span class="hits">4</span>
            

            

            <code class="ruby">    params[:user][:email].try(:strip!)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="109">
            <span class="hits">4</span>
            

            

            <code class="ruby">    params[:user][:alt_email].try(:strip!)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="111">
            <span class="hits">4</span>
            

            

            <code class="ruby">    params[:user].permit(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            
            

            

            <code class="ruby">      :admin,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            
            

            

            <code class="ruby">      :username,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            
            

            

            <code class="ruby">      :email,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            
            

            

            <code class="ruby">      :first_name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            
            

            

            <code class="ruby">      :last_name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            
            

            

            <code class="ruby">      :title,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            
            

            

            <code class="ruby">      :company,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            
            

            

            <code class="ruby">      :alt_email,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            
            

            

            <code class="ruby">      :phone,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            
            

            

            <code class="ruby">      :mobile,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            
            

            

            <code class="ruby">      :aim,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            
            

            

            <code class="ruby">      :yahoo,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            
            

            

            <code class="ruby">      :google,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            
            

            

            <code class="ruby">      :skype,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            
            

            

            <code class="ruby">      :password,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            
            

            

            <code class="ruby">      :password_confirmation,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            
            

            

            <code class="ruby">      group_ids: []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            
            

            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="132">
            <span class="hits">1</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="135">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def get_users(options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="136">
            <span class="hits">3</span>
            

            

            <code class="ruby">    self.current_page  = options[:page] if options[:page]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="137">
            <span class="hits">3</span>
            

            

            <code class="ruby">    self.current_query = params[:query] if params[:query]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="139">
            <span class="hits">3</span>
            

            

            <code class="ruby">    @search = klass.ransack(params[:q])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="140">
            <span class="hits">3</span>
            

            

            <code class="ruby">    @search.build_grouping unless @search.groupings.any?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="142">
            <span class="hits">3</span>
            

            

            <code class="ruby">    wants = request.format</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="143">
            <span class="hits">3</span>
            

            

            <code class="ruby">    scope = User.by_id</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="144">
            <span class="hits">3</span>
            

            

            <code class="ruby">    scope = scope.merge(@search.result)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="145">
            <span class="hits">3</span>
            

            

            <code class="ruby">    scope = scope.text_search(current_query)      if current_query.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="146">
            <span class="hits">3</span>
            

            

            <code class="ruby">    scope = scope.paginate(page: current_page) if wants.html? || wants.js? || wants.xml?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="147">
            <span class="hits">3</span>
            

            

            <code class="ruby">    scope</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="150">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def setup_current_tab</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="151">
            <span class="hits">4</span>
            

            

            <code class="ruby">    set_current_tab(&#39;admin/users&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="a033bec11bb44b7311642ace370f8394b23a0214">
  <div class="header">
    <h3>app/controllers/application_controller.rb</h3>
    <h4>
      <span class="yellow">
  87.5%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>144</b> relevant lines.
      <span class="green"><b>126</b> lines covered</span> and
      <span class="red"><b>18</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            <span class="hits">1</span>
            

            

            <code class="ruby">class ApplicationController &lt; ActionController::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            <span class="hits">1</span>
            

            

            <code class="ruby">  protect_from_forgery with: :exception</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="11">
            <span class="hits">1</span>
            

            

            <code class="ruby">  before_action :configure_devise_parameters, if: :devise_controller?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            <span class="hits">1</span>
            

            

            <code class="ruby">  before_action :authenticate_user!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            <span class="hits">1</span>
            

            

            <code class="ruby">  before_action :set_paper_trail_whodunnit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="14">
            <span class="hits">1</span>
            

            

            <code class="ruby">  before_action :set_context</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="15">
            <span class="hits">1</span>
            

            

            <code class="ruby">  before_action :clear_setting_cache</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            <span class="hits">1</span>
            

            

            <code class="ruby">  before_action :cors_preflight_check</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="868" data-linenumber="17">
            <span class="hits">868</span>
            

            

            <code class="ruby">  before_action { hook(:app_before_filter, self) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="731" data-linenumber="18">
            <span class="hits">731</span>
            

            

            <code class="ruby">  after_action { hook(:app_after_filter, self) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="19">
            <span class="hits">1</span>
            

            

            <code class="ruby">  after_action :cors_set_access_control_headers</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="21">
            <span class="hits">1</span>
            

            

            <code class="ruby">  helper_method :called_from_index_page?, :called_from_landing_page?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="22">
            <span class="hits">1</span>
            

            

            <code class="ruby">  helper_method :klass</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="24">
            <span class="hits">1</span>
            

            

            <code class="ruby">  respond_to :html, only: %i[index show auto_complete]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="25">
            <span class="hits">1</span>
            

            

            <code class="ruby">  respond_to :js</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="26">
            <span class="hits">1</span>
            

            

            <code class="ruby">  respond_to :json, :xml, except: :edit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="27">
            <span class="hits">1</span>
            

            

            <code class="ruby">  respond_to :atom, :csv, :rss, :xls, only: :index</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="29">
            <span class="hits">1</span>
            

            

            <code class="ruby">  rescue_from ActiveRecord::RecordNotFound, with: :respond_to_not_found</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="30">
            <span class="hits">1</span>
            

            

            <code class="ruby">  rescue_from CanCan::AccessDenied,         with: :respond_to_access_denied</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="32">
            <span class="hits">1</span>
            

            

            <code class="ruby">  include ERB::Util # to give us h and j methods</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            
            

            

            <code class="ruby">  # Common auto_complete handler for all core controllers.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="36">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def auto_complete</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="33" data-linenumber="37">
            <span class="hits">33</span>
            

            

            <code class="ruby">    @query = params[:term] || &#39;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="33" data-linenumber="38">
            <span class="hits">33</span>
            

            

            <code class="ruby">    @auto_complete = hook(:auto_complete, self, query: @query, user: current_user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="33" data-linenumber="39">
            <span class="hits">33</span>
            

            

            <code class="ruby">    if @auto_complete.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="33" data-linenumber="40">
            <span class="hits">33</span>
            

            

            <code class="ruby">      exclude_ids = auto_complete_ids_to_exclude(params[:related])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="33" data-linenumber="41">
            <span class="hits">33</span>
            

            

            <code class="ruby">      @auto_complete = klass.my(current_user).text_search(@query).ransack(id_not_in: exclude_ids).result.limit(10)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="43">
            
            

            

            <code class="ruby">      @auto_complete = @auto_complete.last</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="33" data-linenumber="46">
            <span class="hits">33</span>
            

            

            <code class="ruby">    session[:auto_complete] = controller_name.to_sym</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="33" data-linenumber="47">
            <span class="hits">33</span>
            

            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="48" data-linenumber="48">
            <span class="hits">48</span>
            

            

            <code class="ruby">      format.any(:js, :html) { render partial: &#39;auto_complete&#39; }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="33" data-linenumber="49">
            <span class="hits">33</span>
            

            

            <code class="ruby">      format.json do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="50">
            <span class="hits">18</span>
            

            

            <code class="ruby">        results = @auto_complete.map do |a|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            
            

            

            <code class="ruby">          {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="52">
            <span class="hits">20</span>
            

            

            <code class="ruby">            id: a.id,</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="53">
            <span class="hits">20</span>
            

            

            <code class="ruby">            text: a.respond_to?(:full_name) ? a.full_name : a.name</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            
            

            

            <code class="ruby">          }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="56">
            <span class="hits">18</span>
            

            

            <code class="ruby">        render json: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            
            

            

            <code class="ruby">          results: results</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            
            

            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            
            

            

            <code class="ruby">  # To deal with pre rails 6 users, reset the session and ask them to relogin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="64">
            <span class="hits">1</span>
            

            

            <code class="ruby">  rescue_from ArgumentError do |exception|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="65">
            
            

            

            <code class="ruby">    if request.format.html? &amp;&amp; exception.message == &quot;invalid base64&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="66">
            
            

            

            <code class="ruby">      request.reset_session</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="67">
            
            

            

            <code class="ruby">      redirect_to login_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="69">
            
            

            

            <code class="ruby">      raise(exception)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="73">
            <span class="hits">1</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            
            

            

            <code class="ruby">  #</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            
            

            

            <code class="ruby">  # In rails 3, the default behaviour for handle_unverified_request is to delete the session</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            
            

            

            <code class="ruby">  # and continue executing the request. However, we use cookie based authentication and need</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            
            

            

            <code class="ruby">  # to halt proceedings. In Rails 4, use &quot;protect_from_forgery with: :exception&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            
            

            

            <code class="ruby">  # See http://blog.nvisium.com/2014/09/understanding-protectfromforgery.html for more details.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="81">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def handle_unverified_request</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="82">
            
            

            

            <code class="ruby">    raise ActionController::InvalidAuthenticityToken</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            
            

            

            <code class="ruby">  #</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            
            

            

            <code class="ruby">  # Takes { related: &#39;campaigns/7&#39; } or { related: &#39;5&#39; }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            
            

            

            <code class="ruby">  #   and returns array of object ids that should be excluded from search</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            
            

            

            <code class="ruby">  #   assumes controller_name is a method on &#39;related&#39; class that returns a collection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="90">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def auto_complete_ids_to_exclude(related)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="39" data-linenumber="91">
            <span class="hits">39</span>
            

            

            <code class="ruby">    return [] if related.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="92">
            <span class="hits">5</span>
            

            

            <code class="ruby">    return [related.to_i].compact unless related.index(&#39;/&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="94">
            <span class="hits">4</span>
            

            

            <code class="ruby">    related_class, id = related.split(&#39;/&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="95">
            <span class="hits">4</span>
            

            

            <code class="ruby">    obj = related_class.classify.constantize.find_by_id(id)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="96">
            <span class="hits">4</span>
            

            

            <code class="ruby">    if obj&amp;.respond_to?(controller_name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="97">
            <span class="hits">2</span>
            

            

            <code class="ruby">      obj.send(controller_name).map(&amp;:id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="99">
            <span class="hits">2</span>
            

            

            <code class="ruby">      []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="104">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def klass</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="209" data-linenumber="105">
            <span class="hits">209</span>
            

            

            <code class="ruby">    @klass ||= controller_name.classify.constantize</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="109">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def clear_setting_cache</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="867" data-linenumber="110">
            <span class="hits">867</span>
            

            

            <code class="ruby">    Setting.clear_cache!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="114">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def set_context</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="869" data-linenumber="115">
            <span class="hits">869</span>
            

            

            <code class="ruby">    Time.zone = ActiveSupport::TimeZone[session[:timezone_offset]] if session[:timezone_offset]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="869" data-linenumber="116">
            <span class="hits">869</span>
            

            

            <code class="ruby">    if current_user.present? &amp;&amp; (locale = current_user.preference[:locale]).present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="117">
            
            

            

            <code class="ruby">      I18n.locale = locale</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="867" data-linenumber="118">
            <span class="hits">867</span>
            

            

            <code class="ruby">    elsif Setting.locale.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="867" data-linenumber="119">
            <span class="hits">867</span>
            

            

            <code class="ruby">      I18n.locale = Setting.locale</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="124">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def set_current_tab(tab = controller_name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="231" data-linenumber="125">
            <span class="hits">231</span>
            

            

            <code class="ruby">    @current_tab = tab</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="129">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def store_location</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="130">
            
            

            

            <code class="ruby">    session[:return_to] = request.fullpath</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="134">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def redirect_back_or_default(default)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="135">
            
            

            

            <code class="ruby">    redirect_to(session[:return_to] || default)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="136">
            
            

            

            <code class="ruby">    session[:return_to] = nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="140">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def can_signup?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="141">
            
            

            

            <code class="ruby">    User.can_signup?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="145">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def called_from_index_page?(controller = controller_name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="108" data-linenumber="146">
            <span class="hits">108</span>
            

            

            <code class="ruby">    request.referer =~ if controller != &quot;tasks&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="84" data-linenumber="147">
            <span class="hits">84</span>
            

            

            <code class="ruby">                         %r{/#{controller}$}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            
            

            

            <code class="ruby">                       else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="149">
            <span class="hits">24</span>
            

            

            <code class="ruby">                         /tasks\?*/</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            
            

            

            <code class="ruby">                       end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="154">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def called_from_landing_page?(controller = controller_name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="99" data-linenumber="155">
            <span class="hits">99</span>
            

            

            <code class="ruby">    request.referer =~ %r{/#{controller}/\w+}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            
            

            

            <code class="ruby">  # Proxy current page for any of the controllers by storing it in a session.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="160">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def current_page=(page)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="79" data-linenumber="161">
            <span class="hits">79</span>
            

            

            <code class="ruby">    p = page.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="79" data-linenumber="162">
            <span class="hits">79</span>
            

            

            <code class="ruby">    @current_page = session[:&quot;#{controller_name}_current_page&quot;] = (p.zero? ? 1 : p)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="163">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="165">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="166">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def current_page</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="172" data-linenumber="167">
            <span class="hits">172</span>
            

            

            <code class="ruby">    page = params[:page] || session[:&quot;#{controller_name}_current_page&quot;] || 1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="172" data-linenumber="168">
            <span class="hits">172</span>
            

            

            <code class="ruby">    @current_page = page.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="169">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            
            

            

            <code class="ruby">  # Proxy current search query for any of the controllers by storing it in a session.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="173">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def current_query=(query)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="152" data-linenumber="174">
            <span class="hits">152</span>
            

            

            <code class="ruby">    if session[:&quot;#{controller_name}_current_query&quot;].to_s != query.to_s # nil.to_s == &quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="175">
            <span class="hits">24</span>
            

            

            <code class="ruby">      self.current_page = params[:page] # reset paging otherwise results might be hidden, defaults to 1 if nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="176">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="152" data-linenumber="177">
            <span class="hits">152</span>
            

            

            <code class="ruby">    @current_query = session[:&quot;#{controller_name}_current_query&quot;] = query</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="178">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="179">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="181">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def current_query</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="182">
            <span class="hits">4</span>
            

            

            <code class="ruby">    @current_query = params[:query] || session[:&quot;#{controller_name}_current_query&quot;] || &#39;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="183">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="184">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="185">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="186">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def asset</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="104" data-linenumber="187">
            <span class="hits">104</span>
            

            

            <code class="ruby">    controller_name.singularize</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="188">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="189">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="190">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="191">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def respond_to_not_found(*_types)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="104" data-linenumber="192">
            <span class="hits">104</span>
            

            

            <code class="ruby">    flash[:warning] = t(:msg_asset_not_available, asset)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="193">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="104" data-linenumber="194">
            <span class="hits">104</span>
            

            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="115" data-linenumber="195">
            <span class="hits">115</span>
            

            

            <code class="ruby">      format.html { redirect_to(redirection_url) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="188" data-linenumber="196">
            <span class="hits">188</span>
            

            

            <code class="ruby">      format.js   { render plain: &#39;window.location.reload();&#39; }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="108" data-linenumber="197">
            <span class="hits">108</span>
            

            

            <code class="ruby">      format.json { render plain: flash[:warning], status: :not_found }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="109" data-linenumber="198">
            <span class="hits">109</span>
            

            

            <code class="ruby">      format.xml  { render xml: [flash[:warning]], status: :not_found }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="199">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="200">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="201">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="202">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="203">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def respond_to_related_not_found(related, *_types)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="204">
            <span class="hits">8</span>
            

            

            <code class="ruby">    asset = &quot;note&quot; if asset == &quot;comment&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="205">
            <span class="hits">8</span>
            

            

            <code class="ruby">    flash[:warning] = t(:msg_cant_create_related, asset: asset, related: related)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="206">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="207">
            <span class="hits">8</span>
            

            

            <code class="ruby">    url = send(&quot;#{related.pluralize}_path&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="208">
            <span class="hits">8</span>
            

            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="209">
            <span class="hits">8</span>
            

            

            <code class="ruby">      format.html { redirect_to(url) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="210">
            <span class="hits">16</span>
            

            

            <code class="ruby">      format.js   { render plain: %(window.location.href = &quot;#{url}&quot;;) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="211">
            <span class="hits">8</span>
            

            

            <code class="ruby">      format.json { render plain: flash[:warning], status: :not_found }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="212">
            <span class="hits">8</span>
            

            

            <code class="ruby">      format.xml  { render xml: [flash[:warning]], status: :not_found }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="213">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="214">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="215">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="216">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="217">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def respond_to_access_denied</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="218">
            <span class="hits">32</span>
            

            

            <code class="ruby">    flash[:warning] = t(:msg_not_authorized, default: &#39;You are not authorized to take this action.&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="219">
            <span class="hits">32</span>
            

            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="44" data-linenumber="220">
            <span class="hits">44</span>
            

            

            <code class="ruby">      format.html { redirect_to(redirection_url) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="52" data-linenumber="221">
            <span class="hits">52</span>
            

            

            <code class="ruby">      format.js   { render plain: &#39;window.location.reload();&#39; }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="222">
            <span class="hits">32</span>
            

            

            <code class="ruby">      format.json { render plain: flash[:warning], status: :unauthorized }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="223">
            <span class="hits">32</span>
            

            

            <code class="ruby">      format.xml  { render xml: [flash[:warning]], status: :unauthorized }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="224">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="225">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="226">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="227">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="228">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def redirection_url</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="229">
            
            

            

            <code class="ruby">    # Try to redirect somewhere sensible. Note: not all controllers have an index action</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="230">
            <span class="hits">23</span>
            

            

            <code class="ruby">    if current_user.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="231">
            <span class="hits">23</span>
            

            

            <code class="ruby">      respond_to?(:index) &amp;&amp; action_name != &#39;index&#39; ? { action: &#39;index&#39; } : root_url</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="232">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="233">
            
            

            

            <code class="ruby">      login_url</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="234">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="235">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="236">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="237">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def cors_set_access_control_headers</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="730" data-linenumber="238">
            <span class="hits">730</span>
            

            

            <code class="ruby">    headers[&#39;Access-Control-Allow-Origin&#39;] = &#39;*&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="730" data-linenumber="239">
            <span class="hits">730</span>
            

            

            <code class="ruby">    headers[&#39;Access-Control-Allow-Methods&#39;] = &#39;POST, GET, PUT, DELETE, OPTIONS&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="730" data-linenumber="240">
            <span class="hits">730</span>
            

            

            <code class="ruby">    headers[&#39;Access-Control-Allow-Headers&#39;] = &#39;Origin, Content-Type, Accept, Authorization, Token&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="730" data-linenumber="241">
            <span class="hits">730</span>
            

            

            <code class="ruby">    headers[&#39;Access-Control-Max-Age&#39;] = &quot;1728000&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="242">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="243">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="244">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def cors_preflight_check</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="867" data-linenumber="245">
            <span class="hits">867</span>
            

            

            <code class="ruby">    if request.method == &#39;OPTIONS&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="246">
            
            

            

            <code class="ruby">      headers[&#39;Access-Control-Allow-Origin&#39;] = &#39;*&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="247">
            
            

            

            <code class="ruby">      headers[&#39;Access-Control-Allow-Methods&#39;] = &#39;POST, GET, PUT, DELETE, OPTIONS&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="248">
            
            

            

            <code class="ruby">      headers[&#39;Access-Control-Allow-Headers&#39;] = &#39;X-Requested-With, X-Prototype-Version, Token&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="249">
            
            

            

            <code class="ruby">      headers[&#39;Access-Control-Max-Age&#39;] = &#39;1728000&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="250">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="251">
            
            

            

            <code class="ruby">      render plain: &#39;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="252">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="253">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="254">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="255">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def configure_devise_parameters</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="256">
            <span class="hits">30</span>
            

            

            <code class="ruby">    devise_parameter_sanitizer.permit(:sign_up) do |user_params|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="257">
            <span class="hits">2</span>
            

            

            <code class="ruby">      user_params.permit(:username, :email, :password, :password_confirmation)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="258">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="259">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="260">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="261">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def find_class(asset)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="115" data-linenumber="262">
            <span class="hits">115</span>
            

            

            <code class="ruby">    Rails.application.eager_load! unless Rails.application.config.cache_classes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="115" data-linenumber="263">
            <span class="hits">115</span>
            

            

            <code class="ruby">    classes = ActiveRecord::Base.descendants.map(&amp;:name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2727" data-linenumber="264">
            <span class="hits">2727</span>
            

            

            <code class="ruby">    find = classes.find { |m| m == asset.classify }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="115" data-linenumber="265">
            <span class="hits">115</span>
            

            

            <code class="ruby">    if find</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="115" data-linenumber="266">
            <span class="hits">115</span>
            

            

            <code class="ruby">      find.safe_constantize</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="267">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="268">
            
            

            

            <code class="ruby">      raise &quot;Unknown resource&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="269">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="270">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="271">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="272">
            
            

            

            <code class="ruby">  # In a number of places, we pass ?previous=(id) or ?previous=crm.find_form...</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="273">
            
            

            

            <code class="ruby">  # This method centralises all of the places we can pass in a previous param</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="274">
            
            

            

            <code class="ruby">  # and extracts an int ID, or nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="275">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def detect_previous_id</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="74" data-linenumber="276">
            <span class="hits">74</span>
            

            

            <code class="ruby">    return unless params[:previous]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="60" data-linenumber="277">
            <span class="hits">60</span>
            

            

            <code class="ruby">    return if params[:previous].start_with?(&quot;crm&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="278">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="59" data-linenumber="279">
            <span class="hits">59</span>
            

            

            <code class="ruby">    params[:previous].to_i</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="280">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="281">
            <span class="hits">1</span>
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_application_controller, self)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="282">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="4fab948a800ea00b60a180bd1a593bfc824ef80f">
  <div class="header">
    <h3>app/controllers/comments_controller.rb</h3>
    <h4>
      <span class="green">
  90.48%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>42</b> relevant lines.
      <span class="green"><b>38</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            <span class="hits">1</span>
            

            

            <code class="ruby">class CommentsController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">  # GET /comments</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby">  # GET /comments.json</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">  # GET /comments.xml</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="14">
            <span class="hits">30</span>
            

            

            <code class="ruby">    @commentable = extract_commentable_name(params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="15">
            <span class="hits">30</span>
            

            

            <code class="ruby">    if @commentable</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="16">
            <span class="hits">30</span>
            

            

            <code class="ruby">      @asset = find_class(@commentable).my(current_user).find(params[:&quot;#{@commentable}_id&quot;])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="17">
            <span class="hits">15</span>
            

            

            <code class="ruby">      @comments = @asset.comments.order(&quot;created_at DESC&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="19">
            <span class="hits">15</span>
            

            

            <code class="ruby">    respond_with(@comments) do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="20">
            <span class="hits">20</span>
            

            

            <code class="ruby">      format.html { redirect_to @asset }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby">  rescue ActiveRecord::RecordNotFound # Kicks in if @asset was not found.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="23">
            <span class="hits">15</span>
            

            

            <code class="ruby">    flash[:warning] = t(:msg_assets_not_available, &quot;notes&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="24">
            <span class="hits">15</span>
            

            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="25">
            <span class="hits">20</span>
            

            

            <code class="ruby">      format.html { redirect_to root_url }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="26">
            <span class="hits">20</span>
            

            

            <code class="ruby">      format.json { render plain: flash[:warning], status: :not_found }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="27">
            <span class="hits">20</span>
            

            

            <code class="ruby">      format.xml  { render plain: flash[:warning], status: :not_found }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby">  # GET /comments/1/edit                                                   AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="33">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def edit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="34">
            <span class="hits">5</span>
            

            

            <code class="ruby">    @comment = Comment.find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="36">
            <span class="hits">5</span>
            

            

            <code class="ruby">    model = find_class(@comment.commentable_type)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="37">
            <span class="hits">5</span>
            

            

            <code class="ruby">    id = @comment.commentable_id</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="38">
            <span class="hits">5</span>
            

            

            <code class="ruby">    respond_to_related_not_found(model.downcase) unless model.my(current_user).find_by_id(id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            
            

            

            <code class="ruby">  # POST /comments</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            
            

            

            <code class="ruby">  # POST /comments.json</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            
            

            

            <code class="ruby">  # POST /comments.xml                                                     AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="45">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="46">
            <span class="hits">11</span>
            

            

            <code class="ruby">    @comment = Comment.new(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            
            

            

            <code class="ruby">      comment_params.merge(user_id: current_user.id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            
            

            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            
            

            

            <code class="ruby">    # Make sure commentable object exists and is accessible to the current user.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="50">
            <span class="hits">11</span>
            

            

            <code class="ruby">    model = find_class(@comment.commentable_type)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="51">
            <span class="hits">11</span>
            

            

            <code class="ruby">    id = @comment.commentable_id</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="52">
            <span class="hits">11</span>
            

            

            <code class="ruby">    if model.my(current_user).find_by_id(id)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="53">
            <span class="hits">11</span>
            

            

            <code class="ruby">      @comment.save</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="54">
            <span class="hits">11</span>
            

            

            <code class="ruby">      respond_with(@comment)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="56">
            
            

            

            <code class="ruby">      respond_to_related_not_found(model.name.downcase)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            
            

            

            <code class="ruby">  # PUT /comments/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            
            

            

            <code class="ruby">  # PUT /comments/1.json</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            
            

            

            <code class="ruby">  # PUT /comments/1.xml                                          not implemened</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="64">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def update</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="65">
            
            

            

            <code class="ruby">    @comment = Comment.find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="66">
            
            

            

            <code class="ruby">    @comment.update(comment_params)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="67">
            
            

            

            <code class="ruby">    respond_with(@comment)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            
            

            

            <code class="ruby">  # DELETE /comments/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            
            

            

            <code class="ruby">  # DELETE /comments/1.json</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            
            

            

            <code class="ruby">  # DELETE /comments/1.xml                                      not implemented</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="74">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="75">
            <span class="hits">5</span>
            

            

            <code class="ruby">    @comment = Comment.find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="76">
            <span class="hits">5</span>
            

            

            <code class="ruby">    @comment.destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="77">
            <span class="hits">5</span>
            

            

            <code class="ruby">    respond_with(@comment)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="80">
            <span class="hits">1</span>
            

            

            <code class="ruby">  protected</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="82">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def comment_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="83">
            <span class="hits">11</span>
            

            

            <code class="ruby">    return {} unless params[:comment]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="85">
            <span class="hits">6</span>
            

            

            <code class="ruby">    params.require(:comment).permit(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            
            

            

            <code class="ruby">      :user_id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            
            

            

            <code class="ruby">      :commentable_type,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            
            

            

            <code class="ruby">      :commentable_id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            
            

            

            <code class="ruby">      :private,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            
            

            

            <code class="ruby">      :title,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            
            

            

            <code class="ruby">      :comment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            
            

            

            <code class="ruby">      :state</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            
            

            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="96">
            <span class="hits">1</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="99">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def extract_commentable_name(params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="60" data-linenumber="100">
            <span class="hits">60</span>
            

            

            <code class="ruby">    params.keys.detect { |x| x =~ /_id$/ }.try(:sub, /_id$/, &#39;&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="103">
            <span class="hits">1</span>
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_comments_controller, self)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="75c9fd4ba9b31be93dcf8c17ffd5a58cbde5fde3">
  <div class="header">
    <h3>app/controllers/confirmations_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>3</b> relevant lines.
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            <span class="hits">1</span>
            

            

            <code class="ruby">class ConfirmationsController &lt; Devise::ConfirmationsController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            <span class="hits">1</span>
            

            

            <code class="ruby">  respond_to :html</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            <span class="hits">1</span>
            

            

            <code class="ruby">  append_view_path &#39;app/views/devise&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="b069120845397193c5166a3079d24202f440e71b">
  <div class="header">
    <h3>app/controllers/emails_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>6</b> relevant lines.
      <span class="green"><b>6</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            <span class="hits">1</span>
            

            

            <code class="ruby">class EmailsController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">  # DELETE /emails/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby">  # DELETE /emails/1.json</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">  # DELETE /emails/1.xml                                                   AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="14">
            <span class="hits">5</span>
            

            

            <code class="ruby">    @email = Email.find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="15">
            <span class="hits">5</span>
            

            

            <code class="ruby">    @email.destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="16">
            <span class="hits">5</span>
            

            

            <code class="ruby">    respond_with(@email)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">  </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="19">
            <span class="hits">1</span>
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_emails_controller, self)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="68420f19d6cd2c6b6cec60b62d65ac24d11ad36e">
  <div class="header">
    <h3>app/controllers/entities/accounts_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>70</b> relevant lines.
      <span class="green"><b>70</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            <span class="hits">1</span>
            

            

            <code class="ruby">class AccountsController &lt; EntitiesController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            <span class="hits">1</span>
            

            

            <code class="ruby">  before_action :get_data_for_sidebar, only: :index</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">  # GET /accounts</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="14">
            <span class="hits">20</span>
            

            

            <code class="ruby">    @accounts = get_accounts(page: page_param, per_page: per_page_param)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="16">
            <span class="hits">20</span>
            

            

            <code class="ruby">    respond_with @accounts do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="17">
            <span class="hits">20</span>
            

            

            <code class="ruby">      format.xls { render layout: &#39;header&#39; }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="18">
            <span class="hits">20</span>
            

            

            <code class="ruby">      format.csv { render csv: @accounts }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby">  # GET /accounts/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby">  # AJAX /accounts/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="25">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def show</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="26">
            <span class="hits">8</span>
            

            

            <code class="ruby">    @stage = Setting.unroll(:opportunity_stage)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="27">
            <span class="hits">8</span>
            

            

            <code class="ruby">    @comment = Comment.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="28">
            <span class="hits">8</span>
            

            

            <code class="ruby">    @timeline = timeline(@account)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="29">
            <span class="hits">8</span>
            

            

            <code class="ruby">    respond_with(@account)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby">  # GET /accounts/new</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="35">
            <span class="hits">4</span>
            

            

            <code class="ruby">    @account.attributes = { user: current_user, access: Setting.default_access, assigned_to: nil }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="37">
            <span class="hits">4</span>
            

            

            <code class="ruby">    if params[:related]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="38">
            <span class="hits">1</span>
            

            

            <code class="ruby">      model, id = params[:related].split(&#39;_&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="39">
            <span class="hits">1</span>
            

            

            <code class="ruby">      instance_variable_set(&quot;@#{model}&quot;, model.classify.constantize.find(id))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="42">
            <span class="hits">4</span>
            

            

            <code class="ruby">    respond_with(@account)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            
            

            

            <code class="ruby">  # GET /accounts/1/edit                                                   AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="47">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def edit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="48">
            <span class="hits">5</span>
            

            

            <code class="ruby">    @previous = Account.my(current_user).find_by_id(detect_previous_id) || detect_previous_id if detect_previous_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="50">
            <span class="hits">5</span>
            

            

            <code class="ruby">    respond_with(@account)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            
            

            

            <code class="ruby">  # POST /accounts</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="55">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="56">
            <span class="hits">6</span>
            

            

            <code class="ruby">    @comment_body = params[:comment_body]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="57">
            <span class="hits">6</span>
            

            

            <code class="ruby">    respond_with(@account) do |_format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="58">
            <span class="hits">6</span>
            

            

            <code class="ruby">      if @account.save</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="59">
            <span class="hits">5</span>
            

            

            <code class="ruby">        @account.add_comment_by_user(@comment_body, current_user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            
            

            

            <code class="ruby">        # None: account can only be created from the Accounts index page, so we</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            
            

            

            <code class="ruby">        # don&#39;t have to check whether we&#39;re on the index page.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="62">
            <span class="hits">5</span>
            

            

            <code class="ruby">        @accounts = get_accounts</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="63">
            <span class="hits">5</span>
            

            

            <code class="ruby">        get_data_for_sidebar</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            
            

            

            <code class="ruby">  # PUT /accounts/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="70">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="71">
            <span class="hits">5</span>
            

            

            <code class="ruby">    respond_with(@account) do |_format|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            
            

            

            <code class="ruby">      # Must set access before user_ids, because user_ids= method depends on access value.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="73">
            <span class="hits">5</span>
            

            

            <code class="ruby">      @account.access = params[:account][:access] if params[:account][:access]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="74">
            <span class="hits">5</span>
            

            

            <code class="ruby">      get_data_for_sidebar if @account.update(resource_params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            
            

            

            <code class="ruby">  # DELETE /accounts/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="80">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="81">
            <span class="hits">6</span>
            

            

            <code class="ruby">    @account.destroy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="83">
            <span class="hits">6</span>
            

            

            <code class="ruby">    respond_with(@account) do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="84">
            <span class="hits">8</span>
            

            

            <code class="ruby">      format.html { respond_to_destroy(:html) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="85">
            <span class="hits">10</span>
            

            

            <code class="ruby">      format.js   { respond_to_destroy(:ajax) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            
            

            

            <code class="ruby">  # PUT /accounts/1/attach</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            
            

            

            <code class="ruby">  # Handled by EntitiesController :attach</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            
            

            

            <code class="ruby">  # PUT /accounts/1/discard</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            
            

            

            <code class="ruby">  # Handled by EntitiesController :discard</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            
            

            

            <code class="ruby">  # POST /accounts/auto_complete/query                                     AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            
            

            

            <code class="ruby">  # Handled by ApplicationController :auto_complete</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            
            

            

            <code class="ruby">  # GET /accounts/redraw                                                   AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="103">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def redraw</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="104">
            <span class="hits">3</span>
            

            

            <code class="ruby">    current_user.pref[:accounts_per_page] = per_page_param if per_page_param</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="105">
            <span class="hits">3</span>
            

            

            <code class="ruby">    current_user.pref[:accounts_sort_by]  = Account.sort_by_map[params[:sort_by]] if params[:sort_by]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="106">
            <span class="hits">3</span>
            

            

            <code class="ruby">    @accounts = get_accounts(page: 1, per_page: per_page_param)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="107">
            <span class="hits">3</span>
            

            

            <code class="ruby">    set_options # Refresh options</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="109">
            <span class="hits">3</span>
            

            

            <code class="ruby">    respond_with(@accounts) do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="110">
            <span class="hits">6</span>
            

            

            <code class="ruby">      format.js { render :index }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            
            

            

            <code class="ruby">  # POST /accounts/filter                                                  AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="116">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def filter</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="117">
            <span class="hits">2</span>
            

            

            <code class="ruby">    session[:accounts_filter] = params[:category]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="118">
            <span class="hits">2</span>
            

            

            <code class="ruby">    @accounts = get_accounts(page: 1, per_page: per_page_param)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="120">
            <span class="hits">2</span>
            

            

            <code class="ruby">    respond_with(@accounts) do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="121">
            <span class="hits">4</span>
            

            

            <code class="ruby">      format.js { render :index }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="125">
            <span class="hits">1</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="128">
            <span class="hits">1</span>
            

            

            <code class="ruby">  alias get_accounts get_list_of_records</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="131">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def list_includes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="33" data-linenumber="132">
            <span class="hits">33</span>
            

            

            <code class="ruby">    %i[pipeline_opportunities user tags].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="136">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def respond_to_destroy(method)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="137">
            <span class="hits">6</span>
            

            

            <code class="ruby">    if method == :ajax</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="138">
            <span class="hits">4</span>
            

            

            <code class="ruby">      @accounts = get_accounts</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="139">
            <span class="hits">4</span>
            

            

            <code class="ruby">      get_data_for_sidebar</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="140">
            <span class="hits">4</span>
            

            

            <code class="ruby">      if @accounts.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="141">
            <span class="hits">3</span>
            

            

            <code class="ruby">        @accounts = get_accounts(page: current_page - 1) if current_page &gt; 1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="142">
            <span class="hits">3</span>
            

            

            <code class="ruby">        render(:index) &amp;&amp; return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            
            

            

            <code class="ruby">      # At this point render default destroy.js</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            
            

            

            <code class="ruby">    else # :html request</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="146">
            <span class="hits">2</span>
            

            

            <code class="ruby">      self.current_page = 1 # Reset current page to 1 to make sure it stays valid.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="147">
            <span class="hits">2</span>
            

            

            <code class="ruby">      flash[:notice] = t(:msg_asset_deleted, @account.name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="148">
            <span class="hits">2</span>
            

            

            <code class="ruby">      redirect_to accounts_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="153">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def get_data_for_sidebar</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="33" data-linenumber="154">
            <span class="hits">33</span>
            

            

            <code class="ruby">    @account_category_total = HashWithIndifferentAccess[</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            
            

            

            <code class="ruby">                              Setting.account_category.map do |key|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="198" data-linenumber="156">
            <span class="hits">198</span>
            

            

            <code class="ruby">                                [key, Account.my(current_user).where(category: key.to_s).count]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            
            

            

            <code class="ruby">                              end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            
            

            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="33" data-linenumber="159">
            <span class="hits">33</span>
            

            

            <code class="ruby">    categorized = @account_category_total.values.sum</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="33" data-linenumber="160">
            <span class="hits">33</span>
            

            

            <code class="ruby">    @account_category_total[:all] = Account.my(current_user).count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="33" data-linenumber="161">
            <span class="hits">33</span>
            

            

            <code class="ruby">    @account_category_total[:other] = @account_category_total[:all] - categorized</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="163">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="164">
            <span class="hits">1</span>
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_accounts_controller, self)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="165">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="cd4fff59e15d17072ae179b526ac4fe99d7df51f">
  <div class="header">
    <h3>app/controllers/entities/campaigns_controller.rb</h3>
    <h4>
      <span class="yellow">
  87.91%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>91</b> relevant lines.
      <span class="green"><b>80</b> lines covered</span> and
      <span class="red"><b>11</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            <span class="hits">1</span>
            

            

            <code class="ruby">class CampaignsController &lt; EntitiesController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            <span class="hits">1</span>
            

            

            <code class="ruby">  before_action :get_data_for_sidebar, only: :index</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">  # GET /campaigns</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="14">
            <span class="hits">19</span>
            

            

            <code class="ruby">    @campaigns = get_campaigns(page: page_param, per_page: per_page_param)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="16">
            <span class="hits">19</span>
            

            

            <code class="ruby">    respond_with @campaigns do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="17">
            <span class="hits">19</span>
            

            

            <code class="ruby">      format.xls { render layout: &#39;header&#39; }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="18">
            <span class="hits">19</span>
            

            

            <code class="ruby">      format.csv { render csv: @campaigns }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby">  # GET /campaigns/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby">  # AJAX /campaigns/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby">  # XLS /campaigns/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">  # XLS /campaigns/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby">  # CSV /campaigns/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby">  # RSS /campaigns/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby">  # ATOM /campaigns/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="30">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def show</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="31">
            <span class="hits">7</span>
            

            

            <code class="ruby">    respond_with(@campaign) do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="32">
            <span class="hits">7</span>
            

            

            <code class="ruby">      format.html do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="33">
            <span class="hits">5</span>
            

            

            <code class="ruby">        @stage = Setting.unroll(:opportunity_stage)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="34">
            <span class="hits">5</span>
            

            

            <code class="ruby">        @comment = Comment.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="35">
            <span class="hits">5</span>
            

            

            <code class="ruby">        @timeline = timeline(@campaign)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="38">
            <span class="hits">7</span>
            

            

            <code class="ruby">      format.js do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            
            

            

            <code class="ruby">        @stage = Setting.unroll(:opportunity_stage)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            
            

            

            <code class="ruby">        @comment = Comment.new</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            
            

            

            <code class="ruby">        @timeline = timeline(@campaign)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="44">
            <span class="hits">7</span>
            

            

            <code class="ruby">      format.xls do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="45">
            
            

            

            <code class="ruby">        @leads = @campaign.leads</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            
            

            

            <code class="ruby">        render &#39;/leads/index&#39;, layout: &#39;header&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="49">
            <span class="hits">7</span>
            

            

            <code class="ruby">      format.csv do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="50">
            
            

            

            <code class="ruby">        render csv: @campaign.leads</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="53">
            <span class="hits">7</span>
            

            

            <code class="ruby">      format.rss do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="54">
            
            

            

            <code class="ruby">        @items  = &quot;leads&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="55">
            
            

            

            <code class="ruby">        @assets = @campaign.leads</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="58">
            <span class="hits">7</span>
            

            

            <code class="ruby">      format.atom do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="59">
            
            

            

            <code class="ruby">        @items  = &quot;leads&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="60">
            
            

            

            <code class="ruby">        @assets = @campaign.leads</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            
            

            

            <code class="ruby">  # GET /campaigns/new</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            
            

            

            <code class="ruby">  # GET /campaigns/new.json</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            
            

            

            <code class="ruby">  # GET /campaigns/new.xml                                                 AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="69">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="70">
            <span class="hits">4</span>
            

            

            <code class="ruby">    @campaign.attributes = { user: current_user, access: Setting.default_access, assigned_to: nil }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="72">
            <span class="hits">4</span>
            

            

            <code class="ruby">    if params[:related]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="73">
            <span class="hits">1</span>
            

            

            <code class="ruby">      model, id = params[:related].split(&#39;_&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="74">
            <span class="hits">1</span>
            

            

            <code class="ruby">      if related = model.classify.constantize.my(current_user).find_by_id(id)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="75">
            <span class="hits">1</span>
            

            

            <code class="ruby">        instance_variable_set(&quot;@#{model}&quot;, related)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="77">
            
            

            

            <code class="ruby">        respond_to_related_not_found(model) &amp;&amp; return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="81">
            <span class="hits">4</span>
            

            

            <code class="ruby">    respond_with(@campaign)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            
            

            

            <code class="ruby">  # GET /campaigns/1/edit                                                  AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="86">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def edit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="87">
            <span class="hits">5</span>
            

            

            <code class="ruby">    @previous = Campaign.my(current_user).find_by_id(detect_previous_id) || detect_previous_id if detect_previous_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="89">
            <span class="hits">5</span>
            

            

            <code class="ruby">    respond_with(@campaign)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            
            

            

            <code class="ruby">  # POST /campaigns</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="94">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="95">
            <span class="hits">6</span>
            

            

            <code class="ruby">    @comment_body = params[:comment_body]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="97">
            <span class="hits">6</span>
            

            

            <code class="ruby">    respond_with(@campaign) do |_format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="98">
            <span class="hits">6</span>
            

            

            <code class="ruby">      if @campaign.save</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="99">
            <span class="hits">5</span>
            

            

            <code class="ruby">        @campaign.add_comment_by_user(@comment_body, current_user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="100">
            <span class="hits">5</span>
            

            

            <code class="ruby">        @campaigns = get_campaigns</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="101">
            <span class="hits">5</span>
            

            

            <code class="ruby">        get_data_for_sidebar</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            
            

            

            <code class="ruby">  # PUT /campaigns/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="108">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="109">
            <span class="hits">5</span>
            

            

            <code class="ruby">    respond_with(@campaign) do |_format|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            
            

            

            <code class="ruby">      # Must set access before user_ids, because user_ids= method depends on access value.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="111">
            <span class="hits">5</span>
            

            

            <code class="ruby">      @campaign.access = resource_params[:access] if resource_params[:access]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="112">
            <span class="hits">5</span>
            

            

            <code class="ruby">      get_data_for_sidebar if @campaign.update(resource_params) &amp;&amp; called_from_index_page?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            
            

            

            <code class="ruby">  # DELETE /campaigns/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="118">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="119">
            <span class="hits">6</span>
            

            

            <code class="ruby">    @campaign.destroy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="121">
            <span class="hits">6</span>
            

            

            <code class="ruby">    respond_with(@campaign) do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="122">
            <span class="hits">8</span>
            

            

            <code class="ruby">      format.html { respond_to_destroy(:html) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="123">
            <span class="hits">10</span>
            

            

            <code class="ruby">      format.js   { respond_to_destroy(:ajax) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            
            

            

            <code class="ruby">  # PUT /campaigns/1/attach</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            
            

            

            <code class="ruby">  # Handled by EntitiesController :attach</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            
            

            

            <code class="ruby">  # PUT /campaigns/1/discard</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            
            

            

            <code class="ruby">  # Handled by EntitiesController :discard</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            
            

            

            <code class="ruby">  # POST /campaigns/auto_complete/query                                    AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            
            

            

            <code class="ruby">  # Handled by ApplicationController :auto_complete</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            
            

            

            <code class="ruby">  # GET /campaigns/redraw                                                  AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="141">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def redraw</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="142">
            <span class="hits">3</span>
            

            

            <code class="ruby">    current_user.pref[:campaigns_per_page] = per_page_param if per_page_param</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="143">
            <span class="hits">3</span>
            

            

            <code class="ruby">    current_user.pref[:campaigns_sort_by]  = Campaign.sort_by_map[params[:sort_by]] if params[:sort_by]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="144">
            <span class="hits">3</span>
            

            

            <code class="ruby">    @campaigns = get_campaigns(page: 1, per_page: per_page_param)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="145">
            <span class="hits">3</span>
            

            

            <code class="ruby">    set_options # Refresh options</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="147">
            <span class="hits">3</span>
            

            

            <code class="ruby">    respond_with(@campaigns) do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="148">
            <span class="hits">6</span>
            

            

            <code class="ruby">      format.js { render :index }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            
            

            

            <code class="ruby">  # POST /campaigns/filter                                                 AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="154">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def filter</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="155">
            <span class="hits">2</span>
            

            

            <code class="ruby">    session[:campaigns_filter] = params[:status]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="156">
            <span class="hits">2</span>
            

            

            <code class="ruby">    @campaigns = get_campaigns(page: 1, per_page: per_page_param)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="158">
            <span class="hits">2</span>
            

            

            <code class="ruby">    respond_with(@campaigns) do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="159">
            <span class="hits">4</span>
            

            

            <code class="ruby">      format.js { render :index }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="161">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="163">
            <span class="hits">1</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="165">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="166">
            <span class="hits">1</span>
            

            

            <code class="ruby">  alias get_campaigns get_list_of_records</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="167">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="168">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="169">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def list_includes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="170">
            <span class="hits">32</span>
            

            

            <code class="ruby">    %i[tags].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="173">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="174">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def respond_to_destroy(method)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="175">
            <span class="hits">6</span>
            

            

            <code class="ruby">    if method == :ajax</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="176">
            <span class="hits">4</span>
            

            

            <code class="ruby">      get_data_for_sidebar</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="177">
            <span class="hits">4</span>
            

            

            <code class="ruby">      @campaigns = get_campaigns</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="178">
            <span class="hits">4</span>
            

            

            <code class="ruby">      if @campaigns.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="179">
            <span class="hits">3</span>
            

            

            <code class="ruby">        @campaigns = get_campaigns(page: current_page - 1) if current_page &gt; 1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="180">
            <span class="hits">3</span>
            

            

            <code class="ruby">        render(:index) &amp;&amp; return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="181">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="182">
            
            

            

            <code class="ruby">      # At this point render destroy.js</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="183">
            
            

            

            <code class="ruby">    else # :html request</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="184">
            <span class="hits">2</span>
            

            

            <code class="ruby">      self.current_page = 1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="185">
            <span class="hits">2</span>
            

            

            <code class="ruby">      flash[:notice] = t(:msg_asset_deleted, @campaign.name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="186">
            <span class="hits">2</span>
            

            

            <code class="ruby">      redirect_to campaigns_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="187">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="188">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="189">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="190">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="191">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def get_data_for_sidebar</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="192">
            <span class="hits">29</span>
            

            

            <code class="ruby">    @campaign_status_total = HashWithIndifferentAccess[</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="193">
            
            

            

            <code class="ruby">                             all: Campaign.my(current_user).count,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="194">
            
            

            

            <code class="ruby">                             other: 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="195">
            
            

            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="196">
            <span class="hits">29</span>
            

            

            <code class="ruby">    Setting.campaign_status.each do |key|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="145" data-linenumber="197">
            <span class="hits">145</span>
            

            

            <code class="ruby">      @campaign_status_total[key] = 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="198">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="199">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="200">
            <span class="hits">29</span>
            

            

            <code class="ruby">    status_counts = Campaign.my(current_user).where(status: Setting.campaign_status).group(:status).count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="201">
            <span class="hits">29</span>
            

            

            <code class="ruby">    status_counts.each do |key, total|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="202">
            <span class="hits">30</span>
            

            

            <code class="ruby">      @campaign_status_total[key.to_sym] = total</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="203">
            <span class="hits">30</span>
            

            

            <code class="ruby">      @campaign_status_total[:other] -= total</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="204">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="205">
            <span class="hits">29</span>
            

            

            <code class="ruby">    @campaign_status_total[:other] += @campaign_status_total[:all]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="206">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="207">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="208">
            <span class="hits">1</span>
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_campaigns_controller, self)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="209">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="112920e7de4bf30babb1fc5310f335a989a5bf12">
  <div class="header">
    <h3>app/controllers/entities/contacts_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>74</b> relevant lines.
      <span class="green"><b>74</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            <span class="hits">1</span>
            

            

            <code class="ruby">class ContactsController &lt; EntitiesController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            <span class="hits">1</span>
            

            

            <code class="ruby">  before_action :get_accounts, only: %i[new create edit update]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">  # GET /contacts</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="14">
            <span class="hits">17</span>
            

            

            <code class="ruby">    @contacts = get_contacts(page: page_param, per_page: per_page_param)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="16">
            <span class="hits">17</span>
            

            

            <code class="ruby">    respond_with @contacts do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="17">
            <span class="hits">17</span>
            

            

            <code class="ruby">      format.xls { render layout: &#39;header&#39; }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="18">
            <span class="hits">17</span>
            

            

            <code class="ruby">      format.csv { render csv: @contacts }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby">  # GET /contacts/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby">  # AJAX /contacts/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="25">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def show</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="26">
            <span class="hits">7</span>
            

            

            <code class="ruby">    @stage = Setting.unroll(:opportunity_stage)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="27">
            <span class="hits">7</span>
            

            

            <code class="ruby">    @comment = Comment.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="28">
            <span class="hits">7</span>
            

            

            <code class="ruby">    @timeline = timeline(@contact)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="29">
            <span class="hits">7</span>
            

            

            <code class="ruby">    respond_with(@contact)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby">  # GET /contacts/new</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="35">
            <span class="hits">6</span>
            

            

            <code class="ruby">    @contact.attributes = { user: current_user, access: Setting.default_access, assigned_to: nil }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="36">
            <span class="hits">6</span>
            

            

            <code class="ruby">    @account = Account.new(user: current_user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="38">
            <span class="hits">6</span>
            

            

            <code class="ruby">    if params[:related]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="39">
            <span class="hits">3</span>
            

            

            <code class="ruby">      model, id = params[:related].split(&#39;_&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="40">
            <span class="hits">3</span>
            

            

            <code class="ruby">      if related = model.classify.constantize.my(current_user).find_by_id(id)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="41">
            <span class="hits">1</span>
            

            

            <code class="ruby">        instance_variable_set(&quot;@#{model}&quot;, related)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="43">
            <span class="hits">2</span>
            

            

            <code class="ruby">        respond_to_related_not_found(model) &amp;&amp; return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="47">
            <span class="hits">4</span>
            

            

            <code class="ruby">    respond_with(@contact)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            
            

            

            <code class="ruby">  # GET /contacts/1/edit                                                   AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="52">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def edit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="53">
            <span class="hits">6</span>
            

            

            <code class="ruby">    @account = @contact.account || Account.new(user: current_user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="54">
            <span class="hits">6</span>
            

            

            <code class="ruby">    @previous = Contact.my(current_user).find_by_id(detect_previous_id) || detect_previous_id if detect_previous_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="56">
            <span class="hits">6</span>
            

            

            <code class="ruby">    respond_with(@contact)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            
            

            

            <code class="ruby">  # POST /contacts</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="61">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="62">
            <span class="hits">9</span>
            

            

            <code class="ruby">    @comment_body = params[:comment_body]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="63">
            <span class="hits">9</span>
            

            

            <code class="ruby">    respond_with(@contact) do |_format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="64">
            <span class="hits">9</span>
            

            

            <code class="ruby">      if @contact.save_with_account_and_permissions(params.permit!)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="65">
            <span class="hits">5</span>
            

            

            <code class="ruby">        @contact.add_comment_by_user(@comment_body, current_user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="66">
            <span class="hits">5</span>
            

            

            <code class="ruby">        @contacts = get_contacts if called_from_index_page?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="68">
            <span class="hits">4</span>
            

            

            <code class="ruby">        @account = guess_related_account(params[:account][:id], request.referer, current_user) if params[:account]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="69">
            <span class="hits">4</span>
            

            

            <code class="ruby">        @opportunity = Opportunity.my(current_user).find(params[:opportunity]) unless params[:opportunity].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            
            

            

            <code class="ruby">  # PUT /contacts/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="76">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="77">
            <span class="hits">7</span>
            

            

            <code class="ruby">    respond_with(@contact) do |_format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="78">
            <span class="hits">7</span>
            

            

            <code class="ruby">      @account = @contact.account || Account.new(user: current_user) unless @contact.update_with_account_and_permissions(params.permit!)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            
            

            

            <code class="ruby">  # DELETE /contacts/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="84">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="85">
            <span class="hits">6</span>
            

            

            <code class="ruby">    @contact.destroy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="87">
            <span class="hits">6</span>
            

            

            <code class="ruby">    respond_with(@contact) do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="88">
            <span class="hits">8</span>
            

            

            <code class="ruby">      format.html { respond_to_destroy(:html) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="89">
            <span class="hits">10</span>
            

            

            <code class="ruby">      format.js   { respond_to_destroy(:ajax) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            
            

            

            <code class="ruby">  # PUT /contacts/1/attach</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            
            

            

            <code class="ruby">  # Handled by EntitiesController :attach</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            
            

            

            <code class="ruby">  # POST /contacts/1/discard</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            
            

            

            <code class="ruby">  # Handled by EntitiesController :discard</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            
            

            

            <code class="ruby">  # POST /contacts/auto_complete/query                                     AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            
            

            

            <code class="ruby">  # Handled by ApplicationController :auto_complete</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            
            

            

            <code class="ruby">  # GET /contacts/redraw                                                   AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="107">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def redraw</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="108">
            <span class="hits">4</span>
            

            

            <code class="ruby">    current_user.pref[:contacts_per_page] = per_page_param if per_page_param</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            
            

            

            <code class="ruby">    # Sorting and naming only: set the same option for Leads if the hasn&#39;t been set yet.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="111">
            <span class="hits">4</span>
            

            

            <code class="ruby">    if params[:sort_by]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="112">
            <span class="hits">4</span>
            

            

            <code class="ruby">      current_user.pref[:contacts_sort_by] = Contact.sort_by_map[params[:sort_by]]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="113">
            <span class="hits">4</span>
            

            

            <code class="ruby">      current_user.pref[:leads_sort_by] ||= Lead.sort_by_map[params[:sort_by]] if Lead.sort_by_fields.include?(params[:sort_by])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="115">
            <span class="hits">4</span>
            

            

            <code class="ruby">    if params[:naming]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="116">
            <span class="hits">3</span>
            

            

            <code class="ruby">      current_user.pref[:contacts_naming] = params[:naming]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="117">
            <span class="hits">3</span>
            

            

            <code class="ruby">      current_user.pref[:leads_naming] ||= params[:naming]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="120">
            <span class="hits">4</span>
            

            

            <code class="ruby">    @contacts = get_contacts(page: 1, per_page: per_page_param) # Start on the first page.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="121">
            <span class="hits">4</span>
            

            

            <code class="ruby">    set_options # Refresh options</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="123">
            <span class="hits">4</span>
            

            

            <code class="ruby">    respond_with(@contacts) do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="124">
            <span class="hits">8</span>
            

            

            <code class="ruby">      format.js { render :index }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="128">
            <span class="hits">1</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="131">
            <span class="hits">1</span>
            

            

            <code class="ruby">  alias get_contacts get_list_of_records</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="134">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def list_includes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="135">
            <span class="hits">24</span>
            

            

            <code class="ruby">    %i[account tags].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="139">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def get_accounts</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="140">
            <span class="hits">28</span>
            

            

            <code class="ruby">    @accounts = Account.my(current_user).order(&#39;name&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="143">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def set_options</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="144">
            <span class="hits">21</span>
            

            

            <code class="ruby">    super</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="145">
            <span class="hits">21</span>
            

            

            <code class="ruby">    @naming = (current_user.pref[:contacts_naming] || Contact.first_name_position) unless params[:cancel].true?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="149">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def respond_to_destroy(method)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="150">
            <span class="hits">6</span>
            

            

            <code class="ruby">    if method == :ajax</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="151">
            <span class="hits">4</span>
            

            

            <code class="ruby">      if called_from_index_page?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="152">
            <span class="hits">2</span>
            

            

            <code class="ruby">        @contacts = get_contacts</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="153">
            <span class="hits">2</span>
            

            

            <code class="ruby">        if @contacts.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="154">
            <span class="hits">2</span>
            

            

            <code class="ruby">          @contacts = get_contacts(page: current_page - 1) if current_page &gt; 1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="155">
            <span class="hits">2</span>
            

            

            <code class="ruby">          render(:index) &amp;&amp; return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="158">
            <span class="hits">2</span>
            

            

            <code class="ruby">        self.current_page = 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            
            

            

            <code class="ruby">      # At this point render destroy.js</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="161">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="162">
            <span class="hits">2</span>
            

            

            <code class="ruby">      self.current_page = 1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="163">
            <span class="hits">2</span>
            

            

            <code class="ruby">      flash[:notice] = t(:msg_asset_deleted, @contact.full_name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="164">
            <span class="hits">2</span>
            

            

            <code class="ruby">      redirect_to contacts_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="165">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="166">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="167">
            
            

            

            <code class="ruby">  </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="168">
            <span class="hits">1</span>
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_contacts_controller, self)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="169">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="52a92c665a3552a42fd9038367d847df31130da5">
  <div class="header">
    <h3>app/controllers/entities/leads_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>124</b> relevant lines.
      <span class="green"><b>124</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            <span class="hits">1</span>
            

            

            <code class="ruby">class LeadsController &lt; EntitiesController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            <span class="hits">1</span>
            

            

            <code class="ruby">  before_action :get_data_for_sidebar, only: :index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            <span class="hits">1</span>
            

            

            <code class="ruby">  autocomplete :account, :name, full: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">  # GET /leads</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="14">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="15">
            <span class="hits">19</span>
            

            

            <code class="ruby">    @leads = get_leads(page: page_param)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="17">
            <span class="hits">19</span>
            

            

            <code class="ruby">    respond_with @leads do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="18">
            <span class="hits">19</span>
            

            

            <code class="ruby">      format.xls { render layout: &#39;header&#39; }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="19">
            <span class="hits">19</span>
            

            

            <code class="ruby">      format.csv { render csv: @leads }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby">  # GET /leads/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby">  # AJAX /leads/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="26">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def show</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="27">
            <span class="hits">7</span>
            

            

            <code class="ruby">    @comment = Comment.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="28">
            <span class="hits">7</span>
            

            

            <code class="ruby">    @timeline = timeline(@lead)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="29">
            <span class="hits">7</span>
            

            

            <code class="ruby">    respond_with(@lead)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby">  # GET /leads/new</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="35">
            <span class="hits">6</span>
            

            

            <code class="ruby">    @lead.attributes = { user: current_user, access: Setting.default_access, assigned_to: nil }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="36">
            <span class="hits">6</span>
            

            

            <code class="ruby">    get_campaigns</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="38">
            <span class="hits">6</span>
            

            

            <code class="ruby">    if params[:related]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="39">
            <span class="hits">3</span>
            

            

            <code class="ruby">      model, id = params[:related].split(&#39;_&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="40">
            <span class="hits">3</span>
            

            

            <code class="ruby">      if related = model.classify.constantize.my(current_user).find_by_id(id)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="41">
            <span class="hits">1</span>
            

            

            <code class="ruby">        instance_variable_set(&quot;@#{model}&quot;, related)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="43">
            <span class="hits">2</span>
            

            

            <code class="ruby">        respond_to_related_not_found(model) &amp;&amp; return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="47">
            <span class="hits">4</span>
            

            

            <code class="ruby">    respond_with(@lead)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            
            

            

            <code class="ruby">  # GET /leads/1/edit                                                      AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="52">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def edit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="53">
            <span class="hits">5</span>
            

            

            <code class="ruby">    get_campaigns</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="55">
            <span class="hits">5</span>
            

            

            <code class="ruby">    @previous = Lead.my(current_user).find_by_id(detect_previous_id) || detect_previous_id if detect_previous_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="57">
            <span class="hits">5</span>
            

            

            <code class="ruby">    respond_with(@lead)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            
            

            

            <code class="ruby">  # POST /leads</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="62">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="63">
            <span class="hits">8</span>
            

            

            <code class="ruby">    get_campaigns</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="64">
            <span class="hits">8</span>
            

            

            <code class="ruby">    @comment_body = params[:comment_body]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="66">
            <span class="hits">8</span>
            

            

            <code class="ruby">    respond_with(@lead) do |_format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="67">
            <span class="hits">8</span>
            

            

            <code class="ruby">      if @lead.save_with_permissions(params.permit!)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="68">
            <span class="hits">7</span>
            

            

            <code class="ruby">        @lead.add_comment_by_user(@comment_body, current_user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="69">
            <span class="hits">7</span>
            

            

            <code class="ruby">        if called_from_index_page?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="70">
            <span class="hits">3</span>
            

            

            <code class="ruby">          @leads = get_leads</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="71">
            <span class="hits">3</span>
            

            

            <code class="ruby">          get_data_for_sidebar</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            
            

            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="73">
            <span class="hits">4</span>
            

            

            <code class="ruby">          get_data_for_sidebar(:campaign)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            
            

            

            <code class="ruby">  # PUT /leads/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="81">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="82">
            <span class="hits">12</span>
            

            

            <code class="ruby">    respond_with(@lead) do |_format|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            
            

            

            <code class="ruby">      # Must set access before user_ids, because user_ids= method depends on access value.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="84">
            <span class="hits">12</span>
            

            

            <code class="ruby">      @lead.access = resource_params[:access] if resource_params[:access]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="85">
            <span class="hits">12</span>
            

            

            <code class="ruby">      if @lead.update_with_lead_counters(resource_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="86">
            <span class="hits">11</span>
            

            

            <code class="ruby">        update_sidebar</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="88">
            <span class="hits">1</span>
            

            

            <code class="ruby">        @campaigns = Campaign.my(current_user).order(&#39;name&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            
            

            

            <code class="ruby">  # DELETE /leads/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="95">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="96">
            <span class="hits">8</span>
            

            

            <code class="ruby">    @lead.destroy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="98">
            <span class="hits">8</span>
            

            

            <code class="ruby">    respond_with(@lead) do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="99">
            <span class="hits">10</span>
            

            

            <code class="ruby">      format.html { respond_to_destroy(:html) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="100">
            <span class="hits">14</span>
            

            

            <code class="ruby">      format.js   { respond_to_destroy(:ajax) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            
            

            

            <code class="ruby">  # GET /leads/1/convert</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="106">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def convert</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="107">
            <span class="hits">3</span>
            

            

            <code class="ruby">    @account = Account.new(user: current_user, name: @lead.company, access: &quot;Lead&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="108">
            <span class="hits">3</span>
            

            

            <code class="ruby">    @accounts = Account.my(current_user).order(&#39;name&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="109">
            <span class="hits">3</span>
            

            

            <code class="ruby">    @opportunity = Opportunity.new(user: current_user, access: &quot;Lead&quot;, stage: &quot;prospecting&quot;, campaign: @lead.campaign, source: @lead.source)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="111">
            <span class="hits">3</span>
            

            

            <code class="ruby">    @previous = Lead.my(current_user).find_by_id(detect_previous_id) || detect_previous_id if detect_previous_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="113">
            <span class="hits">3</span>
            

            

            <code class="ruby">    respond_with(@lead)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            
            

            

            <code class="ruby">  # PUT /leads/1/promote</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="118">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def promote</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="119">
            <span class="hits">6</span>
            

            

            <code class="ruby">    @account, @opportunity, @contact = @lead.promote(params.permit!)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="120">
            <span class="hits">6</span>
            

            

            <code class="ruby">    @accounts = Account.my(current_user).order(&#39;name&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="121">
            <span class="hits">6</span>
            

            

            <code class="ruby">    @stage = Setting.unroll(:opportunity_stage)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="123">
            <span class="hits">6</span>
            

            

            <code class="ruby">    respond_with(@lead) do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="124">
            <span class="hits">6</span>
            

            

            <code class="ruby">      if @account.errors.empty? &amp;&amp; @opportunity.errors.empty? &amp;&amp; @contact.errors.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="125">
            <span class="hits">5</span>
            

            

            <code class="ruby">        @lead.convert</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="126">
            <span class="hits">5</span>
            

            

            <code class="ruby">        update_sidebar</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="128">
            <span class="hits">1</span>
            

            

            <code class="ruby">        format.json { render json: @account.errors + @opportunity.errors + @contact.errors, status: :unprocessable_entity }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="129">
            <span class="hits">1</span>
            

            

            <code class="ruby">        format.xml  { render xml: @account.errors + @opportunity.errors + @contact.errors, status: :unprocessable_entity }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            
            

            

            <code class="ruby">  # PUT /leads/1/reject</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="136">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def reject</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="137">
            <span class="hits">4</span>
            

            

            <code class="ruby">    @lead.reject</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="138">
            <span class="hits">4</span>
            

            

            <code class="ruby">    update_sidebar</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="140">
            <span class="hits">4</span>
            

            

            <code class="ruby">    respond_with(@lead) do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="141">
            <span class="hits">4</span>
            

            

            <code class="ruby">      format.html do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="142">
            <span class="hits">1</span>
            

            

            <code class="ruby">        flash[:notice] = t(:msg_asset_rejected, @lead.full_name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="143">
            <span class="hits">1</span>
            

            

            <code class="ruby">        redirect_to leads_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            
            

            

            <code class="ruby">  # PUT /leads/1/attach</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            
            

            

            <code class="ruby">  # Handled by EntitiesController :attach</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            
            

            

            <code class="ruby">  # POST /leads/1/discard</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="154">
            
            

            

            <code class="ruby">  # Handled by EntitiesController :discard</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            
            

            

            <code class="ruby">  # POST /leads/auto_complete/query                                        AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            
            

            

            <code class="ruby">  # Handled by ApplicationController :auto_complete</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            
            

            

            <code class="ruby">  # GET /leads/redraw                                                      AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="161">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="162">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def redraw</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="163">
            <span class="hits">4</span>
            

            

            <code class="ruby">    current_user.pref[:leads_per_page] = per_page_param if per_page_param</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="165">
            
            

            

            <code class="ruby">    # Sorting and naming only: set the same option for Contacts if the hasn&#39;t been set yet.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="166">
            <span class="hits">4</span>
            

            

            <code class="ruby">    if params[:sort_by]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="167">
            <span class="hits">4</span>
            

            

            <code class="ruby">      current_user.pref[:leads_sort_by] = Lead.sort_by_map[params[:sort_by]]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="168">
            <span class="hits">4</span>
            

            

            <code class="ruby">      current_user.pref[:contacts_sort_by] ||= Contact.sort_by_map[params[:sort_by]] if Contact.sort_by_fields.include?(params[:sort_by])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="169">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="170">
            <span class="hits">4</span>
            

            

            <code class="ruby">    if params[:naming]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="171">
            <span class="hits">3</span>
            

            

            <code class="ruby">      current_user.pref[:leads_naming] = params[:naming]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="172">
            <span class="hits">3</span>
            

            

            <code class="ruby">      current_user.pref[:contacts_naming] ||= params[:naming]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="173">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="174">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="175">
            <span class="hits">4</span>
            

            

            <code class="ruby">    @leads = get_leads(page: 1, per_page: per_page_param) # Start one the first page.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="176">
            <span class="hits">4</span>
            

            

            <code class="ruby">    set_options # Refresh options</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="177">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="178">
            <span class="hits">4</span>
            

            

            <code class="ruby">    respond_with(@leads) do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="179">
            <span class="hits">8</span>
            

            

            <code class="ruby">      format.js { render :index }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="181">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="182">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="183">
            
            

            

            <code class="ruby">  # POST /leads/filter                                                     AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="184">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="185">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def filter</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="186">
            <span class="hits">2</span>
            

            

            <code class="ruby">    session[:leads_filter] = params[:status]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="187">
            <span class="hits">2</span>
            

            

            <code class="ruby">    @leads = get_leads(page: 1, per_page: per_page_param) # Start one the first page.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="188">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="189">
            <span class="hits">2</span>
            

            

            <code class="ruby">    respond_with(@leads) do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="190">
            <span class="hits">4</span>
            

            

            <code class="ruby">      format.js { render :index }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="191">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="192">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="193">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="194">
            <span class="hits">1</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="195">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="196">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="197">
            <span class="hits">1</span>
            

            

            <code class="ruby">  alias get_leads get_list_of_records</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="198">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="199">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="200">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def list_includes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="201">
            <span class="hits">30</span>
            

            

            <code class="ruby">    %i[tags].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="202">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="203">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="204">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="205">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def get_campaigns</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="206">
            <span class="hits">19</span>
            

            

            <code class="ruby">    @campaigns = Campaign.my(current_user).order(&#39;name&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="207">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="208">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="209">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def set_options</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="210">
            <span class="hits">23</span>
            

            

            <code class="ruby">    super</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="211">
            <span class="hits">23</span>
            

            

            <code class="ruby">    @naming = (current_user.pref[:leads_naming] || Lead.first_name_position) unless params[:cancel].true?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="212">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="213">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="214">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="215">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def respond_to_destroy(method)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="216">
            <span class="hits">8</span>
            

            

            <code class="ruby">    if method == :ajax</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="217">
            <span class="hits">6</span>
            

            

            <code class="ruby">      if called_from_index_page? # Called from Leads index.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="218">
            <span class="hits">3</span>
            

            

            <code class="ruby">        get_data_for_sidebar</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="219">
            <span class="hits">3</span>
            

            

            <code class="ruby">        @leads = get_leads</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="220">
            <span class="hits">3</span>
            

            

            <code class="ruby">        if @leads.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="221">
            
            

            

            <code class="ruby">          # If no lead on this page then try the previous one.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="222">
            
            

            

            <code class="ruby">          # and reload the whole list even if it&#39;s empty.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="223">
            <span class="hits">2</span>
            

            

            <code class="ruby">          @leads = get_leads(page: current_page - 1) if current_page &gt; 1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="224">
            <span class="hits">2</span>
            

            

            <code class="ruby">          render(:index) &amp;&amp; return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="225">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="226">
            
            

            

            <code class="ruby">      else # Called from related asset.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="227">
            
            

            

            <code class="ruby">        # Reset current page to 1 to make sure it stays valid.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="228">
            
            

            

            <code class="ruby">        # Reload lead&#39;s campaign if any and render destroy.js</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="229">
            <span class="hits">3</span>
            

            

            <code class="ruby">        self.current_page = 1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="230">
            <span class="hits">3</span>
            

            

            <code class="ruby">        @campaign = @lead.campaign</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="231">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="232">
            
            

            

            <code class="ruby">    else # :html destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="233">
            <span class="hits">2</span>
            

            

            <code class="ruby">      self.current_page = 1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="234">
            <span class="hits">2</span>
            

            

            <code class="ruby">      flash[:notice] = t(:msg_asset_deleted, @lead.full_name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="235">
            <span class="hits">2</span>
            

            

            <code class="ruby">      redirect_to leads_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="236">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="237">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="238">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="239">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="240">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def get_data_for_sidebar(related = false)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="49" data-linenumber="241">
            <span class="hits">49</span>
            

            

            <code class="ruby">    if related</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="242">
            <span class="hits">21</span>
            

            

            <code class="ruby">      instance_variable_set(&quot;@#{related}&quot;, @lead.send(related)) if called_from_landing_page?(related.to_s.pluralize)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="243">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="244">
            <span class="hits">28</span>
            

            

            <code class="ruby">      @lead_status_total = HashWithIndifferentAccess[</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="245">
            
            

            

            <code class="ruby">                           all: Lead.my(current_user).count,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="246">
            
            

            

            <code class="ruby">                           other: 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="247">
            
            

            

            <code class="ruby">      ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="248">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="249">
            <span class="hits">28</span>
            

            

            <code class="ruby">      Setting.lead_status.each do |key|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="112" data-linenumber="250">
            <span class="hits">112</span>
            

            

            <code class="ruby">        @lead_status_total[key] = 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="251">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="252">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="253">
            <span class="hits">28</span>
            

            

            <code class="ruby">      status_counts = Lead.my(current_user).where(status: Setting.lead_status).group(:status).count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="254">
            <span class="hits">28</span>
            

            

            <code class="ruby">      status_counts.each do |key, total|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="255">
            <span class="hits">30</span>
            

            

            <code class="ruby">        @lead_status_total[key.to_sym] = total</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="256">
            <span class="hits">30</span>
            

            

            <code class="ruby">        @lead_status_total[:other] -= total</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="257">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="258">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="259">
            <span class="hits">28</span>
            

            

            <code class="ruby">      @lead_status_total[:other] += @lead_status_total[:all]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="260">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="261">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="262">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="263">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="264">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def update_sidebar</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="265">
            <span class="hits">20</span>
            

            

            <code class="ruby">    if called_from_index_page?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="266">
            <span class="hits">3</span>
            

            

            <code class="ruby">      get_data_for_sidebar</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="267">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="268">
            <span class="hits">17</span>
            

            

            <code class="ruby">      get_data_for_sidebar(:campaign)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="269">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="270">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="271">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="272">
            <span class="hits">1</span>
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_leads_controller, self)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="273">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="14e2e233337c500d2dab3787f8d47d1745ad1be4">
  <div class="header">
    <h3>app/controllers/entities/opportunities_controller.rb</h3>
    <h4>
      <span class="green">
  99.13%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>115</b> relevant lines.
      <span class="green"><b>114</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            <span class="hits">1</span>
            

            

            <code class="ruby">class OpportunitiesController &lt; EntitiesController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            <span class="hits">1</span>
            

            

            <code class="ruby">  before_action :load_settings</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            <span class="hits">1</span>
            

            

            <code class="ruby">  before_action :get_data_for_sidebar, only: :index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="11">
            <span class="hits">1</span>
            

            

            <code class="ruby">  before_action :set_params, only: %i[index redraw filter]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">  # GET /opportunities</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="15">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="16">
            <span class="hits">22</span>
            

            

            <code class="ruby">    @opportunities = get_opportunities(page: page_param, per_page: per_page_param)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="18">
            <span class="hits">22</span>
            

            

            <code class="ruby">    respond_with @opportunities do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="19">
            <span class="hits">22</span>
            

            

            <code class="ruby">      format.xls { render layout: &#39;header&#39; }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="20">
            <span class="hits">22</span>
            

            

            <code class="ruby">      format.csv { render csv: @opportunities }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby">  # GET /opportunities/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">  # AJAX /opportunities/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="27">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def show</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="28">
            <span class="hits">8</span>
            

            

            <code class="ruby">    @comment = Comment.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="29">
            <span class="hits">8</span>
            

            

            <code class="ruby">    @timeline = timeline(@opportunity)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="30">
            <span class="hits">8</span>
            

            

            <code class="ruby">    respond_with(@opportunity)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            
            

            

            <code class="ruby">  # GET /opportunities/new</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="35">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="36">
            <span class="hits">6</span>
            

            

            <code class="ruby">    @opportunity.attributes = { user: current_user, stage: Opportunity.default_stage, access: Setting.default_access, assigned_to: nil }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="37">
            <span class="hits">6</span>
            

            

            <code class="ruby">    @account = Account.new(user: current_user, access: Setting.default_access)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="38">
            <span class="hits">6</span>
            

            

            <code class="ruby">    @accounts = Account.my(current_user).order(&#39;name&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="40">
            <span class="hits">6</span>
            

            

            <code class="ruby">    if params[:related]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="41">
            <span class="hits">3</span>
            

            

            <code class="ruby">      model, id = params[:related].split(&#39;_&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="42">
            <span class="hits">3</span>
            

            

            <code class="ruby">      if related = model.classify.constantize.my(current_user).find_by_id(id)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="43">
            <span class="hits">1</span>
            

            

            <code class="ruby">        instance_variable_set(&quot;@#{model}&quot;, related)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="44">
            <span class="hits">1</span>
            

            

            <code class="ruby">        @account = related.account if related.respond_to?(:account) &amp;&amp; !related.account.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="45">
            <span class="hits">1</span>
            

            

            <code class="ruby">        @campaign = related.campaign if related.respond_to?(:campaign)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="47">
            <span class="hits">2</span>
            

            

            <code class="ruby">        respond_to_related_not_found(model) &amp;&amp; return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="51">
            <span class="hits">4</span>
            

            

            <code class="ruby">    respond_with(@opportunity)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            
            

            

            <code class="ruby">  # GET /opportunities/1/edit                                              AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="56">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def edit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="57">
            <span class="hits">5</span>
            

            

            <code class="ruby">    @account  = @opportunity.account || Account.new(user: current_user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="58">
            <span class="hits">5</span>
            

            

            <code class="ruby">    @accounts = Account.my(current_user).order(&#39;name&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="60">
            <span class="hits">5</span>
            

            

            <code class="ruby">    @previous = Opportunity.my(current_user).find_by_id(detect_previous_id) || detect_previous_id if detect_previous_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="62">
            <span class="hits">5</span>
            

            

            <code class="ruby">    respond_with(@opportunity)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            
            

            

            <code class="ruby">  # POST /opportunities</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="67">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="68">
            <span class="hits">16</span>
            

            

            <code class="ruby">    @comment_body = params[:comment_body]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="69">
            <span class="hits">16</span>
            

            

            <code class="ruby">    respond_with(@opportunity) do |_format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="70">
            <span class="hits">16</span>
            

            

            <code class="ruby">      if @opportunity.save_with_account_and_permissions(params.permit!)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="71">
            <span class="hits">12</span>
            

            

            <code class="ruby">        @opportunity.add_comment_by_user(@comment_body, current_user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="72">
            <span class="hits">12</span>
            

            

            <code class="ruby">        if called_from_index_page?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="73">
            <span class="hits">3</span>
            

            

            <code class="ruby">          @opportunities = get_opportunities</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="74">
            <span class="hits">3</span>
            

            

            <code class="ruby">          get_data_for_sidebar</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="75">
            <span class="hits">9</span>
            

            

            <code class="ruby">        elsif called_from_landing_page?(:accounts)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="76">
            <span class="hits">1</span>
            

            

            <code class="ruby">          get_data_for_sidebar(:account)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="77">
            <span class="hits">8</span>
            

            

            <code class="ruby">        elsif called_from_landing_page?(:campaigns)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="78">
            <span class="hits">2</span>
            

            

            <code class="ruby">          get_data_for_sidebar(:campaign)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="81">
            <span class="hits">4</span>
            

            

            <code class="ruby">        @accounts = Account.my(current_user).order(&#39;name&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="82">
            <span class="hits">4</span>
            

            

            <code class="ruby">        @account = guess_related_account(params[:account][:id], request.referer, current_user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="83">
            <span class="hits">4</span>
            

            

            <code class="ruby">        @contact = Contact.find(params[:contact]) unless params[:contact].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="84">
            <span class="hits">4</span>
            

            

            <code class="ruby">        @campaign = Campaign.find(params[:campaign]) unless params[:campaign].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            
            

            

            <code class="ruby">  # PUT /opportunities/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="91">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="92">
            <span class="hits">18</span>
            

            

            <code class="ruby">    respond_with(@opportunity) do |_format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="93">
            <span class="hits">18</span>
            

            

            <code class="ruby">      if @opportunity.update_with_account_and_permissions(params.permit!)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="94">
            <span class="hits">16</span>
            

            

            <code class="ruby">        if called_from_index_page?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="95">
            <span class="hits">1</span>
            

            

            <code class="ruby">          get_data_for_sidebar</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="96">
            <span class="hits">15</span>
            

            

            <code class="ruby">        elsif called_from_landing_page?(:accounts)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="97">
            <span class="hits">2</span>
            

            

            <code class="ruby">          get_data_for_sidebar(:account)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="98">
            <span class="hits">13</span>
            

            

            <code class="ruby">        elsif called_from_landing_page?(:campaigns)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="99">
            <span class="hits">2</span>
            

            

            <code class="ruby">          get_data_for_sidebar(:campaign)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="102">
            <span class="hits">2</span>
            

            

            <code class="ruby">        @accounts = Account.my(current_user).order(&#39;name&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="103">
            <span class="hits">2</span>
            

            

            <code class="ruby">        @account = if @opportunity.account</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="104">
            <span class="hits">2</span>
            

            

            <code class="ruby">                     Account.find(@opportunity.account.id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            
            

            

            <code class="ruby">                   else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="106">
            
            

            

            <code class="ruby">                     Account.new(user: current_user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            
            

            

            <code class="ruby">                   end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            
            

            

            <code class="ruby">  # DELETE /opportunities/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="114">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="115">
            <span class="hits">9</span>
            

            

            <code class="ruby">    if called_from_landing_page?(:accounts)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="116">
            <span class="hits">2</span>
            

            

            <code class="ruby">      @account = @opportunity.account   # Reload related account if any.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="117">
            <span class="hits">7</span>
            

            

            <code class="ruby">    elsif called_from_landing_page?(:campaigns)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="118">
            <span class="hits">1</span>
            

            

            <code class="ruby">      @campaign = @opportunity.campaign # Reload related campaign if any.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="120">
            <span class="hits">9</span>
            

            

            <code class="ruby">    @opportunity.destroy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="122">
            <span class="hits">9</span>
            

            

            <code class="ruby">    respond_with(@opportunity) do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="123">
            <span class="hits">11</span>
            

            

            <code class="ruby">      format.html { respond_to_destroy(:html) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="124">
            <span class="hits">16</span>
            

            

            <code class="ruby">      format.js   { respond_to_destroy(:ajax) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            
            

            

            <code class="ruby">  # PUT /opportunities/1/attach</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            
            

            

            <code class="ruby">  # Handled by EntitiesController :attach</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            
            

            

            <code class="ruby">  # POST /opportunities/1/discard</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            
            

            

            <code class="ruby">  # Handled by EntitiesController :discard</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            
            

            

            <code class="ruby">  # POST /opportunities/auto_complete/query                                AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            
            

            

            <code class="ruby">  # Handled by ApplicationController :auto_complete</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            
            

            

            <code class="ruby">  # GET /opportunities/redraw                                              AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="142">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def redraw</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="143">
            <span class="hits">4</span>
            

            

            <code class="ruby">    @opportunities = get_opportunities(page: 1, per_page: per_page_param)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="144">
            <span class="hits">4</span>
            

            

            <code class="ruby">    set_options # Refresh options</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="146">
            <span class="hits">4</span>
            

            

            <code class="ruby">    respond_with(@opportunities) do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="147">
            <span class="hits">8</span>
            

            

            <code class="ruby">      format.js { render :index }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            
            

            

            <code class="ruby">  # POST /opportunities/filter                                             AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="153">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def filter</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="154">
            <span class="hits">2</span>
            

            

            <code class="ruby">    @opportunities = get_opportunities(page: 1, per_page: per_page_param)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="155">
            <span class="hits">2</span>
            

            

            <code class="ruby">    respond_with(@opportunities) do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="156">
            <span class="hits">4</span>
            

            

            <code class="ruby">      format.js { render :index }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="160">
            <span class="hits">1</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="161">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="162">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def order_by_attributes(scope, order)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="163">
            <span class="hits">32</span>
            

            

            <code class="ruby">    scope.weighted_sort.order(order)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="165">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="166">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="167">
            <span class="hits">1</span>
            

            

            <code class="ruby">  alias get_opportunities get_list_of_records</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="168">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="169">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="170">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def list_includes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="171">
            <span class="hits">32</span>
            

            

            <code class="ruby">    %i[account user tags].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="173">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="174">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="175">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def respond_to_destroy(method)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="176">
            <span class="hits">9</span>
            

            

            <code class="ruby">    if method == :ajax</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="177">
            <span class="hits">7</span>
            

            

            <code class="ruby">      if called_from_index_page?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="178">
            <span class="hits">3</span>
            

            

            <code class="ruby">        get_data_for_sidebar</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="179">
            <span class="hits">3</span>
            

            

            <code class="ruby">        @opportunities = get_opportunities</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="180">
            <span class="hits">3</span>
            

            

            <code class="ruby">        if @opportunities.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="181">
            <span class="hits">3</span>
            

            

            <code class="ruby">          @opportunities = get_opportunities(page: current_page - 1) if current_page &gt; 1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="182">
            <span class="hits">3</span>
            

            

            <code class="ruby">          render(:index) &amp;&amp; return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="183">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="184">
            
            

            

            <code class="ruby">      else # Called from related asset.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="185">
            <span class="hits">4</span>
            

            

            <code class="ruby">        self.current_page = 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="186">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="187">
            
            

            

            <code class="ruby">      # At this point render destroy.js</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="188">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="189">
            <span class="hits">2</span>
            

            

            <code class="ruby">      self.current_page = 1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="190">
            <span class="hits">2</span>
            

            

            <code class="ruby">      flash[:notice] = t(:msg_asset_deleted, @opportunity.name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="191">
            <span class="hits">2</span>
            

            

            <code class="ruby">      redirect_to opportunities_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="192">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="193">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="194">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="195">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="196">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def get_data_for_sidebar(related = false)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="197">
            <span class="hits">36</span>
            

            

            <code class="ruby">    if related</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="198">
            <span class="hits">7</span>
            

            

            <code class="ruby">      instance_variable_set(&quot;@#{related}&quot;, @opportunity.send(related)) if called_from_landing_page?(related.to_s.pluralize)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="199">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="200">
            <span class="hits">29</span>
            

            

            <code class="ruby">      @opportunity_stage_total = HashWithIndifferentAccess[</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="201">
            
            

            

            <code class="ruby">                                 all: Opportunity.my(current_user).count,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="202">
            
            

            

            <code class="ruby">                                 other: 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="203">
            
            

            

            <code class="ruby">      ]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="204">
            <span class="hits">29</span>
            

            

            <code class="ruby">      stages = []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="205">
            <span class="hits">29</span>
            

            

            <code class="ruby">      @stage.each do |_value, key|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="232" data-linenumber="206">
            <span class="hits">232</span>
            

            

            <code class="ruby">        stages &lt;&lt; key</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="232" data-linenumber="207">
            <span class="hits">232</span>
            

            

            <code class="ruby">        @opportunity_stage_total[key] = 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="208">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="209">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="210">
            <span class="hits">29</span>
            

            

            <code class="ruby">      stage_counts = Opportunity.my(current_user).where(stage: stages).group(:stage).count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="211">
            <span class="hits">29</span>
            

            

            <code class="ruby">      stage_counts.each do |key, total|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="212">
            <span class="hits">28</span>
            

            

            <code class="ruby">        @opportunity_stage_total[key.to_sym] = total</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="213">
            <span class="hits">28</span>
            

            

            <code class="ruby">        @opportunity_stage_total[:other] -= total</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="214">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="215">
            <span class="hits">29</span>
            

            

            <code class="ruby">      @opportunity_stage_total[:other] += @opportunity_stage_total[:all]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="216">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="217">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="218">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="219">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="220">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def load_settings</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="103" data-linenumber="221">
            <span class="hits">103</span>
            

            

            <code class="ruby">    @stage = Setting.unroll(:opportunity_stage)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="222">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="223">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="224">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="225">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def set_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="226">
            <span class="hits">28</span>
            

            

            <code class="ruby">    current_user.pref[:opportunities_per_page] = per_page_param if per_page_param</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="227">
            <span class="hits">28</span>
            

            

            <code class="ruby">    current_user.pref[:opportunities_sort_by]  = Opportunity.sort_by_map[params[:sort_by]] if params[:sort_by]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="228">
            <span class="hits">28</span>
            

            

            <code class="ruby">    session[:opportunities_filter] = params[:stage] if params[:stage]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="229">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="230">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="231">
            <span class="hits">1</span>
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_opportunities_controller, self)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="232">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="ae1de5bf6f86f737179981ded79852c26a59c337">
  <div class="header">
    <h3>app/controllers/entities_controller.rb</h3>
    <h4>
      <span class="yellow">
  89.74%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>117</b> relevant lines.
      <span class="green"><b>105</b> lines covered</span> and
      <span class="red"><b>12</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            <span class="hits">1</span>
            

            

            <code class="ruby">class EntitiesController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            <span class="hits">1</span>
            

            

            <code class="ruby">  before_action :set_current_tab, only: %i[index show]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            <span class="hits">1</span>
            

            

            <code class="ruby">  before_action :set_view, only: %i[index show redraw]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            <span class="hits">1</span>
            

            

            <code class="ruby">  before_action :set_options, only: :index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            <span class="hits">1</span>
            

            

            <code class="ruby">  before_action :load_ransack_search, only: :index</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="15">
            <span class="hits">1</span>
            

            

            <code class="ruby">  load_and_authorize_resource</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="17">
            <span class="hits">1</span>
            

            

            <code class="ruby">  after_action :update_recently_viewed, only: :show</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="19">
            <span class="hits">1</span>
            

            

            <code class="ruby">  helper_method :entity, :entities</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby">  # Common attach handler for all core controllers.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="23">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def attach</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="49" data-linenumber="24">
            <span class="hits">49</span>
            

            

            <code class="ruby">    @attachment = find_class(params[:assets]).find(params[:asset_id])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="33" data-linenumber="25">
            <span class="hits">33</span>
            

            

            <code class="ruby">    @attached = entity.attach!(@attachment)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="33" data-linenumber="26">
            <span class="hits">33</span>
            

            

            <code class="ruby">    entity.reload</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="33" data-linenumber="28">
            <span class="hits">33</span>
            

            

            <code class="ruby">    respond_with(entity)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby">  # Common discard handler for all core controllers.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="33">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def discard</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="34">
            <span class="hits">20</span>
            

            

            <code class="ruby">    @attachment = find_class(params[:attachment]).find(params[:attachment_id])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="35">
            <span class="hits">10</span>
            

            

            <code class="ruby">    entity.discard!(@attachment)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="36">
            <span class="hits">10</span>
            

            

            <code class="ruby">    entity.reload</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="38">
            <span class="hits">10</span>
            

            

            <code class="ruby">    respond_with(entity)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            
            

            

            <code class="ruby">  # Common subscribe handler for all core controllers.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="43">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def subscribe</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="44">
            
            

            

            <code class="ruby">    entity.subscribed_users += [current_user.id]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="45">
            
            

            

            <code class="ruby">    entity.save</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="47">
            
            

            

            <code class="ruby">    respond_with(@entity) do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="48">
            
            

            

            <code class="ruby">      format.js { render &#39;subscription_update&#39;, entity: entity }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            
            

            

            <code class="ruby">  # Common unsubscribe handler for all core controllers.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="54">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def unsubscribe</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="55">
            
            

            

            <code class="ruby">    entity.subscribed_users -= [current_user.id]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="56">
            
            

            

            <code class="ruby">    entity.save</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="58">
            
            

            

            <code class="ruby">    respond_with(entity) do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="59">
            
            

            

            <code class="ruby">      format.js { render &#39;subscription_update&#39;, entity: entity }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            
            

            

            <code class="ruby">  # GET /entities/contacts                                                 AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="65">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def contacts</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            
            

            

            <code class="ruby">  # GET /entities/leads                                                    AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="70">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def leads</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            
            

            

            <code class="ruby">  # GET /entities/opportunities                                            AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="75">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def opportunities</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            
            

            

            <code class="ruby">  # GET /entities/versions                                                 AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="80">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def versions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="84">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def field_group</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="85">
            <span class="hits">4</span>
            

            

            <code class="ruby">    if @tag = Tag.find_by_name(params[:tag].strip)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="86">
            <span class="hits">2</span>
            

            

            <code class="ruby">      if @field_group = FieldGroup.find_by_tag_id_and_klass_name(@tag.id, klass.to_s)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="87">
            
            

            

            <code class="ruby">        @asset = klass.find_by_id(params[:asset_id]) || klass.new</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="88">
            
            

            

            <code class="ruby">        render(&#39;fields/group&#39;) &amp;&amp; return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="91">
            <span class="hits">4</span>
            

            

            <code class="ruby">    render plain: &#39;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="94">
            <span class="hits">1</span>
            

            

            <code class="ruby">  protected</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="97">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def entity=(entity)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="98">
            
            

            

            <code class="ruby">    instance_variable_set(&quot;@#{controller_name.singularize}&quot;, entity)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="102">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def entity</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="166" data-linenumber="103">
            <span class="hits">166</span>
            

            

            <code class="ruby">    instance_variable_get(&quot;@#{controller_name.singularize}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="107">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def entities=(entities)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="108">
            
            

            

            <code class="ruby">    instance_variable_set(&quot;@#{controller_name}&quot;, entities)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="112">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def entities</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="151" data-linenumber="113">
            <span class="hits">151</span>
            

            

            <code class="ruby">    instance_variable_get(&quot;@#{controller_name}&quot;) || klass.my(current_user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="116">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def set_options</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="115" data-linenumber="117">
            <span class="hits">115</span>
            

            

            <code class="ruby">    unless params[:cancel].true?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="115" data-linenumber="118">
            <span class="hits">115</span>
            

            

            <code class="ruby">      klass = controller_name.classify.constantize</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="115" data-linenumber="119">
            <span class="hits">115</span>
            

            

            <code class="ruby">      @per_page = current_user.pref[:&quot;#{controller_name}_per_page&quot;] || klass.per_page</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="115" data-linenumber="120">
            <span class="hits">115</span>
            

            

            <code class="ruby">      @sort_by  = current_user.pref[:&quot;#{controller_name}_sort_by&quot;]  || klass.sort_by</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="124">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def resource_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="340" data-linenumber="125">
            <span class="hits">340</span>
            

            

            <code class="ruby">    params[controller_name.singularize].permit! if params[controller_name.singularize].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="128">
            <span class="hits">1</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="130">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def ransack_search</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="151" data-linenumber="131">
            <span class="hits">151</span>
            

            

            <code class="ruby">    @ransack_search ||= load_ransack_search</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="151" data-linenumber="132">
            <span class="hits">151</span>
            

            

            <code class="ruby">    @ransack_search.build_sort if @ransack_search.sorts.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="151" data-linenumber="133">
            <span class="hits">151</span>
            

            

            <code class="ruby">    @ransack_search</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            
            

            

            <code class="ruby">  # Get list of records for a given model class.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="138">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def get_list_of_records(options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="151" data-linenumber="139">
            <span class="hits">151</span>
            

            

            <code class="ruby">    options[:query]  ||= params[:query]                        if params[:query]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="151" data-linenumber="140">
            <span class="hits">151</span>
            

            

            <code class="ruby">    self.current_page  = options[:page]                        if options[:page]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="151" data-linenumber="141">
            <span class="hits">151</span>
            

            

            <code class="ruby">    query, tags        = parse_query_and_tags(options[:query])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="151" data-linenumber="142">
            <span class="hits">151</span>
            

            

            <code class="ruby">    self.current_query = query</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="151" data-linenumber="143">
            <span class="hits">151</span>
            

            

            <code class="ruby">    advanced_search = params[:q].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="151" data-linenumber="144">
            <span class="hits">151</span>
            

            

            <code class="ruby">    wants = request.format</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="151" data-linenumber="146">
            <span class="hits">151</span>
            

            

            <code class="ruby">    scope = entities.merge(ransack_search.result(distinct: true))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            
            

            

            <code class="ruby">    # Get filter from session, unless running an advanced search</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="151" data-linenumber="149">
            <span class="hits">151</span>
            

            

            <code class="ruby">    unless advanced_search</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="151" data-linenumber="150">
            <span class="hits">151</span>
            

            

            <code class="ruby">      filter = session[:&quot;#{controller_name}_filter&quot;].to_s.split(&#39;,&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="151" data-linenumber="151">
            <span class="hits">151</span>
            

            

            <code class="ruby">      scope = scope.state(filter) if filter.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="151" data-linenumber="154">
            <span class="hits">151</span>
            

            

            <code class="ruby">    scope = scope.text_search(query) if query.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="151" data-linenumber="155">
            <span class="hits">151</span>
            

            

            <code class="ruby">    scope = scope.tagged_with(tags, on: :tags) if tags.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            
            

            

            <code class="ruby">    # Ignore this order when doing advanced search</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="151" data-linenumber="158">
            <span class="hits">151</span>
            

            

            <code class="ruby">    unless advanced_search</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="151" data-linenumber="159">
            <span class="hits">151</span>
            

            

            <code class="ruby">      order = current_user.pref[:&quot;#{controller_name}_sort_by&quot;] || klass.sort_by</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="151" data-linenumber="160">
            <span class="hits">151</span>
            

            

            <code class="ruby">      scope = order_by_attributes(scope, order)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="161">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="151" data-linenumber="163">
            <span class="hits">151</span>
            

            

            <code class="ruby">    @search_results_count = scope.size</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="165">
            
            

            

            <code class="ruby">    # Pagination is disabled for xls and csv requests</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="151" data-linenumber="166">
            <span class="hits">151</span>
            

            

            <code class="ruby">    unless wants.xls? || wants.csv?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="151" data-linenumber="167">
            <span class="hits">151</span>
            

            

            <code class="ruby">      per_page = if options[:per_page]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="168">
            <span class="hits">15</span>
            

            

            <code class="ruby">                   options[:per_page] == &#39;all&#39; ? @search_results_count : options[:per_page]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="169">
            
            

            

            <code class="ruby">                 else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="136" data-linenumber="170">
            <span class="hits">136</span>
            

            

            <code class="ruby">                   current_user.pref[:&quot;#{controller_name}_per_page&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="151" data-linenumber="172">
            <span class="hits">151</span>
            

            

            <code class="ruby">      scope = scope.paginate(page: current_page, per_page: per_page)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="173">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="174">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="151" data-linenumber="175">
            <span class="hits">151</span>
            

            

            <code class="ruby">    scope = scope.includes(*list_includes) if respond_to?(:list_includes, true)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="176">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="151" data-linenumber="177">
            <span class="hits">151</span>
            

            

            <code class="ruby">    scope</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="178">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="179">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="181">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def order_by_attributes(scope, order)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="119" data-linenumber="182">
            <span class="hits">119</span>
            

            

            <code class="ruby">    scope.order(order)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="183">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="184">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="185">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="186">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def update_recently_viewed</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="37" data-linenumber="187">
            <span class="hits">37</span>
            

            

            <code class="ruby">    entity.versions.create(event: :view, whodunnit: PaperTrail.request.whodunnit)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="188">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="189">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="190">
            
            

            

            <code class="ruby">  # Somewhat simplistic parser that extracts query and hash-prefixed tags from</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="191">
            
            

            

            <code class="ruby">  # the search string and returns them as two element array, for example:</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="192">
            
            

            

            <code class="ruby">  #</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="193">
            
            

            

            <code class="ruby">  # &quot;#real Billy Bones #pirate&quot; =&gt; [ &quot;Billy Bones&quot;, &quot;real, pirate&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="194">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="195">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def parse_query_and_tags(search_string)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="158" data-linenumber="196">
            <span class="hits">158</span>
            

            

            <code class="ruby">    return [&#39;&#39;, &#39;&#39;] if search_string.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="197">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="27" data-linenumber="198">
            <span class="hits">27</span>
            

            

            <code class="ruby">    query = []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="27" data-linenumber="199">
            <span class="hits">27</span>
            

            

            <code class="ruby">    tags = []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="27" data-linenumber="200">
            <span class="hits">27</span>
            

            

            <code class="ruby">    if search_string.start_with?(&quot;#&quot;) &amp;&amp; search_string.end_with?(&quot;#&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="201">
            <span class="hits">1</span>
            

            

            <code class="ruby">      tags &lt;&lt; search_string[1..-2]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="202">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="203">
            <span class="hits">26</span>
            

            

            <code class="ruby">      search_string.strip.split(/\s+/).each do |token|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="46" data-linenumber="204">
            <span class="hits">46</span>
            

            

            <code class="ruby">        if token.starts_with?(&quot;#&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="205">
            <span class="hits">8</span>
            

            

            <code class="ruby">          tags &lt;&lt; token[1..-1]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="206">
            
            

            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="38" data-linenumber="207">
            <span class="hits">38</span>
            

            

            <code class="ruby">          query &lt;&lt; token</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="208">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="209">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="210">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="27" data-linenumber="211">
            <span class="hits">27</span>
            

            

            <code class="ruby">    [query.join(&quot; &quot;), tags.join(&quot;, &quot;)]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="212">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="213">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="214">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="215">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def timeline(asset)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="216">
            <span class="hits">35</span>
            

            

            <code class="ruby">    (asset.comments + asset.emails).sort { |x, y| y.created_at &lt;=&gt; x.created_at }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="217">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="218">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="219">
            
            

            

            <code class="ruby">  # Sets the current template view for entities in this context</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="220">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="221">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def set_view</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="171" data-linenumber="222">
            <span class="hits">171</span>
            

            

            <code class="ruby">    if params[&#39;view&#39;]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="223">
            <span class="hits">11</span>
            

            

            <code class="ruby">      controller = params[&#39;controller&#39;]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="224">
            <span class="hits">11</span>
            

            

            <code class="ruby">      action = params[&#39;action&#39;] == &#39;show&#39; ? &#39;show&#39; : &#39;index&#39; # create update redraw filter index actions all use index view</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="225">
            <span class="hits">11</span>
            

            

            <code class="ruby">      current_user.pref[:&quot;#{controller}_#{action}_view&quot;] = params[&#39;view&#39;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="226">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="227">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="228">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="229">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def per_page_param</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="161" data-linenumber="230">
            <span class="hits">161</span>
            

            

            <code class="ruby">    per_page = params[:per_page]&amp;.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="161" data-linenumber="231">
            <span class="hits">161</span>
            

            

            <code class="ruby">    [1, [per_page, 200].min].max if per_page</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="232">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="233">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="234">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def page_param</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="97" data-linenumber="235">
            <span class="hits">97</span>
            

            

            <code class="ruby">    page = params[:page]&amp;.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="97" data-linenumber="236">
            <span class="hits">97</span>
            

            

            <code class="ruby">    [0, page].max if page</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="237">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="238">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="239">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def guess_related_account(id, url, user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="240">
            <span class="hits">7</span>
            

            

            <code class="ruby">    return Account.find(id) unless id.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="241">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="242">
            <span class="hits">5</span>
            

            

            <code class="ruby">    if url =~ %r{/accounts/(\d+)\z}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="243">
            <span class="hits">1</span>
            

            

            <code class="ruby">      Account.find(Regexp.last_match[1]) # related account</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="244">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="245">
            <span class="hits">4</span>
            

            

            <code class="ruby">      Account.new(user: user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="246">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="247">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="248">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="249">
            <span class="hits">1</span>
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_entities_controller, self)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="250">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="4f5ce7ccd4d1bacdff6d177cc5925ab9a6ba004a">
  <div class="header">
    <h3>app/controllers/home_controller.rb</h3>
    <h4>
      <span class="green">
  98.82%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>85</b> relevant lines.
      <span class="green"><b>84</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            <span class="hits">1</span>
            

            

            <code class="ruby">class HomeController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            <span class="hits">1</span>
            

            

            <code class="ruby">  skip_before_action :authenticate_user!, only: %i[timezone]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            <span class="hits">1</span>
            

            

            <code class="ruby">  before_action :set_current_tab, only: :index</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31" data-linenumber="14">
            <span class="hits">31</span>
            

            

            <code class="ruby">    @activities = get_activities</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31" data-linenumber="15">
            <span class="hits">31</span>
            

            

            <code class="ruby">    @my_tasks = Task.visible_on_dashboard(current_user).includes(:user, :asset).by_due_at</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31" data-linenumber="16">
            <span class="hits">31</span>
            

            

            <code class="ruby">    @my_opportunities = Opportunity.visible_on_dashboard(current_user).includes(:account, :user, :tags).by_closes_on.by_amount</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31" data-linenumber="17">
            <span class="hits">31</span>
            

            

            <code class="ruby">    @my_accounts = Account.visible_on_dashboard(current_user).includes(:user, :tags).by_name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31" data-linenumber="18">
            <span class="hits">31</span>
            

            

            <code class="ruby">    respond_with @activities do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31" data-linenumber="19">
            <span class="hits">31</span>
            

            

            <code class="ruby">      format.xls { render xls: @activities, layout: &#39;header&#39; }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby">  # GET /home/options                                                      AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="25">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def options</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="26">
            <span class="hits">2</span>
            

            

            <code class="ruby">    unless params[:cancel].true?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="27">
            <span class="hits">1</span>
            

            

            <code class="ruby">      @asset = current_user.pref[:activity_asset] || &quot;all&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="28">
            <span class="hits">1</span>
            

            

            <code class="ruby">      @action = current_user.pref[:activity_event] || &quot;all_events&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="29">
            <span class="hits">1</span>
            

            

            <code class="ruby">      @user = current_user.pref[:activity_user] || &quot;all_users&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="30">
            <span class="hits">1</span>
            

            

            <code class="ruby">      @duration = current_user.pref[:activity_duration] || &quot;two_days&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="31">
            <span class="hits">1</span>
            

            

            <code class="ruby">      @all_users = User.order(&quot;first_name, last_name&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            
            

            

            <code class="ruby">  # GET /home/redraw                                                       AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="37">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def redraw</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="38">
            <span class="hits">1</span>
            

            

            <code class="ruby">    current_user.pref[:activity_asset] = params[:asset] if params[:asset]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="39">
            <span class="hits">1</span>
            

            

            <code class="ruby">    current_user.pref[:activity_event] = params[:event] if params[:event]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="40">
            <span class="hits">1</span>
            

            

            <code class="ruby">    current_user.pref[:activity_user] = params[:user] if params[:user]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="41">
            <span class="hits">1</span>
            

            

            <code class="ruby">    current_user.pref[:activity_duration] = params[:duration] if params[:duration]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="42">
            <span class="hits">1</span>
            

            

            <code class="ruby">    @activities = get_activities</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="44">
            <span class="hits">1</span>
            

            

            <code class="ruby">    respond_with(@activities) do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="45">
            <span class="hits">2</span>
            

            

            <code class="ruby">      format.js { render :index }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            
            

            

            <code class="ruby">  # GET /home/toggle                                                       AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="51">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def toggle</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="52">
            <span class="hits">16</span>
            

            

            <code class="ruby">    if (toggle_param = params[:id]&amp;.to_sym)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="53">
            <span class="hits">16</span>
            

            

            <code class="ruby">      session[:toggle_states] ||= {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="54">
            <span class="hits">16</span>
            

            

            <code class="ruby">      if session[:toggle_states][toggle_param]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="55">
            <span class="hits">1</span>
            

            

            <code class="ruby">        session[:toggle_states].delete(toggle_param)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="57">
            <span class="hits">15</span>
            

            

            <code class="ruby">        session[:toggle_states][toggle_param] = true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="60">
            <span class="hits">16</span>
            

            

            <code class="ruby">    head :ok</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            
            

            

            <code class="ruby">  # GET /home/timeline                                                     AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="65">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def timeline</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="66">
            <span class="hits">6</span>
            

            

            <code class="ruby">    state = params[:state].to_s</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="67">
            <span class="hits">6</span>
            

            

            <code class="ruby">    if %w[Collapsed Expanded].include?(state)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="68">
            <span class="hits">5</span>
            

            

            <code class="ruby">      if (model_type = params[:type].to_s).present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="69">
            <span class="hits">2</span>
            

            

            <code class="ruby">        if %w[comment email].include?(model_type)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="70">
            <span class="hits">2</span>
            

            

            <code class="ruby">          model = model_type.camelize.constantize</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="71">
            <span class="hits">2</span>
            

            

            <code class="ruby">          item = model.find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="72">
            <span class="hits">2</span>
            

            

            <code class="ruby">          item.update_attribute(:state, state)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="75">
            <span class="hits">3</span>
            

            

            <code class="ruby">        comments, emails = params[:id].split(&quot;+&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="76">
            <span class="hits">3</span>
            

            

            <code class="ruby">        Comment.where(id: comments.split(&#39;,&#39;)).update_all(state: state) unless comments.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="77">
            <span class="hits">3</span>
            

            

            <code class="ruby">        Email.where(id: emails.split(&#39;,&#39;)).update_all(state: state) unless emails.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="81">
            <span class="hits">6</span>
            

            

            <code class="ruby">    head :ok</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            
            

            

            <code class="ruby">  # GET /home/timezone                                                     AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="86">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def timezone</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            
            

            

            <code class="ruby">    #</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            
            

            

            <code class="ruby">    # (new Date()).getTimezoneOffset() in JavaScript returns (UTC - localtime) in</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            
            

            

            <code class="ruby">    # minutes, while ActiveSupport::TimeZone expects (localtime - UTC) in seconds.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            
            

            

            <code class="ruby">    #</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="34" data-linenumber="91">
            <span class="hits">34</span>
            

            

            <code class="ruby">    if params[:offset]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="34" data-linenumber="92">
            <span class="hits">34</span>
            

            

            <code class="ruby">      session[:timezone_offset] = params[:offset].to_i * -60</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="34" data-linenumber="93">
            <span class="hits">34</span>
            

            

            <code class="ruby">      ActiveSupport::TimeZone[session[:timezone_offset]]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="34" data-linenumber="95">
            <span class="hits">34</span>
            

            

            <code class="ruby">    head :ok</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="98">
            <span class="hits">1</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="101">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def get_activities(options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="102">
            <span class="hits">29</span>
            

            

            <code class="ruby">    options[:asset]    ||= activity_asset</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="103">
            <span class="hits">29</span>
            

            

            <code class="ruby">    options[:event]    ||= activity_event</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="104">
            <span class="hits">29</span>
            

            

            <code class="ruby">    options[:user]     ||= activity_user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="105">
            <span class="hits">29</span>
            

            

            <code class="ruby">    options[:duration] ||= activity_duration</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="106">
            <span class="hits">29</span>
            

            

            <code class="ruby">    options[:max]      ||= 500</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="108">
            <span class="hits">29</span>
            

            

            <code class="ruby">    Version.includes(user: [:avatar]).latest(options).visible_to(current_user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="112">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def activity_asset</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="113">
            <span class="hits">29</span>
            

            

            <code class="ruby">    asset = current_user.pref[:activity_asset]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="114">
            <span class="hits">29</span>
            

            

            <code class="ruby">    if asset.nil? || asset == &quot;all&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            
            

            

            <code class="ruby">      nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="117">
            <span class="hits">1</span>
            

            

            <code class="ruby">      asset.singularize.capitalize</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="122">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def activity_event</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="123">
            <span class="hits">29</span>
            

            

            <code class="ruby">    event = current_user.pref[:activity_event]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="124">
            <span class="hits">29</span>
            

            

            <code class="ruby">    if event == &quot;all_events&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="125">
            
            

            

            <code class="ruby">      %w[create update destroy]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="127">
            <span class="hits">29</span>
            

            

            <code class="ruby">      event</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            
            

            

            <code class="ruby">  # TODO: this is ugly, ugly code. It&#39;s being security patched now but urgently</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            
            

            

            <code class="ruby">  # needs refactoring to use user id instead. Permuations based on name or email</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            
            

            

            <code class="ruby">  # yield incorrect results.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="135">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def activity_user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="33" data-linenumber="136">
            <span class="hits">33</span>
            

            

            <code class="ruby">    return nil if current_user.pref[:activity_user] == &quot;all_users&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="137">
            <span class="hits">32</span>
            

            

            <code class="ruby">    return nil unless current_user.pref[:activity_user]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="139">
            <span class="hits">4</span>
            

            

            <code class="ruby">    is_email = current_user.pref[:activity_user].include?(&quot;@&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="141">
            <span class="hits">4</span>
            

            

            <code class="ruby">    user = if is_email</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="142">
            <span class="hits">1</span>
            

            

            <code class="ruby">             User.where(email: current_user.pref[:activity_user]).first</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            
            

            

            <code class="ruby">           else # first_name middle_name last_name any_name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="144">
            <span class="hits">3</span>
            

            

            <code class="ruby">             name_query(current_user.pref[:activity_user])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            
            

            

            <code class="ruby">           end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="147">
            <span class="hits">4</span>
            

            

            <code class="ruby">    user.is_a?(User) ? user.id : nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="150">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def name_query(user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="151">
            <span class="hits">3</span>
            

            

            <code class="ruby">    if user.include?(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="152">
            <span class="hits">2</span>
            

            

            <code class="ruby">      user.name_permutations.map do |first, last|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="153">
            <span class="hits">4</span>
            

            

            <code class="ruby">        User.where(first_name: first, last_name: last)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="154">
            
            

            

            <code class="ruby">      end.map(&amp;:to_a).flatten.first</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="156">
            <span class="hits">1</span>
            

            

            <code class="ruby">      [User.where(first_name: user), User.where(last_name: user)].map(&amp;:to_a).flatten.first</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="161">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def activity_duration</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="162">
            <span class="hits">29</span>
            

            

            <code class="ruby">    duration = current_user.pref[:activity_duration]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="163">
            <span class="hits">29</span>
            

            

            <code class="ruby">    if duration</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="164">
            <span class="hits">1</span>
            

            

            <code class="ruby">      words = duration.split(&quot;_&quot;) # &quot;two_weeks&quot; =&gt; 2.weeks</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="165">
            <span class="hits">1</span>
            

            

            <code class="ruby">      %w[zero one two].index(words.first).send(words.last) if %w[one two].include?(words.first) &amp;&amp; %w[hour day days week weeks month].include?(words.last)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="166">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="167">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="168">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="169">
            <span class="hits">1</span>
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_home_controller, self)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="41aeface8ad6e11762caf233e62ad8cdb09e1058">
  <div class="header">
    <h3>app/controllers/lists_controller.rb</h3>
    <h4>
      <span class="red">
  40.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>15</b> relevant lines.
      <span class="green"><b>6</b> lines covered</span> and
      <span class="red"><b>9</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            <span class="hits">1</span>
            

            

            <code class="ruby">class ListsController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">  # POST /lists</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="11">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">    list_params[:user_id] = (current_user.id if params[:is_global].to_i.zero?)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">    # Find any existing list with the same name (case insensitive)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">    if @list = List.where(&quot;lower(name) = ?&quot;, list_params[:name].downcase).where(user_id: list_params[:user_id]).first</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">      @list.update(list_params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">      @list = List.create(list_params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">    respond_with(@list)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby">  # DELETE /lists/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="26">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def destroy</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            
            

            

            <code class="ruby">    @list = List.find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">    @list.destroy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            
            

            

            <code class="ruby">    respond_with(@list)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="33">
            <span class="hits">1</span>
            

            

            <code class="ruby">  protected</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="35">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def list_params</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="36">
            
            

            

            <code class="ruby">    params.require(:list).permit(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            
            

            

            <code class="ruby">      :name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            
            

            

            <code class="ruby">      :url,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            
            

            

            <code class="ruby">      :user_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            
            

            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="43">
            <span class="hits">1</span>
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_lists_controller, self)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="8004bf4687d96d44226fb939ae2bea13c195081a">
  <div class="header">
    <h3>app/controllers/passwords_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>3</b> relevant lines.
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            <span class="hits">1</span>
            

            

            <code class="ruby">class PasswordsController &lt; Devise::PasswordsController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            <span class="hits">1</span>
            

            

            <code class="ruby">  respond_to :html</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            <span class="hits">1</span>
            

            

            <code class="ruby">  append_view_path &#39;app/views/devise&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="b2508b1443cedc1b73fbcee47f09bd2d3a14eec5">
  <div class="header">
    <h3>app/controllers/registrations_controller.rb</h3>
    <h4>
      <span class="yellow">
  85.71%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>7</b> relevant lines.
      <span class="green"><b>6</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            <span class="hits">1</span>
            

            

            <code class="ruby">class RegistrationsController &lt; Devise::RegistrationsController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            <span class="hits">1</span>
            

            

            <code class="ruby">  respond_to :html</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            <span class="hits">1</span>
            

            

            <code class="ruby">  append_view_path &#39;app/views/devise&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def edit</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">    redirect_to profile_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def after_inactive_sign_up_path_for(*)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="17">
            <span class="hits">1</span>
            

            

            <code class="ruby">    new_user_session_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="faa649fe77dfb608a3daaf14015e6cca52b6163f">
  <div class="header">
    <h3>app/controllers/sessions_controller.rb</h3>
    <h4>
      <span class="red">
  80.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>5</b> relevant lines.
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            <span class="hits">1</span>
            

            

            <code class="ruby">class SessionsController &lt; Devise::SessionsController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            <span class="hits">1</span>
            

            

            <code class="ruby">  respond_to :html</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            <span class="hits">1</span>
            

            

            <code class="ruby">  append_view_path &#39;app/views/devise&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def after_sign_out_path_for(*)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">    new_user_session_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="687b3ea204385fc370946b711f430aa56d4a8cd4">
  <div class="header">
    <h3>app/controllers/tasks_controller.rb</h3>
    <h4>
      <span class="green">
  99.04%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>104</b> relevant lines.
      <span class="green"><b>103</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            <span class="hits">1</span>
            

            

            <code class="ruby">class TasksController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            <span class="hits">1</span>
            

            

            <code class="ruby">  before_action :set_current_tab, only: %i[index show]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            <span class="hits">1</span>
            

            

            <code class="ruby">  before_action :update_sidebar, only: :index</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">  # GET /tasks</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="14">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="15">
            <span class="hits">17</span>
            

            

            <code class="ruby">    @view = view</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="16">
            <span class="hits">17</span>
            

            

            <code class="ruby">    @tasks = Task.find_all_grouped(current_user, @view)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="18">
            <span class="hits">17</span>
            

            

            <code class="ruby">    respond_with @tasks do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="19">
            <span class="hits">17</span>
            

            

            <code class="ruby">      format.xls { render layout: &#39;header&#39; }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="20">
            <span class="hits">17</span>
            

            

            <code class="ruby">      format.csv { render csv: @tasks.map(&amp;:second).flatten }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="21">
            <span class="hits">20</span>
            

            

            <code class="ruby">      format.xml { render xml: @tasks, except: [:subscribed_users] }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">  # GET /tasks/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="27">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def show</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="28">
            <span class="hits">6</span>
            

            

            <code class="ruby">    @task = Task.tracked_by(current_user).find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="29">
            <span class="hits">6</span>
            

            

            <code class="ruby">    respond_with(@task)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby">  # GET /tasks/new</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="35">
            <span class="hits">6</span>
            

            

            <code class="ruby">    @view = view</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="36">
            <span class="hits">6</span>
            

            

            <code class="ruby">    @task = Task.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="37">
            <span class="hits">6</span>
            

            

            <code class="ruby">    @bucket = Setting.unroll(:task_bucket)[1..-1] &lt;&lt; [t(:due_specific_date, default: &#39;On Specific Date...&#39;), :specific_time]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="38">
            <span class="hits">6</span>
            

            

            <code class="ruby">    @category = Setting.unroll(:task_category)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="40">
            <span class="hits">6</span>
            

            

            <code class="ruby">    if params[:related]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="41">
            <span class="hits">3</span>
            

            

            <code class="ruby">      model, id = params[:related].split(/_(\d+)/)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="42">
            <span class="hits">3</span>
            

            

            <code class="ruby">      if related = model.classify.constantize.my(current_user).find_by_id(id)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="43">
            <span class="hits">1</span>
            

            

            <code class="ruby">        instance_variable_set(&quot;@asset&quot;, related)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="45">
            <span class="hits">2</span>
            

            

            <code class="ruby">        respond_to_related_not_found(model) &amp;&amp; return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="49">
            <span class="hits">4</span>
            

            

            <code class="ruby">    respond_with(@task)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            
            

            

            <code class="ruby">  # GET /tasks/1/edit                                                      AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="54">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def edit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="55">
            <span class="hits">7</span>
            

            

            <code class="ruby">    @view = view</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="56">
            <span class="hits">7</span>
            

            

            <code class="ruby">    @task = Task.tracked_by(current_user).find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="57">
            <span class="hits">5</span>
            

            

            <code class="ruby">    @bucket = Setting.unroll(:task_bucket)[1..-1] &lt;&lt; [t(:due_specific_date, default: &#39;On Specific Date...&#39;), :specific_time]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="58">
            <span class="hits">5</span>
            

            

            <code class="ruby">    @category = Setting.unroll(:task_category)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="59">
            <span class="hits">5</span>
            

            

            <code class="ruby">    @asset = @task.asset if @task.asset_id?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="61">
            <span class="hits">5</span>
            

            

            <code class="ruby">    @previous = Task.tracked_by(current_user).find_by_id(detect_previous_id) || detect_previous_id if detect_previous_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="63">
            <span class="hits">5</span>
            

            

            <code class="ruby">    respond_with(@task)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            
            

            

            <code class="ruby">  # POST /tasks</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="68">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="69">
            <span class="hits">8</span>
            

            

            <code class="ruby">    @view = view</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="70">
            <span class="hits">8</span>
            

            

            <code class="ruby">    @task = Task.new(task_params) # NOTE: we don&#39;t display validation messages for tasks.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="72">
            <span class="hits">8</span>
            

            

            <code class="ruby">    respond_with(@task) do |_format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="73">
            <span class="hits">8</span>
            

            

            <code class="ruby">      if @task.save</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="74">
            <span class="hits">7</span>
            

            

            <code class="ruby">        update_sidebar if called_from_index_page?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            
            

            

            <code class="ruby">  # PUT /tasks/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="81">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="82">
            <span class="hits">9</span>
            

            

            <code class="ruby">    @view = view</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="83">
            <span class="hits">9</span>
            

            

            <code class="ruby">    @task = Task.tracked_by(current_user).find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="84">
            <span class="hits">7</span>
            

            

            <code class="ruby">    @task_before_update = @task.dup</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="86">
            <span class="hits">7</span>
            

            

            <code class="ruby">    @task_before_update.bucket = if @task.due_at &amp;&amp; (@task.due_at &lt; Date.today.to_time)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="87">
            
            

            

            <code class="ruby">                                   &quot;overdue&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            
            

            

            <code class="ruby">                                 else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="89">
            <span class="hits">7</span>
            

            

            <code class="ruby">                                   @task.computed_bucket</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            
            

            

            <code class="ruby">                                 end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="92">
            <span class="hits">7</span>
            

            

            <code class="ruby">    respond_with(@task) do |_format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="93">
            <span class="hits">7</span>
            

            

            <code class="ruby">      if @task.update(task_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="94">
            <span class="hits">6</span>
            

            

            <code class="ruby">        @task.bucket = @task.computed_bucket</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="95">
            <span class="hits">6</span>
            

            

            <code class="ruby">        if called_from_index_page?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="96">
            <span class="hits">5</span>
            

            

            <code class="ruby">          @empty_bucket = @task_before_update.bucket if Task.bucket_empty?(@task_before_update.bucket, current_user, @view)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="97">
            <span class="hits">5</span>
            

            

            <code class="ruby">          update_sidebar</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            
            

            

            <code class="ruby">  # DELETE /tasks/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="105">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="106">
            <span class="hits">9</span>
            

            

            <code class="ruby">    @view = view</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="107">
            <span class="hits">9</span>
            

            

            <code class="ruby">    @task = Task.tracked_by(current_user).find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="108">
            <span class="hits">7</span>
            

            

            <code class="ruby">    @task.destroy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            
            

            

            <code class="ruby">    # Make sure bucket&#39;s div gets hidden if we&#39;re deleting last task in the bucket.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="111">
            <span class="hits">7</span>
            

            

            <code class="ruby">    @empty_bucket = params[:bucket] if Task.bucket_empty?(params[:bucket], current_user, @view)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="113">
            <span class="hits">7</span>
            

            

            <code class="ruby">    update_sidebar if called_from_index_page?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="114">
            <span class="hits">7</span>
            

            

            <code class="ruby">    respond_with(@task)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            
            

            

            <code class="ruby">  # PUT /tasks/1/complete</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="119">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def complete</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="120">
            <span class="hits">5</span>
            

            

            <code class="ruby">    @task = Task.tracked_by(current_user).find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="121">
            <span class="hits">3</span>
            

            

            <code class="ruby">    @task&amp;.update(completed_at: Time.now, completed_by: current_user.id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            
            

            

            <code class="ruby">    # Make sure bucket&#39;s div gets hidden if it&#39;s the last completed task in the bucket.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="124">
            <span class="hits">3</span>
            

            

            <code class="ruby">    @empty_bucket = params[:bucket] if Task.bucket_empty?(params[:bucket], current_user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="126">
            <span class="hits">3</span>
            

            

            <code class="ruby">    update_sidebar unless params[:bucket].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="127">
            <span class="hits">3</span>
            

            

            <code class="ruby">    respond_with(@task)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            
            

            

            <code class="ruby">  # PUT /tasks/1/uncomplete</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="132">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def uncomplete</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="133">
            <span class="hits">2</span>
            

            

            <code class="ruby">    @task = Task.tracked_by(current_user).find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="134">
            <span class="hits">1</span>
            

            

            <code class="ruby">    @task&amp;.update(completed_at: nil, completed_by: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            
            

            

            <code class="ruby">    # Make sure bucket&#39;s div gets hidden if we&#39;re deleting last task in the bucket.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="137">
            <span class="hits">1</span>
            

            

            <code class="ruby">    @empty_bucket = params[:bucket] if Task.bucket_empty?(params[:bucket], current_user, @view)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="139">
            <span class="hits">1</span>
            

            

            <code class="ruby">    update_sidebar</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="140">
            <span class="hits">1</span>
            

            

            <code class="ruby">    respond_with(@task)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            
            

            

            <code class="ruby">  # POST /tasks/auto_complete/query                                        AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            
            

            

            <code class="ruby">  # Handled by ApplicationController :auto_complete</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            
            

            

            <code class="ruby">  # Ajax request to filter out a list of tasks.                            AJAX</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="149">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def filter</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="150">
            <span class="hits">7</span>
            

            

            <code class="ruby">    @view = view</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="152">
            <span class="hits">7</span>
            

            

            <code class="ruby">    update_session do |filters|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="153">
            <span class="hits">7</span>
            

            

            <code class="ruby">      if params[:checked].true?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="154">
            <span class="hits">3</span>
            

            

            <code class="ruby">        filters &lt;&lt; params[:filter]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="156">
            <span class="hits">4</span>
            

            

            <code class="ruby">        filters.delete(params[:filter])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="161">
            <span class="hits">1</span>
            

            

            <code class="ruby">  protected</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="163">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def task_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="164">
            <span class="hits">15</span>
            

            

            <code class="ruby">    return {} unless params[:task]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="165">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="166">
            <span class="hits">14</span>
            

            

            <code class="ruby">    params.require(:task).permit(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="167">
            
            

            

            <code class="ruby">      :user_id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="168">
            
            

            

            <code class="ruby">      :assigned_to,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="169">
            
            

            

            <code class="ruby">      :completed_by,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            
            

            

            <code class="ruby">      :name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            
            

            

            <code class="ruby">      :asset_id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            
            

            

            <code class="ruby">      :asset_type,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="173">
            
            

            

            <code class="ruby">      :priority,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="174">
            
            

            

            <code class="ruby">      :category,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="175">
            
            

            

            <code class="ruby">      :bucket,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="176">
            
            

            

            <code class="ruby">      :due_at,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="177">
            
            

            

            <code class="ruby">      :completed_at,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="178">
            
            

            

            <code class="ruby">      :deleted_at,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="179">
            
            

            

            <code class="ruby">      :background_info,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            
            

            

            <code class="ruby">      :calendar</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="181">
            
            

            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="182">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="183">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="184">
            <span class="hits">1</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="185">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="186">
            
            

            

            <code class="ruby">  # Yields array of current filters and updates the session using new values.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="187">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="188">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def update_session</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="189">
            <span class="hits">25</span>
            

            

            <code class="ruby">    name = &quot;filter_by_task_#{@view}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="190">
            <span class="hits">25</span>
            

            

            <code class="ruby">    filters = (session[name].nil? ? [] : session[name].split(&quot;,&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="191">
            <span class="hits">25</span>
            

            

            <code class="ruby">    yield filters</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="192">
            <span class="hits">25</span>
            

            

            <code class="ruby">    session[name] = filters.uniq.join(&quot;,&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="193">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="194">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="195">
            
            

            

            <code class="ruby">  # Collect data necessary to render filters sidebar.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="196">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="197">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def update_sidebar</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="198">
            <span class="hits">35</span>
            

            

            <code class="ruby">    @view = view</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="199">
            <span class="hits">35</span>
            

            

            <code class="ruby">    @task_total = Task.totals(current_user, @view)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="200">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="201">
            
            

            

            <code class="ruby">    # Update filters session if we added, deleted, or completed a task.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="202">
            <span class="hits">35</span>
            

            

            <code class="ruby">    if @task</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="203">
            <span class="hits">18</span>
            

            

            <code class="ruby">      update_session do |filters|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="204">
            <span class="hits">18</span>
            

            

            <code class="ruby">        if @empty_bucket # deleted, completed, rescheduled, or reassigned and need to hide a bucket</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="205">
            <span class="hits">6</span>
            

            

            <code class="ruby">          filters.delete(@empty_bucket)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="206">
            <span class="hits">12</span>
            

            

            <code class="ruby">        elsif !@task.deleted_at &amp;&amp; !@task.completed_at # created new task</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="207">
            <span class="hits">12</span>
            

            

            <code class="ruby">          filters &lt;&lt; @task.computed_bucket</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="208">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="209">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="210">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="211">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="212">
            
            

            

            <code class="ruby">    # Create default filters if filters session is empty.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="213">
            <span class="hits">35</span>
            

            

            <code class="ruby">    name = &quot;filter_by_task_#{@view}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="214">
            <span class="hits">35</span>
            

            

            <code class="ruby">    unless session[name]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="81" data-linenumber="215">
            <span class="hits">81</span>
            

            

            <code class="ruby">      filters = @task_total.keys.select { |key| key != :all &amp;&amp; @task_total[key] != 0 }.join(&quot;,&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="216">
            <span class="hits">15</span>
            

            

            <code class="ruby">      session[name] = filters unless filters.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="217">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="218">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="219">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="220">
            
            

            

            <code class="ruby">  # Ensure view is allowed</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="221">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="222">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def view</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="98" data-linenumber="223">
            <span class="hits">98</span>
            

            

            <code class="ruby">    view = params[:view]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="98" data-linenumber="224">
            <span class="hits">98</span>
            

            

            <code class="ruby">    views = Task::ALLOWED_VIEWS</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="98" data-linenumber="225">
            <span class="hits">98</span>
            

            

            <code class="ruby">    views.include?(view) ? view : views.first</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="226">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="227">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="228">
            <span class="hits">1</span>
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_tasks_controller, self)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="229">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="ac18fc5a701fcf938184bbc6f6934bb0f51e00ac">
  <div class="header">
    <h3>app/controllers/users_controller.rb</h3>
    <h4>
      <span class="green">
  92.98%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>57</b> relevant lines.
      <span class="green"><b>53</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            <span class="hits">1</span>
            

            

            <code class="ruby">class UsersController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            <span class="hits">1</span>
            

            

            <code class="ruby">  before_action :set_current_tab, only: %i[show opportunities_overview] # Don&#39;t hightlight any tabs.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="11">
            <span class="hits">1</span>
            

            

            <code class="ruby">  check_authorization</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            <span class="hits">1</span>
            

            

            <code class="ruby">  load_and_authorize_resource # handles all security</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="15">
            <span class="hits">1</span>
            

            

            <code class="ruby">  respond_to :html, only: %i[show new]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">  # GET /users/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">  # GET /users/1.js</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="20">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def show</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="21">
            <span class="hits">7</span>
            

            

            <code class="ruby">    @user = current_user if params[:id].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="22">
            <span class="hits">7</span>
            

            

            <code class="ruby">    respond_with(@user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">  # GET /users/1/edit.js</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="27">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def edit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="28">
            <span class="hits">2</span>
            

            

            <code class="ruby">    respond_with(@user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby">  # PUT /users/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby">  # PUT /users/1.js</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="35">
            <span class="hits">3</span>
            

            

            <code class="ruby">    @user.update(user_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="36">
            <span class="hits">3</span>
            

            

            <code class="ruby">    flash[:notice] = t(:msg_user_updated)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="37">
            <span class="hits">3</span>
            

            

            <code class="ruby">    respond_with(@user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            
            

            

            <code class="ruby">  # GET /users/1/avatar</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            
            

            

            <code class="ruby">  # GET /users/1/avatar.js</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="43">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def avatar</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="44">
            <span class="hits">1</span>
            

            

            <code class="ruby">    respond_with(@user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            
            

            

            <code class="ruby">  # PUT /users/1/upload_avatar</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            
            

            

            <code class="ruby">  # PUT /users/1/upload_avatar.js</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="50">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def upload_avatar</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="51">
            <span class="hits">3</span>
            

            

            <code class="ruby">    if params[:gravatar]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="52">
            <span class="hits">1</span>
            

            

            <code class="ruby">      @user.avatar = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="53">
            <span class="hits">1</span>
            

            

            <code class="ruby">      @user.save</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="54">
            <span class="hits">1</span>
            

            

            <code class="ruby">      render</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="56">
            <span class="hits">2</span>
            

            

            <code class="ruby">      if params[:avatar]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="57">
            <span class="hits">1</span>
            

            

            <code class="ruby">        @avatar = Avatar.create(avatar_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="58">
            <span class="hits">1</span>
            

            

            <code class="ruby">        if @avatar.valid?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="59">
            <span class="hits">1</span>
            

            

            <code class="ruby">          @user.avatar = @avatar</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            
            

            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="61">
            
            

            

            <code class="ruby">          @user.avatar.errors.clear</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="62">
            
            

            

            <code class="ruby">          @user.avatar.errors.add(:image, t(:msg_bad_image_file))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="65">
            <span class="hits">2</span>
            

            

            <code class="ruby">      responds_to_parent do</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            
            

            

            <code class="ruby">        # Without return RSpec2 screams bloody murder about rendering twice:</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            
            

            

            <code class="ruby">        # within the block and after yield in responds_to_parent.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="68">
            <span class="hits">2</span>
            

            

            <code class="ruby">        render &amp;&amp; (return if Rails.env.test?)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            
            

            

            <code class="ruby">  # GET /users/1/password</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            
            

            

            <code class="ruby">  # GET /users/1/password.js</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="76">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def password</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="77">
            <span class="hits">1</span>
            

            

            <code class="ruby">    respond_with(@user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            
            

            

            <code class="ruby">  # PUT /users/1/change_password</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            
            

            

            <code class="ruby">  # PUT /users/1/change_password.js</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="83">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def change_password</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="84">
            <span class="hits">5</span>
            

            

            <code class="ruby">    if @user.valid_password?(params[:current_password])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="85">
            <span class="hits">3</span>
            

            

            <code class="ruby">      if params[:user][:password].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="86">
            <span class="hits">1</span>
            

            

            <code class="ruby">        flash[:notice] = t(:msg_password_not_changed)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="88">
            <span class="hits">2</span>
            

            

            <code class="ruby">        @user.password = params[:user][:password]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="89">
            <span class="hits">2</span>
            

            

            <code class="ruby">        @user.password_confirmation = params[:user][:password_confirmation]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="90">
            <span class="hits">2</span>
            

            

            <code class="ruby">        @user.save</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="91">
            <span class="hits">2</span>
            

            

            <code class="ruby">        flash[:notice] = t(:msg_password_changed)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="94">
            <span class="hits">2</span>
            

            

            <code class="ruby">      @user.errors.add(:current_password, t(:msg_invalid_password))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="97">
            <span class="hits">5</span>
            

            

            <code class="ruby">    respond_with(@user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            
            

            

            <code class="ruby">  # GET /users/1/redraw</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="102">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def redraw</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="103">
            
            

            

            <code class="ruby">    current_user.preference[:locale] = params[:locale]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="104">
            
            

            

            <code class="ruby">    render js: %(window.location.href = &quot;#{user_path(current_user)}&quot;;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            
            

            

            <code class="ruby">  # GET /users/opportunities_overview</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="109">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def opportunities_overview</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="110">
            <span class="hits">11</span>
            

            

            <code class="ruby">    @users_with_opportunities = User.have_assigned_opportunities.order(:first_name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="111">
            <span class="hits">11</span>
            

            

            <code class="ruby">    @unassigned_opportunities = Opportunity.my(current_user).unassigned.pipeline.order(:stage).includes(:account, :user, :tags)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="114">
            <span class="hits">1</span>
            

            

            <code class="ruby">  protected</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="116">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def user_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="117">
            <span class="hits">3</span>
            

            

            <code class="ruby">    return {} unless params[:user]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="119">
            <span class="hits">3</span>
            

            

            <code class="ruby">    params[:user][:email].try(:strip!)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="120">
            <span class="hits">3</span>
            

            

            <code class="ruby">    params[:user][:alt_email].try(:strip!)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="122">
            <span class="hits">3</span>
            

            

            <code class="ruby">    params[:user].permit(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            
            

            

            <code class="ruby">      :username,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            
            

            

            <code class="ruby">      :email,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            
            

            

            <code class="ruby">      :first_name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            
            

            

            <code class="ruby">      :last_name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            
            

            

            <code class="ruby">      :title,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            
            

            

            <code class="ruby">      :company,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            
            

            

            <code class="ruby">      :alt_email,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            
            

            

            <code class="ruby">      :phone,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            
            

            

            <code class="ruby">      :mobile,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            
            

            

            <code class="ruby">      :aim,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            
            

            

            <code class="ruby">      :yahoo,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            
            

            

            <code class="ruby">      :google,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            
            

            

            <code class="ruby">      :skype</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            
            

            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="139">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def avatar_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="140">
            <span class="hits">1</span>
            

            

            <code class="ruby">    return {} unless params[:avatar]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="142">
            <span class="hits">1</span>
            

            

            <code class="ruby">    params[:avatar]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            
            

            

            <code class="ruby">      .permit(:image)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            
            

            

            <code class="ruby">      .merge(entity: @user, user_id: @user.id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="147">
            <span class="hits">1</span>
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_users_controller, self)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="9c9a30c03665ca1cf4e31ca746c8afd1b99edff2">
  <div class="header">
    <h3>app/helpers/accounts_helper.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>81</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>81</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module AccountsHelper</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">  # Sidebar checkbox control for filtering accounts by category.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">  def account_category_checkbox(category, count)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">    entity_filter_checkbox(:category, category, count)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">  # Quick account summary for RSS/ATOM feeds.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">  def account_summary(account)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">    [number_to_currency(account.opportunities.pipeline.map(&amp;:weighted_amount).sum, precision: 0),</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">     t(:added_by, time_ago: time_ago_in_words(account.created_at), user: account.user_id_full_name),</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">     t(&#39;pluralize.contact&#39;, account.contacts_count),</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">     t(&#39;pluralize.opportunity&#39;, account.opportunities_count),</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">     t(&#39;pluralize.comment&#39;, account.comments.count)].join(&#39;, &#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">  # Generates a select list with the first 25 accounts</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby">  # and prepends the currently selected account, if any.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">  def account_select(options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            
            

            

            <code class="ruby">    options[:selected] = @account&amp;.id.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            
            

            

            <code class="ruby">    accounts = ([@account.new_record? ? nil : @account] + Account.my(current_user).order(:name).limit(25)).compact.uniq</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            
            

            

            <code class="ruby">    collection_select :account, :id, accounts, :id, :name,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            
            

            

            <code class="ruby">                      { include_blank: true },</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            
            

            

            <code class="ruby">                      style: &#39;width:330px;&#39;, class: &#39;select2&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            
            

            

            <code class="ruby">                      placeholder: t(:select_an_account),</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            
            

            

            <code class="ruby">                      &quot;data-url&quot;: auto_complete_accounts_path(format: &#39;json&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="36">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            
            

            

            <code class="ruby">  # Select an existing account or create a new one.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            
            

            

            <code class="ruby">  def account_select_or_create(form, &amp;_block)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            
            

            

            <code class="ruby">    options = {}</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="42">
            
            

            

            <code class="ruby">    yield options if block_given?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="44">
            
            

            

            <code class="ruby">    content_tag(:div, class: &#39;label&#39;) do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="45">
            
            

            

            <code class="ruby">      t(:account).html_safe +</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            
            

            

            <code class="ruby">        content_tag(:span, id: &#39;account_create_title&#39;) do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="47">
            
            

            

            <code class="ruby">          &quot; (#{t :create_new} #{t :or} &lt;a href=&#39;#&#39; onclick=&#39;crm.show_select_account(); return false;&#39;&gt;#{t :select_existing}&lt;/a&gt;):&quot;.html_safe</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="48">
            
            

            

            <code class="ruby">        end +</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="49">
            
            

            

            <code class="ruby">        content_tag(:span, id: &#39;account_select_title&#39;) do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="50">
            
            

            

            <code class="ruby">          &quot; (&lt;a href=&#39;#&#39; onclick=&#39;crm.show_create_account(); return false;&#39;&gt;#{t :create_new}&lt;/a&gt; #{t :or} #{t :select_existing}):&quot;.html_safe</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            
            

            

            <code class="ruby">        end +</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="52">
            
            

            

            <code class="ruby">        content_tag(:span, &#39;:&#39;, id: &#39;account_disabled_title&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="53">
            
            

            

            <code class="ruby">    end +</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="54">
            
            

            

            <code class="ruby">      account_select(options) +</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="55">
            
            

            

            <code class="ruby">      form.text_field(:name, style: &#39;width:324px; display:none;&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="56">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            
            

            

            <code class="ruby">  # Output account url for a given contact</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            
            

            

            <code class="ruby">  # - a helper so it is easy to override in plugins that allow for several accounts</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="61">
            
            

            

            <code class="ruby">  def account_with_url_for(contact)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="62">
            
            

            

            <code class="ruby">    contact.account ? link_to(h(contact.account.name), account_path(contact.account)) : &quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="63">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            
            

            

            <code class="ruby">  # Output account with title and department</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            
            

            

            <code class="ruby">  # - a helper so it is easy to override in plugins that allow for several accounts</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="68">
            
            

            

            <code class="ruby">  def account_with_title_and_department(contact)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="69">
            
            

            

            <code class="ruby">    text = if !contact.title.blank? &amp;&amp; contact.account</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            
            

            

            <code class="ruby">             # works_at: &quot;{{h(job_title)}} at {{h(company)}}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="71">
            
            

            

            <code class="ruby">             content_tag :div, t(:works_at, job_title: h(contact.title), company: h(account_with_url_for(contact))).html_safe</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="72">
            
            

            

            <code class="ruby">           elsif !contact.title.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="73">
            
            

            

            <code class="ruby">             content_tag :div, h(contact.title)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="74">
            
            

            

            <code class="ruby">           elsif contact.account</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="75">
            
            

            

            <code class="ruby">             content_tag :div, account_with_url_for(contact)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="76">
            
            

            

            <code class="ruby">           else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="77">
            
            

            

            <code class="ruby">             &quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="78">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="79">
            
            

            

            <code class="ruby">    text += t(:department_small, h(contact.department)) unless contact.department.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="80">
            
            

            

            <code class="ruby">    text</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="81">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            
            

            

            <code class="ruby">  # &quot;title, department at Account name&quot; used in index_brief and index_long</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            
            

            

            <code class="ruby">  # - a helper so it is easy to override in plugins that allow for several accounts</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="86">
            
            

            

            <code class="ruby">  def brief_account_info(contact)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="87">
            
            

            

            <code class="ruby">    text = &quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="88">
            
            

            

            <code class="ruby">    title = contact.title</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="89">
            
            

            

            <code class="ruby">    department = contact.department</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="90">
            
            

            

            <code class="ruby">    account = contact.account</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="91">
            
            

            

            <code class="ruby">    account_text = &quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="92">
            
            

            

            <code class="ruby">    account_text = link_to_if(can?(:read, account), h(account.name), account_path(account)) if account.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="94">
            
            

            

            <code class="ruby">    text += if title.present? &amp;&amp; department.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="95">
            
            

            

            <code class="ruby">              t(:account_with_title_department, title: h(title), department: h(department), account: account_text)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="96">
            
            

            

            <code class="ruby">            elsif title.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="97">
            
            

            

            <code class="ruby">              t(:account_with_title, title: h(title), account: account_text)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="98">
            
            

            

            <code class="ruby">            elsif department.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="99">
            
            

            

            <code class="ruby">              t(:account_with_title, title: h(department), account: account_text)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="100">
            
            

            

            <code class="ruby">            elsif account_text.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="101">
            
            

            

            <code class="ruby">              t(:works_at, job_title: &quot;&quot;, company: account_text)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="102">
            
            

            

            <code class="ruby">            else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="103">
            
            

            

            <code class="ruby">              &quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="104">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="105">
            
            

            

            <code class="ruby">    text.html_safe</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="106">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            
            

            

            <code class="ruby">  # We have too much logic in the account views</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            
            

            

            <code class="ruby">  # - a helper that abstracts the logic to the backend</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="110">
            
            

            

            <code class="ruby">  def display_value(value)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="111">
            
            

            

            <code class="ruby">    return &quot;N/A&quot; if value.zero?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="113">
            
            

            

            <code class="ruby">    number_to_currency(value, precision: 0)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="114">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="116">
            
            

            

            <code class="ruby">  def display_assigned(account)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="117">
            
            

            

            <code class="ruby">    return truncate(account.assignee.full_name, length: 16) if account.assigned_to</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="119">
            
            

            

            <code class="ruby">    nil</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="120">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="121">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="be249e6055436738be47028d9734e468af9c1a54">
  <div class="header">
    <h3>app/helpers/addresses_helper.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>9</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>9</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module AddressesHelper</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">  # Sets up new address when used in forms.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">  def get_address(asset, type)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">    asset.send(&quot;build_#{type}&quot;.to_sym) if asset.send(type.to_sym).nil?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">    asset.send(type.to_sym)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">  def priority_countries</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">    Setting[:priority_countries]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="25770e5616114c170b30547bfe45f44fb0745659">
  <div class="header">
    <h3>app/helpers/admin/application_helper.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>8</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>8</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module Admin::ApplicationHelper</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">  def link_to_confirm_delete(model)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">    link_to(t(:yes_button),</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">            url_for([:admin, model]),</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">            method:  :delete,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">            remote:  true)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="264ca494dc75534b0288a4cabab81a8cccb854d4">
  <div class="header">
    <h3>app/helpers/admin/field_groups_helper.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>18</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>18</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module Admin::FieldGroupsHelper</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  include ::ERB::Util</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">  def field_group_subtitle(field_group)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">    asset = field_group.klass_name.downcase</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">    html = t(field_group.name, default: h(field_group.label)).html_safe</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">    html &lt;&lt; content_tag(:small, id: &quot;#{asset}_field_group_#{field_group.id}_intro&quot;) do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">      if field_group.tag_id</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">        t(:field_group_tag_restriction, assets: asset.pluralize, tag: field_group.tag.try(:name))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">        t(:field_group_unrestricted, assets: asset.pluralize)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">    html</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            
            

            

            <code class="ruby">  def link_to_confirm(field_group)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            
            

            

            <code class="ruby">    link_to(t(:delete) + &quot;?&quot;, confirm_admin_field_group_path(field_group), method: :get, remote: true)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="6c7d4db4dd5b288ec97763803e245a9973814b53">
  <div class="header">
    <h3>app/helpers/admin/fields_helper.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>9</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>9</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module Admin::FieldsHelper</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">  # Returns the list of :null and :safe database column transitions.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby">  # Only these options should be shown on the custom field edit form.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">  def field_edit_as_options(field = nil)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">    # Return every available field_type if no restriction</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">    options = (field.as.present? ? field.available_as : Field.field_types).keys</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">    options.map { |k| [t(&quot;field_types.#{k}.title&quot;), k] }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">  def field_group_options</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">    FieldGroup.all.map { |fg| [fg.name, fg.id] }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="04b27418e947ada1f74730032ecc3ae5b50e8d5c">
  <div class="header">
    <h3>app/helpers/admin/plugins_helper.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>2</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module Admin::PluginsHelper</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="16d328f47f2f99b365580073e0ee2b03af2adef5">
  <div class="header">
    <h3>app/helpers/admin/settings_helper.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>2</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module Admin::SettingsHelper</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="798a3ed05c0296cd670cdea2ab63ae39ef396685">
  <div class="header">
    <h3>app/helpers/admin/tags_helper.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>5</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>5</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module Admin::TagsHelper</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  def link_to_confirm(tag)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">    link_to(t(:delete) + &quot;?&quot;, confirm_admin_tag_path(tag), method: :get, remote: true)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="a2cea9205fa423c487cf15351bc739856f40f565">
  <div class="header">
    <h3>app/helpers/admin/users_helper.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>50</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>50</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module Admin::UsersHelper</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  def link_to_suspend(user)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">    link_to(t(:suspend) + &quot;!&quot;, suspend_admin_user_path(user), method: :put, remote: true)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">  def link_to_reactivate(user)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">    name = user.awaits_approval? ? t(:approve) + &quot;!&quot; : t(:reactivate) + &quot;!&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">    link_to(name, reactivate_admin_user_path(user), method: :put, remote: true)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">  def link_to_confirm(user)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">    link_to(t(:delete) + &quot;?&quot;, confirm_admin_user_path(user), method: :get, remote: true)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby">  # User summary info for RSS/ATOM feeds.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            
            

            

            <code class="ruby">  def user_summary(user)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            
            

            

            <code class="ruby">    summary = []</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">    title_and_company = user_summary_title_and_company(user)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            
            

            

            <code class="ruby">    summary &lt;&lt; title_and_company unless title_and_company.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            
            

            

            <code class="ruby">    summary &lt;&lt; t(&#39;pluralize.login&#39;, user.sign_in_count) if user.last_sign_in_at &amp;&amp; user.sign_in_count.positive?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            
            

            

            <code class="ruby">    summary &lt;&lt; user.email</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            
            

            

            <code class="ruby">    summary &lt;&lt; &quot;#{t :phone_small}: #{user.phone}&quot; unless user.phone.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            
            

            

            <code class="ruby">    summary &lt;&lt; &quot;#{t :mobile_small}: #{user.mobile}&quot; unless user.mobile.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            
            

            

            <code class="ruby">    summary &lt;&lt; user_summary_created_at(user)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            
            

            

            <code class="ruby">    summary &lt;&lt; user_summary_status(user)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="36">
            
            

            

            <code class="ruby">    summary.join(&#39;, &#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="37">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            
            

            

            <code class="ruby">  # Formatted user title and company for user summary</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="42">
            
            

            

            <code class="ruby">  def user_summary_title_and_company(user)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="43">
            
            

            

            <code class="ruby">    str = user.title.blank? ? &#39;&#39; : h(user.title)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="44">
            
            

            

            <code class="ruby">    str += &quot; #{t(:at)} #{user.company}&quot; unless user.company.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="45">
            
            

            

            <code class="ruby">    str</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            
            

            

            <code class="ruby">  # Formatted user join date for user summary</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="49">
            
            

            

            <code class="ruby">  def user_summary_created_at(user)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="50">
            
            

            

            <code class="ruby">    if !user.suspended?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            
            

            

            <code class="ruby">      t(:user_since, l(user.created_at.to_date, format: :mmddyy))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="52">
            
            

            

            <code class="ruby">    elsif user.awaits_approval?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="53">
            
            

            

            <code class="ruby">      t(:user_signed_up_on, l(user.created_at, format: :mmddhhss))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="54">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="55">
            
            

            

            <code class="ruby">      t(:user_suspended_on, l(user.created_at.to_date, format: :mmddyy))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="56">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="57">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            
            

            

            <code class="ruby">  # Formatted user status for user summary</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="60">
            
            

            

            <code class="ruby">  def user_summary_status(user)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="61">
            
            

            

            <code class="ruby">    if user.awaits_approval?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="62">
            
            

            

            <code class="ruby">      t(:user_signed_up)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="63">
            
            

            

            <code class="ruby">    elsif user.suspended?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="64">
            
            

            

            <code class="ruby">      t(:user_suspended)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="65">
            
            

            

            <code class="ruby">    elsif user.admin?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="66">
            
            

            

            <code class="ruby">      t(:user_admin)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="67">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="68">
            
            

            

            <code class="ruby">      t(:user_active)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="69">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="70">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="71">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="c11927e86c4c0fda4a3b2a57fe8e28deab663c66">
  <div class="header">
    <h3>app/helpers/application_helper.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>384</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>384</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module ApplicationHelper</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  def tabs(tabs = nil)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">    tabs ||= controller_path.match?(/admin/) ? FatFreeCRM::Tabs.admin : FatFreeCRM::Tabs.main</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">    if tabs</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">      @current_tab ||= tabs.first[:text] # Select first tab by default.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">      tabs.each { |tab| tab[:active] = (@current_tab == tab[:text] || @current_tab == tab[:url][:controller]) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">      raise FatFreeCRM::MissingSettings, &quot;Tab settings are missing, please run &lt;b&gt;rake ffcrm:setup&lt;/b&gt; command.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">  def tabless_layout?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">    %w[sessions passwords registrations confirmations].include?(controller.controller_name) ||</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">      ((controller.controller_name == &quot;users&quot;) &amp;&amp; %w[create new].include?(controller.action_name))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">  # Show existing flash or embed hidden paragraph ready for flash[:notice]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            
            

            

            <code class="ruby">  def show_flash(options = { sticky: false })</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">    %i[error warning info notice alert].each do |type|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            
            

            

            <code class="ruby">      next unless flash[type]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            
            

            

            <code class="ruby">      html = content_tag(:div, h(flash[type]), id: &quot;flash&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            
            

            

            <code class="ruby">      flash[type] = nil</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            
            

            

            <code class="ruby">      return html &lt;&lt; content_tag(:script, &quot;crm.flash(&#39;#{type}&#39;, #{options[:sticky]})&quot;.html_safe, type: &quot;text/javascript&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            
            

            

            <code class="ruby">    content_tag(:p, nil, id: &quot;flash&quot;, style: &quot;display:none;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="36">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="38">
            
            

            

            <code class="ruby">  def subtitle_link(id, text, hidden)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            
            

            

            <code class="ruby">    link_to(&quot;&lt;small&gt;#{hidden ? &#39;&amp;#9655;&#39; : &#39;&amp;#9661;&#39;}&lt;/small&gt; #{sanitize text}&quot;.html_safe,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            
            

            

            <code class="ruby">            url_for(controller: :home, action: :toggle, id: id),</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            
            

            

            <code class="ruby">            remote: true,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="42">
            
            

            

            <code class="ruby">            onclick: &quot;crm.flip_subtitle(this)&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="43">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            
            

            

            <code class="ruby">  def subtitle(id, hidden = true, text = id.to_s.split(&quot;_&quot;).last.capitalize)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="47">
            
            

            

            <code class="ruby">    content_tag(&quot;div&quot;, subtitle_link(id, text, hidden), class: &quot;subtitle&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="48">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            
            

            

            <code class="ruby">  def section(related, assets)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="52">
            
            

            

            <code class="ruby">    asset = assets.to_s.singularize</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="53">
            
            

            

            <code class="ruby">    create_id = &quot;create_#{asset}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="54">
            
            

            

            <code class="ruby">    select_id = &quot;select_#{asset}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="55">
            
            

            

            <code class="ruby">    create_url = controller.send(:&quot;new_#{asset}_path&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="57">
            
            

            

            <code class="ruby">    html = tag(:br)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="58">
            
            

            

            <code class="ruby">    html &lt;&lt; content_tag(:div, link_to(t(select_id), &quot;#&quot;, id: select_id), class: &quot;subtitle_tools&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="59">
            
            

            

            <code class="ruby">    html &lt;&lt; content_tag(:div, &quot;&amp;nbsp;|&amp;nbsp;&quot;.html_safe, class: &quot;subtitle_tools&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="60">
            
            

            

            <code class="ruby">    html &lt;&lt; content_tag(:div, link_to_inline(create_id, create_url, related: dom_id(related), text: t(create_id)), class: &quot;subtitle_tools&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="61">
            
            

            

            <code class="ruby">    html &lt;&lt; content_tag(:div, t(assets), class: :subtitle, id: &quot;create_#{asset}_title&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="62">
            
            

            

            <code class="ruby">    html &lt;&lt; content_tag(:div, &quot;&quot;, class: :remote, id: create_id, style: &quot;display:none;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="63">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="66">
            
            

            

            <code class="ruby">  def load_select_popups_for(related, *assets)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="67">
            
            

            

            <code class="ruby">    js = generate_js_for_popups(related, *assets)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="68">
            
            

            

            <code class="ruby">    content_for(:javascript_epilogue) do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="69">
            
            

            

            <code class="ruby">      raw &quot;$(function() { #{js} });&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="70">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="71">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="73">
            
            

            

            <code class="ruby">  def generate_js_for_popups(related, *assets)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="74">
            
            

            

            <code class="ruby">    assets.map do |asset|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="75">
            
            

            

            <code class="ruby">      render(partial: &quot;shared/select_popup&quot;, locals: { related: related, popup: asset })</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="76">
            
            

            

            <code class="ruby">    end.join</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="77">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            
            

            

            <code class="ruby">  # We need this because standard Rails [select] turns &amp;#9733; into &amp;amp;#9733;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="81">
            
            

            

            <code class="ruby">  def rating_select(name, options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="82">
            
            

            

            <code class="ruby">    stars = Hash[(1..5).map { |star| [star, &quot;&amp;#9733;&quot; * star] }].sort</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="83">
            
            

            

            <code class="ruby">    options_for_select = %(&lt;option value=&quot;0&quot;#{options[:selected].to_i.zero? ? &#39; selected=&quot;selected&quot;&#39; : &#39;&#39;}&gt;#{t :select_none}&lt;/option&gt;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="84">
            
            

            

            <code class="ruby">    options_for_select += stars.map { |star| %(&lt;option value=&quot;#{star.first}&quot;#{options[:selected] == star.first ? &#39; selected=&quot;selected&quot;&#39; : &#39;&#39;}&gt;#{star.last}&lt;/option&gt;) }.join</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="85">
            
            

            

            <code class="ruby">    select_tag name, options_for_select.html_safe, options</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="86">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="89">
            
            

            

            <code class="ruby">  def link_to_inline(id, url, options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="90">
            
            

            

            <code class="ruby">    text = options[:text] || t(id, default: id.to_s.titleize)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="91">
            
            

            

            <code class="ruby">    related = (options[:related] ? &quot;&amp;related=#{options[:related]}&quot; : &#39;&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="93">
            
            

            

            <code class="ruby">    link_to(text,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="94">
            
            

            

            <code class="ruby">            url + &quot;#{url.include?(&#39;?&#39;) ? &#39;&amp;&#39; : &#39;?&#39;}cancel=false&quot; + related,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="95">
            
            

            

            <code class="ruby">            remote: true,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="96">
            
            

            

            <code class="ruby">            onclick: &quot;this.href = this.href.replace(/cancel=(true|false)/,&#39;cancel=&#39;+ ($(&#39;##{id}&#39;).css(&#39;display&#39;) != &#39;none&#39;));&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="97">
            
            

            

            <code class="ruby">            class: options[:class])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="98">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="101">
            
            

            

            <code class="ruby">  def arrow_for(id)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="102">
            
            

            

            <code class="ruby">    content_tag(:span, &quot;&amp;#9655;&quot;.html_safe, id: &quot;#{id}_arrow&quot;, class: :arrow)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="103">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="106">
            
            

            

            <code class="ruby">  def link_to_edit(record, options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="107">
            
            

            

            <code class="ruby">    object = record.is_a?(Array) ? record.last : record</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="109">
            
            

            

            <code class="ruby">    name = (params[:klass_name] || object.class.name).underscore.downcase</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="110">
            
            

            

            <code class="ruby">    link_to(t(:edit),</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="111">
            
            

            

            <code class="ruby">            options[:url] || polymorphic_url(record, action: :edit),</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="112">
            
            

            

            <code class="ruby">            remote:  true,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="113">
            
            

            

            <code class="ruby">            onclick: &quot;this.href = this.href.split(&#39;?&#39;)[0] + &#39;?previous=&#39;+encodeURI(crm.find_form(&#39;edit_#{j name}&#39;));&quot;.html_safe)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="114">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="117">
            
            

            

            <code class="ruby">  def link_to_delete(record, options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="118">
            
            

            

            <code class="ruby">    confirm = options[:confirm] || nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="120">
            
            

            

            <code class="ruby">    link_to(t(:delete) + &quot;!&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="121">
            
            

            

            <code class="ruby">            options[:url] || url_for(record),</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="122">
            
            

            

            <code class="ruby">            method: :delete,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="123">
            
            

            

            <code class="ruby">            remote: true,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="124">
            
            

            

            <code class="ruby">            confirm: confirm)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="125">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="128">
            
            

            

            <code class="ruby">  def link_to_discard(object)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="129">
            
            

            

            <code class="ruby">    current_url = (request.xhr? ? request.referer : request.fullpath)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="130">
            
            

            

            <code class="ruby">    parent, parent_id = current_url.scan(%r{/(\w+)/(\d+)}).flatten</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="132">
            
            

            

            <code class="ruby">    link_to(t(:discard),</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="133">
            
            

            

            <code class="ruby">            url_for(controller: parent, action: :discard, id: parent_id, attachment: object.class.name, attachment_id: object.id),</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="134">
            
            

            

            <code class="ruby">            method:  :post,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="135">
            
            

            

            <code class="ruby">            remote:  true)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="136">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="139">
            
            

            

            <code class="ruby">  def link_to_cancel(url, params = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="140">
            
            

            

            <code class="ruby">    url = params[:url] if params[:url]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="141">
            
            

            

            <code class="ruby">    link_to(t(:cancel),</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="142">
            
            

            

            <code class="ruby">            url + &quot;#{url.include?(&#39;?&#39;) ? &#39;&amp;&#39; : &#39;?&#39;}cancel=true&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="143">
            
            

            

            <code class="ruby">            remote: true)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="144">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="147">
            
            

            

            <code class="ruby">  def link_to_close(url)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="148">
            
            

            

            <code class="ruby">    link_to(&quot;x&quot;, url + &quot;#{url.include?(&#39;?&#39;) ? &#39;&amp;&#39; : &#39;?&#39;}cancel=true&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="149">
            
            

            

            <code class="ruby">            remote: true,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="150">
            
            

            

            <code class="ruby">            class: &quot;close&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="151">
            
            

            

            <code class="ruby">            title: t(:close_form))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="152">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="154">
            
            

            

            <code class="ruby">  # Bcc: to dropbox address if the dropbox has been set up.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="156">
            
            

            

            <code class="ruby">  def link_to_email(email, length = nil, &amp;_block)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="157">
            
            

            

            <code class="ruby">    name = (length ? truncate(email, length: length) : email)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="158">
            
            

            

            <code class="ruby">    bcc = Setting&amp;.email_dropbox</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="159">
            
            

            

            <code class="ruby">    mailto = if bcc &amp;&amp; bcc[:address].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="160">
            
            

            

            <code class="ruby">               &quot;#{email}?bcc=#{bcc[:address]}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="161">
            
            

            

            <code class="ruby">             else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="162">
            
            

            

            <code class="ruby">               email</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="163">
            
            

            

            <code class="ruby">             end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="164">
            
            

            

            <code class="ruby">    if block_given?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="165">
            
            

            

            <code class="ruby">      link_to(&quot;mailto:#{mailto}&quot;, title: email) do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="166">
            
            

            

            <code class="ruby">        yield</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="167">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="168">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="169">
            
            

            

            <code class="ruby">      link_to(h(name), &quot;mailto:#{mailto}&quot;, title: email)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="170">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="171">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="173">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="174">
            
            

            

            <code class="ruby">  def jumpbox(current)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="175">
            
            

            

            <code class="ruby">    tabs = %i[campaigns accounts leads contacts opportunities]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="176">
            
            

            

            <code class="ruby">    current = tabs.first unless tabs.include?(current)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="177">
            
            

            

            <code class="ruby">    tabs.map do |tab|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="178">
            
            

            

            <code class="ruby">      link_to_function(t(&quot;tab_#{tab}&quot;), &quot;crm.jumper(&#39;#{tab}&#39;)&quot;, &quot;html-data&quot; =&gt; tab, class: (tab == current ? &#39;selected&#39; : &#39;&#39;))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="179">
            
            

            

            <code class="ruby">    end.join(&quot; | &quot;).html_safe</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="180">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="181">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="182">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="183">
            
            

            

            <code class="ruby">  def styles_for(*models)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="184">
            
            

            

            <code class="ruby">    render partial: &quot;shared/inline_styles&quot;, locals: { models: models }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="185">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="186">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="187">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="188">
            
            

            

            <code class="ruby">  def hidden</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="189">
            
            

            

            <code class="ruby">    { style: &quot;display:none;&quot;       }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="190">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="191">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="192">
            
            

            

            <code class="ruby">  def exposed</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="193">
            
            

            

            <code class="ruby">    { style: &quot;display:block;&quot;      }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="194">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="195">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="196">
            
            

            

            <code class="ruby">  def invisible</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="197">
            
            

            

            <code class="ruby">    { style: &quot;visibility:hidden;&quot;  }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="198">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="199">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="200">
            
            

            

            <code class="ruby">  def visible</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="201">
            
            

            

            <code class="ruby">    { style: &quot;visibility:visible;&quot; }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="202">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="203">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="204">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="205">
            
            

            

            <code class="ruby">  def one_submit_only(_form = &#39;&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="206">
            
            

            

            <code class="ruby">    { onsubmit: &quot;$(&#39;#&#39;+this.id+&#39; input[type=submit]&#39;).prop(&#39;disabled&#39;, true)&quot;.html_safe }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="207">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="208">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="209">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="210">
            
            

            

            <code class="ruby">  def hidden_if(you_ask)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="211">
            
            

            

            <code class="ruby">    you_ask ? hidden : exposed</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="212">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="213">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="214">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="215">
            
            

            

            <code class="ruby">  def invisible_if(you_ask)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="216">
            
            

            

            <code class="ruby">    you_ask ? invisible : visible</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="217">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="218">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="219">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="220">
            
            

            

            <code class="ruby">  def confirm_delete(model, params = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="221">
            
            

            

            <code class="ruby">    question = %(&lt;span class=&quot;warn&quot;&gt;#{t(:confirm_delete, model.class.to_s.downcase)}&lt;/span&gt;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="222">
            
            

            

            <code class="ruby">    yes = link_to(t(:yes_button), params[:url] || model, method: :delete)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="223">
            
            

            

            <code class="ruby">    no = link_to_function(t(:no_button), &quot;$(&#39;#menu&#39;).html($(&#39;#confirm&#39;).html());&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="224">
            
            

            

            <code class="ruby">    text = &quot;$(&#39;#confirm&#39;).html( $(&#39;#menu&#39;).html() );\n&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="225">
            
            

            

            <code class="ruby">    text += &quot;$(&#39;#menu&#39;).html(&#39;#{question} #{yes} : #{no}&#39;);&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="226">
            
            

            

            <code class="ruby">    text.html_safe</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="227">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="228">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="229">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="230">
            
            

            

            <code class="ruby">  def spacer(width = 10)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="231">
            
            

            

            <code class="ruby">    image_tag &quot;1x1.gif&quot;, width: width, height: 1, alt: nil</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="232">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="233">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="234">
            
            

            

            <code class="ruby">  # Reresh sidebar using the action view within the current controller.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="235">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="236">
            
            

            

            <code class="ruby">  def refresh_sidebar(action = nil)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="237">
            
            

            

            <code class="ruby">    refresh_sidebar_for(controller.controller_name, action)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="238">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="239">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="240">
            
            

            

            <code class="ruby">  # Refresh sidebar using the action view within an arbitrary controller.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="241">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="242">
            
            

            

            <code class="ruby">  def refresh_sidebar_for(view, action = nil)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="243">
            
            

            

            <code class="ruby">    text = &quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="244">
            
            

            

            <code class="ruby">    text += &quot;$(&#39;#sidebar&#39;).html(&#39;#{j render(partial: &#39;layouts/sidebar&#39;, locals: { view: view, action: action })}&#39;);&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="245">
            
            

            

            <code class="ruby">    text.html_safe</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="246">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="247">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="248">
            
            

            

            <code class="ruby">  # Display web presence mini-icons for Contact or Lead.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="249">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="250">
            
            

            

            <code class="ruby">  def web_presence_icons(person)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="251">
            
            

            

            <code class="ruby">    %i[blog linkedin facebook twitter skype].map do |site|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="252">
            
            

            

            <code class="ruby">      url = person.send(site)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="253">
            
            

            

            <code class="ruby">      next if url.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="254">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="255">
            
            

            

            <code class="ruby">      if site == :skype</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="256">
            
            

            

            <code class="ruby">        url = &quot;callto:&quot; + url</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="257">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="258">
            
            

            

            <code class="ruby">        url = &quot;http://&quot; + url unless url.match?(%r{^https?://})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="259">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="260">
            
            

            

            <code class="ruby">      link_to(image_tag(&quot;#{site}.gif&quot;, size: &quot;15x15&quot;), h(url), &quot;data-popup&quot;: true, title: t(:open_in_window, h(url)))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="261">
            
            

            

            <code class="ruby">    end.compact.join(&quot;\n&quot;).html_safe</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="262">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="263">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="264">
            
            

            

            <code class="ruby">  # Ajax helper to refresh current index page once the user selects an option.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="265">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="266">
            
            

            

            <code class="ruby">  def redraw(option, value, url = send(&quot;redraw_#{controller.controller_name}_path&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="267">
            
            

            

            <code class="ruby">    if value.is_a?(Array)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="268">
            
            

            

            <code class="ruby">      param = value.first</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="269">
            
            

            

            <code class="ruby">      value = value.last</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="270">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="271">
            
            

            

            <code class="ruby">    %{</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="272">
            
            

            

            <code class="ruby">      if ($(&#39;##{option}&#39;).html() != &#39;#{j value}&#39;) {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="273">
            
            

            

            <code class="ruby">        $(&#39;##{option}&#39;).html(&#39;#{j value}&#39;);</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="274">
            
            

            

            <code class="ruby">        $(&#39;#loading&#39;).show();</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="275">
            
            

            

            <code class="ruby">        $.post(&#39;#{url}&#39;, {#{option}: &#39;#{j(param || value)}&#39;}, function () {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="276">
            
            

            

            <code class="ruby">          $(&#39;#loading&#39;).hide();</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="277">
            
            

            

            <code class="ruby">        });</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="278">
            
            

            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="279">
            
            

            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="280">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="281">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="282">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="283">
            
            

            

            <code class="ruby">  def options_menu_item(option, key, url = send(&quot;redraw_#{controller.controller_name}_path&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="284">
            
            

            

            <code class="ruby">    name = t(&quot;option_#{key}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="285">
            
            

            

            <code class="ruby">    &quot;{ name: \&quot;#{j name.titleize}\&quot;, on_select: function() {&quot; +</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="286">
            
            

            

            <code class="ruby">      %{</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="287">
            
            

            

            <code class="ruby">        if ($(&#39;##{option}&#39;).html() != &#39;#{j name}&#39;) {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="288">
            
            

            

            <code class="ruby">          $(&#39;##{option}&#39;).html(&#39;#{j name}&#39;);</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="289">
            
            

            

            <code class="ruby">          $(&#39;#loading&#39;).show();</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="290">
            
            

            

            <code class="ruby">          $.get(&#39;#{url}&#39;, {#{option}: &#39;#{key}&#39;, query: $(&#39;#query&#39;).val()}, function () {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="291">
            
            

            

            <code class="ruby">            $(&#39;#loading&#39;).hide();</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="292">
            
            

            

            <code class="ruby">          });</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="293">
            
            

            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="294">
            
            

            

            <code class="ruby">      } + &quot;}}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="295">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="296">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="297">
            
            

            

            <code class="ruby">  # Ajax helper to pass browser timezone offset to the server.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="298">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="299">
            
            

            

            <code class="ruby">  def get_browser_timezone_offset</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="300">
            
            

            

            <code class="ruby">    raw &quot;$.get(&#39;#{timezone_path}&#39;, {offset: (new Date()).getTimezoneOffset()});&quot; unless session[:timezone_offset]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="301">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="302">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="303">
            
            

            

            <code class="ruby">  STYLES = { large: &quot;75x75#&quot;, medium: &quot;50x50#&quot;, small: &quot;25x25#&quot;, thumb: &quot;16x16#&quot; }.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="304">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="305">
            
            

            

            <code class="ruby">  # Convert STYLE symbols to &#39;w x h&#39; format for Gravatar and Rails</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="306">
            
            

            

            <code class="ruby">  # e.g. size_from_style(:size =&gt; :large) -&gt; &#39;75x75&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="307">
            
            

            

            <code class="ruby">  # Allow options to contain :width and :height override keys</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="308">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="309">
            
            

            

            <code class="ruby">  def size_from_style!(options)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="310">
            
            

            

            <code class="ruby">    if options[:width] &amp;&amp; options[:height]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="311">
            
            

            

            <code class="ruby">      options[:size] = %i[width height].map { |d| options[d] }.join(&quot;x&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="312">
            
            

            

            <code class="ruby">      options.delete(:width)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="313">
            
            

            

            <code class="ruby">      options.delete(:height)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="314">
            
            

            

            <code class="ruby">    elsif STYLES.keys.include?(options[:size])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="315">
            
            

            

            <code class="ruby">      options[:size] = STYLES[options[:size]].sub(/\#\z/, &#39;&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="316">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="317">
            
            

            

            <code class="ruby">    options</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="318">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="319">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="320">
            
            

            

            <code class="ruby">  # Entities can have associated avatars or gravatars. Only calls Gravatar</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="321">
            
            

            

            <code class="ruby">  # in production env. Gravatar won&#39;t serve default images if they are not</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="322">
            
            

            

            <code class="ruby">  # publically available: https://en.gravatar.com/site/implement/images</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="323">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="324">
            
            

            

            <code class="ruby">  def avatar_for(model, args = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="325">
            
            

            

            <code class="ruby">    args = { class: &#39;gravatar&#39;, size: :large }.merge(args)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="326">
            
            

            

            <code class="ruby">    args = size_from_style!(args)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="327">
            
            

            

            <code class="ruby">    if model.respond_to?(:avatar) &amp;&amp; model.avatar.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="328">
            
            

            

            <code class="ruby">      size = args[:size].split(&#39;x&#39;).map(&amp;:to_i) # convert &#39;75x75&#39; into [75, 75]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="329">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="330">
            
            

            

            <code class="ruby">      image_tag model.avatar.image.variant(resize_to_limit: size)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="331">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="332">
            
            

            

            <code class="ruby">      gravatar_image_tag(model.email, args)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="333">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="334">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="335">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="336">
            
            

            

            <code class="ruby">  # Returns default permissions intro.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="337">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="338">
            
            

            

            <code class="ruby">  def get_default_permissions_intro(access, text)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="339">
            
            

            

            <code class="ruby">    case access</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="340">
            
            

            

            <code class="ruby">    when &quot;Private&quot; then t(:permissions_intro_private, text)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="341">
            
            

            

            <code class="ruby">    when &quot;Public&quot;  then t(:permissions_intro_public,  text)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="342">
            
            

            

            <code class="ruby">    when &quot;Shared&quot;  then t(:permissions_intro_shared,  text)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="343">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="344">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="345">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="346">
            
            

            

            <code class="ruby">  # Render a text field that is part of compound address.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="347">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="348">
            
            

            

            <code class="ruby">  def address_field(form, attribute, extra_styles)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="349">
            
            

            

            <code class="ruby">    hint = &quot;#{t(attribute)}...&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="350">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="351">
            
            

            

            <code class="ruby">    form.text_field(attribute,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="352">
            
            

            

            <code class="ruby">                    style:   &quot;margin-top: 6px; #{extra_styles}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="353">
            
            

            

            <code class="ruby">                    placeholder: hint)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="354">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="355">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="356">
            
            

            

            <code class="ruby">  # Return true if:</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="357">
            
            

            

            <code class="ruby">  #   - it&#39;s an Ajax request made from the asset landing page (i.e. create opportunity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="358">
            
            

            

            <code class="ruby">  #     from a contact landing page) OR</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="359">
            
            

            

            <code class="ruby">  #   - we&#39;re actually showing asset landing page.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="360">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="361">
            
            

            

            <code class="ruby">  def shown_on_landing_page?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="362">
            
            

            

            <code class="ruby">    !!((request.xhr? &amp;&amp; request.referer =~ %r{/\w+/\d+}) ||</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="363">
            
            

            

            <code class="ruby">       (!request.xhr? &amp;&amp; request.fullpath =~ %r{/\w+/\d+}))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="364">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="365">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="366">
            
            

            

            <code class="ruby">  # Helper to display links to supported data export formats.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="367">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="368">
            
            

            

            <code class="ruby">  def links_to_export(action = :index)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="369">
            
            

            

            <code class="ruby">    token = current_user.authentication_token</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="370">
            
            

            

            <code class="ruby">    url_params = { action: action }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="371">
            
            

            

            <code class="ruby">    url_params[:id] = params[:id] unless params[:id].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="372">
            
            

            

            <code class="ruby">    url_params[:query] = params[:query] unless params[:query].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="373">
            
            

            

            <code class="ruby">    url_params[:q] = params[:q] unless params[:q].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="374">
            
            

            

            <code class="ruby">    url_params[:view] = @view unless @view.blank? # tasks</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="375">
            
            

            

            <code class="ruby">    url_params[:id] = params[:id] unless params[:id].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="376">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="377">
            
            

            

            <code class="ruby">    exports = %w[xls csv].map do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="378">
            
            

            

            <code class="ruby">      link_to(format.upcase, url_params.merge(format: format), title: I18n.t(:&quot;to_#{format}&quot;)) unless action.to_s == &quot;show&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="379">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="380">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="381">
            
            

            

            <code class="ruby">    feeds = %w[rss atom].map do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="382">
            
            

            

            <code class="ruby">      link_to(format.upcase, url_params.merge(format: format, authentication_credentials: token), title: I18n.t(:&quot;to_#{format}&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="383">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="384">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="385">
            
            

            

            <code class="ruby">    links = [&#39;perm&#39;].map do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="386">
            
            

            

            <code class="ruby">      link_to(format.upcase, url_params, title: I18n.t(:&quot;to_#{format}&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="387">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="388">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="389">
            
            

            

            <code class="ruby">    (exports + feeds + links).compact.join(&#39; | &#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="390">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="391">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="392">
            
            

            

            <code class="ruby">  def user_options</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="393">
            
            

            

            <code class="ruby">    User.all.map { |u| [u.full_name, u.id] }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="394">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="395">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="396">
            
            

            

            <code class="ruby">  def group_options</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="397">
            
            

            

            <code class="ruby">    Group.all.map { |g| [g.name, g.id] }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="398">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="399">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="400">
            
            

            

            <code class="ruby">  def list_of_entities</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="401">
            
            

            

            <code class="ruby">    ENTITIES</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="402">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="403">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="404">
            
            

            

            <code class="ruby">  def entity_filter_checkbox(name, value, count)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="405">
            
            

            

            <code class="ruby">    checked = (session[&quot;#{controller_name}_filter&quot;].present? ? session[&quot;#{controller_name}_filter&quot;].split(&quot;,&quot;).include?(value.to_s) : count.to_i.positive?)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="406">
            
            

            

            <code class="ruby">    url = url_for(action: :filter)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="407">
            
            

            

            <code class="ruby">    onclick = %{</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="408">
            
            

            

            <code class="ruby">      var query = $(&#39;#query&#39;).val(),</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="409">
            
            

            

            <code class="ruby">          values = [];</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="410">
            
            

            

            <code class="ruby">      $(&#39;input[name=&amp;quot;#{h name}[]&amp;quot;]&#39;).filter(&#39;:checked&#39;).each(function () {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="411">
            
            

            

            <code class="ruby">        values.push(this.value);</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="412">
            
            

            

            <code class="ruby">      });</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="413">
            
            

            

            <code class="ruby">      $(&#39;#loading&#39;).show();</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="414">
            
            

            

            <code class="ruby">      $.post(&#39;#{url}&#39;, {#{h name}: values.join(&#39;,&#39;), query: query}, function () {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="415">
            
            

            

            <code class="ruby">        $(&#39;#loading&#39;).hide();</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="416">
            
            

            

            <code class="ruby">      });</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="417">
            
            

            

            <code class="ruby">    }.html_safe</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="418">
            
            

            

            <code class="ruby">    check_box_tag(&quot;#{name}[]&quot;, value, checked, id: value, onclick: onclick)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="419">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="420">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="421">
            
            

            

            <code class="ruby">  # Create a column in the &#39;asset_attributes&#39; table.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="422">
            
            

            

            <code class="ruby">  # If a block is given, render it inside the td</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="423">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="424">
            
            

            

            <code class="ruby">  def col(title, value = nil, last = false, email = false, &amp;_block)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="425">
            
            

            

            <code class="ruby">    last_class = (last ? &#39;last&#39; : nil)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="426">
            
            

            

            <code class="ruby">    out = content_tag(:th, title, class: last_class)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="427">
            
            

            

            <code class="ruby">    if block_given?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="428">
            
            

            

            <code class="ruby">      out &lt;&lt; content_tag(:td, class: last_class) do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="429">
            
            

            

            <code class="ruby">        yield</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="430">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="431">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="432">
            
            

            

            <code class="ruby">      # Parse and format urls as links.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="433">
            
            

            

            <code class="ruby">      fmt_value = (value.to_s || &quot;&quot;).gsub(&quot;\n&quot;, &quot;&lt;br /&gt;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="434">
            
            

            

            <code class="ruby">      fmt_value = if email</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="435">
            
            

            

            <code class="ruby">                    link_to_email(fmt_value)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="436">
            
            

            

            <code class="ruby">                  else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="437">
            
            

            

            <code class="ruby">                    fmt_value.gsub(%r{((http|ftp|https)://[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&amp;amp;:/\+#]*[\w\-\@?^=%&amp;amp;/\+#])?)}, &quot;&lt;a href=\&quot;\\1\&quot;&gt;\\1&lt;/a&gt;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="438">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="439">
            
            

            

            <code class="ruby">      out &lt;&lt; content_tag(:td, fmt_value, class: last_class)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="440">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="441">
            
            

            

            <code class="ruby">    out</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="442">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="443">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="444">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="445">
            
            

            

            <code class="ruby">  # Combines the &#39;subtitle&#39; helper with the small info text on the same line.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="446">
            
            

            

            <code class="ruby">  def section_title(id, hidden = true, text = nil, info_text = nil)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="447">
            
            

            

            <code class="ruby">    text = id.to_s.split(&quot;_&quot;).last.capitalize if text.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="448">
            
            

            

            <code class="ruby">    content_tag(&quot;div&quot;, class: &quot;subtitle show_attributes&quot;) do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="449">
            
            

            

            <code class="ruby">      content = subtitle_link(id, text, hidden)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="450">
            
            

            

            <code class="ruby">      content &lt;&lt; content_tag(&quot;small&quot;, info_text.to_s, class: &quot;subtitle_inline_info&quot;, id: &quot;#{id}_intro&quot;, style: hidden ? &quot;&quot; : &quot;display:none;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="451">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="452">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="453">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="454">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="455">
            
            

            

            <code class="ruby">  # Get template in current context with current view name</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="456">
            
            

            

            <code class="ruby">  def template_for_current_view</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="457">
            
            

            

            <code class="ruby">    FatFreeCRM::ViewFactory.template_for_current_view(controller: controller.controller_name,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="458">
            
            

            

            <code class="ruby">                                                      action: show_or_index_action,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="459">
            
            

            

            <code class="ruby">                                                      name: current_view_name)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="460">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="461">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="462">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="463">
            
            

            

            <code class="ruby">  # Generate buttons for available views given the current context</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="464">
            
            

            

            <code class="ruby">  def view_buttons</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="465">
            
            

            

            <code class="ruby">    views = FatFreeCRM::ViewFactory.views_for(controller: controller.controller_name,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="466">
            
            

            

            <code class="ruby">                                              action: show_or_index_action)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="467">
            
            

            

            <code class="ruby">    return nil unless views.size &gt; 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="468">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="469">
            
            

            

            <code class="ruby">    lis = &#39;&#39;.html_safe</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="470">
            
            

            

            <code class="ruby">    content_tag :ul, class: &#39;format-buttons&#39; do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="471">
            
            

            

            <code class="ruby">      views.collect do |view|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="472">
            
            

            

            <code class="ruby">        classes = if (current_view_name == view.name) || (current_view_name.nil? &amp;&amp; view.template.nil?) # nil indicates default template.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="473">
            
            

            

            <code class="ruby">                    &quot;#{h view.name}-button active&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="474">
            
            

            

            <code class="ruby">                  else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="475">
            
            

            

            <code class="ruby">                    &quot;#{h view.name}-button&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="476">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="477">
            
            

            

            <code class="ruby">        lis &lt;&lt; content_tag(:li) do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="478">
            
            

            

            <code class="ruby">          url = show_or_index_action == &quot;index&quot; ? send(&quot;redraw_#{controller.controller_name}_path&quot;) : send(&quot;#{controller.controller_name.singularize}_path&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="479">
            
            

            

            <code class="ruby">          link_to(&#39;#&#39;, title: t(view.name, default: h(view.title)), &quot;data-view&quot;: h(view.name), &quot;data-url&quot;: h(url), &quot;data-context&quot;: show_or_index_action, class: classes) do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="480">
            
            

            

            <code class="ruby">            icon = view.icon || &#39;fa-bars&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="481">
            
            

            

            <code class="ruby">            content_tag(:i, nil, class: &quot;fa #{h icon}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="482">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="483">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="484">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="485">
            
            

            

            <code class="ruby">      lis</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="486">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="487">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="488">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="489">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="490">
            
            

            

            <code class="ruby">  # Generate the html for $.timeago function</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="491">
            
            

            

            <code class="ruby">  # &lt;span class=&quot;timeago&quot; datetime=&quot;2008-07-17T09:24:17Z&quot;&gt;July 17, 2008&lt;/span&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="492">
            
            

            

            <code class="ruby">  def timeago(time, options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="493">
            
            

            

            <code class="ruby">    return unless time</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="494">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="495">
            
            

            

            <code class="ruby">    options[:class] ||= &quot;timeago&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="496">
            
            

            

            <code class="ruby">    options[:title] = time.getutc.iso8601</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="497">
            
            

            

            <code class="ruby">    content_tag(:span, I18n.l(time), options)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="498">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="499">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="500">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="501">
            
            

            

            <code class="ruby">  # Translate List name to FontAwesome icon text</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="502">
            
            

            

            <code class="ruby">  def get_icon(name)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="503">
            
            

            

            <code class="ruby">    case name</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="504">
            
            

            

            <code class="ruby">    when &quot;tasks&quot; then &quot;fa-check-square-o&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="505">
            
            

            

            <code class="ruby">    when &quot;campaigns&quot; then &quot;fa-bar-chart-o&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="506">
            
            

            

            <code class="ruby">    when &quot;leads&quot; then &quot;fa-tasks&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="507">
            
            

            

            <code class="ruby">    when &quot;accounts&quot; then &quot;fa-users&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="508">
            
            

            

            <code class="ruby">    when &quot;contacts&quot; then &quot;fa-user&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="509">
            
            

            

            <code class="ruby">    when &quot;opportunities&quot; then &quot;fa-money&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="510">
            
            

            

            <code class="ruby">    when &quot;team&quot; then &quot;fa-globe&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="511">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="512">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="513">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="514">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="515">
            
            

            

            <code class="ruby">  # Ajaxification FTW!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="516">
            
            

            

            <code class="ruby">  # e.g. collection = Opportunity.my(current_user).scope</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="517">
            
            

            

            <code class="ruby">  #         options = { renderer: {...} , params: {...}</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="518">
            
            

            

            <code class="ruby">  def paginate(options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="519">
            
            

            

            <code class="ruby">    collection = options.delete(:collection)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="520">
            
            

            

            <code class="ruby">    options = { params: { action: &#39;index&#39; } }.merge(options) if controller.action_name == &#39;filter&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="521">
            
            

            

            <code class="ruby">    options = { renderer: RemoteLinkPaginationHelper::LinkRenderer }.merge(options)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="522">
            
            

            

            <code class="ruby">    will_paginate(collection, options)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="523">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="524">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="525">
            
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="526">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="527">
            
            

            

            <code class="ruby">  def show_or_index_action</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="528">
            
            

            

            <code class="ruby">    controller.action_name == &#39;show&#39; ? &#39;show&#39; : &#39;index&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="529">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="530">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="531">
            
            

            

            <code class="ruby">  def current_view_name</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="532">
            
            

            

            <code class="ruby">    current_user.pref[:&quot;#{controller.controller_name}_#{show_or_index_action}_view&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="533">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="534">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="7154fa4a212c06b52eb83dcd0d4eac77ba0c9d45">
  <div class="header">
    <h3>app/helpers/authentications_helper.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>2</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module AuthenticationsHelper</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="950f1bd5a4a706063ff453dc64bcc57736c48574">
  <div class="header">
    <h3>app/helpers/campaigns_helper.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>22</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>22</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module CampaignsHelper</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">  # Sidebar checkbox control for filtering campaigns by status.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">  def campaign_status_checkbox(status, count)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">    entity_filter_checkbox(:status, status, count)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">  def performance(actual, target)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">    if target.to_i.positive? &amp;&amp; actual.to_i.positive?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">      if target &gt; actual</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">        n = 100 - actual * 100 / target</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">        html = content_tag(:span, &quot;(-#{number_to_percentage(n, precision: 1)})&quot;, class: &quot;warn&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">        n = actual * 100 / target - 100</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">        html = content_tag(:span, &quot;(+#{number_to_percentage(n, precision: 1)})&quot;, class: &quot;cool&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            
            

            

            <code class="ruby">    html || &quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby">  # Quick campaign summary for RSS/ATOM feeds.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            
            

            

            <code class="ruby">  def campaign_summary(campaign)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            
            

            

            <code class="ruby">    status  = render file: &quot;campaigns/_status.html.haml&quot;,  locals: { campaign: campaign }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            
            

            

            <code class="ruby">    metrics = render file: &quot;campaigns/_metrics.html.haml&quot;, locals: { campaign: campaign }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            
            

            

            <code class="ruby">    &quot;#{t(campaign.status)}, &quot; + [status, metrics].map { |str| strip_tags(str) }.join(&#39; &#39;).delete(&quot;\n&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="36">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="3fe902205f00e2135ddd23764d1a7acf40717e60">
  <div class="header">
    <h3>app/helpers/comments_helper.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>6</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>6</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module CommentsHelper</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  def notification_emails_configured?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">    config = Setting.email_comment_replies || {}</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">    config[:server].present? &amp;&amp; config[:user].present? &amp;&amp; config[:password].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="dc6f6ee8e644a18b2c32518404a4c5e0e284c7d3">
  <div class="header">
    <h3>app/helpers/contacts_helper.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>12</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>12</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module ContactsHelper</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">  # Contact summary for RSS/ATOM feeds.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">  def contact_summary(contact)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">    summary = [&#39;&#39;]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">    summary &lt;&lt; contact.title.titleize if contact.title?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">    summary &lt;&lt; contact.department if contact.department?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">    summary.last += &quot; #{t(:at)} #{contact.account.name}&quot; if contact.account&amp;.name?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">    summary &lt;&lt; contact.email if contact.email.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">    summary &lt;&lt; &quot;#{t(:phone_small)}: #{contact.phone}&quot; if contact.phone.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">    summary &lt;&lt; &quot;#{t(:mobile_small)}: #{contact.mobile}&quot; if contact.mobile.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">    summary.join(&#39;, &#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="6ed067454c5da284c2e66e80fe349aedbad390bc">
  <div class="header">
    <h3>app/helpers/emails_helper.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>2</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module EmailsHelper</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="f0361ca5aedfe5c3781c609034fd3ca035c9e99f">
  <div class="header">
    <h3>app/helpers/fields_helper.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>2</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module FieldsHelper</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="c638742ade6584593069543b6b0533da884a74d1">
  <div class="header">
    <h3>app/helpers/groups_helper.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>2</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module GroupsHelper</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="cdf8ff408a41519a5173c6e552e7e2288b8d6f8c">
  <div class="header">
    <h3>app/helpers/home_helper.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>49</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>49</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module HomeHelper</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  def sort_by_assets</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">    Version::ASSETS.map do |asset|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">      %[{ name: &quot;#{t(asset.singularize)}&quot;, on_select: function() { #{redraw(:asset, [asset, t(asset.singularize).downcase], url_for(action: :redraw))} } }]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">  def sort_by_events</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">    Version::EVENTS.map do |event|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">      %[{ name: &quot;#{t(event + &#39;_past_participle&#39;)}&quot;, on_select: function() { #{redraw(:event, [event, t(event + &#39;_past_participle&#39;).downcase], url_for(action: :redraw))} } }]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">  def sort_by_duration</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            
            

            

            <code class="ruby">    Version::DURATION.map do |duration|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            
            

            

            <code class="ruby">      %[{ name: &quot;#{t(duration)}&quot;, on_select: function() { #{redraw(:duration, [duration, t(duration).downcase], url_for(action: :redraw))} } }]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            
            

            

            <code class="ruby">  def sort_by_users</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            
            

            

            <code class="ruby">    users = [[&quot;all_users&quot;, t(:option_all_users)]] + @all_users.map do |user|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            
            

            

            <code class="ruby">      escaped = sanitize(user.full_name)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            
            

            

            <code class="ruby">      [escaped, escaped]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="36">
            
            

            

            <code class="ruby">    users.map do |key, value|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="37">
            
            

            

            <code class="ruby">      %[{ name: &quot;#{value}&quot;, on_select: function() { #{redraw(:user, [key, (value == t(:option_all_users) ? value.downcase : value)], url_for(action: :redraw))} } }]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="38">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            
            

            

            <code class="ruby">  # Activity title for RSS/ATOM feeds.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="43">
            
            

            

            <code class="ruby">  def activity_title(activity)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="44">
            
            

            

            <code class="ruby">    user    = activity.user.try(:full_name) || &#39;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="45">
            
            

            

            <code class="ruby">    action  = t(&#39;action_&#39; + activity.event)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            
            

            

            <code class="ruby">    type    = t(&#39;subject_&#39; + activity.item_type.downcase)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="47">
            
            

            

            <code class="ruby">    subject = if item = activity.item</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="48">
            
            

            

            <code class="ruby">                if item.respond_to?(:full_name)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="49">
            
            

            

            <code class="ruby">                  item.full_name</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="50">
            
            

            

            <code class="ruby">                elsif item.respond_to?(:name)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            
            

            

            <code class="ruby">                  item.name</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="52">
            
            

            

            <code class="ruby">                end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="53">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="54">
            
            

            

            <code class="ruby">    t(:activity_text, user: user, action: action, type: type, subject: subject,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="55">
            
            

            

            <code class="ruby">                      default: &quot;#{user} #{action} #{type} #{subject}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="56">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            
            

            

            <code class="ruby">  # Displays &#39;not showing&#39; message for a given count, entity and limit</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="59">
            
            

            

            <code class="ruby">  def show_hidden_entities_message(count, entity, limit = 10)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="60">
            
            

            

            <code class="ruby">    if count &gt; limit</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="61">
            
            

            

            <code class="ruby">      hidden_count = count - 10</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="62">
            
            

            

            <code class="ruby">      entity_string = I18n.t(&quot;#{hidden_count == 1 ? entity : entity.pluralize}_small&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="63">
            
            

            

            <code class="ruby">      content_tag(:p) do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="64">
            
            

            

            <code class="ruby">        t(:not_showing_hidden_entities, entity: entity_string, count: hidden_count)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="65">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="66">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="67">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="68">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="1095a84f5dcc0522d2c94e2efd3093f806e70f58">
  <div class="header">
    <h3>app/helpers/javascript_helper.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>9</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>9</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby"># Copied from prototype-rails which is no longer maintained</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">module JavascriptHelper</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">  #   link_to_function(&quot;Show me more&quot;, nil, :id =&gt; &quot;more_link&quot;) do |page|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">  #     page[:details].visual_effect  :toggle_blind</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">  #     page[:more_link].replace_html &quot;Show me less&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">  #   end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">  #     Produces:</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">  #       &lt;a href=&quot;#&quot; id=&quot;more_link&quot; onclick=&quot;try {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">  #         $(&amp;quot;details&amp;quot;).visualEffect(&amp;quot;toggle_blind&amp;quot;);</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">  #         $(&amp;quot;more_link&amp;quot;).update(&amp;quot;Show me less&amp;quot;);</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">  #       }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">  #       catch (e) {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby">  #         alert(&#39;RJS error:\n\n&#39; + e.toString());</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby">  #         alert(&#39;$(\&amp;quot;details\&amp;quot;).visualEffect(\&amp;quot;toggle_blind\&amp;quot;);</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby">  #         \n$(\&amp;quot;more_link\&amp;quot;).update(\&amp;quot;Show me less\&amp;quot;);&#39;);</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby">  #         throw e</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">  #       };</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby">  #       return false;&quot;&gt;Show me more&lt;/a&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby">  #</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">  def link_to_function(name, *args, &amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            
            

            

            <code class="ruby">    html_options = args.extract_options!.symbolize_keys</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            
            

            

            <code class="ruby">    function = block_given? ? update_page(&amp;block) : args[0] || &#39;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            
            

            

            <code class="ruby">    onclick = &quot;#{&quot;#{html_options[:onclick]}; &quot; if html_options[:onclick]}#{function}; return false;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            
            

            

            <code class="ruby">    href = html_options[:href] || &#39;#&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            
            

            

            <code class="ruby">    content_tag(:a, name, html_options.merge(href: href, onclick: onclick))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="36">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="37">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="5e1a41ef2c03d310603bce8537aa0e823c104c5f">
  <div class="header">
    <h3>app/helpers/leads_helper.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>57</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>57</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module LeadsHelper</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  RATING_STARS = 5</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">  def stars_for(lead)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">    star = &#39;&amp;#9733;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">    rating = lead.rating.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">    (star * rating).html_safe + content_tag(:font, (star * (RATING_STARS - rating)).html_safe, color: &#39;gainsboro&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">  def link_to_convert(lead)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">    link_to(t(:convert), convert_lead_path(lead),</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">            method: :get,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">            with:   &quot;{ previous: crm.find_form(&#39;edit_lead&#39;) }&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">            remote: true)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            
            

            

            <code class="ruby">  def link_to_reject(lead)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">    link_to(t(:reject) + &quot;!&quot;, reject_lead_path(lead), method: :put, remote: true)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            
            

            

            <code class="ruby">  def confirm_reject(lead)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            
            

            

            <code class="ruby">    question = %(&lt;span class=&quot;warn&quot;&gt;#{t(:reject_lead_confirm)}&lt;/span&gt;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            
            

            

            <code class="ruby">    yes = link_to(t(:yes_button), reject_lead_path(lead), method: :put)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            
            

            

            <code class="ruby">    no = link_to_function(t(:no_button), &quot;$(&#39;#menu&#39;).html($(&#39;#confirm&#39;).html());&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="36">
            
            

            

            <code class="ruby">    text = &quot;$(&#39;#confirm&#39;).html( $(&#39;#menu&#39;).html() );\n&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="37">
            
            

            

            <code class="ruby">    text += &quot;$(&#39;#menu&#39;).html(&#39;#{question} #{yes} : #{no}&#39;);&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="38">
            
            

            

            <code class="ruby">    text.html_safe</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            
            

            

            <code class="ruby">  # Sidebar checkbox control for filtering leads by status.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="43">
            
            

            

            <code class="ruby">  def lead_status_checkbox(status, count)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="44">
            
            

            

            <code class="ruby">    entity_filter_checkbox(:status, status, count)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="45">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            
            

            

            <code class="ruby">  # Returns default permissions intro for leads</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="49">
            
            

            

            <code class="ruby">  def get_lead_default_permissions_intro(access)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="50">
            
            

            

            <code class="ruby">    case access</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            
            

            

            <code class="ruby">    when &quot;Private&quot; then t(:lead_permissions_intro_private, t(:opportunity_small))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="52">
            
            

            

            <code class="ruby">    when &quot;Public&quot; then t(:lead_permissions_intro_public, t(:opportunity_small))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="53">
            
            

            

            <code class="ruby">    when &quot;Shared&quot; then t(:lead_permissions_intro_shared, t(:opportunity_small))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="54">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="55">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            
            

            

            <code class="ruby">  # Do not offer :converted status choice if we are creating a new lead or</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            
            

            

            <code class="ruby">  # editing existing lead that hasn&#39;t been converted before.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="60">
            
            

            

            <code class="ruby">  def lead_status_codes_for(lead)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="61">
            
            

            

            <code class="ruby">    if lead.status != &quot;converted&quot; &amp;&amp; (lead.new_record? || lead.contact.nil?)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="62">
            
            

            

            <code class="ruby">      Setting.unroll(:lead_status).delete_if { |status| status.last == :converted }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="63">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="64">
            
            

            

            <code class="ruby">      Setting.unroll(:lead_status)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="65">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="66">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            
            

            

            <code class="ruby">  # Lead summary for RSS/ATOM feed.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="70">
            
            

            

            <code class="ruby">  def lead_summary(lead)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="71">
            
            

            

            <code class="ruby">    summary = []</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="72">
            
            

            

            <code class="ruby">    summary &lt;&lt; (lead.status ? t(lead.status) : t(:other))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="74">
            
            

            

            <code class="ruby">    if lead.company? &amp;&amp; lead.title?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="75">
            
            

            

            <code class="ruby">      summary &lt;&lt; t(:works_at, job_title: lead.title, company: lead.company)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="76">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="77">
            
            

            

            <code class="ruby">      summary &lt;&lt; lead.company if lead.company?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="78">
            
            

            

            <code class="ruby">      summary &lt;&lt; lead.title if lead.title?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="79">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="80">
            
            

            

            <code class="ruby">    summary &lt;&lt; &quot;#{t(:referred_by_small)} #{lead.referred_by}&quot; if lead.referred_by?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="81">
            
            

            

            <code class="ruby">    summary &lt;&lt; lead.email if lead.email.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="82">
            
            

            

            <code class="ruby">    summary &lt;&lt; &quot;#{t(:phone_small)}: #{lead.phone}&quot; if lead.phone.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="83">
            
            

            

            <code class="ruby">    summary &lt;&lt; &quot;#{t(:mobile_small)}: #{lead.mobile}&quot; if lead.mobile.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="84">
            
            

            

            <code class="ruby">    summary.join(&#39;, &#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="85">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="86">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="db404918440086aa04300998e312500e1d3dbcbe">
  <div class="header">
    <h3>app/helpers/lists_helper.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>2</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module ListsHelper</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="767ab31a97bf4d62ebc4fa7cd4f493be03e02bfb">
  <div class="header">
    <h3>app/helpers/opportunities_helper.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>65</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>65</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module OpportunitiesHelper</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">  # Sidebar checkbox control for filtering opportunities by stage.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">  def opportunity_stage_checkbox(stage, count)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">    entity_filter_checkbox(:stage, stage, count)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">  # Opportunity summary for RSS/ATOM feeds.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">  def opportunity_summary(opportunity)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">    summary = []</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">    amount = []</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">    summary &lt;&lt; (opportunity.stage ? t(opportunity.stage) : t(:other))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">    summary &lt;&lt; number_to_currency(opportunity.weighted_amount, precision: 0)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">    unless %w[won lost].include?(opportunity.stage)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">      amount &lt;&lt; number_to_currency(opportunity.amount.to_f, precision: 0)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            
            

            

            <code class="ruby">      amount &lt;&lt; (opportunity.discount ? t(:discount_number, number_to_currency(opportunity.discount, precision: 0)) : t(:no_discount))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            
            

            

            <code class="ruby">      amount &lt;&lt; t(:probability_number, opportunity.probability.to_i.to_s + &#39;%&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            
            

            

            <code class="ruby">      summary &lt;&lt; amount.join(&#39; &#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">    summary &lt;&lt; if opportunity.closes_on</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            
            

            

            <code class="ruby">                 t(:closing_date, l(opportunity.closes_on, format: :mmddyy))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            
            

            

            <code class="ruby">               else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            
            

            

            <code class="ruby">                 t(:no_closing_date)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            
            

            

            <code class="ruby">               end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            
            

            

            <code class="ruby">    summary.compact.join(&#39;, &#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            
            

            

            <code class="ruby">  # Generates a select list with the first 25 campaigns</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            
            

            

            <code class="ruby">  # and prepends the currently selected campaign, if any.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            
            

            

            <code class="ruby">  def opportunity_campaign_select(options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            
            

            

            <code class="ruby">    options[:selected] ||= @opportunity.campaign_id.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            
            

            

            <code class="ruby">    selected_campaign = Campaign.find_by_id(options[:selected])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="42">
            
            

            

            <code class="ruby">    campaigns = ([selected_campaign] + Campaign.my(current_user).order(:name).limit(25)).compact.uniq</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="43">
            
            

            

            <code class="ruby">    collection_select :opportunity, :campaign_id, campaigns, :id, :name,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="44">
            
            

            

            <code class="ruby">                      { selected: options[:selected], prompt: t(:select_a_campaign) },</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="45">
            
            

            

            <code class="ruby">                      style: &#39;width:330px;&#39;, class: &#39;select2&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            
            

            

            <code class="ruby">  # Generates the inline revenue message for the opportunity list table.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="50">
            
            

            

            <code class="ruby">  def opportunity_revenue_message(opportunity, detailed = false)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            
            

            

            <code class="ruby">    msg = []</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="52">
            
            

            

            <code class="ruby">    won_or_lost = %w[won lost].include?(opportunity.stage)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="54">
            
            

            

            <code class="ruby">    msg &lt;&lt; content_tag(:b, number_to_currency(opportunity.weighted_amount, precision: 0)) if opportunity.weighted_amount != 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="56">
            
            

            

            <code class="ruby">    unless won_or_lost</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="57">
            
            

            

            <code class="ruby">      if detailed</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="58">
            
            

            

            <code class="ruby">        msg &lt;&lt; number_to_currency(opportunity.amount.to_f, precision: 0) if opportunity.amount.to_f != 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="60">
            
            

            

            <code class="ruby">        msg &lt;&lt; t(:discount) + &#39; &#39; + number_to_currency(opportunity.discount, precision: 0) if opportunity.discount.to_f != 0</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="61">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="63">
            
            

            

            <code class="ruby">      msg &lt;&lt; t(:probability) + &#39; &#39; + opportunity.probability.to_s + &#39;%&#39; if opportunity.probability.to_i != 0</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="64">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="66">
            
            

            

            <code class="ruby">    msg &lt;&lt; opportunity_closes_on_message(opportunity, won_or_lost)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="68">
            
            

            

            <code class="ruby">    msg.join(&#39; | &#39;).html_safe</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="69">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="71">
            
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="73">
            
            

            

            <code class="ruby">  def opportunity_closes_on_message(opportunity, won_or_lost)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="74">
            
            

            

            <code class="ruby">    if opportunity.closes_on</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="75">
            
            

            

            <code class="ruby">      if won_or_lost</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="76">
            
            

            

            <code class="ruby">        if opportunity.closes_on &gt;= Date.today</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="77">
            
            

            

            <code class="ruby">          t(:closing_date, l(opportunity.closes_on, format: :mmddyy))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="78">
            
            

            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="79">
            
            

            

            <code class="ruby">          t(:closed_ago_on, time_ago: distance_of_time_in_words(opportunity.closes_on, Date.today), date: l(opportunity.closes_on, format: :mmddyy))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="80">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="81">
            
            

            

            <code class="ruby">      elsif opportunity.closes_on &gt; Date.today</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="82">
            
            

            

            <code class="ruby">        t(:expected_to_close, time: distance_of_time_in_words(Date.today, opportunity.closes_on), date: l(opportunity.closes_on, format: :mmddyy))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="83">
            
            

            

            <code class="ruby">      elsif opportunity.closes_on == Date.today</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="84">
            
            

            

            <code class="ruby">        content_tag(:span, t(:closes_today), class: &#39;warn&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="85">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="86">
            
            

            

            <code class="ruby">        content_tag(:span, t(:past_due, distance_of_time_in_words(opportunity.closes_on, Date.today)), class: &#39;warn&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="87">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="88">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="89">
            
            

            

            <code class="ruby">      t(:no_closing_date)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="90">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="91">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="92">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="ccb09cb3fdf22f1a0cf5288a59c1daf7f1a2d9d0">
  <div class="header">
    <h3>app/helpers/passwords_helper.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>2</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module PasswordsHelper</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="332505e0382a8c99957cf4c90b33956f5ac8ed23">
  <div class="header">
    <h3>app/helpers/remote_link_pagination_helper.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>8</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>8</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module RemoteLinkPaginationHelper</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  class LinkRenderer &lt; WillPaginate::ActionView::LinkRenderer</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">    def link(text, target, attributes = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">      attributes[&#39;data-remote&#39;] = true</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">      super</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="3a43a8538cdf796ca62ef5fbbc63abbb4287de7c">
  <div class="header">
    <h3>app/helpers/tags_helper.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>21</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>21</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module TagsHelper</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">  # Generate tag links for use on asset index pages.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">  def tags_for_index(model)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">    model.tags.inject(&quot;&quot;.html_safe) do |out, tag|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">      query = controller.send(:current_query) || &quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">      hashtag = &quot;##{tag}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">      if query.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">        query = hashtag</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">      elsif !query.include?(hashtag)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">        query += &quot; #{hashtag}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">      out &lt;&lt; link_to_function(tag, &quot;crm.search_tagged(&#39;#{escape_javascript(query)}&#39;, &#39;#{model.class.to_s.tableize}&#39;)&quot;, title: tag)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            
            

            

            <code class="ruby">  def tags_for_dashboard(model)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            
            

            

            <code class="ruby">    content_tag(:ul) do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            
            

            

            <code class="ruby">      model.tags.each do |tag|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            
            

            

            <code class="ruby">        concat(content_tag(:li, tag.name))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="7458f999a7eda6ff016b569506abf849663c62b8">
  <div class="header">
    <h3>app/helpers/tasks_helper.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>106</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>106</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module TasksHelper</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">  # Sidebar checkbox control for filtering tasks by due date -- used for</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby">  # pending and assigned views only.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">  def task_filter_checkbox(view, filter, count)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">    name = &quot;filter_by_task_#{view}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">    checked = (session[name] ? session[name].split(&quot;,&quot;).include?(filter.to_s) : count.positive?)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">    url = url_for(action: :filter, view: view)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">    onclick = %{</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">      $(&#39;#loading&#39;).show();</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">      $.post(&#39;#{url}&#39;, {filter: this.value, checked: this.checked}, function () {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">        $(&#39;#loading&#39;).hide();</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">      });</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">    check_box_tag(&quot;filters[]&quot;, filter, checked, onclick: onclick, id: &quot;filters_#{filter.to_s.underscore}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            
            

            

            <code class="ruby">  def filtered_out?(view, filter = nil)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            
            

            

            <code class="ruby">    name = &quot;filter_by_task_#{view}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">    if filter</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            
            

            

            <code class="ruby">      filters = (session[name].nil? ? [] : session[name].split(&quot;,&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            
            

            

            <code class="ruby">      !filters.include?(filter.to_s)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            
            

            

            <code class="ruby">      session[name].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="37">
            
            

            

            <code class="ruby">  def link_to_task_edit(task, bucket)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="38">
            
            

            

            <code class="ruby">    link_to(t(:edit), edit_task_path(task, bucket: bucket, view: @view, previous: &quot;crm.find_form(&#39;edit_task&#39;)&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            
            

            

            <code class="ruby">            method: :get, remote: true)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="43">
            
            

            

            <code class="ruby">  def link_to_task_delete(task, bucket)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="44">
            
            

            

            <code class="ruby">    link_to(t(:delete) + &quot;!&quot;, task_path(task, bucket: bucket, view: @view),</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="45">
            
            

            

            <code class="ruby">            method: :delete, remote: true)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="49">
            
            

            

            <code class="ruby">  def link_to_task_complete(pending, bucket)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="50">
            
            

            

            <code class="ruby">    onclick = %{$(&quot;##{dom_id(pending, :name)}&quot;).css({textDecoration: &quot;line-through&quot;});}</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            
            

            

            <code class="ruby">    onclick + %{$.ajax(&quot;#{complete_task_path(pending)}&quot;, {type: &quot;PUT&quot;, data: {bucket: &quot;#{bucket}&quot;}});}</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="52">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="55">
            
            

            

            <code class="ruby">  def link_to_task_uncomplete(task, bucket)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="56">
            
            

            

            <code class="ruby">    link_to(t(:task_uncomplete), uncomplete_task_path(task, bucket: bucket, view: @view),</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="57">
            
            

            

            <code class="ruby">            method: :put, remote: true)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="58">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            
            

            

            <code class="ruby">  # Task summary for RSS/ATOM feed.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="62">
            
            

            

            <code class="ruby">  def task_summary(task)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="63">
            
            

            

            <code class="ruby">    summary = [task.category.blank? ? t(:other) : t(task.category)]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="64">
            
            

            

            <code class="ruby">    if @view != &quot;completed&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="65">
            
            

            

            <code class="ruby">      if @view == &quot;pending&quot; &amp;&amp; task.user != current_user</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="66">
            
            

            

            <code class="ruby">        summary &lt;&lt; t(:task_from, task.user.full_name)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="67">
            
            

            

            <code class="ruby">      elsif @view == &quot;assigned&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="68">
            
            

            

            <code class="ruby">        summary &lt;&lt; t(:task_from, task.assignee.full_name)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="69">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="70">
            
            

            

            <code class="ruby">      summary &lt;&lt; &quot;#{t(:related)} #{task.asset.name} (#{task.asset_type.downcase})&quot; if task.asset_id?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="71">
            
            

            

            <code class="ruby">      summary &lt;&lt; if task.bucket == &quot;due_asap&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="72">
            
            

            

            <code class="ruby">                   t(:task_due_now)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="73">
            
            

            

            <code class="ruby">                 elsif task.bucket == &quot;due_later&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="74">
            
            

            

            <code class="ruby">                   t(:task_due_later)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="75">
            
            

            

            <code class="ruby">                 else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="76">
            
            

            

            <code class="ruby">                   l(task.due_at.localtime, format: :mmddhhss)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="77">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="78">
            
            

            

            <code class="ruby">    else # completed</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="79">
            
            

            

            <code class="ruby">      summary &lt;&lt; &quot;#{t(:related)} #{task.asset.name} (#{task.asset_type.downcase})&quot; if task.asset_id?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="80">
            
            

            

            <code class="ruby">      summary &lt;&lt; t(:task_completed_by,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="81">
            
            

            

            <code class="ruby">                   time_ago: distance_of_time_in_words(task.completed_at, Time.now),</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="82">
            
            

            

            <code class="ruby">                   date:     l(task.completed_at.localtime, format: :mmddhhss),</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="83">
            
            

            

            <code class="ruby">                   user:     task.completor.full_name)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="84">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="85">
            
            

            

            <code class="ruby">    summary.join(&#39;, &#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="86">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="89">
            
            

            

            <code class="ruby">  def hide_task_and_possibly_bucket(task, bucket)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="90">
            
            

            

            <code class="ruby">    text = &quot;$(&#39;##{h dom_id(task)}&#39;).remove();\n&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="91">
            
            

            

            <code class="ruby">    text += &quot;$(&#39;#list_#{h bucket.to_s}&#39;).fadeOut({ duration:500 });\n&quot; if Task.bucket_empty?(bucket, current_user, @view)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="92">
            
            

            

            <code class="ruby">    text.html_safe</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="93">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="96">
            
            

            

            <code class="ruby">  def replace_content(task, bucket = nil)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="97">
            
            

            

            <code class="ruby">    partial = task.assigned_to &amp;&amp; task.assigned_to != current_user.id ? &quot;assigned&quot; : &quot;pending&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="98">
            
            

            

            <code class="ruby">    html = render(partial: &quot;tasks/#{partial}&quot;, collection: [task], locals: { bucket: bucket })</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="99">
            
            

            

            <code class="ruby">    &quot;$(&#39;##{dom_id(task)}&#39;).html(&#39;#{j html}&#39;);\n&quot;.html_safe</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="100">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="103">
            
            

            

            <code class="ruby">  def insert_content(task, bucket, view)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="104">
            
            

            

            <code class="ruby">    html = render(partial: view, collection: [task], locals: { bucket: bucket })</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="105">
            
            

            

            <code class="ruby">    text = &quot;$(&#39;#list_#{bucket}&#39;).show();\n&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="106">
            
            

            

            <code class="ruby">    text += &quot;$(&#39;##{h bucket.to_s}&#39;).prepend(&#39;#{j html}&#39;);\n&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="107">
            
            

            

            <code class="ruby">    text += &quot;$(&#39;##{dom_id(task)}&#39;).effect(&#39;highlight&#39;, { duration:1500 });\n&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="108">
            
            

            

            <code class="ruby">    text.html_safe</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="109">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="112">
            
            

            

            <code class="ruby">  def tasks_flash(message)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="113">
            
            

            

            <code class="ruby">    text = &quot;$(&#39;#flash&#39;).html(&#39;#{sanitize(message)}&#39;);\n&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="114">
            
            

            

            <code class="ruby">    text += &quot;crm.flash(&#39;notice&#39;, true)\n&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="115">
            
            

            

            <code class="ruby">    text.html_safe</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="116">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="119">
            
            

            

            <code class="ruby">  def reassign(task)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="120">
            
            

            

            <code class="ruby">    text = &#39;&#39;.html_safe</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="121">
            
            

            

            <code class="ruby">    if @view == &quot;pending&quot; &amp;&amp; @task.assigned_to.present? &amp;&amp; @task.assigned_to != current_user.id</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="122">
            
            

            

            <code class="ruby">      text &lt;&lt; hide_task_and_possibly_bucket(task, @task_before_update.bucket)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="123">
            
            

            

            <code class="ruby">      text &lt;&lt; tasks_flash(t(:task_assigned, (h @task.assignee.try(:full_name))) + &quot; (#{link_to(t(:view_assigned_tasks), url_for(controller: :tasks, view: :assigned))})&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="124">
            
            

            

            <code class="ruby">    elsif @view == &quot;assigned&quot; &amp;&amp; @task.assigned_to.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="125">
            
            

            

            <code class="ruby">      text &lt;&lt; hide_task_and_possibly_bucket(task, @task_before_update.bucket)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="126">
            
            

            

            <code class="ruby">      text &lt;&lt; tasks_flash(t(:task_pending) + &quot; (#{link_to(t(:view_pending_tasks), tasks_url)}.&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="127">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="128">
            
            

            

            <code class="ruby">      text &lt;&lt; replace_content(@task, @task.bucket)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="129">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="130">
            
            

            

            <code class="ruby">    text &lt;&lt; refresh_sidebar(:index)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="131">
            
            

            

            <code class="ruby">    text</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="132">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="135">
            
            

            

            <code class="ruby">  def reschedule(task)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="136">
            
            

            

            <code class="ruby">    text = hide_task_and_possibly_bucket(task, @task_before_update.bucket)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="137">
            
            

            

            <code class="ruby">    text += insert_content(task, task.bucket, @view)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="138">
            
            

            

            <code class="ruby">    text += refresh_sidebar(:index)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="139">
            
            

            

            <code class="ruby">    text</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="140">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="141">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="b7ee12dc01ce7942093e03fa6f22056464dea569">
  <div class="header">
    <h3>app/helpers/users_helper.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>24</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>24</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module UsersHelper</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  def language_for(user)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">    _locale, language = languages.detect { |locale, _language| locale == user.preference[:locale] } if user.preference[:locale]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">    language || &quot;English&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">  def sort_by_language</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">    languages.sort.map do |locale, language|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">      %[{ name: &quot;#{language}&quot;, on_select: function() { #{redraw(:locale, [locale, language], url_for(action: :redraw, id: current_user))} } }]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">  def all_users</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">    User.by_name</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            
            

            

            <code class="ruby">  def user_select(asset, users, myself)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            
            

            

            <code class="ruby">    user_options = user_options_for_select(users, myself)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            
            

            

            <code class="ruby">    select(asset, :assigned_to, user_options,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            
            

            

            <code class="ruby">           { include_blank: t(:unassigned) },</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">           style: &#39;width: 160px;&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            
            

            

            <code class="ruby">           class: &#39;select2&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            
            

            

            <code class="ruby">  def user_options_for_select(users, myself)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            
            

            

            <code class="ruby">    (users - [myself]).map { |u| [u.full_name, u.id] }.prepend([t(:myself), myself.id])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="c19f7fb1c0a6e88e9ef880b918bf7061bf09a584">
  <div class="header">
    <h3>app/helpers/versions_helper.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>22</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>22</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module VersionsHelper</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">  # Parse the changes for each version</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">  def parse_version(attr_name, change)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">    if attr_name =~ /\Acf_/ &amp;&amp; (field = CustomField.where(name: attr_name).first).present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">      label = field.label</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">      first = field.render(change.first)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">      second = field.render(change.second)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">      label = t(attr_name)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">      first = change.first</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">      second = change.second</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby">    # Find account and link to it.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">    if attr_name == &#39;account_id&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            
            

            

            <code class="ruby">      if first.present? &amp;&amp; (account = Account.find_by_id(first))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            
            

            

            <code class="ruby">        first = link_to(h(account.name), account_path(account))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            
            

            

            <code class="ruby">      if second.present? &amp;&amp; (account = Account.find_by_id(second))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">        second = link_to(h(account.name), account_path(account))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            
            

            

            <code class="ruby">    [label, first, second]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="756519ed6f79b62531f65ea58fe5a3623c7745b9">
  <div class="header">
    <h3>app/inputs/date_pair_input.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>38</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>38</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">class DatePairInput &lt; SimpleForm::Inputs::Base</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">  # Output two date fields: start and end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby">  #------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">  def input(wrapper_options)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">    add_autocomplete!</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">    out = &quot;&lt;br /&gt;&quot;.html_safe</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">    field1, field2 = get_fields</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">    [field1, field2].compact.each do |field|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">      out &lt;&lt; &#39;&lt;div&gt;&#39;.html_safe</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">      label = field == field1 ? I18n.t(&#39;pair.start&#39;) : I18n.t(&#39;pair.end&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">      %i[required disabled].each { |k| input_html_options.delete(k) } # ensure these come from field not default options</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">      input_html_options.merge!(field.input_options)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">      input_html_options[:value] = value(field)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">      out &lt;&lt; &quot;&lt;label#{&#39; class=&quot;req&quot;&#39; if input_html_options[:required]}&gt;#{label}&lt;/label&gt;&quot;.html_safe</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            
            

            

            <code class="ruby">      text = @builder.text_field(field.name, merge_wrapper_options(input_html_options, wrapper_options))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            
            

            

            <code class="ruby">      out &lt;&lt; text &lt;&lt; &#39;&lt;/div&gt;&#39;.html_safe</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">    out</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            
            

            

            <code class="ruby">  # Returns true if either field is required?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            
            

            

            <code class="ruby">  #------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            
            

            

            <code class="ruby">  def required_field?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="36">
            
            

            

            <code class="ruby">    get_fields.map(&amp;:required).any?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="37">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            
            

            

            <code class="ruby">  # Turns autocomplete off unless told otherwise.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            
            

            

            <code class="ruby">  #------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            
            

            

            <code class="ruby">  def add_autocomplete!</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="42">
            
            

            

            <code class="ruby">    input_html_options[:autocomplete] ||= &#39;off&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="43">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            
            

            

            <code class="ruby">  # Datepicker latches onto the &#39;date&#39; class.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            
            

            

            <code class="ruby">  #------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="47">
            
            

            

            <code class="ruby">  def input_html_classes</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="48">
            
            

            

            <code class="ruby">    super.push(&#39;date&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="49">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            
            

            

            <code class="ruby">  # Returns the pair as [field1, field2]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            
            

            

            <code class="ruby">  #------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="53">
            
            

            

            <code class="ruby">  def get_fields</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="54">
            
            

            

            <code class="ruby">    @field1 ||= Field.where(name: attribute_name).first</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="55">
            
            

            

            <code class="ruby">    @field2 ||= @field1.try(:paired_with)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="56">
            
            

            

            <code class="ruby">    [@field1, @field2]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="57">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            
            

            

            <code class="ruby">  # Serialize into a value recognised by datepicker</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            
            

            

            <code class="ruby">  #------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="61">
            
            

            

            <code class="ruby">  def value(field)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="62">
            
            

            

            <code class="ruby">    val = object.send(field.name)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="63">
            
            

            

            <code class="ruby">    val.present? ? val.strftime(&#39;%Y-%m-%d&#39;) : nil</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="64">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="66">
            
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_date_pair_input, self)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="67">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="39d79c838240be884b4de1b484f0d5381a649de7">
  <div class="header">
    <h3>app/inputs/date_time_input.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>23</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>23</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">class DateTimeInput &lt; SimpleForm::Inputs::DateTimeInput</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  def input(wrapper_options)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">    add_autocomplete!</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">    input_html_options.merge(input_options)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">    input_html_options[:value] = value</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">    @builder.text_field(attribute_name, merge_wrapper_options(input_html_options, wrapper_options))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">  def label_target</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">    attribute_name</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">  def has_required?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">    options[:required]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            
            

            

            <code class="ruby">  def add_autocomplete!</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            
            

            

            <code class="ruby">    input_html_options[:autocomplete] ||= &#39;off&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby">  # Serialize into a value recognised by datepicker, also sorts out timezone conversion</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby">  #------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            
            

            

            <code class="ruby">  def value</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            
            

            

            <code class="ruby">    val = object.send(attribute_name)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            
            

            

            <code class="ruby">    val.present? ? val.strftime(&#39;%Y-%m-%d %H:%M&#39;) : nil</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="37">
            
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_date_time_input, self)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="38">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="ee8442d0521c93a18dae4f7c6915401c6c2a10a0">
  <div class="header">
    <h3>app/inputs/datetime_pair_input.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>13</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>13</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">class DatetimePairInput &lt; DatePairInput</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">  # Tell datepicker this is a datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">  #------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">  def input_html_classes</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">    classes = super.dup</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">    classes.delete(&#39;date&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">    classes.push(&#39;datetime&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">  # Return value recognised by datepicker and ensure timezone properly set by AR</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">  #------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">  def value(field)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">    val = object.send(field.name)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">    val.present? ? val.strftime(&#39;%Y-%m-%d %H:%M&#39;) : nil</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_datetime_pair_input, self)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="fcf410a573759741145f518d877c7b0a889db93c">
  <div class="header">
    <h3>app/inputs/text_input.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>6</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>6</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">class TextInput &lt; SimpleForm::Inputs::TextInput</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  def input(wrapper_options)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">    @builder.text_area(attribute_name, { rows: 7 }.merge(merge_wrapper_options(input_html_options, wrapper_options)))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_text_input, self)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="af99db8f598d35b19aff0f6c9080fa4515530853">
  <div class="header">
    <h3>app/mailers/devise_mailer.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>3</b> relevant lines.
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            <span class="hits">1</span>
            

            

            <code class="ruby">class DeviseMailer &lt; Devise::Mailer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def template_paths</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3442" data-linenumber="10">
            <span class="hits">3442</span>
            

            

            <code class="ruby">    [&quot;devise/mailer&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="06d834ceef65da758c55530cb921d16a9d1cbc4b">
  <div class="header">
    <h3>app/mailers/dropbox_mailer.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>12</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>12</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">class DropboxMailer &lt; ActionMailer::Base</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  def dropbox_notification(user, from, email, mediator_links)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">    I18n.locale = Setting.locale</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">    @mediator_links = mediator_links.join(&quot;\n&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">    @subject        = email.subject</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">    @body           = email.body_plain</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">    mail subject: I18n.t(:dropbox_notification_subject, subject: email.subject),</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">         to: user.email,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">         from: from,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">         date: Time.now</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="3d313ddf91806b84359c4a46a8ace1637be3e017">
  <div class="header">
    <h3>app/mailers/subscription_mailer.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>15</b> relevant lines.
      <span class="green"><b>15</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            <span class="hits">1</span>
            

            

            <code class="ruby">class SubscriptionMailer &lt; ActionMailer::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def comment_notification(user, comment)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="10">
            <span class="hits">6</span>
            

            

            <code class="ruby">    @entity = comment.commentable</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="11">
            <span class="hits">6</span>
            

            

            <code class="ruby">    @entity_type = @entity.class.to_s</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="12">
            <span class="hits">6</span>
            

            

            <code class="ruby">    @entity_name = @entity.respond_to?(:full_name) ? @entity.full_name : @entity.name</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="14">
            <span class="hits">6</span>
            

            

            <code class="ruby">    @comment = comment</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="15">
            <span class="hits">6</span>
            

            

            <code class="ruby">    @user = comment.user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">    # If entity has tags, join them and wrap in parantheses</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="18">
            <span class="hits">6</span>
            

            

            <code class="ruby">    subject = &quot;RE: [#{@entity_type.downcase}:#{@entity.id}] #{@entity_name}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="19">
            <span class="hits">6</span>
            

            

            <code class="ruby">    subject += &quot; (#{@entity.tags.join(&#39;, &#39;)})&quot; if @entity.tags.any?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="21">
            <span class="hits">6</span>
            

            

            <code class="ruby">    mail subject: subject,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby">         to: user.email,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby">         from: from_address(@user),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby">         date: Time.now</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="27">
            <span class="hits">1</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="29">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def from_address(user = nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="30">
            <span class="hits">6</span>
            

            

            <code class="ruby">    address = Setting.dig(:email_comment_replies, :address).presence ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby">              Setting.dig(:smtp, :from).presence ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby">              &quot;noreply@fatfreecrm.com&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="33">
            <span class="hits">6</span>
            

            

            <code class="ruby">    address = &quot;#{user.full_name} &lt;#{address}&gt;&quot; if user &amp;&amp; !address.match(/&lt;.+&gt;\z/)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="34">
            <span class="hits">6</span>
            

            

            <code class="ruby">    address</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="6bb27bccb2057b9b2885e92e4a4ca6c642190bae">
  <div class="header">
    <h3>app/mailers/user_mailer.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>10</b> relevant lines.
      <span class="green"><b>10</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            <span class="hits">1</span>
            

            

            <code class="ruby">class UserMailer &lt; ActionMailer::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def assigned_entity_notification(entity, assigner)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="10">
            <span class="hits">20</span>
            

            

            <code class="ruby">    @entity_url = url_for(entity)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="11">
            <span class="hits">20</span>
            

            

            <code class="ruby">    @entity_name = entity.name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="12">
            <span class="hits">20</span>
            

            

            <code class="ruby">    @entity_type = entity.class.name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="13">
            <span class="hits">20</span>
            

            

            <code class="ruby">    @assigner_name = assigner.name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="14">
            <span class="hits">20</span>
            

            

            <code class="ruby">    mail subject: &quot;Fat Free CRM: You have been assigned #{@entity_name} #{@entity_type}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">         to: entity.assignee.email,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">         from: from_address</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="19">
            <span class="hits">1</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="21">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def from_address</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="22">
            <span class="hits">20</span>
            

            

            <code class="ruby">    Setting.dig(:smtp, :from).presence || &quot;Fat Free CRM &lt;noreply@fatfreecrm.com&gt;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="b3190e1acd6b47eadc4c3beaf1a3b0ba3fb1fc4a">
  <div class="header">
    <h3>app/models/entities/account.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>84</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>84</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby"># == Schema Information</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"># Table name: accounts</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">#  id              :integer         not null, primary key</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">#  user_id         :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">#  assigned_to     :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">#  name            :string(64)      default(&quot;&quot;), not null</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">#  access          :string(8)       default(&quot;Public&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">#  website         :string(64)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">#  toll_free_phone :string(32)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">#  phone           :string(32)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">#  fax             :string(32)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby">#  deleted_at      :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby">#  created_at      :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby">#  updated_at      :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby">#  email           :string(64)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">#  background_info :string(255)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby">#  rating          :integer         default(0), not null</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby">#  category        :string(32)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            
            

            

            <code class="ruby">class Account &lt; ActiveRecord::Base</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            
            

            

            <code class="ruby">  belongs_to :user, optional: true # TODO: Is this really optional?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            
            

            

            <code class="ruby">  belongs_to :assignee, class_name: &quot;User&quot;, foreign_key: :assigned_to, optional: true</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            
            

            

            <code class="ruby">  has_many :account_contacts, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            
            

            

            <code class="ruby">  has_many :contacts, -&gt; { distinct }, through: :account_contacts</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            
            

            

            <code class="ruby">  has_many :account_opportunities, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="36">
            
            

            

            <code class="ruby">  has_many :opportunities, -&gt; { order(&quot;opportunities.id DESC&quot;).distinct }, through: :account_opportunities</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="37">
            
            

            

            <code class="ruby">  has_many :pipeline_opportunities, -&gt; { order(&quot;opportunities.id DESC&quot;).distinct.pipeline }, through: :account_opportunities, source: :opportunity</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="38">
            
            

            

            <code class="ruby">  has_many :tasks, as: :asset, dependent: :destroy # , :order =&gt; &#39;created_at DESC&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            
            

            

            <code class="ruby">  has_one :billing_address, -&gt; { where(address_type: &quot;Billing&quot;) }, dependent: :destroy, as: :addressable, class_name: &quot;Address&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            
            

            

            <code class="ruby">  has_one :shipping_address, -&gt; { where(address_type: &quot;Shipping&quot;) }, dependent: :destroy, as: :addressable, class_name: &quot;Address&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            
            

            

            <code class="ruby">  has_many :addresses, dependent: :destroy, as: :addressable, class_name: &quot;Address&quot; # advanced search uses this</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="42">
            
            

            

            <code class="ruby">  has_many :emails, as: :mediator</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="44">
            
            

            

            <code class="ruby">  serialize :subscribed_users, Array</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            
            

            

            <code class="ruby">  accepts_nested_attributes_for :billing_address,  allow_destroy: true, reject_if: proc { |attributes| Address.reject_address(attributes) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="47">
            
            

            

            <code class="ruby">  accepts_nested_attributes_for :shipping_address, allow_destroy: true, reject_if: proc { |attributes| Address.reject_address(attributes) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="49">
            
            

            

            <code class="ruby">  scope :state, lambda { |filters|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="50">
            
            

            

            <code class="ruby">    where(&#39;category IN (?)&#39; + (filters.delete(&#39;other&#39;) ? &#39; OR category IS NULL&#39; : &#39;&#39;), filters)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            
            

            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="52">
            
            

            

            <code class="ruby">  scope :created_by,  -&gt;(user) { where(user_id: user.id) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="53">
            
            

            

            <code class="ruby">  scope :assigned_to, -&gt;(user) { where(assigned_to: user.id) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="55">
            
            

            

            <code class="ruby">  scope :text_search, -&gt;(query) { ransack(&#39;name_or_email_cont&#39; =&gt; query).result }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="57">
            
            

            

            <code class="ruby">  scope :visible_on_dashboard, lambda { |user|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            
            

            

            <code class="ruby">    # Show accounts which either belong to the user and are unassigned, or are assigned to the user</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="59">
            
            

            

            <code class="ruby">    where(&#39;(user_id = :user_id AND assigned_to IS NULL) OR assigned_to = :user_id&#39;, user_id: user.id)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="60">
            
            

            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="62">
            
            

            

            <code class="ruby">  scope :by_name, -&gt; { order(:name) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="64">
            
            

            

            <code class="ruby">  uses_user_permissions</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="65">
            
            

            

            <code class="ruby">  acts_as_commentable</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="66">
            
            

            

            <code class="ruby">  uses_comment_extensions</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="67">
            
            

            

            <code class="ruby">  acts_as_taggable_on :tags</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="68">
            
            

            

            <code class="ruby">  has_paper_trail versions: { class_name: &#39;Version&#39; }, ignore: [:subscribed_users]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="69">
            
            

            

            <code class="ruby">  has_fields</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="70">
            
            

            

            <code class="ruby">  exportable</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="71">
            
            

            

            <code class="ruby">  sortable by: [&quot;name ASC&quot;, &quot;rating DESC&quot;, &quot;created_at DESC&quot;, &quot;updated_at DESC&quot;], default: &quot;created_at DESC&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="73">
            
            

            

            <code class="ruby">  has_ransackable_associations %w[contacts opportunities tags activities emails addresses comments tasks]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="74">
            
            

            

            <code class="ruby">  ransack_can_autocomplete</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="76">
            
            

            

            <code class="ruby">  validates_presence_of :name, message: :missing_account_name</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="77">
            
            

            

            <code class="ruby">  validates_uniqueness_of :name, scope: :deleted_at, if: -&gt; { Setting.require_unique_account_names }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="78">
            
            

            

            <code class="ruby">  validates :rating, inclusion: { in: 0..5 }, allow_blank: true</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="79">
            
            

            

            <code class="ruby">  validates :category, inclusion: { in: proc { Setting.unroll(:account_category).map { |s| s.last.to_s } } }, allow_blank: true</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="80">
            
            

            

            <code class="ruby">  validate :users_for_shared_access</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="82">
            
            

            

            <code class="ruby">  before_save :nullify_blank_category</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            
            

            

            <code class="ruby">  # Default values provided through class methods.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="86">
            
            

            

            <code class="ruby">  def self.per_page</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="87">
            
            

            

            <code class="ruby">    20</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="88">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            
            

            

            <code class="ruby">  # Extract last line of billing address and get rid of numeric zipcode.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="92">
            
            

            

            <code class="ruby">  def location</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="93">
            
            

            

            <code class="ruby">    return &quot;&quot; unless self[:billing_address]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="95">
            
            

            

            <code class="ruby">    location = self[:billing_address].strip.split(&quot;\n&quot;).last</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="96">
            
            

            

            <code class="ruby">    location&amp;.gsub(/(^|\s+)\d+(:?\s+|$)/, &quot; &quot;)&amp;.strip</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="97">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            
            

            

            <code class="ruby">  # Attach given attachment to the account if it hasn&#39;t been attached already.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="101">
            
            

            

            <code class="ruby">  def attach!(attachment)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="102">
            
            

            

            <code class="ruby">    send(attachment.class.name.tableize) &lt;&lt; attachment unless send(&quot;#{attachment.class.name.downcase}_ids&quot;).include?(attachment.id)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="103">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            
            

            

            <code class="ruby">  # Discard given attachment from the account.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="107">
            
            

            

            <code class="ruby">  def discard!(attachment)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="108">
            
            

            

            <code class="ruby">    if attachment.is_a?(Task)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="109">
            
            

            

            <code class="ruby">      attachment.update_attribute(:asset, nil)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="110">
            
            

            

            <code class="ruby">    else # Contacts, Opportunities</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="111">
            
            

            

            <code class="ruby">      send(attachment.class.name.tableize).delete(attachment)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="112">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="113">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            
            

            

            <code class="ruby">  # Class methods.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="117">
            
            

            

            <code class="ruby">  def self.create_or_select_for(model, params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            
            

            

            <code class="ruby">    # Attempt to find existing account</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="119">
            
            

            

            <code class="ruby">    return Account.find(params[:id]) if params[:id].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="121">
            
            

            

            <code class="ruby">    if params[:name].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="122">
            
            

            

            <code class="ruby">      account = Account.find_by(name: params[:name])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="123">
            
            

            

            <code class="ruby">      return account if account</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="124">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            
            

            

            <code class="ruby">    # Fallback to create new account</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="127">
            
            

            

            <code class="ruby">    params[:user] = model.user if model</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="128">
            
            

            

            <code class="ruby">    account = Account.new(params)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="129">
            
            

            

            <code class="ruby">    if account.access != &quot;Lead&quot; || model.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="130">
            
            

            

            <code class="ruby">      account.save</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="131">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="132">
            
            

            

            <code class="ruby">      account.save_with_model_permissions(model)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="133">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="134">
            
            

            

            <code class="ruby">    account</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="135">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="137">
            
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            
            

            

            <code class="ruby">  # Make sure at least one user has been selected if the account is being shared.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="141">
            
            

            

            <code class="ruby">  def users_for_shared_access</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="142">
            
            

            

            <code class="ruby">    errors.add(:access, :share_account) if self[:access] == &quot;Shared&quot; &amp;&amp; permissions.none?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="143">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="145">
            
            

            

            <code class="ruby">  def nullify_blank_category</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="146">
            
            

            

            <code class="ruby">    self.category = nil if category.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="147">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="149">
            
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_account, self)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="150">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="42f121fdc7f89c3e7f10358982eda365240f4918">
  <div class="header">
    <h3>app/models/entities/account_contact.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>6</b> relevant lines.
      <span class="green"><b>6</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby"># == Schema Information</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"># Table name: account_contacts</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">#  id         :integer         not null, primary key</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">#  account_id :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">#  contact_id :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">#  deleted_at :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">#  created_at :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">#  updated_at :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="20">
            <span class="hits">1</span>
            

            

            <code class="ruby">class AccountContact &lt; ActiveRecord::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="21">
            <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :account, counter_cache: :contacts_count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="22">
            <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :contact</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="24">
            <span class="hits">1</span>
            

            

            <code class="ruby">  has_paper_trail versions: { class_name: &#39;Version&#39; }, meta: { related: :contact },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">                  ignore: %i[id created_at updated_at contact_id]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="27">
            <span class="hits">1</span>
            

            

            <code class="ruby">  validates_presence_of :account_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="29">
            <span class="hits">1</span>
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_account_contact, self)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="d886a657b7885c91a35c22df717bfe38bcf36744">
  <div class="header">
    <h3>app/models/entities/account_opportunity.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>6</b> relevant lines.
      <span class="green"><b>6</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby"># == Schema Information</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"># Table name: account_opportunities</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">#  id             :integer         not null, primary key</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">#  account_id     :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">#  opportunity_id :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">#  deleted_at     :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">#  created_at     :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">#  updated_at     :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="20">
            <span class="hits">1</span>
            

            

            <code class="ruby">class AccountOpportunity &lt; ActiveRecord::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="21">
            <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :account, counter_cache: :opportunities_count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="22">
            <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :opportunity</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="23">
            <span class="hits">1</span>
            

            

            <code class="ruby">  validates_presence_of :account_id, :opportunity_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="25">
            <span class="hits">1</span>
            

            

            <code class="ruby">  has_paper_trail versions: { class_name: &#39;Version&#39; }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="27">
            <span class="hits">1</span>
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_account_opportunity, self)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="54523023897f661e80322c55aa801a98b89529f5">
  <div class="header">
    <h3>app/models/entities/campaign.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>48</b> relevant lines.
      <span class="green"><b>48</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby"># == Schema Information</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"># Table name: campaigns</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">#  id                  :integer         not null, primary key</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">#  user_id             :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">#  assigned_to         :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">#  name                :string(64)      default(&quot;&quot;), not null</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">#  access              :string(8)       default(&quot;Public&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">#  status              :string(64)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">#  budget              :decimal(12, 2)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">#  target_leads        :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">#  target_conversion   :float</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby">#  target_revenue      :decimal(12, 2)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby">#  leads_count         :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby">#  opportunities_count :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby">#  revenue             :decimal(12, 2)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">#  starts_on           :date</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby">#  ends_on             :date</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby">#  objectives          :text</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby">#  deleted_at          :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby">#  created_at          :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby">#  updated_at          :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby">#  background_info     :string(255)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            <span class="hits">1</span>
            

            

            <code class="ruby">class Campaign &lt; ActiveRecord::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="35">
            <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :user, optional: true # TODO: Is this really optional?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="36">
            <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :assignee, class_name: &quot;User&quot;, foreign_key: :assigned_to, optional: true # TODO: Is this really optional?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="37">
            <span class="hits">1</span>
            

            

            <code class="ruby">  has_many :tasks, as: :asset, dependent: :destroy # , :order =&gt; &#39;created_at DESC&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="38">
            <span class="hits">54</span>
            

            

            <code class="ruby">  has_many :leads, -&gt; { order &quot;id DESC&quot; }, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="39">
            <span class="hits">56</span>
            

            

            <code class="ruby">  has_many :opportunities, -&gt; { order &quot;id DESC&quot; }, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="40">
            <span class="hits">1</span>
            

            

            <code class="ruby">  has_many :emails, as: :mediator</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="42">
            <span class="hits">1</span>
            

            

            <code class="ruby">  serialize :subscribed_users, Array</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="44">
            <span class="hits">1</span>
            

            

            <code class="ruby">  scope :state, lambda { |filters|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="45">
            <span class="hits">3</span>
            

            

            <code class="ruby">    where(&#39;status IN (?)&#39; + (filters.delete(&#39;other&#39;) ? &#39; OR status IS NULL&#39; : &#39;&#39;), filters)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            
            

            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="47">
            <span class="hits">11</span>
            

            

            <code class="ruby">  scope :created_by,  -&gt;(user) { where(user_id: user.id) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="48">
            <span class="hits">12</span>
            

            

            <code class="ruby">  scope :assigned_to, -&gt;(user) { where(assigned_to: user.id) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="50">
            <span class="hits">8</span>
            

            

            <code class="ruby">  scope :text_search, -&gt;(query) { ransack(&#39;name_cont&#39; =&gt; query).result }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="52">
            <span class="hits">1</span>
            

            

            <code class="ruby">  uses_user_permissions</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="53">
            <span class="hits">1</span>
            

            

            <code class="ruby">  acts_as_commentable</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="54">
            <span class="hits">1</span>
            

            

            <code class="ruby">  uses_comment_extensions</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="55">
            <span class="hits">1</span>
            

            

            <code class="ruby">  acts_as_taggable_on :tags</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="56">
            <span class="hits">1</span>
            

            

            <code class="ruby">  has_paper_trail versions: { class_name: &#39;Version&#39; }, ignore: [:subscribed_users]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="57">
            <span class="hits">1</span>
            

            

            <code class="ruby">  has_fields</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="58">
            <span class="hits">1</span>
            

            

            <code class="ruby">  exportable</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="59">
            <span class="hits">1</span>
            

            

            <code class="ruby">  sortable by: [&quot;name ASC&quot;, &quot;target_leads DESC&quot;, &quot;target_revenue DESC&quot;, &quot;leads_count DESC&quot;, &quot;revenue DESC&quot;, &quot;starts_on DESC&quot;, &quot;ends_on DESC&quot;, &quot;created_at DESC&quot;, &quot;updated_at DESC&quot;], default: &quot;created_at DESC&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="61">
            <span class="hits">1</span>
            

            

            <code class="ruby">  has_ransackable_associations %w[leads opportunities tags activities emails comments tasks]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="62">
            <span class="hits">1</span>
            

            

            <code class="ruby">  ransack_can_autocomplete</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="64">
            <span class="hits">1</span>
            

            

            <code class="ruby">  validates_presence_of :name, message: :missing_campaign_name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="65">
            <span class="hits">1</span>
            

            

            <code class="ruby">  validates_uniqueness_of :name, scope: %i[user_id deleted_at]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="66">
            <span class="hits">1</span>
            

            

            <code class="ruby">  validate :start_and_end_dates</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="67">
            <span class="hits">1</span>
            

            

            <code class="ruby">  validate :users_for_shared_access</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5491" data-linenumber="68">
            <span class="hits">5491</span>
            

            

            <code class="ruby">  validates :status, inclusion: { in: proc { Setting.unroll(:campaign_status).map { |s| s.last.to_s } } }, allow_blank: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            
            

            

            <code class="ruby">  # Default values provided through class methods.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="72">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def self.per_page</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="49" data-linenumber="73">
            <span class="hits">49</span>
            

            

            <code class="ruby">    20</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            
            

            

            <code class="ruby">  # Attach given attachment to the campaign if it hasn&#39;t been attached already.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="78">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def attach!(attachment)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="79">
            <span class="hits">20</span>
            

            

            <code class="ruby">    unless send(&quot;#{attachment.class.name.downcase}_ids&quot;).include?(attachment.id)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="80">
            <span class="hits">11</span>
            

            

            <code class="ruby">      if attachment.is_a?(Task)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="81">
            <span class="hits">3</span>
            

            

            <code class="ruby">        send(attachment.class.name.tableize) &lt;&lt; attachment</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            
            

            

            <code class="ruby">      else # Leads, Opportunities</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="83">
            <span class="hits">8</span>
            

            

            <code class="ruby">        attachment.update_attribute(:campaign, self)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="84">
            <span class="hits">8</span>
            

            

            <code class="ruby">        attachment.send(&quot;increment_#{attachment.class.name.tableize}_count&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="85">
            <span class="hits">8</span>
            

            

            <code class="ruby">        [attachment]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            
            

            

            <code class="ruby">  # Discard given attachment from the campaign.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="92">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def discard!(attachment)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="93">
            <span class="hits">6</span>
            

            

            <code class="ruby">    if attachment.is_a?(Task)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="94">
            <span class="hits">2</span>
            

            

            <code class="ruby">      attachment.update_attribute(:asset, nil)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            
            

            

            <code class="ruby">    else # Leads, Opportunities</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="96">
            <span class="hits">4</span>
            

            

            <code class="ruby">      attachment.send(&quot;decrement_#{attachment.class.name.tableize}_count&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="97">
            <span class="hits">4</span>
            

            

            <code class="ruby">      attachment.update_attribute(:campaign, nil)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="101">
            <span class="hits">1</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            
            

            

            <code class="ruby">  # Make sure end date &gt; start date.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="105">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def start_and_end_dates</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="812" data-linenumber="106">
            <span class="hits">812</span>
            

            

            <code class="ruby">    errors.add(:ends_on, :dates_not_in_sequence) if (starts_on &amp;&amp; ends_on) &amp;&amp; (starts_on &gt; ends_on)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            
            

            

            <code class="ruby">  # Make sure at least one user has been selected if the campaign is being shared.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="111">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def users_for_shared_access</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="812" data-linenumber="112">
            <span class="hits">812</span>
            

            

            <code class="ruby">    errors.add(:access, :share_campaign) if self[:access] == &quot;Shared&quot; &amp;&amp; permissions.none?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="115">
            <span class="hits">1</span>
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_campaign, self)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="8cc50694f028c8ad9b55612a84515c012d6182d0">
  <div class="header">
    <h3>app/models/entities/contact.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>139</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>139</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby"># == Schema Information</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"># Table name: contacts</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">#  id              :integer         not null, primary key</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">#  user_id         :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">#  lead_id         :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">#  assigned_to     :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">#  reports_to      :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">#  first_name      :string(64)      default(&quot;&quot;), not null</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">#  last_name       :string(64)      default(&quot;&quot;), not null</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">#  access          :string(8)       default(&quot;Public&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">#  title           :string(64)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby">#  department      :string(64)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby">#  source          :string(32)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby">#  email           :string(64)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby">#  alt_email       :string(64)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">#  phone           :string(32)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby">#  mobile          :string(32)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby">#  fax             :string(32)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby">#  blog            :string(128)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby">#  linkedin        :string(128)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby">#  facebook        :string(128)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby">#  twitter         :string(128)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby">#  born_on         :date</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            
            

            

            <code class="ruby">#  do_not_call     :boolean         default(FALSE), not null</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            
            

            

            <code class="ruby">#  deleted_at      :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            
            

            

            <code class="ruby">#  created_at      :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            
            

            

            <code class="ruby">#  updated_at      :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            
            

            

            <code class="ruby">#  background_info :string(255)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            
            

            

            <code class="ruby">#  skype           :string(128)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            
            

            

            <code class="ruby">class Contact &lt; ActiveRecord::Base</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="42">
            
            

            

            <code class="ruby">  belongs_to :user</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="43">
            
            

            

            <code class="ruby">  belongs_to :lead, optional: true # TODO: Is this really optional?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="44">
            
            

            

            <code class="ruby">  belongs_to :assignee, class_name: &quot;User&quot;, foreign_key: :assigned_to, optional: true # TODO: Is this really optional?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="45">
            
            

            

            <code class="ruby">  belongs_to :reporting_user, class_name: &quot;User&quot;, foreign_key: :reports_to, optional: true # TODO: Is this really optional?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            
            

            

            <code class="ruby">  has_one :account_contact, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="47">
            
            

            

            <code class="ruby">  has_one :account, through: :account_contact</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="48">
            
            

            

            <code class="ruby">  has_many :contact_opportunities, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="49">
            
            

            

            <code class="ruby">  has_many :opportunities, -&gt; { order(&quot;opportunities.id DESC&quot;).distinct }, through: :contact_opportunities</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="50">
            
            

            

            <code class="ruby">  has_many :tasks, as: :asset, dependent: :destroy # , :order =&gt; &#39;created_at DESC&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            
            

            

            <code class="ruby">  has_one :business_address, -&gt; { where(address_type: &quot;Business&quot;) }, dependent: :destroy, as: :addressable, class_name: &quot;Address&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="52">
            
            

            

            <code class="ruby">  has_many :addresses, dependent: :destroy, as: :addressable, class_name: &quot;Address&quot; # advanced search uses this</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="53">
            
            

            

            <code class="ruby">  has_many :emails, as: :mediator</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="55">
            
            

            

            <code class="ruby">  delegate :campaign, to: :lead, allow_nil: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="57">
            
            

            

            <code class="ruby">  has_ransackable_associations %w[account opportunities tags activities emails addresses comments tasks]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="58">
            
            

            

            <code class="ruby">  ransack_can_autocomplete</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="60">
            
            

            

            <code class="ruby">  serialize :subscribed_users, Array</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="62">
            
            

            

            <code class="ruby">  accepts_nested_attributes_for :business_address, allow_destroy: true, reject_if: proc { |attributes| Address.reject_address(attributes) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="64">
            
            

            

            <code class="ruby">  scope :created_by,  -&gt;(user) { where(user_id: user.id) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="65">
            
            

            

            <code class="ruby">  scope :assigned_to, -&gt;(user) { where(assigned_to: user.id) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="67">
            
            

            

            <code class="ruby">  scope :text_search, lambda { |query|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="68">
            
            

            

            <code class="ruby">    t = Contact.arel_table</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            
            

            

            <code class="ruby">    # We can&#39;t always be sure that names are entered in the right order, so we must</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            
            

            

            <code class="ruby">    # split the query into all possible first/last name permutations.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="71">
            
            

            

            <code class="ruby">    name_query = if query.include?(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="72">
            
            

            

            <code class="ruby">                   scope, *rest = query.name_permutations.map do |first, last|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="73">
            
            

            

            <code class="ruby">                     t[:first_name].matches(&quot;%#{first}%&quot;).and(t[:last_name].matches(&quot;%#{last}%&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="74">
            
            

            

            <code class="ruby">                   end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="75">
            
            

            

            <code class="ruby">                   rest.map { |r| scope = scope.or(r) } if scope</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="76">
            
            

            

            <code class="ruby">                   scope</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="77">
            
            

            

            <code class="ruby">                 else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="78">
            
            

            

            <code class="ruby">                   t[:first_name].matches(&quot;%#{query}%&quot;).or(t[:last_name].matches(&quot;%#{query}%&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="79">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="81">
            
            

            

            <code class="ruby">    other = t[:email].matches(&quot;%#{query}%&quot;).or(t[:alt_email].matches(&quot;%#{query}%&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="82">
            
            

            

            <code class="ruby">    other = other.or(t[:phone].matches(&quot;%#{query}%&quot;)).or(t[:mobile].matches(&quot;%#{query}%&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="84">
            
            

            

            <code class="ruby">    where(name_query.nil? ? other : name_query.or(other))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="85">
            
            

            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="87">
            
            

            

            <code class="ruby">  uses_user_permissions</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="88">
            
            

            

            <code class="ruby">  acts_as_commentable</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="89">
            
            

            

            <code class="ruby">  uses_comment_extensions</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="90">
            
            

            

            <code class="ruby">  acts_as_taggable_on :tags</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="91">
            
            

            

            <code class="ruby">  has_paper_trail versions: { class_name: &#39;Version&#39; }, ignore: [:subscribed_users]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="93">
            
            

            

            <code class="ruby">  has_fields</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="94">
            
            

            

            <code class="ruby">  exportable</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="95">
            
            

            

            <code class="ruby">  sortable by: [&quot;first_name ASC&quot;, &quot;last_name ASC&quot;, &quot;created_at DESC&quot;, &quot;updated_at DESC&quot;], default: &quot;created_at DESC&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="97">
            
            

            

            <code class="ruby">  validates_presence_of :first_name, message: :missing_first_name, if: -&gt; { Setting.require_first_names }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="98">
            
            

            

            <code class="ruby">  validates_presence_of :last_name,  message: :missing_last_name,  if: -&gt; { Setting.require_last_names  }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="99">
            
            

            

            <code class="ruby">  validate :users_for_shared_access</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="101">
            
            

            

            <code class="ruby">  validates_length_of :first_name, maximum: 64</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="102">
            
            

            

            <code class="ruby">  validates_length_of :last_name, maximum: 64</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="103">
            
            

            

            <code class="ruby">  validates_length_of :title, maximum: 64</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="104">
            
            

            

            <code class="ruby">  validates_length_of :department, maximum: 64</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="105">
            
            

            

            <code class="ruby">  validates_length_of :email, maximum: 254</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="106">
            
            

            

            <code class="ruby">  validates_length_of :alt_email, maximum: 254</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="107">
            
            

            

            <code class="ruby">  validates_length_of :phone, maximum: 32</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="108">
            
            

            

            <code class="ruby">  validates_length_of :mobile, maximum: 32</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="109">
            
            

            

            <code class="ruby">  validates_length_of :fax, maximum: 32</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="110">
            
            

            

            <code class="ruby">  validates_length_of :blog, maximum: 128</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="111">
            
            

            

            <code class="ruby">  validates_length_of :linkedin, maximum: 128</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="112">
            
            

            

            <code class="ruby">  validates_length_of :facebook, maximum: 128</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="113">
            
            

            

            <code class="ruby">  validates_length_of :twitter, maximum: 128</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="114">
            
            

            

            <code class="ruby">  validates_length_of :skype, maximum: 128</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            
            

            

            <code class="ruby">  # Default values provided through class methods.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="118">
            
            

            

            <code class="ruby">  def self.per_page</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="119">
            
            

            

            <code class="ruby">    20</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="120">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="122">
            
            

            

            <code class="ruby">  def self.first_name_position</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="123">
            
            

            

            <code class="ruby">    &quot;before&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="124">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="127">
            
            

            

            <code class="ruby">  def full_name(format = nil)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="128">
            
            

            

            <code class="ruby">    if format.nil? || format == &quot;before&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="129">
            
            

            

            <code class="ruby">      &quot;#{first_name} #{last_name}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="130">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="131">
            
            

            

            <code class="ruby">      &quot;#{last_name}, #{first_name}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="132">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="133">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="134">
            
            

            

            <code class="ruby">  alias name full_name</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            
            

            

            <code class="ruby">  # Backend handler for [Create New Contact] form (see contact/create).</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="138">
            
            

            

            <code class="ruby">  def save_with_account_and_permissions(params)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="139">
            
            

            

            <code class="ruby">    save_account(params)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="140">
            
            

            

            <code class="ruby">    result = save</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="141">
            
            

            

            <code class="ruby">    opportunities &lt;&lt; Opportunity.find(params[:opportunity]) unless params[:opportunity].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="142">
            
            

            

            <code class="ruby">    result</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="143">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            
            

            

            <code class="ruby">  # Backend handler for [Update Contact] form (see contact/update).</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="147">
            
            

            

            <code class="ruby">  def update_with_account_and_permissions(params)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="148">
            
            

            

            <code class="ruby">    save_account(params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            
            

            

            <code class="ruby">    # Must set access before user_ids, because user_ids= method depends on access value.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="150">
            
            

            

            <code class="ruby">    self.access = params[:contact][:access] if params[:contact][:access]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="151">
            
            

            

            <code class="ruby">    self.attributes = params[:contact]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="152">
            
            

            

            <code class="ruby">    save</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="153">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="154">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            
            

            

            <code class="ruby">  # Attach given attachment to the contact if it hasn&#39;t been attached already.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="157">
            
            

            

            <code class="ruby">  def attach!(attachment)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="158">
            
            

            

            <code class="ruby">    send(attachment.class.name.tableize) &lt;&lt; attachment unless send(&quot;#{attachment.class.name.downcase}_ids&quot;).include?(attachment.id)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="159">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="161">
            
            

            

            <code class="ruby">  # Discard given attachment from the contact.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="163">
            
            

            

            <code class="ruby">  def discard!(attachment)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="164">
            
            

            

            <code class="ruby">    if attachment.is_a?(Task)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="165">
            
            

            

            <code class="ruby">      attachment.update_attribute(:asset, nil)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="166">
            
            

            

            <code class="ruby">    else # Opportunities</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="167">
            
            

            

            <code class="ruby">      send(attachment.class.name.tableize).delete(attachment)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="168">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="169">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            
            

            

            <code class="ruby">  # Class methods.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="173">
            
            

            

            <code class="ruby">  def self.create_for(model, account, opportunity, params)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="174">
            
            

            

            <code class="ruby">    attributes = {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="175">
            
            

            

            <code class="ruby">      lead_id:     model.id,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="176">
            
            

            

            <code class="ruby">      user_id:     params[:account][:user_id] || account.user_id,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="177">
            
            

            

            <code class="ruby">      assigned_to: params[:account][:assigned_to],</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="178">
            
            

            

            <code class="ruby">      access:      params[:access]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="179">
            
            

            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="180">
            
            

            

            <code class="ruby">    %w[first_name last_name title source email alt_email phone mobile blog linkedin facebook twitter skype do_not_call background_info].each do |name|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="181">
            
            

            

            <code class="ruby">      attributes[name] = model.send(name.intern)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="182">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="183">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="184">
            
            

            

            <code class="ruby">    contact = Contact.new(attributes)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="185">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="186">
            
            

            

            <code class="ruby">    # Set custom fields.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="187">
            
            

            

            <code class="ruby">    if model.class.respond_to?(:fields)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="188">
            
            

            

            <code class="ruby">      model.class.fields.each do |field|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="189">
            
            

            

            <code class="ruby">        contact.send &quot;#{field.name}=&quot;, model.send(field.name) if contact.respond_to?(field.name)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="190">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="191">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="192">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="193">
            
            

            

            <code class="ruby">    contact.business_address = Address.new(street1: model.business_address.street1, street2: model.business_address.street2, city: model.business_address.city, state: model.business_address.state, zipcode: model.business_address.zipcode, country: model.business_address.country, full_address: model.business_address.full_address, address_type: &quot;Business&quot;) unless model.business_address.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="194">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="195">
            
            

            

            <code class="ruby">    # Save the contact only if the account and the opportunity have no errors.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="196">
            
            

            

            <code class="ruby">    if account.errors.empty? &amp;&amp; opportunity.errors.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="197">
            
            

            

            <code class="ruby">      # Note: contact.account = account doesn&#39;t seem to work here.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="198">
            
            

            

            <code class="ruby">      contact.account_contact = AccountContact.new(account: account, contact: contact) unless account.id.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="199">
            
            

            

            <code class="ruby">      if contact.access != &quot;Lead&quot; || model.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="200">
            
            

            

            <code class="ruby">        contact.save</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="201">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="202">
            
            

            

            <code class="ruby">        contact.save_with_model_permissions(model)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="203">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="204">
            
            

            

            <code class="ruby">      contact.opportunities &lt;&lt; opportunity unless opportunity.id.blank? # must happen after contact is saved</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="205">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="206">
            
            

            

            <code class="ruby">    contact</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="207">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="208">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="209">
            
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="210">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="211">
            
            

            

            <code class="ruby">  # Make sure at least one user has been selected if the contact is being shared.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="212">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="213">
            
            

            

            <code class="ruby">  def users_for_shared_access</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="214">
            
            

            

            <code class="ruby">    errors.add(:access, :share_contact) if self[:access] == &quot;Shared&quot; &amp;&amp; permissions.none?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="215">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="216">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="217">
            
            

            

            <code class="ruby">  # Handles the saving of related accounts</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="218">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="219">
            
            

            

            <code class="ruby">  def save_account(params)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="220">
            
            

            

            <code class="ruby">    account_params = params[:account]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="221">
            
            

            

            <code class="ruby">    valid_account = account_params &amp;&amp; (account_params[:id].present? || account_params[:name].present?)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="222">
            
            

            

            <code class="ruby">    self.account = if valid_account</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="223">
            
            

            

            <code class="ruby">                     Account.create_or_select_for(self, account_params)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="224">
            
            

            

            <code class="ruby">                   else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="225">
            
            

            

            <code class="ruby">                     nil</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="226">
            
            

            

            <code class="ruby">                   end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="227">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="228">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="229">
            
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_contact, self)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="230">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="9f4c373f3fdfc75e103e21c39a3369610ab5c511">
  <div class="header">
    <h3>app/models/entities/contact_opportunity.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>5</b> relevant lines.
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby"># == Schema Information</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"># Table name: contact_opportunities</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">#  id             :integer         not null, primary key</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">#  contact_id     :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">#  opportunity_id :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">#  role           :string(32)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">#  deleted_at     :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">#  created_at     :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">#  updated_at     :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="21">
            <span class="hits">1</span>
            

            

            <code class="ruby">class ContactOpportunity &lt; ActiveRecord::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="22">
            <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :contact</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="23">
            <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :opportunity</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="24">
            <span class="hits">1</span>
            

            

            <code class="ruby">  validates_presence_of :contact_id, :opportunity_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby">  # has_paper_trail :class_name =&gt; &#39;Version&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="28">
            <span class="hits">1</span>
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_contact_opportunity, self)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="b6a52687d74edeb646dc2ef58bc5f441b84ec1d3">
  <div class="header">
    <h3>app/models/entities/lead.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>102</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>102</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby"># == Schema Information</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"># Table name: leads</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">#  id              :integer         not null, primary key</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">#  user_id         :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">#  campaign_id     :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">#  assigned_to     :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">#  first_name      :string(64)      default(&quot;&quot;), not null</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">#  last_name       :string(64)      default(&quot;&quot;), not null</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">#  access          :string(8)       default(&quot;Public&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">#  title           :string(64)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">#  company         :string(64)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby">#  source          :string(32)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby">#  status          :string(32)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby">#  referred_by     :string(64)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby">#  email           :string(64)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">#  alt_email       :string(64)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby">#  phone           :string(32)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby">#  mobile          :string(32)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby">#  blog            :string(128)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby">#  linkedin        :string(128)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby">#  facebook        :string(128)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby">#  twitter         :string(128)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby">#  rating          :integer         default(0), not null</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            
            

            

            <code class="ruby">#  do_not_call     :boolean         default(FALSE), not null</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            
            

            

            <code class="ruby">#  deleted_at      :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            
            

            

            <code class="ruby">#  created_at      :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            
            

            

            <code class="ruby">#  updated_at      :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            
            

            

            <code class="ruby">#  background_info :string(255)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            
            

            

            <code class="ruby">#  skype           :string(128)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            
            

            

            <code class="ruby">class Lead &lt; ActiveRecord::Base</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="42">
            
            

            

            <code class="ruby">  belongs_to :user, optional: true # TODO: Is this really optional?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="43">
            
            

            

            <code class="ruby">  belongs_to :campaign, optional: true # TODO: Is this really optional?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="44">
            
            

            

            <code class="ruby">  belongs_to :assignee, class_name: &quot;User&quot;, foreign_key: :assigned_to, optional: true # TODO: Is this really optional?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="45">
            
            

            

            <code class="ruby">  has_one :contact, dependent: :nullify # On destroy keep the contact, but nullify its lead_id</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            
            

            

            <code class="ruby">  has_many :tasks, as: :asset, dependent: :destroy # , :order =&gt; &#39;created_at DESC&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="47">
            
            

            

            <code class="ruby">  has_one :business_address, -&gt; { where &quot;address_type=&#39;Business&#39;&quot; }, dependent: :destroy, as: :addressable, class_name: &quot;Address&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="48">
            
            

            

            <code class="ruby">  has_many :addresses, dependent: :destroy, as: :addressable, class_name: &quot;Address&quot; # advanced search uses this</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="49">
            
            

            

            <code class="ruby">  has_many :emails, as: :mediator</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            
            

            

            <code class="ruby">  serialize :subscribed_users, Array</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="53">
            
            

            

            <code class="ruby">  accepts_nested_attributes_for :business_address, allow_destroy: true, reject_if: proc { |attributes| Address.reject_address(attributes) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="55">
            
            

            

            <code class="ruby">  scope :state, lambda { |filters|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="56">
            
            

            

            <code class="ruby">    where([&#39;status IN (?)&#39; + (filters.delete(&#39;other&#39;) ? &#39; OR status IS NULL&#39; : &#39;&#39;), filters])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="57">
            
            

            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="58">
            
            

            

            <code class="ruby">  scope :converted,    -&gt;       { where(status: &#39;converted&#39;) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="59">
            
            

            

            <code class="ruby">  scope :for_campaign, -&gt;(id)   { where(campaign_id: id) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="60">
            
            

            

            <code class="ruby">  scope :created_by,   -&gt;(user) { where(user_id: user.id) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="61">
            
            

            

            <code class="ruby">  scope :assigned_to,  -&gt;(user) { where(assigned_to: user.id) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="63">
            
            

            

            <code class="ruby">  scope :text_search, -&gt;(query) { ransack(&#39;first_name_or_last_name_or_company_or_email_cont&#39; =&gt; query).result }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="65">
            
            

            

            <code class="ruby">  uses_user_permissions</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="66">
            
            

            

            <code class="ruby">  acts_as_commentable</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="67">
            
            

            

            <code class="ruby">  uses_comment_extensions</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="68">
            
            

            

            <code class="ruby">  acts_as_taggable_on :tags</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="69">
            
            

            

            <code class="ruby">  has_paper_trail versions: { class_name: &#39;Version&#39; }, ignore: [:subscribed_users]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="70">
            
            

            

            <code class="ruby">  has_fields</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="71">
            
            

            

            <code class="ruby">  exportable</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="72">
            
            

            

            <code class="ruby">  sortable by: [&quot;first_name ASC&quot;, &quot;last_name ASC&quot;, &quot;company ASC&quot;, &quot;rating DESC&quot;, &quot;created_at DESC&quot;, &quot;updated_at DESC&quot;], default: &quot;created_at DESC&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="74">
            
            

            

            <code class="ruby">  has_ransackable_associations %w[contact campaign tasks tags activities emails addresses comments]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="75">
            
            

            

            <code class="ruby">  ransack_can_autocomplete</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="77">
            
            

            

            <code class="ruby">  validates_presence_of :first_name, message: :missing_first_name, if: -&gt; { Setting.require_first_names }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="78">
            
            

            

            <code class="ruby">  validates_presence_of :last_name,  message: :missing_last_name,  if: -&gt; { Setting.require_last_names  }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="79">
            
            

            

            <code class="ruby">  validate :users_for_shared_access</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="80">
            
            

            

            <code class="ruby">  validates :status, inclusion: { in: proc { Setting.unroll(:lead_status).map { |s| s.last.to_s } } }, allow_blank: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="82">
            
            

            

            <code class="ruby">  after_create :increment_leads_count</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="83">
            
            

            

            <code class="ruby">  after_destroy :decrement_leads_count</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            
            

            

            <code class="ruby">  # Default values provided through class methods.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="87">
            
            

            

            <code class="ruby">  def self.per_page</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="88">
            
            

            

            <code class="ruby">    20</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="89">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="91">
            
            

            

            <code class="ruby">  def self.first_name_position</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="92">
            
            

            

            <code class="ruby">    &quot;before&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="93">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            
            

            

            <code class="ruby">  # Save the lead along with its permissions.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="97">
            
            

            

            <code class="ruby">  def save_with_permissions(params)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="98">
            
            

            

            <code class="ruby">    self.campaign = Campaign.find(params[:campaign]) unless params[:campaign].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="99">
            
            

            

            <code class="ruby">    if params[:lead][:access] == &quot;Campaign&quot; &amp;&amp; campaign # Copy campaign permissions.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="100">
            
            

            

            <code class="ruby">      save_with_model_permissions(Campaign.find(campaign_id))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="101">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="102">
            
            

            

            <code class="ruby">      self.attributes = params[:lead]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="103">
            
            

            

            <code class="ruby">      save</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="104">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="105">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            
            

            

            <code class="ruby">  # Update lead attributes taking care of campaign lead counters when necessary.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="109">
            
            

            

            <code class="ruby">  def update_with_lead_counters(attributes)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="110">
            
            

            

            <code class="ruby">    if campaign_id == attributes[:campaign_id] # Same campaign (if any).</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="111">
            
            

            

            <code class="ruby">      self.attributes = attributes</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="112">
            
            

            

            <code class="ruby">      save</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="113">
            
            

            

            <code class="ruby">    else                                            # Campaign has been changed -- update lead counters...</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="114">
            
            

            

            <code class="ruby">      decrement_leads_count                         # ..for the old campaign...</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="115">
            
            

            

            <code class="ruby">      self.attributes = attributes                  # Assign new campaign.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="116">
            
            

            

            <code class="ruby">      lead = save</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="117">
            
            

            

            <code class="ruby">      increment_leads_count                         # ...and now for the new campaign.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="118">
            
            

            

            <code class="ruby">      lead</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="119">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="120">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            
            

            

            <code class="ruby">  # Promote the lead by creating contact and optional opportunity. Upon</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            
            

            

            <code class="ruby">  # successful promotion Lead status gets set to :converted.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="125">
            
            

            

            <code class="ruby">  def promote(params)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="126">
            
            

            

            <code class="ruby">    account_params = params[:account] || {}</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="127">
            
            

            

            <code class="ruby">    opportunity_params = params[:opportunity] || {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="129">
            
            

            

            <code class="ruby">    account     = Account.create_or_select_for(self, account_params)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="130">
            
            

            

            <code class="ruby">    opportunity = Opportunity.create_for(self, account, opportunity_params)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="131">
            
            

            

            <code class="ruby">    contact     = Contact.create_for(self, account, opportunity, params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="133">
            
            

            

            <code class="ruby">    [account, opportunity, contact]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="134">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="137">
            
            

            

            <code class="ruby">  def convert</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="138">
            
            

            

            <code class="ruby">    update_attribute(:status, &quot;converted&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="139">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="142">
            
            

            

            <code class="ruby">  def reject</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="143">
            
            

            

            <code class="ruby">    update_attribute(:status, &quot;rejected&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="144">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            
            

            

            <code class="ruby">  # Attach a task to the lead if it hasn&#39;t been attached already.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="148">
            
            

            

            <code class="ruby">  def attach!(task)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="149">
            
            

            

            <code class="ruby">    tasks &lt;&lt; task unless task_ids.include?(task.id)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="150">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            
            

            

            <code class="ruby">  # Discard a task from the lead.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="154">
            
            

            

            <code class="ruby">  def discard!(task)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="155">
            
            

            

            <code class="ruby">    task.update_attribute(:asset, nil)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="156">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="159">
            
            

            

            <code class="ruby">  def full_name(format = nil)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="160">
            
            

            

            <code class="ruby">    if format.nil? || format == &quot;before&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="161">
            
            

            

            <code class="ruby">      &quot;#{first_name} #{last_name}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="162">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="163">
            
            

            

            <code class="ruby">      &quot;#{last_name}, #{first_name}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="164">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="165">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="166">
            
            

            

            <code class="ruby">  alias name full_name</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="167">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="168">
            
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="169">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="171">
            
            

            

            <code class="ruby">  def increment_leads_count</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="172">
            
            

            

            <code class="ruby">    Campaign.increment_counter(:leads_count, campaign_id) if campaign_id</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="173">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="174">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="175">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="176">
            
            

            

            <code class="ruby">  def decrement_leads_count</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="177">
            
            

            

            <code class="ruby">    Campaign.decrement_counter(:leads_count, campaign_id) if campaign_id</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="178">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="179">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            
            

            

            <code class="ruby">  # Make sure at least one user has been selected if the lead is being shared.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="181">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="182">
            
            

            

            <code class="ruby">  def users_for_shared_access</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="183">
            
            

            

            <code class="ruby">    errors.add(:access, :share_lead) if self[:access] == &quot;Shared&quot; &amp;&amp; permissions.none?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="184">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="185">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="186">
            
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_lead, self)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="187">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="2da15aef42629cb5b053ca67365727fbd5c011e3">
  <div class="header">
    <h3>app/models/entities/opportunity.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>113</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>113</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby"># == Schema Information</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"># Table name: opportunities</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">#  id              :integer         not null, primary key</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">#  user_id         :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">#  campaign_id     :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">#  assigned_to     :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">#  name            :string(64)      default(&quot;&quot;), not null</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">#  access          :string(8)       default(&quot;Public&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">#  source          :string(32)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">#  stage           :string(32)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">#  probability     :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby">#  amount          :decimal(12, 2)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby">#  discount        :decimal(12, 2)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby">#  closes_on       :date</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby">#  deleted_at      :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">#  created_at      :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby">#  updated_at      :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby">#  background_info :string(255)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            
            

            

            <code class="ruby">class Opportunity &lt; ActiveRecord::Base</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            
            

            

            <code class="ruby">  belongs_to :user, optional: true</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            
            

            

            <code class="ruby">  belongs_to :campaign, optional: true</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            
            

            

            <code class="ruby">  belongs_to :assignee, class_name: &quot;User&quot;, foreign_key: :assigned_to, optional: true</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            
            

            

            <code class="ruby">  has_one :account_opportunity, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            
            

            

            <code class="ruby">  has_one :account, through: :account_opportunity</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="36">
            
            

            

            <code class="ruby">  has_many :contact_opportunities, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="37">
            
            

            

            <code class="ruby">  has_many :contacts, -&gt; { order(&quot;contacts.id DESC&quot;).distinct }, through: :contact_opportunities</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="38">
            
            

            

            <code class="ruby">  has_many :tasks, as: :asset, dependent: :destroy # , :order =&gt; &#39;created_at DESC&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            
            

            

            <code class="ruby">  has_many :emails, as: :mediator</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            
            

            

            <code class="ruby">  serialize :subscribed_users, Array</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="43">
            
            

            

            <code class="ruby">  scope :state, lambda { |filters|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="44">
            
            

            

            <code class="ruby">    where(&#39;stage IN (?)&#39; + (filters.delete(&#39;other&#39;) ? &#39; OR stage IS NULL&#39; : &#39;&#39;), filters)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="45">
            
            

            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            
            

            

            <code class="ruby">  scope :created_by,  -&gt;(user) { where(&#39;user_id = ?&#39;, user.id) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="47">
            
            

            

            <code class="ruby">  scope :assigned_to, -&gt;(user) { where(&#39;assigned_to = ?&#39;, user.id) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="48">
            
            

            

            <code class="ruby">  scope :won,         -&gt; { where(&quot;opportunities.stage = &#39;won&#39;&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="49">
            
            

            

            <code class="ruby">  scope :lost,        -&gt; { where(&quot;opportunities.stage = &#39;lost&#39;&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="50">
            
            

            

            <code class="ruby">  scope :not_lost,    -&gt; { where(&quot;opportunities.stage &lt;&gt; &#39;lost&#39;&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            
            

            

            <code class="ruby">  scope :pipeline,    -&gt; { where(&quot;opportunities.stage IS NULL OR (opportunities.stage != &#39;won&#39; AND opportunities.stage != &#39;lost&#39;)&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="52">
            
            

            

            <code class="ruby">  scope :unassigned,  -&gt; { where(&quot;opportunities.assigned_to IS NULL&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="53">
            
            

            

            <code class="ruby">  scope :weighted_sort, -&gt; { select(&#39;*, amount*probability&#39;) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            
            

            

            <code class="ruby">  # Search by name OR id</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="56">
            
            

            

            <code class="ruby">  scope :text_search, lambda { |query|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="57">
            
            

            

            <code class="ruby">    if query.match?(/\A\d+\z/)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="58">
            
            

            

            <code class="ruby">      where(&#39;upper(name) LIKE upper(:name) OR opportunities.id = :id&#39;, name: &quot;%#{query}%&quot;, id: query)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="59">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="60">
            
            

            

            <code class="ruby">      ransack(&#39;name_cont&#39; =&gt; query).result</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="61">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="62">
            
            

            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="64">
            
            

            

            <code class="ruby">  scope :visible_on_dashboard, lambda { |user|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            
            

            

            <code class="ruby">    # Show opportunities which either belong to the user and are unassigned, or are assigned to the user and haven&#39;t been closed (won/lost)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="66">
            
            

            

            <code class="ruby">    where(&#39;(user_id = :user_id AND assigned_to IS NULL) OR assigned_to = :user_id&#39;, user_id: user.id).where(&quot;opportunities.stage != &#39;won&#39;&quot;).where(&quot;opportunities.stage != &#39;lost&#39;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="67">
            
            

            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="69">
            
            

            

            <code class="ruby">  scope :by_closes_on, -&gt; { order(:closes_on) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="70">
            
            

            

            <code class="ruby">  scope :by_amount,    -&gt; { order(&#39;opportunities.amount DESC&#39;) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="72">
            
            

            

            <code class="ruby">  uses_user_permissions</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="73">
            
            

            

            <code class="ruby">  acts_as_commentable</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="74">
            
            

            

            <code class="ruby">  uses_comment_extensions</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="75">
            
            

            

            <code class="ruby">  acts_as_taggable_on :tags</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="76">
            
            

            

            <code class="ruby">  has_paper_trail versions: { class_name: &#39;Version&#39; }, ignore: [:subscribed_users]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="77">
            
            

            

            <code class="ruby">  has_fields</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="78">
            
            

            

            <code class="ruby">  exportable</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="79">
            
            

            

            <code class="ruby">  sortable by: [&quot;name ASC&quot;, &quot;amount DESC&quot;, &quot;amount*probability DESC&quot;, &quot;probability DESC&quot;, &quot;closes_on ASC&quot;, &quot;created_at DESC&quot;, &quot;updated_at DESC&quot;], default: &quot;created_at DESC&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="81">
            
            

            

            <code class="ruby">  has_ransackable_associations %w[account contacts tags campaign activities emails comments]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="82">
            
            

            

            <code class="ruby">  ransack_can_autocomplete</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="84">
            
            

            

            <code class="ruby">  validates_presence_of :name, message: :missing_opportunity_name</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="85">
            
            

            

            <code class="ruby">  validates_numericality_of %i[probability amount discount], allow_nil: true</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="86">
            
            

            

            <code class="ruby">  validate :users_for_shared_access</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="87">
            
            

            

            <code class="ruby">  validates :stage, inclusion: { in: proc { Setting.unroll(:opportunity_stage).map { |s| s.last.to_s } } }, allow_blank: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="89">
            
            

            

            <code class="ruby">  after_create :increment_opportunities_count</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="90">
            
            

            

            <code class="ruby">  after_destroy :decrement_opportunities_count</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            
            

            

            <code class="ruby">  # Default values provided through class methods.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="94">
            
            

            

            <code class="ruby">  def self.per_page</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="95">
            
            

            

            <code class="ruby">    20</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="96">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="98">
            
            

            

            <code class="ruby">  def self.default_stage</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="99">
            
            

            

            <code class="ruby">    Setting[:opportunity_default_stage].try(:to_s) || &#39;prospecting&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="100">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="103">
            
            

            

            <code class="ruby">  def weighted_amount</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="104">
            
            

            

            <code class="ruby">    (amount.to_f - discount.to_f) * probability.to_i / 100.0</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="105">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            
            

            

            <code class="ruby">  # Backend handler for [Create New Opportunity] form (see opportunity/create).</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="109">
            
            

            

            <code class="ruby">  def save_with_account_and_permissions(params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            
            

            

            <code class="ruby">    # Quick sanitization, makes sure Account will not search for blank id.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="111">
            
            

            

            <code class="ruby">    params[:account].delete(:id) if params[:account][:id].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="112">
            
            

            

            <code class="ruby">    account = Account.create_or_select_for(self, params[:account])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="113">
            
            

            

            <code class="ruby">    self.account_opportunity = AccountOpportunity.new(account: account, opportunity: self) unless account.id.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="114">
            
            

            

            <code class="ruby">    self.account = account</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="115">
            
            

            

            <code class="ruby">    self.campaign = Campaign.find(params[:campaign]) unless params[:campaign].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="116">
            
            

            

            <code class="ruby">    result = save</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="117">
            
            

            

            <code class="ruby">    contacts &lt;&lt; Contact.find(params[:contact]) unless params[:contact].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="118">
            
            

            

            <code class="ruby">    result</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="119">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            
            

            

            <code class="ruby">  # Backend handler for [Update Opportunity] form (see opportunity/update).</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="123">
            
            

            

            <code class="ruby">  def update_with_account_and_permissions(params)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="124">
            
            

            

            <code class="ruby">    if params[:account] &amp;&amp; (params[:account][:id] == &quot;&quot; || params[:account][:name] == &quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="125">
            
            

            

            <code class="ruby">      self.account = nil # Opportunity is not associated with the account anymore.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="126">
            
            

            

            <code class="ruby">    elsif params[:account]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="127">
            
            

            

            <code class="ruby">      self.account = Account.create_or_select_for(self, params[:account])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="128">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            
            

            

            <code class="ruby">    # Must set access before user_ids, because user_ids= method depends on access value.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="130">
            
            

            

            <code class="ruby">    self.access = params[:opportunity][:access] if params[:opportunity][:access]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="131">
            
            

            

            <code class="ruby">    self.attributes = params[:opportunity]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="132">
            
            

            

            <code class="ruby">    save</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="133">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            
            

            

            <code class="ruby">  # Attach given attachment to the opportunity if it hasn&#39;t been attached already.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="137">
            
            

            

            <code class="ruby">  def attach!(attachment)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="138">
            
            

            

            <code class="ruby">    send(attachment.class.name.tableize) &lt;&lt; attachment unless send(&quot;#{attachment.class.name.downcase}_ids&quot;).include?(attachment.id)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="139">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            
            

            

            <code class="ruby">  # Discard given attachment from the opportunity.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="143">
            
            

            

            <code class="ruby">  def discard!(attachment)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="144">
            
            

            

            <code class="ruby">    if attachment.is_a?(Task)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="145">
            
            

            

            <code class="ruby">      attachment.update_attribute(:asset, nil)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="146">
            
            

            

            <code class="ruby">    else # Contacts</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="147">
            
            

            

            <code class="ruby">      send(attachment.class.name.tableize).delete(attachment)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="148">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="149">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            
            

            

            <code class="ruby">  # Class methods.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="153">
            
            

            

            <code class="ruby">  def self.create_for(model, account, params)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="154">
            
            

            

            <code class="ruby">    opportunity = Opportunity.new(params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            
            

            

            <code class="ruby">    # Save the opportunity if its name was specified and account has no errors.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="157">
            
            

            

            <code class="ruby">    if opportunity.name? &amp;&amp; account.errors.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            
            

            

            <code class="ruby">      # Note: opportunity.account = account doesn&#39;t seem to work here.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="159">
            
            

            

            <code class="ruby">      opportunity.account_opportunity = AccountOpportunity.new(account: account, opportunity: opportunity) unless account.id.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="160">
            
            

            

            <code class="ruby">      if opportunity.access != &quot;Lead&quot; || model.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="161">
            
            

            

            <code class="ruby">        opportunity.save</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="162">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="163">
            
            

            

            <code class="ruby">        opportunity.save_with_model_permissions(model)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="164">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="165">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="166">
            
            

            

            <code class="ruby">    opportunity</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="167">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="168">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="169">
            
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            
            

            

            <code class="ruby">  # Make sure at least one user has been selected if the contact is being shared.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="173">
            
            

            

            <code class="ruby">  def users_for_shared_access</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="174">
            
            

            

            <code class="ruby">    errors.add(:access, :share_opportunity) if self[:access] == &quot;Shared&quot; &amp;&amp; permissions.none?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="175">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="176">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="177">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="178">
            
            

            

            <code class="ruby">  def increment_opportunities_count</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="179">
            
            

            

            <code class="ruby">    Campaign.increment_counter(:opportunities_count, campaign_id) if campaign_id</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="180">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="181">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="182">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="183">
            
            

            

            <code class="ruby">  def decrement_opportunities_count</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="184">
            
            

            

            <code class="ruby">    Campaign.decrement_counter(:opportunities_count, campaign_id) if campaign_id</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="185">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="186">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="187">
            
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_opportunity, self)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="188">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="01c5a1446d33a9024d0f891503534d4f9a2ea286">
  <div class="header">
    <h3>app/models/fields/core_field.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>8</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>8</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby"># == Schema Information</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"># Table name: fields</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">#  id             :integer         not null, primary key</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">#  type           :string(255)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">#  field_group_id :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">#  position       :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">#  name           :string(64)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">#  label          :string(128)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">#  hint           :string(255)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">#  placeholder    :string(255)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">#  as             :string(32)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby">#  collection     :text</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby">#  disabled       :boolean</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby">#  required       :boolean</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby">#  minlength      :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">#  maxlength      :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby">#  created_at     :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby">#  updated_at     :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            
            

            

            <code class="ruby">class CoreField &lt; Field</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby">  # Some CoreField attributes should be read-only</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            
            

            

            <code class="ruby">  attr_readonly :name, :as, :collection</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            
            

            

            <code class="ruby">  before_destroy :error_on_destroy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            
            

            

            <code class="ruby">  def error_on_destroy</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="36">
            
            

            

            <code class="ruby">    errors.add_to_base &quot;Core fields cannot be deleted.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="37">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_core_field, self)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="b8cad087d4ed4a60bd083abcd7cb6d44bfd79a29">
  <div class="header">
    <h3>app/models/fields/custom_field.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>44</b> relevant lines.
      <span class="green"><b>44</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby"># == Schema Information</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"># Table name: fields</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">#  id             :integer         not null, primary key</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">#  type           :string(255)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">#  field_group_id :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">#  position       :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">#  name           :string(64)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">#  label          :string(128)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">#  hint           :string(255)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">#  placeholder    :string(255)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">#  as             :string(32)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby">#  collection     :text</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby">#  disabled       :boolean</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby">#  required       :boolean</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby">#  minlength      :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">#  maxlength      :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby">#  created_at     :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby">#  updated_at     :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby"># Implementation Notes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby"># Adding database columns dynamically is not usually recommended,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            
            

            

            <code class="ruby"># and can be potentially unsafe. However, the only alternative would be static migrations,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            
            

            

            <code class="ruby"># and we want to let users add custom fields without having to restart their server.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            
            

            

            <code class="ruby"># We could not use the EAV model for performance reasons, since we need to retain the</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            
            

            

            <code class="ruby"># ability to filter and search across thousands of records with potentially hundreds</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            
            

            

            <code class="ruby"># of custom fields.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            
            

            

            <code class="ruby"># We have solved all of the major issues:</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            
            

            

            <code class="ruby"># * Custom fields for view templates are dynamically generated based on normalized</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            
            

            

            <code class="ruby">#   database records in the &#39;fields&#39; table, instead of ActiveRecord&#39;s cached attributes.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            
            

            

            <code class="ruby"># * Concurrency issues are resolved by using &#39;method_missing&#39; to refresh a model&#39;s column information</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            
            

            

            <code class="ruby">#   when fields are added by a separate server process.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            
            

            

            <code class="ruby"># * The custom field can be renamed or deleted, but database columns are never renamed or destroyed.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            
            

            

            <code class="ruby">#   A rake task can be run to purge any orphaned columns.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            
            

            

            <code class="ruby"># * Custom field types can only be changed if the database can support the transition.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            
            

            

            <code class="ruby">#   For example, you can change an &#39;email&#39; field to a &#39;string&#39;, but not to a &#39;datetime&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            
            

            

            <code class="ruby">#   since changing the type of the database column would cause data to be lost.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="52">
            <span class="hits">1</span>
            

            

            <code class="ruby">class CustomField &lt; Field</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="53">
            <span class="hits">1</span>
            

            

            <code class="ruby">  delegate :table_name, to: :klass</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="55">
            <span class="hits">1</span>
            

            

            <code class="ruby">  after_validation :update_column, on: :update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="56">
            <span class="hits">1</span>
            

            

            <code class="ruby">  before_create :add_column</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="57">
            <span class="hits">1</span>
            

            

            <code class="ruby">  after_create :add_ransack_translation</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            
            

            

            <code class="ruby">  SAFE_DB_TRANSITIONS = {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="60">
            <span class="hits">1</span>
            

            

            <code class="ruby">    any: [%w[date time timestamp], %w[integer float]],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            
            

            

            <code class="ruby">    one: { &#39;string&#39; =&gt; &#39;text&#39; }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            
            

            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="64">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def available_as</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="65">
            <span class="hits">2</span>
            

            

            <code class="ruby">    Field.field_types.reject do |new_type, _params|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="66">
            <span class="hits">32</span>
            

            

            <code class="ruby">      db_transition_safety(as, new_type) == :unsafe</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            
            

            

            <code class="ruby">  # Extra validation that is called on this field when validation happens</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            
            

            

            <code class="ruby">  # obj is reference to parent object</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            
            

            

            <code class="ruby">  #------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="73">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def custom_validator(obj)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="74">
            <span class="hits">8</span>
            

            

            <code class="ruby">    attr = name.to_sym</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="75">
            <span class="hits">8</span>
            

            

            <code class="ruby">    obj.errors.add(attr, ::I18n.t(&#39;activerecord.errors.models.custom_field.required&#39;, field: label)) if required? &amp;&amp; obj.send(attr).blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="76">
            <span class="hits">8</span>
            

            

            <code class="ruby">    obj.errors.add(attr, ::I18n.t(&#39;activerecord.errors.models.custom_field.minlength&#39;, field: label)) if (minlength.to_i &gt; 0) &amp;&amp; (obj.send(attr).to_s.length &lt; minlength.to_i)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="77">
            <span class="hits">8</span>
            

            

            <code class="ruby">    obj.errors.add(attr, ::I18n.t(&#39;activerecord.errors.models.custom_field.maxlength&#39;, field: label)) if (maxlength.to_i &gt; 0) &amp;&amp; (obj.send(attr).to_s.length &gt; maxlength.to_i)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="80">
            <span class="hits">1</span>
            

            

            <code class="ruby">  protected</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            
            

            

            <code class="ruby">  # When changing a custom field&#39;s type, it may be necessary to</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            
            

            

            <code class="ruby">  # change the column type in the database. This method returns</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            
            

            

            <code class="ruby">  # the safety of a given transition.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            
            

            

            <code class="ruby">  # Returns:</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            
            

            

            <code class="ruby">  #   :null   =&gt; no transition needed</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            
            

            

            <code class="ruby">  #   :safe   =&gt; transition is safe</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            
            

            

            <code class="ruby">  #   :unsafe =&gt; transition is unsafe</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            
            

            

            <code class="ruby">  #------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="90">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def db_transition_safety(old_type, new_type = as)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="114" data-linenumber="91">
            <span class="hits">114</span>
            

            

            <code class="ruby">    old_col, new_col = [old_type, new_type].map { |t| column_type(t).to_s }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="38" data-linenumber="92">
            <span class="hits">38</span>
            

            

            <code class="ruby">    return :null if old_col == new_col # no transition needed</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="93">
            <span class="hits">30</span>
            

            

            <code class="ruby">    return :safe if SAFE_DB_TRANSITIONS[:one].any? do |start, final|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="94">
            <span class="hits">30</span>
            

            

            <code class="ruby">      old_col == start.to_s &amp;&amp; new_col == final.to_s # one-to-one</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="96">
            <span class="hits">26</span>
            

            

            <code class="ruby">    return :safe if SAFE_DB_TRANSITIONS[:any].any? do |col_set|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="119" data-linenumber="97">
            <span class="hits">119</span>
            

            

            <code class="ruby">      [old_col, new_col].all? { |c| col_set.include?(c.to_s) } # any-to-any</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="100">
            <span class="hits">24</span>
            

            

            <code class="ruby">    :unsafe # Else, unsafe.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            
            

            

            <code class="ruby">  # Generate column name for custom field.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            
            

            

            <code class="ruby">  # If column name is already taken, a numeric suffix is appended.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            
            

            

            <code class="ruby">  # Example column sequence: cf_custom, cf_custom_2, cf_custom_3, ...</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            
            

            

            <code class="ruby">  #------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="107">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def generate_column_name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="108">
            <span class="hits">5</span>
            

            

            <code class="ruby">    suffix = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="109">
            <span class="hits">5</span>
            

            

            <code class="ruby">    field_name = &#39;cf_&#39; + label.downcase.gsub(/[^a-z0-9]+/, &#39;_&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="110">
            <span class="hits">16</span>
            

            

            <code class="ruby">    while (final_name = [field_name, suffix].compact.join(&#39;_&#39;)) &amp;&amp;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            
            

            

            <code class="ruby">          klass.column_names.include?(final_name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="112">
            <span class="hits">6</span>
            

            

            <code class="ruby">      suffix = (suffix || 1) + 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="114">
            <span class="hits">5</span>
            

            

            <code class="ruby">    final_name</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            
            

            

            <code class="ruby">  # Returns options for ActiveRecord operations</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            
            

            

            <code class="ruby">  #------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="119">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def column_options</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="120">
            <span class="hits">4</span>
            

            

            <code class="ruby">    Field.field_types[as][:column_options] || {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            
            

            

            <code class="ruby">  # Create a new column to hold the custom field data</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            
            

            

            <code class="ruby">  #------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="125">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def add_column</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="126">
            <span class="hits">3</span>
            

            

            <code class="ruby">    self.name = generate_column_name if name.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="127">
            <span class="hits">3</span>
            

            

            <code class="ruby">    klass.connection.add_column(table_name, name, column_type, **column_options)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="128">
            <span class="hits">3</span>
            

            

            <code class="ruby">    klass.reset_column_information</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="129">
            <span class="hits">3</span>
            

            

            <code class="ruby">    klass.serialize_custom_fields!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            
            

            

            <code class="ruby">  # Adds custom field translation for Ransack</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="133">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def add_ransack_translation</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="134">
            <span class="hits">3</span>
            

            

            <code class="ruby">    I18n.backend.store_translations(Setting.locale.to_sym,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            
            

            

            <code class="ruby">                                    ransack: { attributes: { klass.model_name.singular =&gt; { name =&gt; label } } })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            
            

            

            <code class="ruby">    # Reset Ransack cache</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            
            

            

            <code class="ruby">    # Ransack::Helpers::FormBuilder.cached_searchable_attributes_for_base = {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            
            

            

            <code class="ruby">  # Change database column type only if safe to do so</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            
            

            

            <code class="ruby">  # Note: columns will never be renamed or destroyed</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            
            

            

            <code class="ruby">  #------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="143">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def update_column</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="144">
            <span class="hits">1</span>
            

            

            <code class="ruby">    if errors.empty? &amp;&amp; db_transition_safety(as_was) == :safe</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="145">
            <span class="hits">1</span>
            

            

            <code class="ruby">      klass.connection.change_column(table_name, name, column_type, **column_options)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="146">
            <span class="hits">1</span>
            

            

            <code class="ruby">      klass.reset_column_information</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="147">
            <span class="hits">1</span>
            

            

            <code class="ruby">      klass.serialize_custom_fields!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="151">
            <span class="hits">1</span>
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_custom_field, self)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="0c05b241b5cc91c427b8c170d37dcdbdd84b049a">
  <div class="header">
    <h3>app/models/fields/custom_field_date_pair.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>23</b> relevant lines.
      <span class="green"><b>23</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            <span class="hits">1</span>
            

            

            <code class="ruby">class CustomFieldDatePair &lt; CustomFieldPair</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">  # For rendering paired values</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby">  # Handle case where both pairs are blank</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">  #------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def render_value(object)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="13">
            <span class="hits">4</span>
            

            

            <code class="ruby">    return &quot;&quot; unless paired_with.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="15">
            <span class="hits">4</span>
            

            

            <code class="ruby">    from = render(object.send(name))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="16">
            <span class="hits">4</span>
            

            

            <code class="ruby">    to = render(object.send(paired_with.name))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="17">
            <span class="hits">4</span>
            

            

            <code class="ruby">    if from.present? &amp;&amp; to.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="18">
            <span class="hits">1</span>
            

            

            <code class="ruby">      I18n.t(&#39;pair.from_to&#39;, from: from, to: to)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="19">
            <span class="hits">3</span>
            

            

            <code class="ruby">    elsif from.present? &amp;&amp; !to.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="20">
            <span class="hits">1</span>
            

            

            <code class="ruby">      I18n.t(&#39;pair.from_only&#39;, from: from)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="21">
            <span class="hits">2</span>
            

            

            <code class="ruby">    elsif !from.present? &amp;&amp; to.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="22">
            <span class="hits">1</span>
            

            

            <code class="ruby">      I18n.t(&#39;pair.to_only&#39;, to: to)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="24">
            <span class="hits">1</span>
            

            

            <code class="ruby">      &quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="28">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def render(value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="29">
            <span class="hits">8</span>
            

            

            <code class="ruby">    value&amp;.strftime(I18n.t(&quot;date.formats.mmddyy&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="32">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def custom_validator(obj)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="33">
            <span class="hits">6</span>
            

            

            <code class="ruby">    super</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            
            

            

            <code class="ruby">    # validate when we get to 2nd of the pair</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="35">
            <span class="hits">6</span>
            

            

            <code class="ruby">    if pair_id.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="36">
            <span class="hits">4</span>
            

            

            <code class="ruby">      start = CustomFieldPair.find(pair_id)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="37">
            <span class="hits">4</span>
            

            

            <code class="ruby">      return if start.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="39">
            <span class="hits">4</span>
            

            

            <code class="ruby">      from = obj.send(start.name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="40">
            <span class="hits">4</span>
            

            

            <code class="ruby">      to = obj.send(name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="41">
            <span class="hits">4</span>
            

            

            <code class="ruby">      obj.errors.add(name.to_sym, ::I18n.t(&#39;activerecord.errors.models.custom_field.endbeforestart&#39;, field: start.label)) if from.present? &amp;&amp; to.present? &amp;&amp; (from &gt; to)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="45">
            <span class="hits">1</span>
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_date_pair, self)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="880162bc5a47ca4d6124bbc1f4c979a5ec650fe1">
  <div class="header">
    <h3>app/models/fields/custom_field_datetime_pair.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>6</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>6</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">class CustomFieldDatetimePair &lt; CustomFieldDatePair</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  def render(value)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">    value&amp;.strftime(I18n.t(&quot;time.formats.mmddhhss&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_datetime_pair, self)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="29c5bf28325b97421ff54f53f9b755ceabdcb640">
  <div class="header">
    <h3>app/models/fields/custom_field_pair.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>23</b> relevant lines.
      <span class="green"><b>23</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            <span class="hits">1</span>
            

            

            <code class="ruby">class CustomFieldPair &lt; CustomField</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            <span class="hits">1</span>
            

            

            <code class="ruby">  has_one :pair, class_name: &#39;CustomFieldPair&#39;, foreign_key: &#39;pair_id&#39;, dependent: :destroy # points to &#39;end&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">  # Helper to create a pair. Used in fields_controller</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">  #------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def self.create_pair(params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="14">
            <span class="hits">1</span>
            

            

            <code class="ruby">    fields = params[&#39;field&#39;]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="15">
            <span class="hits">1</span>
            

            

            <code class="ruby">    as = params[&#39;field&#39;][&#39;as&#39;]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            <span class="hits">1</span>
            

            

            <code class="ruby">    pair = params.delete(&#39;pair&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="17">
            <span class="hits">4</span>
            

            

            <code class="ruby">    base_params = fields.delete_if { |k, _v| !%w[field_group_id label as].include?(k) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="18">
            <span class="hits">1</span>
            

            

            <code class="ruby">    klass = (&quot;custom_field_&quot; + as.gsub(&#39;pair&#39;, &#39;_pair&#39;)).classify.constantize</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="19">
            <span class="hits">1</span>
            

            

            <code class="ruby">    field1 = klass.create(base_params.merge(pair[&#39;0&#39;]))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="20">
            <span class="hits">1</span>
            

            

            <code class="ruby">    field2 = klass.create(base_params.merge(pair[&#39;1&#39;]).merge(&#39;pair_id&#39; =&gt; field1.id, &#39;required&#39; =&gt; field1.required, &#39;disabled&#39; =&gt; field1.disabled))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="21">
            <span class="hits">1</span>
            

            

            <code class="ruby">    [field1, field2]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby">  # Helper to update a pair. Used in fields_controller</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">  #------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="26">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def self.update_pair(params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="27">
            <span class="hits">1</span>
            

            

            <code class="ruby">    fields = params[&#39;field&#39;]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="28">
            <span class="hits">1</span>
            

            

            <code class="ruby">    pair = params.delete(&#39;pair&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="29">
            <span class="hits">4</span>
            

            

            <code class="ruby">    base_params = fields.delete_if { |k, _v| !%w[field_group_id label as].include?(k) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="30">
            <span class="hits">1</span>
            

            

            <code class="ruby">    field1 = CustomFieldPair.find(params[&#39;id&#39;])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="31">
            <span class="hits">1</span>
            

            

            <code class="ruby">    field1.update(base_params.merge(pair[&#39;0&#39;]))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="32">
            <span class="hits">1</span>
            

            

            <code class="ruby">    field2 = field1.paired_with</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="33">
            <span class="hits">1</span>
            

            

            <code class="ruby">    field2.update(base_params.merge(pair[&#39;1&#39;]).merge(&#39;required&#39; =&gt; field1.required, &#39;disabled&#39; =&gt; field1.disabled))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            <span class="hits">1</span>
            

            

            <code class="ruby">    [field1, field2]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            
            

            

            <code class="ruby">  # Returns the field that this field is paired with</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            
            

            

            <code class="ruby">  #------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="39">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def paired_with</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="40">
            <span class="hits">2</span>
            

            

            <code class="ruby">    pair || CustomFieldPair.where(pair_id: id).first</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="43">
            <span class="hits">1</span>
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_custom_field_pair, self)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="b3aa2c72a1f16ffff3a5cfb7e22132910c4a1631">
  <div class="header">
    <h3>app/models/fields/field.rb</h3>
    <h4>
      <span class="yellow">
  88.89%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>45</b> relevant lines.
      <span class="green"><b>40</b> lines covered</span> and
      <span class="red"><b>5</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby"># == Schema Information</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"># Table name: fields</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">#  id             :integer         not null, primary key</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">#  type           :string(255)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">#  field_group_id :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">#  position       :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">#  pair_id        :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">#  name           :string(64)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">#  label          :string(128)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">#  hint           :string(255)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">#  placeholder    :string(255)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby">#  as             :string(32)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby">#  collection     :text</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby">#  disabled       :boolean</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby">#  required       :boolean</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">#  maxlength      :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby">#  minlength      :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby">#  created_at     :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby">#  updated_at     :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="31">
            <span class="hits">1</span>
            

            

            <code class="ruby">class Field &lt; ActiveRecord::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="32">
            <span class="hits">1</span>
            

            

            <code class="ruby">  acts_as_list</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            <span class="hits">1</span>
            

            

            <code class="ruby">  serialize :collection, Array</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="35">
            <span class="hits">1</span>
            

            

            <code class="ruby">  serialize :settings, HashWithIndifferentAccess</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="37">
            <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :field_group, optional: true # TODO: Is this really optional?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="39">
            <span class="hits">1</span>
            

            

            <code class="ruby">  scope :core_fields,   -&gt; { where(type: &#39;CoreField&#39;) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="40">
            <span class="hits">1</span>
            

            

            <code class="ruby">  scope :custom_fields, -&gt; { where(&quot;type != &#39;CoreField&#39;&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="41">
            <span class="hits">2</span>
            

            

            <code class="ruby">  scope :without_pairs, -&gt; { where(pair_id: nil) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="43">
            <span class="hits">1</span>
            

            

            <code class="ruby">  delegate :klass, :klass_name, :klass_name=, to: :field_group</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            
            

            

            <code class="ruby">  BASE_FIELD_TYPES = {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="46">
            <span class="hits">1</span>
            

            

            <code class="ruby">    &#39;string&#39;      =&gt; { klass: &#39;CustomField&#39;, type: &#39;string&#39; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            
            

            

            <code class="ruby">    &#39;text&#39;        =&gt; { klass: &#39;CustomField&#39;, type: &#39;text&#39; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            
            

            

            <code class="ruby">    &#39;email&#39;       =&gt; { klass: &#39;CustomField&#39;, type: &#39;string&#39; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            
            

            

            <code class="ruby">    &#39;url&#39;         =&gt; { klass: &#39;CustomField&#39;, type: &#39;string&#39; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            
            

            

            <code class="ruby">    &#39;tel&#39;         =&gt; { klass: &#39;CustomField&#39;, type: &#39;string&#39; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            
            

            

            <code class="ruby">    &#39;select&#39;      =&gt; { klass: &#39;CustomField&#39;, type: &#39;string&#39; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            
            

            

            <code class="ruby">    &#39;radio_buttons&#39; =&gt; { klass: &#39;CustomField&#39;, type: &#39;string&#39; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            
            

            

            <code class="ruby">    &#39;check_boxes&#39; =&gt; { klass: &#39;CustomField&#39;, type: &#39;text&#39; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            
            

            

            <code class="ruby">    &#39;boolean&#39;     =&gt; { klass: &#39;CustomField&#39;, type: &#39;boolean&#39; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            
            

            

            <code class="ruby">    &#39;date&#39;        =&gt; { klass: &#39;CustomField&#39;, type: &#39;date&#39; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            
            

            

            <code class="ruby">    &#39;datetime&#39;    =&gt; { klass: &#39;CustomField&#39;, type: &#39;timestamp&#39; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            
            

            

            <code class="ruby">    &#39;decimal&#39;     =&gt; { klass: &#39;CustomField&#39;, type: &#39;decimal&#39;, column_options: { precision: 15, scale: 2 } },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            
            

            

            <code class="ruby">    &#39;integer&#39;     =&gt; { klass: &#39;CustomField&#39;, type: &#39;integer&#39; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            
            

            

            <code class="ruby">    &#39;float&#39;       =&gt; { klass: &#39;CustomField&#39;, type: &#39;float&#39; }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            
            

            

            <code class="ruby">  }.with_indifferent_access</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="62">
            <span class="hits">1</span>
            

            

            <code class="ruby">  validates_presence_of :label, message: &quot;^Please enter a field label.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="63">
            <span class="hits">1</span>
            

            

            <code class="ruby">  validates_length_of :label, maximum: 64, message: &quot;^The field name must be less than 64 characters in length.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="64">
            <span class="hits">1</span>
            

            

            <code class="ruby">  validates_numericality_of :minlength, only_integer: true, greater_than_or_equal_to: 0, allow_blank: true, message: &quot;^Min size can only be whole number.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="65">
            <span class="hits">1</span>
            

            

            <code class="ruby">  validates_numericality_of :minlength, less_than_or_equal_to: :maxlength, allow_blank: true, if: :maxlength, message: &quot;^Min size cannot be greater than max size.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="66">
            <span class="hits">1</span>
            

            

            <code class="ruby">  validates_numericality_of :maxlength, only_integer: true, greater_than: 0, allow_blank: true, message: &quot;^Max size can only be whole number.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="67">
            <span class="hits">1</span>
            

            

            <code class="ruby">  validates_presence_of :as, message: &quot;^Please specify a field type.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="68">
            <span class="hits">6</span>
            

            

            <code class="ruby">  validates_inclusion_of :as, in: proc { field_types.keys }, message: &quot;^Invalid field type.&quot;, allow_blank: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="70">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def column_type(field_type = as)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="80" data-linenumber="71">
            <span class="hits">80</span>
            

            

            <code class="ruby">    (opts = Field.field_types[field_type]) ? opts[:type] : raise(&quot;Unknown field_type: #{field_type}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="74">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def input_options</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="75">
            <span class="hits">1</span>
            

            

            <code class="ruby">    input_html = {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="76">
            <span class="hits">1</span>
            

            

            <code class="ruby">    attributes.reject do |k, v|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="77">
            <span class="hits">23</span>
            

            

            <code class="ruby">      !%w[as collection disabled label placeholder required minlength maxlength].include?(k) || v.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            
            

            

            <code class="ruby">    end.symbolize_keys.merge(input_html)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="81">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def collection_string=(value)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="82">
            
            

            

            <code class="ruby">    self.collection = value.split(&quot;|&quot;).map(&amp;:strip).reject(&amp;:blank?)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="85">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def collection_string</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="86">
            
            

            

            <code class="ruby">    collection.try(:join, &quot;|&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="89">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def render_value(object)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="90">
            <span class="hits">4</span>
            

            

            <code class="ruby">    render object.send(name)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="93">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def render(value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="94">
            <span class="hits">4</span>
            

            

            <code class="ruby">    case as</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            
            

            

            <code class="ruby">    when &#39;checkbox&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="96">
            <span class="hits">2</span>
            

            

            <code class="ruby">      value.to_s == &#39;0&#39; ? &quot;no&quot; : &quot;yes&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            
            

            

            <code class="ruby">    when &#39;date&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="98">
            <span class="hits">1</span>
            

            

            <code class="ruby">      value&amp;.strftime(I18n.t(&quot;date.formats.mmddyy&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            
            

            

            <code class="ruby">    when &#39;datetime&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="100">
            
            

            

            <code class="ruby">      value&amp;.in_time_zone&amp;.strftime(I18n.t(&quot;time.formats.mmddyyyy_hhmm&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            
            

            

            <code class="ruby">    when &#39;check_boxes&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="102">
            <span class="hits">3</span>
            

            

            <code class="ruby">      value.select(&amp;:present?).in_groups_of(2, false).map { |g| g.join(&#39;, &#39;) }.join(&quot;&lt;br /&gt;&quot;.html_safe) if Array === value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="104">
            
            

            

            <code class="ruby">      value.to_s</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="108">
            <span class="hits">1</span>
            

            

            <code class="ruby">  class &lt;&lt; self</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            
            

            

            <code class="ruby">    # Provides access to registered field_types</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            
            

            

            <code class="ruby">    #------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="111">
            <span class="hits">1</span>
            

            

            <code class="ruby">    def field_types</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="93" data-linenumber="112">
            <span class="hits">93</span>
            

            

            <code class="ruby">      @@field_types ||= BASE_FIELD_TYPES</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            
            

            

            <code class="ruby">    # Register custom fields so they are available to the rest of the app</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            
            

            

            <code class="ruby">    # Example options: :as =&gt; &#39;datepair&#39;, :type =&gt; &#39;date&#39;, :klass =&gt; &#39;CustomFieldDatePair&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            
            

            

            <code class="ruby">    #------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="118">
            <span class="hits">1</span>
            

            

            <code class="ruby">    def register(options)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="119">
            <span class="hits">2</span>
            

            

            <code class="ruby">      as = options.delete(:as)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="120">
            <span class="hits">2</span>
            

            

            <code class="ruby">      (@@field_types ||= BASE_FIELD_TYPES).merge!(as =&gt; options)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            
            

            

            <code class="ruby">    # Returns class name given a key</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            
            

            

            <code class="ruby">    #------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="125">
            <span class="hits">1</span>
            

            

            <code class="ruby">    def lookup_class(as)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="126">
            
            

            

            <code class="ruby">      (@@field_types ||= BASE_FIELD_TYPES)[as][:klass]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="130">
            <span class="hits">1</span>
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_field, self)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="e42cfbff64c4ceab0c1dd299a2d0414be225af88">
  <div class="header">
    <h3>app/models/fields/field_group.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>31</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>31</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby"># == Schema Information</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"># Table name: field_groups</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">#  id         :integer         not null, primary key</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">#  name       :string(64)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">#  label      :string(128)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">#  position   :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">#  hint       :string(255)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">#  created_at :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">#  updated_at :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">#  tag_id     :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">#  klass_name :string(32)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">class FieldGroup &lt; ActiveRecord::Base</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            
            

            

            <code class="ruby">  has_many :fields, -&gt; { order :position }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            
            

            

            <code class="ruby">  belongs_to :tag, optional: true</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            
            

            

            <code class="ruby">  before_destroy :not_default_field_group, :move_fields_to_default_field_group</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">  validates_presence_of :label</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            
            

            

            <code class="ruby">  before_save do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            
            

            

            <code class="ruby">    self.name = label.downcase.gsub(/[^a-z0-9]+/, &#39;_&#39;) if name.blank? &amp;&amp; label.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            
            

            

            <code class="ruby">  def key</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            
            

            

            <code class="ruby">    &quot;field_group_#{id}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="36">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="38">
            
            

            

            <code class="ruby">  def klass</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            
            

            

            <code class="ruby">    klass_name.constantize</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="42">
            
            

            

            <code class="ruby">  def self.with_tags(tag_ids)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="43">
            
            

            

            <code class="ruby">    where &#39;tag_id IS NULL OR tag_id IN (?)&#39;, tag_ids</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="44">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            
            

            

            <code class="ruby">  def label_i18n</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="47">
            
            

            

            <code class="ruby">    I18n.t(name, default: label)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="48">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="50">
            
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            
            

            

            <code class="ruby">  # Can&#39;t delete default field group</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="53">
            
            

            

            <code class="ruby">  def not_default_field_group</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="54">
            
            

            

            <code class="ruby">    name != &quot;custom_fields&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="55">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            
            

            

            <code class="ruby">  # When deleted, transfer fields to default field group</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="58">
            
            

            

            <code class="ruby">  def move_fields_to_default_field_group</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="59">
            
            

            

            <code class="ruby">    default_group = FieldGroup.find_by_name_and_klass_name(&quot;custom_fields&quot;, klass_name)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="60">
            
            

            

            <code class="ruby">    default_group.fields &lt;&lt; fields if default_group.fields</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="61">
            
            

            

            <code class="ruby">    reload</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="62">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="64">
            
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_field_group, self)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="65">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="de1259f86b5cefecb2afb355069e195792b1a8ab">
  <div class="header">
    <h3>app/models/list.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>7</b> relevant lines.
      <span class="green"><b>7</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            <span class="hits">1</span>
            

            

            <code class="ruby">class List &lt; ActiveRecord::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            <span class="hits">1</span>
            

            

            <code class="ruby">  validates_presence_of :name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            <span class="hits">1</span>
            

            

            <code class="ruby">  validates_presence_of :url</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="11">
            <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">  # Parses the controller from the url</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="14">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def controller</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="15">
            <span class="hits">3</span>
            

            

            <code class="ruby">    (url || &quot;&quot;).sub(%r{\A/}, &#39;&#39;).split(%r{/|\?}).first</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="18">
            <span class="hits">1</span>
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_list, self)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="6b3d88bd003a9e1f9ff0be83194c0b420452f408">
  <div class="header">
    <h3>app/models/observers/entity_observer.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>25</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>25</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">class EntityObserver &lt; ActiveRecord::Observer</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  observe :account, :contact, :lead, :opportunity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">  def after_create(item)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">    send_notification_to_assignee(item) if current_user != item.assignee</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">  def after_update(item)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">    send_notification_to_assignee(item) if item.saved_change_to_assigned_to? &amp;&amp; item.assignee != current_user</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">  def send_notification_to_assignee(item)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">    UserMailer.assigned_entity_notification(item, current_user).deliver_later if item.assignee.present? &amp;&amp; current_user.present? &amp;&amp; can_send_email?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">  # Need to have a host set before email can be sent</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            
            

            

            <code class="ruby">  def can_send_email?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            
            

            

            <code class="ruby">    Setting.host.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            
            

            

            <code class="ruby">  def current_user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby">    # this deals with whodunnit inconsistencies, where in some cases it&#39;s set to a user&#39;s id and others the user object itself</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            
            

            

            <code class="ruby">    user_id_or_user = PaperTrail.request.whodunnit</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            
            

            

            <code class="ruby">    if user_id_or_user.is_a?(User)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            
            

            

            <code class="ruby">      user_id_or_user</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            
            

            

            <code class="ruby">    elsif user_id_or_user.is_a?(String)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="36">
            
            

            

            <code class="ruby">      User.find_by_id(user_id_or_user.to_i)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="37">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="38">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_entity_observer, self)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="2d94f1aa15d78b448daf8ea9b6e4c3b607fa1598">
  <div class="header">
    <h3>app/models/observers/lead_observer.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>16</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>16</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">class LeadObserver &lt; ActiveRecord::Observer</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  observe :lead</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">  @@leads = {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">  def before_update(item)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">    @@leads[item.id] = Lead.find(item.id).freeze</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">  def after_update(item)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">    original = @@leads.delete(item.id)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">    return log_activity(item, :reject) if original&amp;.status != &quot;rejected&quot; &amp;&amp; item.status == &quot;rejected&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            
            

            

            <code class="ruby">  def log_activity(item, event)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            
            

            

            <code class="ruby">    item.send(item.class.versions_association_name).create(event: event, whodunnit: PaperTrail.request.whodunnit)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_lead_observer, self)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="4a534cd95e4b769eff0af54d168079156582dc43">
  <div class="header">
    <h3>app/models/observers/opportunity_observer.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>32</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>32</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">class OpportunityObserver &lt; ActiveRecord::Observer</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  observe :opportunity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">  @@opportunities = {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">  def after_create(item)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">    update_campaign_revenue(item.campaign, item.amount.to_f - item.discount.to_f) if item.campaign &amp;&amp; item.stage == &quot;won&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">  def before_update(item)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">    @@opportunities[item.id] = Opportunity.find(item.id).freeze</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">  def after_update(item)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">    original = @@opportunities.delete(item.id)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">    if original</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            
            

            

            <code class="ruby">      if original.stage != &quot;won&quot; &amp;&amp; item.stage == &quot;won&quot; # :other to :won -- add to total campaign revenue.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            
            

            

            <code class="ruby">        update_campaign_revenue(item.campaign, item.amount.to_f - item.discount.to_f)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            
            

            

            <code class="ruby">        item.update_attribute(:probability, 100) # Set probability to 100% if won</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            
            

            

            <code class="ruby">        log_activity(item, :won)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">      elsif original.stage == &quot;won&quot; &amp;&amp; item.stage != &quot;won&quot; # :won to :other -- substract from total campaign revenue.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            
            

            

            <code class="ruby">        update_campaign_revenue(original.campaign, -(original.amount.to_f - original.discount.to_f))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            
            

            

            <code class="ruby">      elsif original.stage != &quot;lost&quot; &amp;&amp; item.stage == &quot;lost&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            
            

            

            <code class="ruby">        item.update_attribute(:probability, 0) # Set probability to 0% if lost</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="36">
            
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="38">
            
            

            

            <code class="ruby">  def log_activity(item, event)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            
            

            

            <code class="ruby">    item.send(item.class.versions_association_name).create(event: event, whodunnit: PaperTrail.request.whodunnit)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="42">
            
            

            

            <code class="ruby">  def update_campaign_revenue(campaign, revenue)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="43">
            
            

            

            <code class="ruby">    campaign&amp;.update_attribute(:revenue, campaign.revenue.to_f + revenue)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="44">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_opportunity_observer, self)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="47">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="dc5f35793edcdb2f0ac91300e9fde796afabf470">
  <div class="header">
    <h3>app/models/observers/task_observer.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>20</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>20</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">class TaskObserver &lt; ActiveRecord::Observer</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  observe :task</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">  @@tasks = {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">  def before_update(item)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">    @@tasks[item.id] = Task.find(item.id).freeze</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">  def after_update(item)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">    original = @@tasks.delete(item.id)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">    if original</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">      return log_activity(item, :complete)   if item.completed_at &amp;&amp; original.completed_at.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">      return log_activity(item, :reassign)   if item.assigned_to != original.assigned_to</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">      return log_activity(item, :reschedule) if item.bucket != original.bucket</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">  def log_activity(item, event)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            
            

            

            <code class="ruby">    item.send(item.class.versions_association_name).create(event: event, whodunnit: PaperTrail.request.whodunnit)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_task_observer, self)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="f61a48b999baeb768b2e011765586d403e67141c">
  <div class="header">
    <h3>app/models/polymorphic/address.rb</h3>
    <h4>
      <span class="green">
  93.75%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>16</b> relevant lines.
      <span class="green"><b>15</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby"># == Schema Information</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"># Table name: addresses</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">#  id               :integer         not null, primary key</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">#  street1          :string(255)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">#  street2          :string(255)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">#  city             :string(64)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">#  state            :string(64)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">#  zipcode          :string(16)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">#  country          :string(64)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">#  full_address     :string(255)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">#  address_type     :string(16)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby">#  addressable_id   :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby">#  addressable_type :string(255)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby">#  created_at       :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby">#  updated_at       :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">#  deleted_at       :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="28">
            <span class="hits">1</span>
            

            

            <code class="ruby">class Address &lt; ActiveRecord::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="29">
            <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :addressable, polymorphic: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="31">
            <span class="hits">1</span>
            

            

            <code class="ruby">  has_paper_trail versions: { class_name: &#39;Version&#39; }, meta: { related: :addressable }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="33">
            <span class="hits">1</span>
            

            

            <code class="ruby">  scope :business, -&gt; { where(&quot;address_type=&#39;Business&#39;&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            <span class="hits">1</span>
            

            

            <code class="ruby">  scope :billing,  -&gt; { where(&quot;address_type=&#39;Billing&#39;&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="35">
            <span class="hits">1</span>
            

            

            <code class="ruby">  scope :shipping, -&gt; { where(&quot;address_type=&#39;Shipping&#39;&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            
            

            

            <code class="ruby">  # Checks if the address is blank for both single and compound addresses.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="39">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31" data-linenumber="40">
            <span class="hits">31</span>
            

            

            <code class="ruby">    if Setting.compound_address</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="217" data-linenumber="41">
            <span class="hits">217</span>
            

            

            <code class="ruby">      %w[street1 street2 city state zipcode country].all? { |attr| send(attr).blank? }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="43">
            
            

            

            <code class="ruby">      full_address.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            
            

            

            <code class="ruby">  # Ensure blank address records don&#39;t get created. If we have a new record and</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            
            

            

            <code class="ruby">  #   address is empty then return true otherwise return false so that _destroy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            
            

            

            <code class="ruby">  #   is processed (if applicable) and the record is removed.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            
            

            

            <code class="ruby">  # Intended to be called as follows:</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            
            

            

            <code class="ruby">  #   accepts_nested_attributes_for :business_address, :allow_destroy =&gt; true, :reject_if =&gt; proc {|attributes| Address.reject_address(attributes)}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="53">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def self.reject_address(attributes)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="54">
            <span class="hits">9</span>
            

            

            <code class="ruby">    exists = attributes[&#39;id&#39;].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="72" data-linenumber="55">
            <span class="hits">72</span>
            

            

            <code class="ruby">    empty = %w[street1 street2 city state zipcode country full_address].map { |name| attributes[name].blank? }.all?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="56">
            <span class="hits">9</span>
            

            

            <code class="ruby">    attributes[:_destroy] = 1 if exists &amp;&amp; empty</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="57">
            <span class="hits">9</span>
            

            

            <code class="ruby">    (!exists &amp;&amp; empty)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="60">
            <span class="hits">1</span>
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_address, self)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="78b5c42a122e0210b1833dfb28d409e932aafdd5">
  <div class="header">
    <h3>app/models/polymorphic/avatar.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>5</b> relevant lines.
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby"># == Schema Information</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"># Table name: avatars</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">#  id                 :integer         not null, primary key</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">#  user_id            :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">#  entity_id          :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">#  entity_type        :string(255)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">#  image_file_size    :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">#  image_file_name    :string(255)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">#  image_content_type :string(255)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">#  created_at         :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">#  updated_at         :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="23">
            <span class="hits">1</span>
            

            

            <code class="ruby">class Avatar &lt; ActiveRecord::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="24">
            <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="25">
            <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :entity, polymorphic: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="27">
            <span class="hits">1</span>
            

            

            <code class="ruby">  has_one_attached :image</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="29">
            <span class="hits">1</span>
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_avatar, self)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="8b6c7531a221e68c3922dd64d4b3228f5382de03">
  <div class="header">
    <h3>app/models/polymorphic/comment.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>25</b> relevant lines.
      <span class="green"><b>25</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby"># == Schema Information</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"># Table name: comments</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">#  id               :integer         not null, primary key</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">#  user_id          :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">#  commentable_id   :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">#  commentable_type :string(255)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">#  private          :boolean</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">#  title            :string(255)     default(&quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">#  comment          :text</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">#  created_at       :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">#  updated_at       :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby">#  state            :string(16)      default(&quot;Expanded&quot;), not null</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="24">
            <span class="hits">1</span>
            

            

            <code class="ruby">class Comment &lt; ActiveRecord::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="25">
            <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="26">
            <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :commentable, polymorphic: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="28">
            <span class="hits">4</span>
            

            

            <code class="ruby">  scope :created_by, -&gt;(user) { where(user_id: user.id) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="30">
            <span class="hits">1</span>
            

            

            <code class="ruby">  validates_presence_of :user, :commentable, :comment</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="31">
            <span class="hits">1</span>
            

            

            <code class="ruby">  has_paper_trail versions: { class_name: &#39;Version&#39; }, meta: { related: :commentable },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby">                  ignore: [:state]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            <span class="hits">1</span>
            

            

            <code class="ruby">  before_create :subscribe_mentioned_users</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="35">
            <span class="hits">1</span>
            

            

            <code class="ruby">  after_create :subscribe_user_to_entity, :notify_subscribers</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="37">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def expanded?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="38">
            <span class="hits">5</span>
            

            

            <code class="ruby">    state == &quot;Expanded&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="41">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def collapsed?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="42">
            <span class="hits">10</span>
            

            

            <code class="ruby">    state == &quot;Collapsed&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="45">
            <span class="hits">1</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            
            

            

            <code class="ruby">  # Add user to subscribed_users field on entity</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="48">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def subscribe_user_to_entity(u = user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="68" data-linenumber="49">
            <span class="hits">68</span>
            

            

            <code class="ruby">    commentable.subscribed_users &lt;&lt; u.id</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="68" data-linenumber="50">
            <span class="hits">68</span>
            

            

            <code class="ruby">    commentable.save</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            
            

            

            <code class="ruby">  # Notify subscribed users when a comment is added, unless user created this comment</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="54">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def notify_subscribers</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="134" data-linenumber="55">
            <span class="hits">134</span>
            

            

            <code class="ruby">    commentable.subscribed_users.reject { |user_id| user_id == user.id }.each do |subscriber_id|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="56">
            <span class="hits">2</span>
            

            

            <code class="ruby">      if subscriber = User.find_by_id(subscriber_id)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="57">
            <span class="hits">2</span>
            

            

            <code class="ruby">        SubscriptionMailer.comment_notification(subscriber, self).deliver_later</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            
            

            

            <code class="ruby">  # If a user is mentioned in the comment body, subscribe them to the entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            
            

            

            <code class="ruby">  # before creation, so that they are sent an email notification</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="64">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def subscribe_mentioned_users</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            
            

            

            <code class="ruby">    # Scan for usernames mentioned in the comment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            
            

            

            <code class="ruby">    # e.g. &quot;Hi @example_user, take a look at this lead. Please show @another_user&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="66" data-linenumber="67">
            <span class="hits">66</span>
            

            

            <code class="ruby">    comment.scan(/@([a-zA-Z0-9_-]+)/).map(&amp;:first).each do |username|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="68">
            <span class="hits">2</span>
            

            

            <code class="ruby">      if (mentioned_user = User.find_by_username(username))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="69">
            <span class="hits">2</span>
            

            

            <code class="ruby">        subscribe_user_to_entity(mentioned_user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="74">
            <span class="hits">1</span>
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_comment, self)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="967a4de76ddb5c0aaa4be5741799f0c922474b54">
  <div class="header">
    <h3>app/models/polymorphic/email.rb</h3>
    <h4>
      <span class="yellow">
  84.62%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>13</b> relevant lines.
      <span class="green"><b>11</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby"># == Schema Information</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"># Table name: emails</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">#  id              :integer         not null, primary key</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">#  imap_message_id :string(255)     not null</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">#  user_id         :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">#  mediator_id     :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">#  mediator_type   :string(255)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">#  sent_from       :string(255)     not null</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">#  sent_to         :string(255)     not null</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">#  cc              :string(255)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">#  bcc             :string(255)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby">#  subject         :string(255)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby">#  body            :text</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby">#  header          :text</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby">#  sent_at         :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">#  received_at     :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby">#  deleted_at      :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby">#  created_at      :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby">#  updated_at      :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby">#  state           :string(16)      default(&quot;Expanded&quot;), not null</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="32">
            <span class="hits">1</span>
            

            

            <code class="ruby">class Email &lt; ActiveRecord::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="33">
            <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :mediator, polymorphic: true, optional: true # TODO: Is this really optional?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :user, optional: true # TODO: Is this really optional?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="36">
            <span class="hits">1</span>
            

            

            <code class="ruby">  has_paper_trail versions: { class_name: &#39;Version&#39; }, meta: { related: :mediator },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            
            

            

            <code class="ruby">                  ignore: [:state]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="39">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def expanded?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            
            

            

            <code class="ruby">    state == &quot;Expanded&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="43">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def collapsed?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="44">
            
            

            

            <code class="ruby">    state == &quot;Collapsed&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="47">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def body_html</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="48">
            <span class="hits">1</span>
            

            

            <code class="ruby">    body.to_s.gsub(&quot;\n&quot;, &quot;&lt;br&gt;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="51">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def body_inline</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="52">
            <span class="hits">1</span>
            

            

            <code class="ruby">    body.to_s.tr(&quot;\n&quot;, &quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="55">
            <span class="hits">1</span>
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_email, self)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="cbc7955106b4554ccd24914039aaa133948d5288">
  <div class="header">
    <h3>app/models/polymorphic/tag.rb</h3>
    <h4>
      <span class="red">
  71.43%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>7</b> relevant lines.
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            <span class="hits">1</span>
            

            

            <code class="ruby">class Tag &lt; ActsAsTaggableOn::Tag</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            <span class="hits">1</span>
            

            

            <code class="ruby">  before_destroy :no_associated_field_groups</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">  # Don&#39;t allow a tag to be deleted if it is associated with a Field Group</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def no_associated_field_groups</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">    FieldGroup.where(tag_id: id).none?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">  # Returns a count of taggings per model klass</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">  # e.g. {&quot;Contact&quot; =&gt; 3, &quot;Account&quot; =&gt; 1}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="18">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def model_tagging_counts</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">    Tagging.where(tag_id: id).group(:taggable_type).count</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="22">
            <span class="hits">1</span>
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_tag, self)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="cb1aa12ef61d4ed45591155b5b158814b45135da">
  <div class="header">
    <h3>app/models/polymorphic/tagging.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>3</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">class Tagging &lt; ActsAsTaggableOn::Tagging</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_tagging, self)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="4164333929c60a89b46dd2994b744a703af19d65">
  <div class="header">
    <h3>app/models/polymorphic/task.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>180</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>180</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby"># == Schema Information</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"># Table name: tasks</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">#  id              :integer         not null, primary key</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">#  user_id         :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">#  assigned_to     :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">#  completed_by    :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">#  name            :string(255)     default(&quot;&quot;), not null</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">#  asset_id        :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">#  asset_type      :string(255)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">#  priority        :string(32)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">#  category        :string(32)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby">#  bucket          :string(32)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby">#  due_at          :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby">#  completed_at    :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby">#  deleted_at      :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">#  created_at      :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby">#  updated_at      :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby">#  background_info :string(255)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            
            

            

            <code class="ruby">class Task &lt; ActiveRecord::Base</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            
            

            

            <code class="ruby">  include ActiveModel::Serializers::Xml</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            
            

            

            <code class="ruby">  attr_accessor :calendar</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            
            

            

            <code class="ruby">  ALLOWED_VIEWS = %w[pending assigned completed]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="37">
            
            

            

            <code class="ruby">  belongs_to :user</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="38">
            
            

            

            <code class="ruby">  belongs_to :assignee, class_name: &quot;User&quot;, foreign_key: :assigned_to, optional: true # TODO: Is this really optional?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            
            

            

            <code class="ruby">  belongs_to :completor, class_name: &quot;User&quot;, foreign_key: :completed_by, optional: true # TODO: Is this really optional?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            
            

            

            <code class="ruby">  belongs_to :asset, polymorphic: true, optional: true # TODO: Is this really optional?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="42">
            
            

            

            <code class="ruby">  serialize :subscribed_users, Array</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            
            

            

            <code class="ruby">  # Tasks created by the user for herself, or assigned to her by others. That&#39;s</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            
            

            

            <code class="ruby">  # what gets shown on Tasks/Pending and Tasks/Completed pages.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            
            

            

            <code class="ruby">  scope :my, lambda { |*args|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="47">
            
            

            

            <code class="ruby">    options = args[0] || {}</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="48">
            
            

            

            <code class="ruby">    user_option = (options.is_a?(Hash) ? options[:user] : options) || User.current_user</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="49">
            
            

            

            <code class="ruby">    includes(:assignee)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="50">
            
            

            

            <code class="ruby">      .where(&#39;(user_id = ? AND assigned_to IS NULL) OR assigned_to = ?&#39;, user_option, user_option)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            
            

            

            <code class="ruby">      .order(options[:order] || &#39;name ASC&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="52">
            
            

            

            <code class="ruby">      .limit(options[:limit]) # nil selects all records</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="53">
            
            

            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="55">
            
            

            

            <code class="ruby">  scope :created_by,  -&gt;(user) { where(user_id: user.id) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="56">
            
            

            

            <code class="ruby">  scope :assigned_to, -&gt;(user) { where(assigned_to: user.id) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            
            

            

            <code class="ruby">  # Tasks assigned by the user to others. That&#39;s what we see on Tasks/Assigned.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="59">
            
            

            

            <code class="ruby">  scope :assigned_by, lambda { |user|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="60">
            
            

            

            <code class="ruby">    includes(:assignee)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="61">
            
            

            

            <code class="ruby">      .where(&#39;user_id = ? AND assigned_to IS NOT NULL AND assigned_to != ?&#39;, user.id, user.id)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="62">
            
            

            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            
            

            

            <code class="ruby">  # Tasks created by the user or assigned to the user, i.e. the union of the two</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            
            

            

            <code class="ruby">  # scopes above. That&#39;s the tasks the user is allowed to see and track.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="66">
            
            

            

            <code class="ruby">  scope :tracked_by, lambda { |user|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="67">
            
            

            

            <code class="ruby">    includes(:assignee)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="68">
            
            

            

            <code class="ruby">      .where(&#39;user_id = ? OR assigned_to = ?&#39;, user.id, user.id)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="69">
            
            

            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            
            

            

            <code class="ruby">  # Show tasks which either belong to the user and are unassigned, or are assigned to the user</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="72">
            
            

            

            <code class="ruby">  scope :visible_on_dashboard, lambda { |user|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="73">
            
            

            

            <code class="ruby">    where(&#39;(user_id = :user_id AND assigned_to IS NULL) OR assigned_to = :user_id&#39;, user_id: user.id).where(&#39;completed_at IS NULL&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="74">
            
            

            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="76">
            
            

            

            <code class="ruby">  scope :by_due_at, lambda {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="77">
            
            

            

            <code class="ruby">    order({</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="78">
            
            

            

            <code class="ruby">      &quot;MySQL&quot;      =&gt; &quot;due_at NOT NULL, due_at ASC&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="79">
            
            

            

            <code class="ruby">      &quot;PostgreSQL&quot; =&gt; &quot;due_at ASC NULLS FIRST&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="80">
            
            

            

            <code class="ruby">    }[ActiveRecord::Base.connection.adapter_name] || :due_at)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="81">
            
            

            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            
            

            

            <code class="ruby">  # Status based scopes to be combined with the due date and completion time.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="84">
            
            

            

            <code class="ruby">  scope :pending,       -&gt; { where(&#39;completed_at IS NULL&#39;).order(&#39;tasks.due_at, tasks.id&#39;) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="85">
            
            

            

            <code class="ruby">  scope :assigned,      -&gt; { where(&#39;completed_at IS NULL AND assigned_to IS NOT NULL&#39;).order(&#39;tasks.due_at, tasks.id&#39;) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="86">
            
            

            

            <code class="ruby">  scope :completed,     -&gt; { where(&#39;completed_at IS NOT NULL&#39;).order(&#39;tasks.completed_at DESC&#39;) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            
            

            

            <code class="ruby">  # Due date scopes.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="89">
            
            

            

            <code class="ruby">  scope :due_asap,      -&gt; { where(&quot;due_at IS NULL AND bucket = &#39;due_asap&#39;&quot;).order(&#39;tasks.id DESC&#39;) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="90">
            
            

            

            <code class="ruby">  scope :overdue,       -&gt; { where(&#39;due_at IS NOT NULL AND due_at &lt; ?&#39;, Time.zone.now.midnight.utc).order(&#39;tasks.id DESC&#39;) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="91">
            
            

            

            <code class="ruby">  scope :due_today,     -&gt; { where(&#39;due_at &gt;= ? AND due_at &lt; ?&#39;, Time.zone.now.midnight.utc, Time.zone.now.midnight.tomorrow.utc).order(&#39;tasks.id DESC&#39;) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="92">
            
            

            

            <code class="ruby">  scope :due_tomorrow,  -&gt; { where(&#39;due_at &gt;= ? AND due_at &lt; ?&#39;, Time.zone.now.midnight.tomorrow.utc, Time.zone.now.midnight.tomorrow.utc + 1.day).order(&#39;tasks.id DESC&#39;) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="93">
            
            

            

            <code class="ruby">  scope :due_this_week, -&gt; { where(&#39;due_at &gt;= ? AND due_at &lt; ?&#39;, Time.zone.now.midnight.tomorrow.utc + 1.day, Time.zone.now.next_week.utc).order(&#39;tasks.id DESC&#39;) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="94">
            
            

            

            <code class="ruby">  scope :due_next_week, -&gt; { where(&#39;due_at &gt;= ? AND due_at &lt; ?&#39;, Time.zone.now.next_week.utc, Time.zone.now.next_week.end_of_week.utc + 1.day).order(&#39;tasks.id DESC&#39;) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="95">
            
            

            

            <code class="ruby">  scope :due_later,     -&gt; { where(&quot;(due_at IS NULL AND bucket = &#39;due_later&#39;) OR due_at &gt;= ?&quot;, Time.zone.now.next_week.end_of_week.utc + 1.day).order(&#39;tasks.id DESC&#39;) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            
            

            

            <code class="ruby">  # Completion time scopes.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="98">
            
            

            

            <code class="ruby">  scope :completed_today,      -&gt; { where(&#39;completed_at &gt;= ? AND completed_at &lt; ?&#39;, Time.zone.now.midnight.utc, Time.zone.now.midnight.tomorrow.utc) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="99">
            
            

            

            <code class="ruby">  scope :completed_yesterday,  -&gt; { where(&#39;completed_at &gt;= ? AND completed_at &lt; ?&#39;, Time.zone.now.midnight.yesterday.utc, Time.zone.now.midnight.utc) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="100">
            
            

            

            <code class="ruby">  scope :completed_this_week,  -&gt; { where(&#39;completed_at &gt;= ? AND completed_at &lt; ?&#39;, Time.zone.now.beginning_of_week.utc, Time.zone.now.midnight.yesterday.utc) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="101">
            
            

            

            <code class="ruby">  scope :completed_last_week,  -&gt; { where(&#39;completed_at &gt;= ? AND completed_at &lt; ?&#39;, Time.zone.now.beginning_of_week.utc - 7.days, Time.zone.now.beginning_of_week.utc) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="102">
            
            

            

            <code class="ruby">  scope :completed_this_month, -&gt; { where(&#39;completed_at &gt;= ? AND completed_at &lt; ?&#39;, Time.zone.now.beginning_of_month.utc, Time.zone.now.beginning_of_week.utc - 7.days) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="103">
            
            

            

            <code class="ruby">  scope :completed_last_month, -&gt; { where(&#39;completed_at &gt;= ? AND completed_at &lt; ?&#39;, (Time.zone.now.beginning_of_month.utc - 1.day).beginning_of_month.utc, Time.zone.now.beginning_of_month.utc) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="105">
            
            

            

            <code class="ruby">  scope :text_search, lambda { |query|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="106">
            
            

            

            <code class="ruby">    query = query.gsub(/[^\w\s\-\.&#39;\p{L}]/u, &#39;&#39;).strip</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="107">
            
            

            

            <code class="ruby">    where(&#39;upper(name) LIKE upper(?)&#39;, &quot;%#{query}%&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="108">
            
            

            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="110">
            
            

            

            <code class="ruby">  acts_as_commentable</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="111">
            
            

            

            <code class="ruby">  has_paper_trail versions: { class_name: &#39;Version&#39; }, meta: { related: :asset },</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="112">
            
            

            

            <code class="ruby">                  ignore: [:subscribed_users]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="113">
            
            

            

            <code class="ruby">  has_fields</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="114">
            
            

            

            <code class="ruby">  exportable</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="116">
            
            

            

            <code class="ruby">  validates_presence_of :user</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="117">
            
            

            

            <code class="ruby">  validates_presence_of :name, message: :missing_task_name</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="118">
            
            

            

            <code class="ruby">  validates_presence_of :calendar, if: -&gt; { bucket == &#39;specific_time&#39; &amp;&amp; !completed_at }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="119">
            
            

            

            <code class="ruby">  validate :specific_time, unless: :completed?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="121">
            
            

            

            <code class="ruby">  before_create :set_due_date</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="122">
            
            

            

            <code class="ruby">  before_update :set_due_date, unless: :completed?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="123">
            
            

            

            <code class="ruby">  before_save :notify_assignee</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            
            

            

            <code class="ruby">  # Matcher for the :my named scope.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="127">
            
            

            

            <code class="ruby">  def my?(user)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="128">
            
            

            

            <code class="ruby">    (self.user == user &amp;&amp; assignee.nil?) || assignee == user</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="129">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            
            

            

            <code class="ruby">  # Matcher for the :assigned_by named scope.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="133">
            
            

            

            <code class="ruby">  def assigned_by?(user)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="134">
            
            

            

            <code class="ruby">    self.user == user &amp;&amp; assignee &amp;&amp; assignee != user</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="135">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="138">
            
            

            

            <code class="ruby">  def completed?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="139">
            
            

            

            <code class="ruby">    !!completed_at</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="140">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            
            

            

            <code class="ruby">  # Matcher for the :tracked_by? named scope.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="144">
            
            

            

            <code class="ruby">  def tracked_by?(user)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="145">
            
            

            

            <code class="ruby">    self.user == user || assignee == user</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="146">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            
            

            

            <code class="ruby">  # Check whether the due date has specific time ignoring 23:59:59 timestamp</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            
            

            

            <code class="ruby">  # set by Time.now.end_of_week.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="151">
            
            

            

            <code class="ruby">  def at_specific_time?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="152">
            
            

            

            <code class="ruby">    due_at.present? &amp;&amp; !due_end_of_day? &amp;&amp; !due_beginning_of_day?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="153">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="154">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            
            

            

            <code class="ruby">  # Convert specific due_date to &quot;due_today&quot;, &quot;due_tomorrow&quot;, etc. bucket name.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="157">
            
            

            

            <code class="ruby">  def computed_bucket</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="158">
            
            

            

            <code class="ruby">    return bucket if bucket != &quot;specific_time&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="160">
            
            

            

            <code class="ruby">    if overdue?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="161">
            
            

            

            <code class="ruby">      &quot;overdue&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="162">
            
            

            

            <code class="ruby">    elsif due_today?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="163">
            
            

            

            <code class="ruby">      &quot;due_today&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="164">
            
            

            

            <code class="ruby">    elsif due_tomorrow?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="165">
            
            

            

            <code class="ruby">      &quot;due_tomorrow&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="166">
            
            

            

            <code class="ruby">    elsif due_this_week? &amp;&amp; !due_today? &amp;&amp; !due_tomorrow?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="167">
            
            

            

            <code class="ruby">      &quot;due_this_week&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="168">
            
            

            

            <code class="ruby">    elsif due_next_week?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="169">
            
            

            

            <code class="ruby">      &quot;due_next_week&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="170">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="171">
            
            

            

            <code class="ruby">      &quot;due_later&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="172">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="173">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="174">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="175">
            
            

            

            <code class="ruby">  # Returns list of tasks grouping them by due date as required by tasks/index.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="176">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="177">
            
            

            

            <code class="ruby">  def self.find_all_grouped(user, view)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="178">
            
            

            

            <code class="ruby">    return {} unless ALLOWED_VIEWS.include?(view)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="179">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="180">
            
            

            

            <code class="ruby">    settings = (view == &quot;completed&quot; ? Setting.task_completed : Setting.task_bucket)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="181">
            
            

            

            <code class="ruby">    Hash[</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="182">
            
            

            

            <code class="ruby">      settings.map do |key, _value|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="183">
            
            

            

            <code class="ruby">        [key, view == &quot;assigned&quot; ? assigned_by(user).send(key).pending : my(user).send(key).send(view)]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="184">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="185">
            
            

            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="186">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="187">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="188">
            
            

            

            <code class="ruby">  # Returns bucket if it&#39;s empty (i.e. we have to hide it), nil otherwise.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="189">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="190">
            
            

            

            <code class="ruby">  def self.bucket_empty?(bucket, user, view = &quot;pending&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="191">
            
            

            

            <code class="ruby">    return false if bucket.blank? || !ALLOWED_VIEWS.include?(view)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="192">
            
            

            

            <code class="ruby">    return false unless Setting.task_bucket.map(&amp;:to_s).include?(bucket.to_s)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="193">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="194">
            
            

            

            <code class="ruby">    if view == &quot;assigned&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="195">
            
            

            

            <code class="ruby">      assigned_by(user).send(bucket).pending.count</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="196">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="197">
            
            

            

            <code class="ruby">      my(user).send(bucket).send(view).count</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="198">
            
            

            

            <code class="ruby">    end == 0</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="199">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="200">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="201">
            
            

            

            <code class="ruby">  # Returns task totals for each of the views as needed by tasks sidebar.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="202">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="203">
            
            

            

            <code class="ruby">  def self.totals(user, view = &quot;pending&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="204">
            
            

            

            <code class="ruby">    return {} unless ALLOWED_VIEWS.include?(view)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="205">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="206">
            
            

            

            <code class="ruby">    settings = (view == &quot;completed&quot; ? Setting.task_completed : Setting.task_bucket)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="207">
            
            

            

            <code class="ruby">    settings.each_with_object(HashWithIndifferentAccess[all: 0]) do |key, hash|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="208">
            
            

            

            <code class="ruby">      hash[key] = (view == &quot;assigned&quot; ? assigned_by(user).send(key).pending.count : my(user).send(key).send(view).count)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="209">
            
            

            

            <code class="ruby">      hash[:all] += hash[key]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="210">
            
            

            

            <code class="ruby">      hash</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="211">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="212">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="213">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="214">
            
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="215">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="216">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="217">
            
            

            

            <code class="ruby">  def set_due_date</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="218">
            
            

            

            <code class="ruby">    self.due_at = case bucket</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="219">
            
            

            

            <code class="ruby">                  when &quot;overdue&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="220">
            
            

            

            <code class="ruby">                    due_at || Time.zone.now.midnight.yesterday</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="221">
            
            

            

            <code class="ruby">                  when &quot;due_today&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="222">
            
            

            

            <code class="ruby">                    Time.zone.now.midnight</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="223">
            
            

            

            <code class="ruby">                  when &quot;due_tomorrow&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="224">
            
            

            

            <code class="ruby">                    Time.zone.now.midnight.tomorrow</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="225">
            
            

            

            <code class="ruby">                  when &quot;due_this_week&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="226">
            
            

            

            <code class="ruby">                    Time.zone.now.end_of_week</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="227">
            
            

            

            <code class="ruby">                  when &quot;due_next_week&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="228">
            
            

            

            <code class="ruby">                    Time.zone.now.next_week.end_of_week</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="229">
            
            

            

            <code class="ruby">                  when &quot;due_later&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="230">
            
            

            

            <code class="ruby">                    Time.zone.now.midnight + 100.years</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="231">
            
            

            

            <code class="ruby">                  when &quot;specific_time&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="232">
            
            

            

            <code class="ruby">                    calendar ? parse_calendar_date : nil</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="233">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="234">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="235">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="236">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="237">
            
            

            

            <code class="ruby">  def due_end_of_day?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="238">
            
            

            

            <code class="ruby">    due_at.present? &amp;&amp; (due_at.change(usec: 0) == due_at.end_of_day.change(usec: 0))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="239">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="240">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="241">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="242">
            
            

            

            <code class="ruby">  def due_beginning_of_day?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="243">
            
            

            

            <code class="ruby">    due_at.present? &amp;&amp; (due_at == due_at.beginning_of_day)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="244">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="245">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="246">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="247">
            
            

            

            <code class="ruby">  def overdue?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="248">
            
            

            

            <code class="ruby">    due_at &lt; Time.zone.now.midnight</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="249">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="250">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="251">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="252">
            
            

            

            <code class="ruby">  def due_today?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="253">
            
            

            

            <code class="ruby">    due_at.between?(Time.zone.now.midnight, Time.zone.now.end_of_day)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="254">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="255">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="256">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="257">
            
            

            

            <code class="ruby">  def due_tomorrow?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="258">
            
            

            

            <code class="ruby">    due_at.between?(Time.zone.now.midnight.tomorrow, Time.zone.now.tomorrow.end_of_day)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="259">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="260">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="261">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="262">
            
            

            

            <code class="ruby">  def due_this_week?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="263">
            
            

            

            <code class="ruby">    due_at.between?(Time.zone.now.beginning_of_week, Time.zone.now.end_of_week)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="264">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="265">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="266">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="267">
            
            

            

            <code class="ruby">  def due_next_week?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="268">
            
            

            

            <code class="ruby">    due_at.between?(Time.zone.now.next_week, Time.zone.now.next_week.end_of_week)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="269">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="270">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="271">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="272">
            
            

            

            <code class="ruby">  def notify_assignee</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="273">
            
            

            

            <code class="ruby">    if assigned_to</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="274">
            
            

            

            <code class="ruby">      # Notify assignee.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="275">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="276">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="277">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="278">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="279">
            
            

            

            <code class="ruby">  def specific_time</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="280">
            
            

            

            <code class="ruby">    parse_calendar_date if bucket == &quot;specific_time&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="281">
            
            

            

            <code class="ruby">  rescue ArgumentError</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="282">
            
            

            

            <code class="ruby">    errors.add(:calendar, :invalid_date)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="283">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="284">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="285">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="286">
            
            

            

            <code class="ruby">  def parse_calendar_date</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="287">
            
            

            

            <code class="ruby">    # always in 2012-10-28 06:28 format regardless of language</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="288">
            
            

            

            <code class="ruby">    Time.parse(calendar)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="289">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="290">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="291">
            
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_task, self)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="292">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="6c240699a86bbed2746e59537b7cbc324b99e8fb">
  <div class="header">
    <h3>app/models/polymorphic/version.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>62</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>62</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">require &#39;paper_trail&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">class Version &lt; PaperTrail::Version</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">  ASSETS = %w[all tasks campaigns leads accounts contacts opportunities comments emails]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">  EVENTS = %w[all_events create view update destroy]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">  DURATION = %w[one_hour one_day two_days one_week two_weeks one_month]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">  belongs_to :related, polymorphic: true, optional: true # TODO: Is this really optional?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">  belongs_to :user, foreign_key: :whodunnit, optional: true # TODO: Is this really optional?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">  scope :default_order,  -&gt; { order(&#39;created_at DESC&#39;) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">  scope :include_events, -&gt;(*events) { where(event: events) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">  scope :exclude_events, -&gt;(*events) { where(&#39;event NOT IN (?)&#39;, events) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">  scope :for,            -&gt;(user) { where(whodunnit: user.id.to_s) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">  class &lt;&lt; self</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            
            

            

            <code class="ruby">    def recent_for_user(user, limit = 10)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">      # Hybrid SQL/Ruby to build a unique list of the most recent entities that the</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby">      # user has interacted with</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            
            

            

            <code class="ruby">      versions = []</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">      offset = 0</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            
            

            

            <code class="ruby">      while versions.size &lt; limit</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            
            

            

            <code class="ruby">        query = includes(:item)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            
            

            

            <code class="ruby">                .where(whodunnit: user.id.to_s)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            
            

            

            <code class="ruby">                .where(item_type: ENTITIES)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            
            

            

            <code class="ruby">                .limit(limit * 2)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            
            

            

            <code class="ruby">                .offset(offset)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            
            

            

            <code class="ruby">                .default_order</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="37">
            
            

            

            <code class="ruby">        break if query.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            
            

            

            <code class="ruby">        versions += query.select { |v| v.item.present? }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            
            

            

            <code class="ruby">        versions.uniq! { |v| [v.item_id, v.item_type] }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            
            

            

            <code class="ruby">        offset += limit * 2</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="42">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="43">
            
            

            

            <code class="ruby">      versions[0...10]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="44">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            
            

            

            <code class="ruby">    def latest(options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="47">
            
            

            

            <code class="ruby">      includes(:item, :related, :user)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="48">
            
            

            

            <code class="ruby">        .where(({ item_type: options[:asset] } if options[:asset]))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="49">
            
            

            

            <code class="ruby">        .where(({ event:     options[:event] } if options[:event]))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="50">
            
            

            

            <code class="ruby">        .where(({ whodunnit: options[:user].to_s } if options[:user]))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            
            

            

            <code class="ruby">        .where(&#39;versions.created_at &gt;= ?&#39;, Time.zone.now - (options[:duration] || 2.days))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="52">
            
            

            

            <code class="ruby">        .limit(options[:max])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="53">
            
            

            

            <code class="ruby">        .default_order</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="54">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="56">
            
            

            

            <code class="ruby">    def related_to(object)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="57">
            
            

            

            <code class="ruby">      where(&#39;(item_id = :id AND item_type = :type) OR (related_id = :id AND related_type = :type)&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="58">
            
            

            

            <code class="ruby">            id: object.id, type: object.class.name)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="59">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="61">
            
            

            

            <code class="ruby">    def history(object)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="62">
            
            

            

            <code class="ruby">      related_to(object).exclude_events(:view).default_order</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="63">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="65">
            
            

            

            <code class="ruby">    def visible_to(user)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="66">
            
            

            

            <code class="ruby">      all.to_a.delete_if do |version|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="67">
            
            

            

            <code class="ruby">        if item = version.item || version.reify</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="68">
            
            

            

            <code class="ruby">          if item.respond_to?(:access) # NOTE: Tasks don&#39;t have :access as of yet.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            
            

            

            <code class="ruby">            # Delete from scope if it shouldn&#39;t be visible</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="70">
            
            

            

            <code class="ruby">            next item.user_id != user.id &amp;&amp;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="71">
            
            

            

            <code class="ruby">              item.assigned_to != user.id &amp;&amp;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="72">
            
            

            

            <code class="ruby">              (item.access == &quot;Private&quot; ||</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="73">
            
            

            

            <code class="ruby">                (item.access == &quot;Shared&quot; &amp;&amp;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="74">
            
            

            

            <code class="ruby">                 !item.permissions.map(&amp;:user_id).include?(user.id)))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="75">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            
            

            

            <code class="ruby">          # Don&#39;t delete any objects that don&#39;t have :access method (e.g. tasks)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="77">
            
            

            

            <code class="ruby">          next false</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="78">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            
            

            

            <code class="ruby">        # Delete from scope if no object can be found or reified (e.g. from &#39;show&#39; events)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="80">
            
            

            

            <code class="ruby">        true</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="81">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="82">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="83">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="84">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="5394a224d1f2e949adf1d8e327c281da8920f031">
  <div class="header">
    <h3>app/models/setting.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>59</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>59</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby"># == Schema Information</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"># Table name: settings</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">#  id            :integer         not null, primary key</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">#  name          :string(32)      default(&quot;&quot;), not null</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">#  value         :text</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">#  created_at    :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">#  updated_at    :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby"># Fat Free CRM settings are stored in three places, and are loaded in the following order:</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby"># 1) config/settings.default.yml</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby"># 2) config/settings.yml  (if exists)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby"># 3) &#39;settings&#39; table in database  (if exists)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby"># Any configured settings in `config/settings.yml` will override those in</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby"># `config/settings.default.yml`, and settings in the database table have the highest priority.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">class Setting &lt; ActiveRecord::Base</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            
            

            

            <code class="ruby">  validates :name, presence: true, allow_blank: false</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            
            

            

            <code class="ruby">  serialize :value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby">  # Use class variables for cache and yaml settings.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            
            

            

            <code class="ruby">  cattr_accessor :cache, :yaml_settings</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            
            

            

            <code class="ruby">  @@cache = @@yaml_settings = {}.with_indifferent_access</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="36">
            
            

            

            <code class="ruby">  class &lt;&lt; self</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            
            

            

            <code class="ruby">    # Cache should be cleared before each request.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="38">
            
            

            

            <code class="ruby">    def clear_cache!</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            
            

            

            <code class="ruby">      @@cache = {}.with_indifferent_access</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            
            

            

            <code class="ruby">    #-------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="43">
            
            

            

            <code class="ruby">    def method_missing(method, *args)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="44">
            
            

            

            <code class="ruby">      super</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="45">
            
            

            

            <code class="ruby">    rescue NoMethodError</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            
            

            

            <code class="ruby">      method_name = method.to_s</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="47">
            
            

            

            <code class="ruby">      if method_name.last == &quot;=&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="48">
            
            

            

            <code class="ruby">        self[method_name.sub(&quot;=&quot;, &quot;&quot;)] = args.first</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="49">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="50">
            
            

            

            <code class="ruby">        self[method_name]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="52">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            
            

            

            <code class="ruby">    # Get setting value (from database or loaded YAML files)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            
            

            

            <code class="ruby">    #-------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="56">
            
            

            

            <code class="ruby">    def [](name)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            
            

            

            <code class="ruby">      # Return value if cached</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="58">
            
            

            

            <code class="ruby">      return cache[name] if cache.key?(name)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            
            

            

            <code class="ruby">      # Check database</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="61">
            
            

            

            <code class="ruby">      if database_and_table_exists? &amp;&amp; (setting = find_by_name(name.to_s))&amp;.value.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="62">
            
            

            

            <code class="ruby">        return cache[name] = setting.value</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="63">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            
            

            

            <code class="ruby">      # Check YAML settings</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="65">
            
            

            

            <code class="ruby">      cache[name] = yaml_settings[name] if yaml_settings.key?(name)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="66">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            
            

            

            <code class="ruby">    # Set setting value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            
            

            

            <code class="ruby">    #-------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="70">
            
            

            

            <code class="ruby">    def []=(name, value)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="71">
            
            

            

            <code class="ruby">      raise ArgumentError, &quot;name cannot be blank&quot; if name.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="73">
            
            

            

            <code class="ruby">      return nil unless database_and_table_exists?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="75">
            
            

            

            <code class="ruby">      setting = find_by_name(name.to_s) || new(name: name.to_s)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="76">
            
            

            

            <code class="ruby">      setting.value = value</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="77">
            
            

            

            <code class="ruby">      setting.save</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="78">
            
            

            

            <code class="ruby">      cache[name] = value</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="79">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            
            

            

            <code class="ruby">    # Unrolls [ :one, :two ] settings array into [[ &quot;One&quot;, :one ], [ &quot;Two&quot;, :two ]]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            
            

            

            <code class="ruby">    # picking symbol translations from locale. If setting is not a symbol but</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            
            

            

            <code class="ruby">    # string it gets copied without translation.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            
            

            

            <code class="ruby">    #-------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="85">
            
            

            

            <code class="ruby">    def unroll(setting)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="86">
            
            

            

            <code class="ruby">      send(setting).map { |key| [key.is_a?(Symbol) ? I18n.t(key) : key, key.to_sym] }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="87">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            
            

            

            <code class="ruby">    # Retrieves the value object corresponding to the each key objects repeatedly.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            
            

            

            <code class="ruby">    # Equivalent to the #dig method on a Hash.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            
            

            

            <code class="ruby">    #-------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="92">
            
            

            

            <code class="ruby">    def dig(key, *rest)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="93">
            
            

            

            <code class="ruby">      value = self[key]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="94">
            
            

            

            <code class="ruby">      if value.nil? || rest.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="95">
            
            

            

            <code class="ruby">        value</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="96">
            
            

            

            <code class="ruby">      elsif value.respond_to?(:dig)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="97">
            
            

            

            <code class="ruby">        value.dig(*rest)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="98">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="99">
            
            

            

            <code class="ruby">        raise TypeError, &quot;#{value.class} does not have #dig method&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="100">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="101">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="103">
            
            

            

            <code class="ruby">    def database_and_table_exists?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            
            

            

            <code class="ruby">      # Returns false if table or database is unavailable.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            
            

            

            <code class="ruby">      # Catches all database-related errors, so that Setting will return nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            
            

            

            <code class="ruby">      # instead of crashing the entire application.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="108">
            
            

            

            <code class="ruby">      table_exists?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="109">
            
            

            

            <code class="ruby">    rescue StandardError</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="110">
            
            

            

            <code class="ruby">      false</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="111">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            
            

            

            <code class="ruby">    # Loads settings from YAML files</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="114">
            
            

            

            <code class="ruby">    def load_settings_from_yaml(file)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="115">
            
            

            

            <code class="ruby">      settings = YAML.load(ERB.new(File.read(file)).result)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="116">
            
            

            

            <code class="ruby">      @@yaml_settings.deep_merge!(settings)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="117">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="118">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="120">
            
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_setting, self)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="121">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="29a9f704c4194fa13d6d2270b03782b4e0035d0e">
  <div class="header">
    <h3>app/models/users/ability.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>24</b> relevant lines.
      <span class="green"><b>24</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby"># See the wiki for details: https://github.com/ryanb/cancan/wiki/Defining-Abilities</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            <span class="hits">1</span>
            

            

            <code class="ruby">class Ability</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="11">
            <span class="hits">1</span>
            

            

            <code class="ruby">  include CanCan::Ability</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def initialize(user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">    # handle signup</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1033" data-linenumber="15">
            <span class="hits">1033</span>
            

            

            <code class="ruby">    can(:create, User) if User.can_signup?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1033" data-linenumber="17">
            <span class="hits">1033</span>
            

            

            <code class="ruby">    if user.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1031" data-linenumber="18">
            <span class="hits">1031</span>
            

            

            <code class="ruby">      entities = [Account, Campaign, Contact, Lead, Opportunity]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">      # User</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1031" data-linenumber="21">
            <span class="hits">1031</span>
            

            

            <code class="ruby">      can :manage, User, id: user.id # can do any action on themselves</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby">      # Tasks</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1031" data-linenumber="24">
            <span class="hits">1031</span>
            

            

            <code class="ruby">      can :create, Task</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1031" data-linenumber="25">
            <span class="hits">1031</span>
            

            

            <code class="ruby">      can :manage, Task, user: user.id</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1031" data-linenumber="26">
            <span class="hits">1031</span>
            

            

            <code class="ruby">      can :manage, Task, assigned_to: user.id</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1031" data-linenumber="27">
            <span class="hits">1031</span>
            

            

            <code class="ruby">      can :manage, Task, completed_by: user.id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby">      # Entities</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1031" data-linenumber="30">
            <span class="hits">1031</span>
            

            

            <code class="ruby">      can :manage, entities, access: &#39;Public&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1031" data-linenumber="31">
            <span class="hits">1031</span>
            

            

            <code class="ruby">      can :manage, entities + [Task], user_id: user.id</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1031" data-linenumber="32">
            <span class="hits">1031</span>
            

            

            <code class="ruby">      can :manage, entities + [Task], assigned_to: user.id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            
            

            

            <code class="ruby">      #</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            
            

            

            <code class="ruby">      # Due to an obscure bug (see https://github.com/ryanb/cancan/issues/213)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            
            

            

            <code class="ruby">      # we must switch on user.admin? here to avoid the nil constraints which</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            
            

            

            <code class="ruby">      # activate the issue referred to above.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            
            

            

            <code class="ruby">      #</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1031" data-linenumber="39">
            <span class="hits">1031</span>
            

            

            <code class="ruby">      if user.admin?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="40">
            <span class="hits">28</span>
            

            

            <code class="ruby">        can :manage, :all</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            
            

            

            <code class="ruby">        # Group or User permissions</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1003" data-linenumber="43">
            <span class="hits">1003</span>
            

            

            <code class="ruby">        t = Permission.arel_table</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1003" data-linenumber="44">
            <span class="hits">1003</span>
            

            

            <code class="ruby">        scope = t[:user_id].eq(user.id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1003" data-linenumber="46">
            <span class="hits">1003</span>
            

            

            <code class="ruby">        if (group_ids = user.group_ids).any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="47">
            <span class="hits">10</span>
            

            

            <code class="ruby">          scope = scope.or(t[:group_id].eq_any(group_ids))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6018" data-linenumber="50">
            <span class="hits">6018</span>
            

            

            <code class="ruby">        permissions = Permission.select(:asset_type, :asset_id).where(scope).where(asset_type: entities.map { |k| k.name.to_s })</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1003" data-linenumber="51">
            <span class="hits">1003</span>
            

            

            <code class="ruby">        permissions.each do |p|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="52">
            <span class="hits">20</span>
            

            

            <code class="ruby">          can :manage, p.asset_type.constantize, id: p.asset_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="59">
            <span class="hits">1</span>
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_ability, self)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="0ac5aaafe553e1dffc5acaf1659ea0034a8a1aa4">
  <div class="header">
    <h3>app/models/users/group.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>5</b> relevant lines.
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            <span class="hits">1</span>
            

            

            <code class="ruby">class Group &lt; ActiveRecord::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            <span class="hits">1</span>
            

            

            <code class="ruby">  has_and_belongs_to_many :users</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            <span class="hits">1</span>
            

            

            <code class="ruby">  has_many :permissions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            <span class="hits">1</span>
            

            

            <code class="ruby">  validates :name, presence: true, uniqueness: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="14">
            <span class="hits">1</span>
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_group, self)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="0ccdaa919b68a81161ac6c67f889aa7d194f4a6e">
  <div class="header">
    <h3>app/models/users/permission.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>8</b> relevant lines.
      <span class="green"><b>8</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby"># == Schema Information</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"># Table name: permissions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">#  id         :integer         not null, primary key</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">#  user_id    :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">#  asset_id   :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">#  asset_type :string(255)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">#  created_at :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">#  updated_at :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="20">
            <span class="hits">1</span>
            

            

            <code class="ruby">class Permission &lt; ActiveRecord::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="21">
            <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :user, optional: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="22">
            <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :group, optional: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="23">
            <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :asset, polymorphic: true, optional: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="25">
            <span class="hits">1</span>
            

            

            <code class="ruby">  validates_presence_of :user_id, unless: :group_id?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="26">
            <span class="hits">1</span>
            

            

            <code class="ruby">  validates_presence_of :group_id, unless: :user_id?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="28">
            <span class="hits">1</span>
            

            

            <code class="ruby">  validates_uniqueness_of :user_id, scope: %i[group_id asset_id asset_type]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="30">
            <span class="hits">1</span>
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_permission, self)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="5521f9bd15b4b60e86d751428d346159ff37ca13">
  <div class="header">
    <h3>app/models/users/preference.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>17</b> relevant lines.
      <span class="green"><b>17</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby"># == Schema Information</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"># Table name: preferences</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">#  id         :integer         not null, primary key</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">#  user_id    :integer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">#  name       :string(32)      default(&quot;&quot;), not null</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">#  value      :text</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">#  created_at :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">#  updated_at :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="20">
            <span class="hits">1</span>
            

            

            <code class="ruby">class Preference &lt; ActiveRecord::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="21">
            <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :user, optional: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby">  #-------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="24">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def [](name)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">    # Following line is to preserve AR relationships</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2005" data-linenumber="26">
            <span class="hits">2005</span>
            

            

            <code class="ruby">    return super(name) if name.to_s == &quot;user_id&quot; # get the value of belongs_to</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2004" data-linenumber="28">
            <span class="hits">2004</span>
            

            

            <code class="ruby">    return cached_prefs[name.to_s] if cached_prefs.key?(name.to_s)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1508" data-linenumber="30">
            <span class="hits">1508</span>
            

            

            <code class="ruby">    cached_prefs[name.to_s] = if user.present? &amp;&amp; pref = Preference.find_by_name_and_user_id(name.to_s, user.id)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="31">
            <span class="hits">28</span>
            

            

            <code class="ruby">                                JSON.parse(Base64.decode64(pref.value), symbolize_name: true)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            
            

            

            <code class="ruby">  #-------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="36">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def []=(name, value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="231" data-linenumber="37">
            <span class="hits">231</span>
            

            

            <code class="ruby">    return super(name, value) if name.to_s == &quot;user_id&quot; # set the value of belongs_to</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="70" data-linenumber="39">
            <span class="hits">70</span>
            

            

            <code class="ruby">    encoded = Base64.encode64(value.to_json)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="70" data-linenumber="40">
            <span class="hits">70</span>
            

            

            <code class="ruby">    if pref = Preference.find_by(name: name.to_s, user_id: user.id)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="41">
            <span class="hits">1</span>
            

            

            <code class="ruby">      pref.update_attribute(:value, encoded)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="69" data-linenumber="43">
            <span class="hits">69</span>
            

            

            <code class="ruby">      Preference.create(user: user, name: name.to_s, value: encoded)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="70" data-linenumber="45">
            <span class="hits">70</span>
            

            

            <code class="ruby">    cached_prefs[name.to_s] = value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="48">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def cached_prefs</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4078" data-linenumber="49">
            <span class="hits">4078</span>
            

            

            <code class="ruby">    @cached_prefs ||= {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="52">
            <span class="hits">1</span>
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_preference, self)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="fb6ecfed0ebc511cdf5cd31263a2aeb0e77e2986">
  <div class="header">
    <h3>app/models/users/user.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>114</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>114</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby"># == Schema Information</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"># Table name: users</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">#  id                  :integer         not null, primary key</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">#  username            :string(32)      default(&quot;&quot;), not null</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">#  email               :string(254)     default(&quot;&quot;), not null</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">#  first_name          :string(32)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">#  last_name           :string(32)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">#  title               :string(64)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">#  company             :string(64)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">#  alt_email           :string(64)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">#  phone               :string(32)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby">#  mobile              :string(32)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby">#  aim                 :string(32)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby">#  yahoo               :string(32)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby">#  google              :string(32)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">#  skype               :string(32)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby">#  encrypted_password  :string(255)     default(&quot;&quot;), not null</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby">#  password_salt       :string(255)     default(&quot;&quot;), not null</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby">#  last_sign_in_at     :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby">#  current_sign_in_at  :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby">#  last_sign_in_ip     :string(255)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby">#  current_sign_in_ip  :string(255)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby">#  sign_in_count       :integer         default(0), not null</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            
            

            

            <code class="ruby">#  deleted_at          :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            
            

            

            <code class="ruby">#  created_at          :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            
            

            

            <code class="ruby">#  updated_at          :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            
            

            

            <code class="ruby">#  admin               :boolean         default(FALSE), not null</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            
            

            

            <code class="ruby">#  suspended_at        :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            
            

            

            <code class="ruby">#  unconfirmed_email   :string(254)     default(&quot;&quot;), not null</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            
            

            

            <code class="ruby">#  reset_password_token    :string(255)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            
            

            

            <code class="ruby">#  reset_password_sent_at  :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            
            

            

            <code class="ruby">#  remember_token          :string(255)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            
            

            

            <code class="ruby">#  remember_created_at     :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            
            

            

            <code class="ruby">#  authentication_token    :string(255)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            
            

            

            <code class="ruby">#  confirmation_token      :string(255)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            
            

            

            <code class="ruby">#  confirmed_at            :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            
            

            

            <code class="ruby">#  confirmation_sent_at    :datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="49">
            
            

            

            <code class="ruby">class User &lt; ActiveRecord::Base</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="50">
            
            

            

            <code class="ruby">  devise :database_authenticatable, :registerable, :confirmable,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            
            

            

            <code class="ruby">         :encryptable, :recoverable, :rememberable, :trackable</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="52">
            
            

            

            <code class="ruby">  before_create :suspend_if_needs_approval</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="54">
            
            

            

            <code class="ruby">  has_one :avatar, as: :entity, dependent: :destroy  # Personal avatar.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="55">
            
            

            

            <code class="ruby">  has_many :avatars                                  # As owner who uploaded it, ex. Contact avatar.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="56">
            
            

            

            <code class="ruby">  has_many :comments, as: :commentable               # As owner who created a comment.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="57">
            
            

            

            <code class="ruby">  has_many :accounts</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="58">
            
            

            

            <code class="ruby">  has_many :campaigns</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="59">
            
            

            

            <code class="ruby">  has_many :leads</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="60">
            
            

            

            <code class="ruby">  has_many :contacts</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="61">
            
            

            

            <code class="ruby">  has_many :opportunities</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="62">
            
            

            

            <code class="ruby">  has_many :assigned_opportunities, class_name: &#39;Opportunity&#39;, foreign_key: &#39;assigned_to&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="63">
            
            

            

            <code class="ruby">  has_many :permissions, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="64">
            
            

            

            <code class="ruby">  has_many :preferences, class_name: &#39;Preference&#39;, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="65">
            
            

            

            <code class="ruby">  has_many :lists</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="66">
            
            

            

            <code class="ruby">  has_and_belongs_to_many :groups</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="68">
            
            

            

            <code class="ruby">  has_paper_trail versions: { class_name: &#39;Version&#39; }, ignore: [:last_sign_in_at]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="70">
            
            

            

            <code class="ruby">  scope :by_id, -&gt; { order(&#39;id DESC&#39;) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            
            

            

            <code class="ruby">  # TODO: /home/clockwerx/.rbenv/versions/2.5.3/lib/ruby/gems/2.5.0/gems/activerecord-5.2.3/lib/active_record/scoping/named.rb:175:in `scope&#39;: You tried to define a scope named &quot;without&quot; on the model &quot;User&quot;, but ActiveRecord::Relation already defined an instance method with the same name. (ArgumentError)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="72">
            
            

            

            <code class="ruby">  scope :without_user, -&gt;(user) { where(&#39;id != ?&#39;, user.id).by_name }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="73">
            
            

            

            <code class="ruby">  scope :by_name, -&gt; { order(&#39;first_name, last_name, email&#39;) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="75">
            
            

            

            <code class="ruby">  scope :text_search, lambda { |query|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="76">
            
            

            

            <code class="ruby">    query = query.gsub(/[^\w\s\-\.&#39;\p{L}]/u, &#39;&#39;).strip</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="77">
            
            

            

            <code class="ruby">    where(&#39;upper(username) LIKE upper(:s) OR upper(email) LIKE upper(:s) OR upper(first_name) LIKE upper(:s) OR upper(last_name) LIKE upper(:s)&#39;, s: &quot;%#{query}%&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="78">
            
            

            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="80">
            
            

            

            <code class="ruby">  scope :my, -&gt;(current_user) { accessible_by(current_user.ability) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="82">
            
            

            

            <code class="ruby">  scope :have_assigned_opportunities, lambda {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="83">
            
            

            

            <code class="ruby">    joins(&quot;INNER JOIN opportunities ON users.id = opportunities.assigned_to&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="84">
            
            

            

            <code class="ruby">      .where(&quot;opportunities.stage &lt;&gt; &#39;lost&#39; AND opportunities.stage &lt;&gt; &#39;won&#39;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="85">
            
            

            

            <code class="ruby">      .select(&#39;DISTINCT(users.id), users.*&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="86">
            
            

            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="88">
            
            

            

            <code class="ruby">  validates :email,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="89">
            
            

            

            <code class="ruby">            presence: { message: :missing_email },</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="90">
            
            

            

            <code class="ruby">            length: { minimum: 3, maximum: 254 },</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="91">
            
            

            

            <code class="ruby">            uniqueness: { message: :email_in_use, case_sensitive: false },</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="92">
            
            

            

            <code class="ruby">            format: { with: /\A([^@\s]+)@((?:[-a-z0-9]+\.)+[a-z]{2,})\z/i, on: :create }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="93">
            
            

            

            <code class="ruby">  validates :username,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="94">
            
            

            

            <code class="ruby">            uniqueness: { message: :username_taken, case_sensitive: false },</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="95">
            
            

            

            <code class="ruby">            presence: { message: :missing_username },</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="96">
            
            

            

            <code class="ruby">            format: { with: /\A[a-z0-9_-]+\z/i }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="97">
            
            

            

            <code class="ruby">  validates :password,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="98">
            
            

            

            <code class="ruby">            presence: { if: :password_required? },</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="99">
            
            

            

            <code class="ruby">            confirmation: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="102">
            
            

            

            <code class="ruby">  def name</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="103">
            
            

            

            <code class="ruby">    first_name.blank? ? username : first_name</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="104">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="107">
            
            

            

            <code class="ruby">  def full_name</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="108">
            
            

            

            <code class="ruby">    first_name.blank? &amp;&amp; last_name.blank? ? email : &quot;#{first_name} #{last_name}&quot;.strip</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="109">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="112">
            
            

            

            <code class="ruby">  def suspended?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="113">
            
            

            

            <code class="ruby">    suspended_at != nil</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="114">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="117">
            
            

            

            <code class="ruby">  def awaits_approval?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="118">
            
            

            

            <code class="ruby">    suspended? &amp;&amp; sign_in_count == 0 &amp;&amp; Setting.user_signup == :needs_approval</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="119">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="121">
            
            

            

            <code class="ruby">  def active_for_authentication?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="122">
            
            

            

            <code class="ruby">    super &amp;&amp; confirmed? &amp;&amp; !awaits_approval? &amp;&amp; !suspended?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="123">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="125">
            
            

            

            <code class="ruby">  def inactive_message</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="126">
            
            

            

            <code class="ruby">    if !confirmed?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="127">
            
            

            

            <code class="ruby">      super</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="128">
            
            

            

            <code class="ruby">    elsif awaits_approval?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="129">
            
            

            

            <code class="ruby">      I18n.t(:msg_account_not_approved)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="130">
            
            

            

            <code class="ruby">    elsif suspended?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="131">
            
            

            

            <code class="ruby">      I18n.t(:msg_invalig_login)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="132">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="133">
            
            

            

            <code class="ruby">      super</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="134">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="135">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="138">
            
            

            

            <code class="ruby">  def preference</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="139">
            
            

            

            <code class="ruby">    @preference ||= preferences.build</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="140">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="141">
            
            

            

            <code class="ruby">  alias pref preference</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            
            

            

            <code class="ruby">  # Override global I18n.locale if the user has individual local preference.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="145">
            
            

            

            <code class="ruby">  def set_individual_locale</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="146">
            
            

            

            <code class="ruby">    I18n.locale = preference[:locale] if preference[:locale]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="147">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            
            

            

            <code class="ruby">  # Generate the value of single access token if it hasn&#39;t been set already.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="151">
            
            

            

            <code class="ruby">  def to_json(_options = nil)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="152">
            
            

            

            <code class="ruby">    [name].to_json</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="153">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="154">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="155">
            
            

            

            <code class="ruby">  def to_xml(_options = nil)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="156">
            
            

            

            <code class="ruby">    [name].to_xml</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="157">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="159">
            
            

            

            <code class="ruby">  def password_required?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="160">
            
            

            

            <code class="ruby">    !persisted? || !password.nil? || !password_confirmation.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="161">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="163">
            
            

            

            <code class="ruby">  # Returns permissions ability object.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="165">
            
            

            

            <code class="ruby">  def ability</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="166">
            
            

            

            <code class="ruby">    @ability ||= Ability.new(self)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="167">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="168">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="169">
            
            

            

            <code class="ruby">  # Returns true if this user is allowed to be destroyed.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="171">
            
            

            

            <code class="ruby">  def destroyable?(current_user)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="172">
            
            

            

            <code class="ruby">    current_user != self &amp;&amp; !has_related_assets?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="173">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="174">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="175">
            
            

            

            <code class="ruby">  # Suspend newly created user if signup requires an approval.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="176">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="177">
            
            

            

            <code class="ruby">  def suspend_if_needs_approval</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="178">
            
            

            

            <code class="ruby">    self.suspended_at = Time.now if Setting.user_signup == :needs_approval &amp;&amp; !admin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="179">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="181">
            
            

            

            <code class="ruby">  # Prevent deleting a user unless she has no artifacts left.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="182">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="183">
            
            

            

            <code class="ruby">  def has_related_assets?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="184">
            
            

            

            <code class="ruby">    sum = %w[Account Campaign Lead Contact Opportunity Comment Task].detect do |asset|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="185">
            
            

            

            <code class="ruby">      klass = asset.constantize</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="186">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="187">
            
            

            

            <code class="ruby">      asset != &quot;Comment&quot; &amp;&amp; klass.assigned_to(self).exists? || klass.created_by(self).exists?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="188">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="189">
            
            

            

            <code class="ruby">    !sum.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="190">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="191">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="192">
            
            

            

            <code class="ruby">  # Define class methods</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="193">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="194">
            
            

            

            <code class="ruby">  class &lt;&lt; self</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="195">
            
            

            

            <code class="ruby">    def can_signup?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="196">
            
            

            

            <code class="ruby">      %i[allowed needs_approval].include? Setting.user_signup</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="197">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="198">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="199">
            
            

            

            <code class="ruby">    # Overrides Devise sign-in to use either username or email (case-insensitive)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="200">
            
            

            

            <code class="ruby">    #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="201">
            
            

            

            <code class="ruby">    def find_for_database_authentication(warden_conditions)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="202">
            
            

            

            <code class="ruby">      conditions = warden_conditions.dup</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="203">
            
            

            

            <code class="ruby">      if login = conditions.delete(:email)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="204">
            
            

            

            <code class="ruby">        where(conditions.to_h).where([&quot;lower(username) = :value OR lower(email) = :value&quot;, { value: login.downcase }]).first</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="205">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="206">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="207">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="208">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="209">
            
            

            

            <code class="ruby">  ActiveSupport.run_load_hooks(:fat_free_crm_user, self)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="210">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="3caacf91941ed11988fdd4c4377e0cf9e8dcd161">
  <div class="header">
    <h3>lib/fat_free_crm.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>37</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>37</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">module FatFreeCRM</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">  class &lt;&lt; self</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">    # Return either Application or Engine,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">    # depending on how Fat Free CRM has been loaded</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">    def application</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">      engine? ? Engine : Application</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">    delegate :root, to: :application</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">    # Are we running as an engine?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">    def engine?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">      defined?(FatFreeCRM::Engine).present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            
            

            

            <code class="ruby">    def application?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            
            

            

            <code class="ruby">      !engine?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby"># Load Fat Free CRM as a Rails Engine, unless running as a Rails Application</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            
            

            

            <code class="ruby">require &#39;fat_free_crm/engine&#39; unless defined?(FatFreeCRM::Application)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            
            

            

            <code class="ruby">require &#39;fat_free_crm/load_settings&#39; # register load hook for Setting</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            
            

            

            <code class="ruby"># Require gem dependencies, monkey patches, and vendored plugins (in lib)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="36">
            
            

            

            <code class="ruby">require &quot;fat_free_crm/gem_dependencies&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="37">
            
            

            

            <code class="ruby">require &quot;fat_free_crm/gem_ext&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            
            

            

            <code class="ruby">require &quot;fat_free_crm/custom_fields&quot; # load hooks for Field</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            
            

            

            <code class="ruby">require &quot;fat_free_crm/version&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            
            

            

            <code class="ruby">require &quot;fat_free_crm/core_ext&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="42">
            
            

            

            <code class="ruby">require &quot;fat_free_crm/comment_extensions&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="43">
            
            

            

            <code class="ruby">require &quot;fat_free_crm/exceptions&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="44">
            
            

            

            <code class="ruby">require &quot;fat_free_crm/export_csv&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="45">
            
            

            

            <code class="ruby">require &quot;fat_free_crm/errors&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            
            

            

            <code class="ruby">require &quot;fat_free_crm/i18n&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="47">
            
            

            

            <code class="ruby">require &quot;fat_free_crm/permissions&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="48">
            
            

            

            <code class="ruby">require &quot;fat_free_crm/exportable&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="49">
            
            

            

            <code class="ruby">require &quot;fat_free_crm/renderers&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="50">
            
            

            

            <code class="ruby">require &quot;fat_free_crm/fields&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            
            

            

            <code class="ruby">require &quot;fat_free_crm/sortable&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="52">
            
            

            

            <code class="ruby">require &quot;fat_free_crm/tabs&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="53">
            
            

            

            <code class="ruby">require &quot;fat_free_crm/callback&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="54">
            
            

            

            <code class="ruby">require &quot;fat_free_crm/view_factory&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="56">
            
            

            

            <code class="ruby">require &quot;activemodel-serializers-xml&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="57">
            
            

            

            <code class="ruby">require &quot;country_select&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="58">
            
            

            

            <code class="ruby">require &quot;gravatar_image_tag&quot;</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="66aa9776f777a4cbda1adb9c6fa354907cdb15d0">
  <div class="header">
    <h3>lib/fat_free_crm/callback.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>83</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>83</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module FatFreeCRM</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  module Callback</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">    @@classes   = []  # Classes that inherit from FatFreeCRM::Callback::Base.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">    @@responder = {}  # Class instances that respond to (i.e. implement) hook methods.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">    # Also includes class instances that implement a</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">    # set of view hook operations (insert_after, replace, etc).</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">    # Adds a class inherited from from FatFreeCRM::Callback::Base.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">    #--------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">    def self.add(klass)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">      @@classes &lt;&lt; klass</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby">    #                     [Controller] and [Legacy View] Hooks</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby">    # -----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby">    # Finds class instance that responds to given method.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">    #------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            
            

            

            <code class="ruby">    def self.responder(method)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            
            

            

            <code class="ruby">      @@responder[method] ||= @@classes.map(&amp;:instance).select { |instance| instance.respond_to?(method) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby">    # Invokes the hook named :method and captures its output.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby">    #--------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            
            

            

            <code class="ruby">    def self.hook(method, caller, context = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            
            

            

            <code class="ruby">      str = &quot;&quot;.html_safe</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            
            

            

            <code class="ruby">      responder(method).map do |m|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            
            

            

            <code class="ruby">        str &lt;&lt; m.send(method, caller, context) if m.respond_to?(method)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="36">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="37">
            
            

            

            <code class="ruby">      str</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="38">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            
            

            

            <code class="ruby">    #                             [View] Hooks</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            
            

            

            <code class="ruby">    # -----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            
            

            

            <code class="ruby">    # Find class instances that contain operations for the given view hook.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            
            

            

            <code class="ruby">    #------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="45">
            
            

            

            <code class="ruby">    def self.view_responder(method)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            
            

            

            <code class="ruby">      @@responder[method] ||= @@classes.map(&amp;:instance).select { |instance| instance.class.view_hooks[method] }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="47">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            
            

            

            <code class="ruby">    # Invokes the view hook Proc stored under :hook and captures its output.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            
            

            

            <code class="ruby">    # =&gt; Instead of defining methods on the class, view hooks are</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            
            

            

            <code class="ruby">    #    stored as Procs in a hash. This allows the same hook to be manipulated in</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            
            

            

            <code class="ruby">    #    multiple ways from within a single Callback subclass.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            
            

            

            <code class="ruby">    # The hook returns:</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            
            

            

            <code class="ruby">    # - empty hash if no hook with this name was detected.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            
            

            

            <code class="ruby">    # - a hash of arrays containing Procs and positions to insert content.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            
            

            

            <code class="ruby">    #--------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="57">
            
            

            

            <code class="ruby">    def self.view_hook(hook, caller, context = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="58">
            
            

            

            <code class="ruby">      view_responder(hook).each_with_object(Hash.new([])) do |instance, response|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            
            

            

            <code class="ruby">        # Process each operation within each view hook, storing the data in a hash.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="60">
            
            

            

            <code class="ruby">        instance.class.view_hooks[hook].each do |op|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="61">
            
            

            

            <code class="ruby">          response[op[:position]] += [op[:proc].call(caller, context)]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="62">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="63">
            
            

            

            <code class="ruby">        response</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="64">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="65">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            
            

            

            <code class="ruby">    #--------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="68">
            
            

            

            <code class="ruby">    class Base</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="69">
            
            

            

            <code class="ruby">      include Singleton</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="70">
            
            

            

            <code class="ruby">      def self.inherited(child)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="71">
            
            

            

            <code class="ruby">        FatFreeCRM::Callback.add(child)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            
            

            

            <code class="ruby">        # Positioning hash to determine where content is placed.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="73">
            
            

            

            <code class="ruby">        child.class_eval do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="74">
            
            

            

            <code class="ruby">          @view_hooks = Hash.new([])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="75">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="76">
            
            

            

            <code class="ruby">        super</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="77">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="79">
            
            

            

            <code class="ruby">      class &lt;&lt; self</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="80">
            
            

            

            <code class="ruby">        attr_accessor :view_hooks</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="82">
            
            

            

            <code class="ruby">        def add_view_hook(hook, proc, position)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="83">
            
            

            

            <code class="ruby">          @view_hooks[hook] += [{ proc: proc,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="84">
            
            

            

            <code class="ruby">                                  position: position }]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="85">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="87">
            
            

            

            <code class="ruby">        def insert_before(hook, &amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="88">
            
            

            

            <code class="ruby">          add_view_hook(hook, block,        :before)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="89">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="91">
            
            

            

            <code class="ruby">        def insert_after(hook, &amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="92">
            
            

            

            <code class="ruby">          add_view_hook(hook, block,        :after)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="93">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="95">
            
            

            

            <code class="ruby">        def replace(hook, &amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="96">
            
            

            

            <code class="ruby">          add_view_hook(hook, block,        :replace)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="97">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="99">
            
            

            

            <code class="ruby">        def remove(hook)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="100">
            
            

            

            <code class="ruby">          add_view_hook(hook, proc { &quot;&quot; }, :replace)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="101">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="102">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="103">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            
            

            

            <code class="ruby">    # This makes it possible to call hook() without FatFreeCRM::Callback prefix.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            
            

            

            <code class="ruby">    # Returns stringified data when called from within templates, and the actual</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            
            

            

            <code class="ruby">    # data otherwise.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            
            

            

            <code class="ruby">    #--------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="109">
            
            

            

            <code class="ruby">    module Helper</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="110">
            
            

            

            <code class="ruby">      def hook(method, caller, context = {}, &amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            
            

            

            <code class="ruby">        # In a view template context, hooks are able to replace, append or prepend content.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="113">
            
            

            

            <code class="ruby">        if caller.is_a?(ActionView::Base)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="114">
            
            

            

            <code class="ruby">          hooks = FatFreeCRM::Callback.view_hook(method, caller, context)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            
            

            

            <code class="ruby">          # Add content to the view in the following order:</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            
            

            

            <code class="ruby">          # -- before</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            
            

            

            <code class="ruby">          # -- replace || original block</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            
            

            

            <code class="ruby">          # -- after</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="119">
            
            

            

            <code class="ruby">          view_data = &quot;&quot;.html_safe</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="120">
            
            

            

            <code class="ruby">          hooks[:before].each { |data| view_data &lt;&lt; data }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            
            

            

            <code class="ruby">          # Only render the original view block if there are no pending :replace operations</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="122">
            
            

            

            <code class="ruby">          if hooks[:replace].empty?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="123">
            
            

            

            <code class="ruby">            view_data &lt;&lt; if block_given?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="124">
            
            

            

            <code class="ruby">                           capture(&amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="125">
            
            

            

            <code class="ruby">                         else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            
            

            

            <code class="ruby">                           # legacy view hooks</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="127">
            
            

            

            <code class="ruby">                           FatFreeCRM::Callback.hook(method, caller, context)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="128">
            
            

            

            <code class="ruby">              end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="129">
            
            

            

            <code class="ruby">          else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="130">
            
            

            

            <code class="ruby">            hooks[:replace].each { |data| view_data &lt;&lt; data }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="131">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="132">
            
            

            

            <code class="ruby">          hooks[:after].each { |data| view_data &lt;&lt; data }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="134">
            
            

            

            <code class="ruby">          view_data</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="136">
            
            

            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            
            

            

            <code class="ruby">          # Hooks called without blocks are either controller or legacy view hooks</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="138">
            
            

            

            <code class="ruby">          FatFreeCRM::Callback.hook(method, caller, context)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="139">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="140">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="141">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="142">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="143">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="145">
            
            

            

            <code class="ruby">ActionView::Base.include FatFreeCRM::Callback::Helper</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="146">
            
            

            

            <code class="ruby">ActionController::Base.include FatFreeCRM::Callback::Helper</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="7beadb898c0fd7f17fe6541d40ca5fbb0143c3d1">
  <div class="header">
    <h3>lib/fat_free_crm/comment_extensions.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>18</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>18</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module FatFreeCRM</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  module CommentExtensions</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">    def self.included(base)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">      base.extend(ClassMethods)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">    module ClassMethods</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">      def uses_comment_extensions</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">        include FatFreeCRM::CommentExtensions::InstanceMethods unless included_modules.include?(InstanceMethods)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">    module InstanceMethods</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">      def add_comment_by_user(comment_body, user)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">        comments.create(comment: comment_body, user: user) if comment_body.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">ActiveRecord::Base.include FatFreeCRM::CommentExtensions</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="23538a0bb46d0666e3000c361b5c1b8342177832">
  <div class="header">
    <h3>lib/fat_free_crm/core_ext.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>1</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">Dir[File.dirname(__FILE__) + &quot;/core_ext/*.rb&quot;].sort.each { |file| require(file) }</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="9565eb831e551260a15b9522cba6326aa5aa48ea">
  <div class="header">
    <h3>lib/fat_free_crm/core_ext/alias_method_chain.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>18</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>18</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="3">
            
            

            

            <code class="ruby">class Module</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="4">
            
            

            

            <code class="ruby">  def alias_method_chain(target, feature)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby">    # Strip out punctuation on predicates, bang or writer methods since</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby">    # e.g. target?_without_feature is not a valid method name.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="7">
            
            

            

            <code class="ruby">    aliased_target = target.to_s.sub(/([?!=])$/, &#39;&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">    punctuation = Regexp.last_match(1)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">    yield(aliased_target, punctuation) if block_given?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">    with_method = &quot;#{aliased_target}_with_#{feature}#{punctuation}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">    without_method = &quot;#{aliased_target}_without_#{feature}#{punctuation}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">    alias_method without_method, target</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">    alias_method target, with_method</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">    if public_method_defined?(without_method)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">      public target</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">    elsif protected_method_defined?(without_method)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">      protected target</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">    elsif private_method_defined?(without_method)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">      private target</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="eabfe41b758964aa346c457317b1a0e048448fdb">
  <div class="header">
    <h3>lib/fat_free_crm/core_ext/nil.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>8</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>8</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">class NilClass</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  def true?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">    false</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">  def false?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">    false</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="95af1b965979017afaa8d781e4a48bc5d88d0ddd">
  <div class="header">
    <h3>lib/fat_free_crm/core_ext/string.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>31</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>31</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">class String</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  alias - delete</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">  def n2br</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">    strip.gsub(&quot;\n&quot;, &quot;&lt;br /&gt;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">  def wrap(prefix, suffix = prefix)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">    prefix + self + suffix</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">  def digitize</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">    gsub(/[^\d]/, &quot;&quot;) # &quot;$100,000&quot;.digitize # =&gt; 100000</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">  def to_url</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            
            

            

            <code class="ruby">    match?(%r{^https?://}) ? self : &quot;http://#{self}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            
            

            

            <code class="ruby">  def true?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">    self == &quot;true&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            
            

            

            <code class="ruby">  def false?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            
            

            

            <code class="ruby">    self == &quot;false&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            
            

            

            <code class="ruby">  # Generates all permutations for first and last name, based on the order of parts</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            
            

            

            <code class="ruby">  # A query with 4 words will generate 6 permutations</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="37">
            
            

            

            <code class="ruby">  def name_permutations</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="38">
            
            

            

            <code class="ruby">    parts = split(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            
            

            

            <code class="ruby">    Array.new((parts.size - 1)) do |i|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            
            

            

            <code class="ruby">      # [&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;]  =&gt;  [[&quot;A B C&quot;, &quot;D&quot;], [&quot;A B&quot;, &quot;C D&quot;], [&quot;A&quot;, &quot;B C D&quot;]]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            
            

            

            <code class="ruby">      [parts[(0..i)].join(&quot; &quot;), parts[(i + 1)..-1].join(&quot; &quot;)]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="42">
            
            

            

            <code class="ruby">    end.each_with_object([]) do |perm, arr|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            
            

            

            <code class="ruby">      # Search both [first, last] and [last, first]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            
            

            

            <code class="ruby">      # e.g. for every [&quot;A B C&quot;, &quot;D&quot;], also include [&quot;D&quot;, &quot;A B C&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="45">
            
            

            

            <code class="ruby">      arr &lt;&lt; perm</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            
            

            

            <code class="ruby">      arr &lt;&lt; perm.reverse</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="47">
            
            

            

            <code class="ruby">      arr</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="48">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="49">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="50">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="bd4c731b7c154a70f8c7630cf3729ca08c967a6d">
  <div class="header">
    <h3>lib/fat_free_crm/custom_fields.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>4</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"># Register CustomFields when Field class is loaded</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">ActiveSupport.on_load(:fat_free_crm_field) do # self == Field</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">  register(as: &#39;date_pair&#39;, klass: &#39;CustomFieldDatePair&#39;, type: &#39;date&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">  register(as: &#39;datetime_pair&#39;, klass: &#39;CustomFieldDatetimePair&#39;, type: &#39;timestamp&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="bf15d31f2eaba8e56b5e13fa7f2482599b624b48">
  <div class="header">
    <h3>lib/fat_free_crm/engine.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>23</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>23</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module FatFreeCRM</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  class Engine &lt; ::Rails::Engine</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">    config.autoload_paths += Dir[root.join(&quot;app/models/**&quot;)] +</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">                             Dir[root.join(&quot;app/controllers/entities&quot;)]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">    config.active_record.observers = %i[lead_observer opportunity_observer</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">                                        task_observer entity_observer]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">    initializer &quot;model_core.factories&quot;, after: &quot;factory_bot.set_factory_paths&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">      FactoryBot.definition_file_paths &lt;&lt; File.expand_path(&#39;../../spec/factories&#39;, __dir__) if defined?(FactoryBot)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">    initializer :append_migrations do |app|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">      unless app.root.to_s == root.to_s</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">        config.paths[&quot;db/migrate&quot;].expanded.each do |expanded_path|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">          app.config.paths[&quot;db/migrate&quot;] &lt;&lt; expanded_path</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">    config.to_prepare do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            
            

            

            <code class="ruby">      Dir.glob(Rails.root + &quot;app/decorators/**/*_decorator*.rb&quot;).each do |c|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            
            

            

            <code class="ruby">        require_dependency(c)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="0542703a1a97575dc6845405325e6485a8030181">
  <div class="header">
    <h3>lib/fat_free_crm/errors.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>15</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>15</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module FatFreeCRM</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  module ActiveModel</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">    module Errors</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">      # Override ActiveModel::Errors#each so we could display validation</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">      # errors as is without rendering the attribute name. Simply place</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">      # a caret as the first character of the error message.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">      #</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">      # This feature was handled by &#39;advanced_errors&#39; plugin in Rails 2.x</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">      # version of Fat Free CRM.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">      #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">      def self.included(base)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">        base.class_eval do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">          alias_method :each, :each_with_explicit_error</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            
            

            

            <code class="ruby">      def each_with_explicit_error(&amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            
            

            

            <code class="ruby">        @errors.each(&amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            
            

            

            <code class="ruby">ActiveModel::Errors.include FatFreeCRM::ActiveModel::Errors</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="df721cab87c653d1cb79ccf5f81ce55e1ec3c522">
  <div class="header">
    <h3>lib/fat_free_crm/exceptions.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>13</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>13</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module FatFreeCRM</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  class MissingSettings &lt; StandardError; end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">  class ObsoleteSettings &lt; StandardError; end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">class ActionController::Base</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">  rescue_from FatFreeCRM::MissingSettings,  with: :render_fat_free_crm_exception</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">  rescue_from FatFreeCRM::ObsoleteSettings, with: :render_fat_free_crm_exception</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">  def render_fat_free_crm_exception(exception)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">    logger.error exception.inspect</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">    render layout: false, template: &quot;/layouts/500&quot;, format: :html, status: 500, locals: { exception: exception }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="9ad0382c18bbe1348e24a2b869af30d4b8ef9454">
  <div class="header">
    <h3>lib/fat_free_crm/export_csv.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>23</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>23</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">require &quot;csv&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">module FatFreeCRM</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">  class ExportCSV</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">    # CSV export. Based on to_csv Rails plugin by Ary Djmal</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">    # https://github.com/arydjmal/to_csv</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">    #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">    def self.from_array(items = [])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">      return &#39;&#39; if items.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">      # Infer column types from the first item in the array</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">      klass = items.first.class</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">      columns = klass.columns.map(&amp;:name).reject { |column| column =~ /password|token/ }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">      columns &lt;&lt; &#39;tags&#39; if klass.taggable?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">      CSV.generate do |csv|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">        csv &lt;&lt; columns.map { |column| klass.human_attribute_name(column) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            
            

            

            <code class="ruby">        items.each do |item|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            
            

            

            <code class="ruby">          csv &lt;&lt; columns.map do |column|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            
            

            

            <code class="ruby">            if column == &#39;tags&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            
            

            

            <code class="ruby">              item.tags.join(&#39; &#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">            else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            
            

            

            <code class="ruby">              item.send(column)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            
            

            

            <code class="ruby">            end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="36">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="9b9cfe0fb6583f8f1b68d605a80e76b50c522750">
  <div class="header">
    <h3>lib/fat_free_crm/exportable.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>38</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>38</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module FatFreeCRM</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  module Exportable</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">    def self.included(base)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">      base.extend(ClassMethods)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">    module ClassMethods</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">      def exportable(_options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">        unless included_modules.include?(InstanceMethods)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">          include InstanceMethods</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">          extend SingletonMethods</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">    module InstanceMethods</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            
            

            

            <code class="ruby">      def user_id_full_name</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            
            

            

            <code class="ruby">        user = self.user</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            
            

            

            <code class="ruby">        user ? user.full_name : &#39;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            
            

            

            <code class="ruby">      def self.included(base)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            
            

            

            <code class="ruby">        if base.instance_methods.include?(:assignee) || base.instance_methods.include?(&#39;assignee&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            
            

            

            <code class="ruby">          define_method :assigned_to_full_name do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            
            

            

            <code class="ruby">            user = assignee</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            
            

            

            <code class="ruby">            user ? user.full_name : &#39;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="37">
            
            

            

            <code class="ruby">        if base.instance_methods.include?(:completor) || base.instance_methods.include?(&#39;completor&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="38">
            
            

            

            <code class="ruby">          define_method :completed_by_full_name do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            
            

            

            <code class="ruby">            user = completor</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            
            

            

            <code class="ruby">            user ? user.full_name : &#39;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="42">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="43">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="44">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            
            

            

            <code class="ruby">    module SingletonMethods</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="47">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="48">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="49">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            
            

            

            <code class="ruby">ActiveRecord::Base.include FatFreeCRM::Exportable</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="50c1a49de6a132aa0097d700103676abe61e70e5">
  <div class="header">
    <h3>lib/fat_free_crm/fields.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>67</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>67</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module FatFreeCRM</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  module Fields</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">    def self.included(base)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">      base.extend(ClassMethods)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">    module ClassMethods</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">      def has_fields</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">        unless included_modules.include?(InstanceMethods)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">          extend SingletonMethods</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">          include InstanceMethods</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">          serialize_custom_fields!</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">          validate :custom_fields_validator</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            
            

            

            <code class="ruby">    module SingletonMethods</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            
            

            

            <code class="ruby">      def field_groups</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby">        # catches cases where this code runs before database has been created or migrated</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">        FieldGroup.where(klass_name: name).order(:position)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            
            

            

            <code class="ruby">      rescue ActiveRecord::NoDatabaseError, ActiveRecord::StatementInvalid</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            
            

            

            <code class="ruby">        []</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            
            

            

            <code class="ruby">      def fields</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            
            

            

            <code class="ruby">        field_groups.map(&amp;:fields).flatten</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="37">
            
            

            

            <code class="ruby">      def serialize_custom_fields!</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="38">
            
            

            

            <code class="ruby">        fields.each do |field|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            
            

            

            <code class="ruby">          serialize(field.name.to_sym, Array) if field.as == &#39;check_boxes&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            
            

            

            <code class="ruby">      # Shows custom field select options in ransack search form</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="44">
            
            

            

            <code class="ruby">      def ransack_column_select_options</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="45">
            
            

            

            <code class="ruby">        field_groups.each_with_object({}) do |group, hash|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            
            

            

            <code class="ruby">          group.fields.select { |f| f.collection.present? }.each do |field|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="47">
            
            

            

            <code class="ruby">            hash[field.name] = field.collection.each_with_object({}) do |option, options|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="48">
            
            

            

            <code class="ruby">              options[option] = option</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="49">
            
            

            

            <code class="ruby">            end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="50">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="52">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="53">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="55">
            
            

            

            <code class="ruby">    module InstanceMethods</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="56">
            
            

            

            <code class="ruby">      def field_groups</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="57">
            
            

            

            <code class="ruby">        field_groups = self.class.field_groups</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="58">
            
            

            

            <code class="ruby">        respond_to?(:tag_ids) ? field_groups.with_tags(tag_ids) : field_groups</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="59">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            
            

            

            <code class="ruby">      # run custom field validations on this object</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            
            

            

            <code class="ruby">      #------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="63">
            
            

            

            <code class="ruby">      def custom_fields_validator</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="64">
            
            

            

            <code class="ruby">        field_groups.map(&amp;:fields).flatten.each { |f| f.custom_validator(self) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="65">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="67">
            
            

            

            <code class="ruby">      def assign_attributes(new_attributes)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="68">
            
            

            

            <code class="ruby">        super</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            
            

            

            <code class="ruby">      # If attribute is unknown, a new custom field may have been added.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            
            

            

            <code class="ruby">      # Refresh columns and try again.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="71">
            
            

            

            <code class="ruby">      rescue ActiveRecord::UnknownAttributeError</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="72">
            
            

            

            <code class="ruby">        self.class.reset_column_information</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="73">
            
            

            

            <code class="ruby">        super</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="74">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="76">
            
            

            

            <code class="ruby">      def method_missing(method_id, *args, &amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="77">
            
            

            

            <code class="ruby">        if method_id.to_s.match?(/\Acf_.*[^=]\Z/)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            
            

            

            <code class="ruby">          # Refresh columns and try again.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="79">
            
            

            

            <code class="ruby">          self.class.reset_column_information</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            
            

            

            <code class="ruby">          # If new record, create new object from class, else reload class</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="81">
            
            

            

            <code class="ruby">          object = new_record? ? self.class.new : (reload &amp;&amp; self)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            
            

            

            <code class="ruby">          # ensure serialization is setup if needed</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="83">
            
            

            

            <code class="ruby">          self.class.serialize_custom_fields!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            
            

            

            <code class="ruby">          # Try again if object now responds to method, else return nil</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="85">
            
            

            

            <code class="ruby">          object.respond_to?(method_id) ? object.send(method_id, *args) : nil</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="86">
            
            

            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="87">
            
            

            

            <code class="ruby">          super</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="88">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="89">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="90">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="91">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="92">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="94">
            
            

            

            <code class="ruby">ActiveRecord::Base.include FatFreeCRM::Fields</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="36f4686c647fb03c839a62065a68d6b854a65286">
  <div class="header">
    <h3>lib/fat_free_crm/gem_dependencies.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>32</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>32</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">require &#39;rails/all&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">require &#39;rails-observers&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">require &#39;responders&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">require &#39;jquery-rails&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">require &#39;jquery-migrate-rails&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">require &#39;jquery-ui-rails&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">require &#39;select2-rails&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">require &#39;haml&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">require &#39;sass&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">require &#39;acts_as_commentable&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">require &#39;acts_as_list&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">require &#39;acts-as-taggable-on&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">require &#39;responds_to_parent&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">require &#39;dynamic_form&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">require &#39;simple_form&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">require &#39;will_paginate&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            
            

            

            <code class="ruby">require &#39;devise&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            
            

            

            <code class="ruby">require &#39;ransack&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            
            

            

            <code class="ruby">require &#39;ransack_ui&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            
            

            

            <code class="ruby">require &#39;paper_trail&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">require &#39;cancan&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            
            

            

            <code class="ruby">require &#39;rails3-jquery-autocomplete&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            
            

            

            <code class="ruby">require &#39;ffaker&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            
            

            

            <code class="ruby">require &#39;premailer&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            
            

            

            <code class="ruby">require &#39;nokogiri&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            
            

            

            <code class="ruby">require &#39;font-awesome-rails&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            
            

            

            <code class="ruby">require &#39;thor&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            
            

            

            <code class="ruby">require &#39;rails_autolink&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            
            

            

            <code class="ruby"># Load redcloth if available (for textile markup in emails)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="38">
            
            

            

            <code class="ruby">begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            
            

            

            <code class="ruby">  require &#39;redcloth&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            
            

            

            <code class="ruby">rescue LoadError</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="6bab3c2fed05643752635b4246c2f3be8b015ba7">
  <div class="header">
    <h3>lib/fat_free_crm/gem_ext.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>3</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">require &quot;fat_free_crm/gem_ext/active_support/buffered_logger&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">require &quot;fat_free_crm/gem_ext/action_controller/base&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">require &quot;fat_free_crm/gem_ext/rake/task&quot; if defined?(Rake)</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="abd7e18c9e9262b070bd907eca20b2d8d3568f23">
  <div class="header">
    <h3>lib/fat_free_crm/gem_ext/action_controller/base.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>7</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>7</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">unless Rails.env.test?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  class ActionController::Base</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby">    # Remove helpers residing in subdirectories from the list of application</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">    # helpers.  Basically we don&#39;t want helpers in app/helpers/admin/* to</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">    # override the ones in app/helpers/*.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">    #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">    def self.all_application_helpers</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">      super.delete_if { |helper| helper.include?(File::SEPARATOR) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="0505a8eb292ed1925cea6eb4bf691726f4fc0469">
  <div class="header">
    <h3>lib/fat_free_crm/gem_ext/active_support/buffered_logger.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>10</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>10</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">class ActiveSupport::BufferedLogger</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  BRIGHT = &quot;\033[1;37;40m&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">  NORMAL = &quot;\033[0m&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">  def p(*args)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">    info &quot;#{BRIGHT}\n\n#{args.join(&#39; &#39;)}#{NORMAL}\n\n\n&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">  def i(*args)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">    info &quot;#{BRIGHT}\n\n#{args.map(&amp;:inspect).join(&#39; &#39;)}#{NORMAL}\n\n\n&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="0b832f4045d41d7cc62cc3b48f42d8f721527457">
  <div class="header">
    <h3>lib/fat_free_crm/gem_ext/rails/engine.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>8</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>8</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby"># Override engine views so that plugin views have higher priority.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">Rails::Engine.initializers.detect { |i| i.name == :add_view_paths }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">             .instance_variable_set(&quot;@block&quot;, proc do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">                                                views = paths[&quot;app/views&quot;].to_a</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">                                                unless views.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">                                                  ActiveSupport.on_load(:action_controller) { append_view_path(views) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">                                                  ActiveSupport.on_load(:action_mailer) { append_view_path(views) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">                                                end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">                                              end)</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="7add5f39b722a45897a49982a5af878689281768">
  <div class="header">
    <h3>lib/fat_free_crm/gem_ext/rake/task.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>8</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>8</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">require &#39;rake/task&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">module Rake</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">  Task.class_eval do</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">    # Removes a Rake task</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">    def self.remove(task_name)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">      Rake.application.instance_variable_get(&#39;@tasks&#39;).delete(task_name.to_s)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="f21d226db5895b026180a2823d8437ba9103aee2">
  <div class="header">
    <h3>lib/fat_free_crm/i18n.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>24</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>24</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">require &#39;pathname&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">module FatFreeCRM</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">  module I18n</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">    #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">    def t(*args)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">      if args.size == 1</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">        super(args.first, default: args.first.to_s)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">      elsif args.second.is_a?(Hash)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">        super(args.first, **args.second)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">      elsif args.second.is_a?(Integer)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">        super(args.first, count: args.second)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">        super(args.first, value: args.second)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">    # Scan config/locales directory for Fat Free CRM localization files</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby">    # (i.e. *_fat_free_crm.yml) and return locale part of the file name.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby">    # We can&#39;t use ::I18n.available_locales because rails provides it&#39;s own</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby">    # translations too and we only want the locales that Fat Free CRM supports.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby">    #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            
            

            

            <code class="ruby">    def locales</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            
            

            

            <code class="ruby">      @@locales ||= ::I18n.load_path.grep(/_fat_free_crm\.yml$/).map { |path| Pathname.new(path).basename.to_s.match(/(.*)_fat_free_crm\.yml/)[1] }.uniq</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            
            

            

            <code class="ruby">    # Return a hash where the key is locale name, and the value is language name</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            
            

            

            <code class="ruby">    # as defined in the locale_fat_free_crm.yml file.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            
            

            

            <code class="ruby">    #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="37">
            
            

            

            <code class="ruby">    def languages</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="38">
            
            

            

            <code class="ruby">      @@languages ||= Hash[locales.map { |locale| [locale, t(:language, locale: locale)] }]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="43">
            
            

            

            <code class="ruby">ActionView::Base.include FatFreeCRM::I18n</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="44">
            
            

            

            <code class="ruby">ActionController::Base.include FatFreeCRM::I18n</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="482760fcdb86187e2b5c6b52c2d0acc7f040ea86">
  <div class="header">
    <h3>lib/fat_free_crm/load_settings.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>7</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>7</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"># Register and call when Setting class is loaded</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby"># Load settings.default.yml</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby"># Then override with settings.yml</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby"># Don&#39;t override default settings in test environment</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">ActiveSupport.on_load(:fat_free_crm_setting) do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">  setting_files = [FatFreeCRM.root.join(&quot;config&quot;, &quot;settings.default.yml&quot;)]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">  setting_files &lt;&lt; Rails.root.join(&quot;config&quot;, &quot;settings.yml&quot;) unless Rails.env == &#39;test&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">  setting_files.each do |settings_file|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">    Setting.load_settings_from_yaml(settings_file) if File.exist?(settings_file)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="b7c78b9b641a30d2008fbcf801789a4d1afff272">
  <div class="header">
    <h3>lib/fat_free_crm/mail_processor/base.rb</h3>
    <h4>
      <span class="red">
  73.91%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>115</b> relevant lines.
      <span class="green"><b>85</b> lines covered</span> and
      <span class="red"><b>30</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            <span class="hits">1</span>
            

            

            <code class="ruby">require &#39;net/imap&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            <span class="hits">1</span>
            

            

            <code class="ruby">require &#39;mail&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            <span class="hits">1</span>
            

            

            <code class="ruby">require &#39;email_reply_parser&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="11">
            <span class="hits">1</span>
            

            

            <code class="ruby">require &#39;premailer&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            <span class="hits">1</span>
            

            

            <code class="ruby">require &#39;nokogiri&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="14">
            <span class="hits">1</span>
            

            

            <code class="ruby">module FatFreeCRM</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="15">
            <span class="hits">1</span>
            

            

            <code class="ruby">  module MailProcessor</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            <span class="hits">1</span>
            

            

            <code class="ruby">    class Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="17">
            <span class="hits">1</span>
            

            

            <code class="ruby">      KEYWORDS = %w[account campaign contact lead opportunity].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">      #--------------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="20">
            <span class="hits">1</span>
            

            

            <code class="ruby">      def initialize</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="43" data-linenumber="21">
            <span class="hits">43</span>
            

            

            <code class="ruby">        @archived = 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="43" data-linenumber="22">
            <span class="hits">43</span>
            

            

            <code class="ruby">        @discarded = 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="43" data-linenumber="23">
            <span class="hits">43</span>
            

            

            <code class="ruby">        @dry_run = false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby">      # Setup imap folders in settings.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby">      #--------------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="28">
            <span class="hits">1</span>
            

            

            <code class="ruby">      def setup</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            
            

            

            <code class="ruby">        log &quot;connecting to #{@settings[:server]}...&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            
            

            

            <code class="ruby">        connect!(setup: true) || (return nil)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            
            

            

            <code class="ruby">        log &quot;logged in to #{@settings[:server]}, checking folders...&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            
            

            

            <code class="ruby">        folders = [@settings[:scan_folder]]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            
            

            

            <code class="ruby">        folders &lt;&lt; @settings[:move_to_folder] unless @settings[:move_to_folder].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            
            

            

            <code class="ruby">        folders &lt;&lt; @settings[:move_invalid_to_folder] unless @settings[:move_invalid_to_folder].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            
            

            

            <code class="ruby">        # Open (or create) destination folder in read-write mode.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="37">
            
            

            

            <code class="ruby">        folders.each do |folder|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="38">
            
            

            

            <code class="ruby">          if @imap.list(&quot;&quot;, folder)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            
            

            

            <code class="ruby">            log &quot;folder #{folder} OK&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            
            

            

            <code class="ruby">          else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            
            

            

            <code class="ruby">            log &quot;folder #{folder} missing, creating...&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="42">
            
            

            

            <code class="ruby">            @imap.create(folder)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            
            

            

            <code class="ruby">      rescue Exception =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            
            

            

            <code class="ruby">        warn &quot;setup error #{e.inspect}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            
            

            

            <code class="ruby">      ensure</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="48">
            
            

            

            <code class="ruby">        disconnect!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            
            

            

            <code class="ruby">      #--------------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="52">
            <span class="hits">1</span>
            

            

            <code class="ruby">      def run(dry_run = false)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="53">
            <span class="hits">21</span>
            

            

            <code class="ruby">        log &quot;Not discarding or archiving any new messages...&quot; if @dry_run = dry_run</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="54">
            <span class="hits">21</span>
            

            

            <code class="ruby">        connect! || (return nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="55">
            <span class="hits">21</span>
            

            

            <code class="ruby">        with_new_emails do |uid, email|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            
            

            

            <code class="ruby">          # Subclasses must define a #process method that takes arguments: uid, email</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="57">
            <span class="hits">19</span>
            

            

            <code class="ruby">          process(uid, email)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="58">
            <span class="hits">19</span>
            

            

            <code class="ruby">          archive(uid)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            
            

            

            <code class="ruby">      ensure</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="61">
            <span class="hits">21</span>
            

            

            <code class="ruby">        log &quot;messages processed=#{@archived + @discarded} archived=#{@archived} discarded=#{@discarded}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="62">
            <span class="hits">21</span>
            

            

            <code class="ruby">        disconnect!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="65">
            <span class="hits">1</span>
            

            

            <code class="ruby">      private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            
            

            

            <code class="ruby">      # Connects to the imap server with the loaded settings</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            
            

            

            <code class="ruby">      #------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="69">
            <span class="hits">1</span>
            

            

            <code class="ruby">      def connect!(options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="70">
            <span class="hits">29</span>
            

            

            <code class="ruby">        log &quot;connecting &amp; logging in to #{@settings[:server]}...&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="71">
            <span class="hits">29</span>
            

            

            <code class="ruby">        @imap = Net::IMAP.new(@settings[:server], @settings[:port], @settings[:ssl])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="72">
            <span class="hits">28</span>
            

            

            <code class="ruby">        @imap.login(@settings[:user], @settings[:password])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="73">
            <span class="hits">28</span>
            

            

            <code class="ruby">        log &quot;logged in to #{@settings[:server]}, checking folders...&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="74">
            <span class="hits">28</span>
            

            

            <code class="ruby">        @imap.select(@settings[:scan_folder]) unless options[:setup]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="75">
            <span class="hits">28</span>
            

            

            <code class="ruby">        @imap</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            
            

            

            <code class="ruby">      rescue Exception =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="77">
            <span class="hits">1</span>
            

            

            <code class="ruby">        warn &quot;Could not login to the IMAP server: #{e.inspect}&quot; unless Rails.env == &quot;test&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="78">
            <span class="hits">1</span>
            

            

            <code class="ruby">        nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            
            

            

            <code class="ruby">      #------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="82">
            <span class="hits">1</span>
            

            

            <code class="ruby">      def disconnect!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="83">
            <span class="hits">22</span>
            

            

            <code class="ruby">        if @imap</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="84">
            <span class="hits">22</span>
            

            

            <code class="ruby">          @imap.logout</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="85">
            <span class="hits">22</span>
            

            

            <code class="ruby">          unless @imap.disconnected?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            
            

            

            <code class="ruby">            begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="87">
            <span class="hits">22</span>
            

            

            <code class="ruby">              @imap.disconnect</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            
            

            

            <code class="ruby">            rescue Exception</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="89">
            
            

            

            <code class="ruby">              nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            
            

            

            <code class="ruby">            end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            
            

            

            <code class="ruby">      #--------------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="96">
            <span class="hits">1</span>
            

            

            <code class="ruby">      def with_new_emails</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="97">
            <span class="hits">21</span>
            

            

            <code class="ruby">        @imap.uid_search(%w[NOT SEEN]).each do |uid|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            
            

            

            <code class="ruby">          begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="99">
            <span class="hits">21</span>
            

            

            <code class="ruby">            email = Mail.new(@imap.uid_fetch(uid, &#39;RFC822&#39;).first.attr[&#39;RFC822&#39;])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="100">
            <span class="hits">21</span>
            

            

            <code class="ruby">            log &quot;fetched new message...&quot;, email</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="101">
            <span class="hits">21</span>
            

            

            <code class="ruby">            if is_valid?(email) &amp;&amp; sent_from_known_user?(email)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="102">
            <span class="hits">19</span>
            

            

            <code class="ruby">              yield(uid, email)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            
            

            

            <code class="ruby">            else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="104">
            <span class="hits">2</span>
            

            

            <code class="ruby">              discard(uid)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            
            

            

            <code class="ruby">            end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            
            

            

            <code class="ruby">          rescue Exception =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="107">
            
            

            

            <code class="ruby">            if %w[test development].include?(Rails.env)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="108">
            
            

            

            <code class="ruby">              warn e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="109">
            
            

            

            <code class="ruby">              warn e.backtrace</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            
            

            

            <code class="ruby">            end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="111">
            
            

            

            <code class="ruby">            log &quot;error processing email: #{e.inspect}&quot;, email</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="112">
            
            

            

            <code class="ruby">            discard(uid)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="115">
            <span class="hits">21</span>
            

            

            <code class="ruby">          if @dry_run</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="116">
            
            

            

            <code class="ruby">            log &quot;Marking message as unread&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="117">
            
            

            

            <code class="ruby">            @imap.uid_store(uid, &quot;-FLAGS&quot;, [:Seen])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            
            

            

            <code class="ruby">      # Discard message (not valid) action based on settings</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            
            

            

            <code class="ruby">      #------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="124">
            <span class="hits">1</span>
            

            

            <code class="ruby">      def discard(uid)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="125">
            <span class="hits">2</span>
            

            

            <code class="ruby">        if @dry_run</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="126">
            
            

            

            <code class="ruby">          log &quot;Not discarding message&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            
            

            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="128">
            <span class="hits">2</span>
            

            

            <code class="ruby">          @imap.uid_copy(uid, @settings[:move_invalid_to_folder]) if @settings[:move_invalid_to_folder]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="129">
            <span class="hits">2</span>
            

            

            <code class="ruby">          @imap.uid_store(uid, &quot;+FLAGS&quot;, [:Deleted])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="131">
            <span class="hits">2</span>
            

            

            <code class="ruby">        @discarded += 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            
            

            

            <code class="ruby">      # Archive message (valid) action based on settings</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            
            

            

            <code class="ruby">      #------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="136">
            <span class="hits">1</span>
            

            

            <code class="ruby">      def archive(uid)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="137">
            <span class="hits">6</span>
            

            

            <code class="ruby">        if @dry_run</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="138">
            
            

            

            <code class="ruby">          log &quot;Not archiving message&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            
            

            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="140">
            <span class="hits">6</span>
            

            

            <code class="ruby">          @imap.uid_copy(uid, @settings[:move_to_folder]) if @settings[:move_to_folder]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="141">
            <span class="hits">6</span>
            

            

            <code class="ruby">          @imap.uid_store(uid, &quot;+FLAGS&quot;, [:Seen])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="143">
            <span class="hits">6</span>
            

            

            <code class="ruby">        @archived += 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            
            

            

            <code class="ruby">      #------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="147">
            <span class="hits">1</span>
            

            

            <code class="ruby">      def is_valid?(email)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="148">
            <span class="hits">21</span>
            

            

            <code class="ruby">        valid = email.content_type != &quot;text/html&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="149">
            <span class="hits">21</span>
            

            

            <code class="ruby">        log(&quot;not a text message, discarding&quot;) unless valid</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="150">
            <span class="hits">21</span>
            

            

            <code class="ruby">        valid</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            
            

            

            <code class="ruby">      #------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="154">
            <span class="hits">1</span>
            

            

            <code class="ruby">      def sent_from_known_user?(email)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="155">
            <span class="hits">23</span>
            

            

            <code class="ruby">        email_address = email.from.first</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="156">
            <span class="hits">23</span>
            

            

            <code class="ruby">        known = !find_sender(email_address).nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="157">
            <span class="hits">23</span>
            

            

            <code class="ruby">        log(&quot;sent by unknown user #{email_address}, discarding&quot;) unless known</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="158">
            <span class="hits">23</span>
            

            

            <code class="ruby">        known</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="161">
            
            

            

            <code class="ruby">      #------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="162">
            <span class="hits">1</span>
            

            

            <code class="ruby">      def find_sender(email_address)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="163">
            <span class="hits">23</span>
            

            

            <code class="ruby">        if @sender = User.find_by(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            
            

            

            <code class="ruby">          &#39;(lower(email) = :email OR lower(alt_email) = :email) AND suspended_at IS NULL&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="165">
            
            

            

            <code class="ruby">          email: email_address.downcase</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="166">
            
            

            

            <code class="ruby">        )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="167">
            
            

            

            <code class="ruby">          # Set the PaperTrail user for versions (if user is found)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="168">
            <span class="hits">20</span>
            

            

            <code class="ruby">          PaperTrail.request.whodunnit = @sender.id.to_s</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="169">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            
            

            

            <code class="ruby">      #--------------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="173">
            <span class="hits">1</span>
            

            

            <code class="ruby">      def sender_has_permissions_for?(asset)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="174">
            <span class="hits">10</span>
            

            

            <code class="ruby">        return true if asset.access == &quot;Public&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="175">
            
            

            

            <code class="ruby">        return true if asset.user_id == @sender.id || asset.assigned_to == @sender.id</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="176">
            
            

            

            <code class="ruby">        return true if asset.access == &quot;Shared&quot; &amp;&amp; Permission.exists(&#39;user_id = ? AND asset_id = ? AND asset_type = ?&#39;, @sender.id, asset.id, asset.class.to_s)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="177">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="178">
            
            

            

            <code class="ruby">        false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="179">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="181">
            
            

            

            <code class="ruby">      # Centralized logging.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="182">
            
            

            

            <code class="ruby">      #--------------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="183">
            <span class="hits">1</span>
            

            

            <code class="ruby">      def log(message, email = nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="110" data-linenumber="184">
            <span class="hits">110</span>
            

            

            <code class="ruby">        unless %w[test cucumber].include?(Rails.env)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="185">
            
            

            

            <code class="ruby">          klass = self.class.to_s.split(&quot;::&quot;).last</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="186">
            
            

            

            <code class="ruby">          klass &lt;&lt; &quot; [Dry Run]&quot; if @dry_run</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="187">
            
            

            

            <code class="ruby">          puts &quot;[#{Time.now.rfc822}] #{klass}: #{message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="188">
            
            

            

            <code class="ruby">          puts &quot;[#{Time.now.rfc822}] #{klass}: From: #{email.from}, Subject: #{email.subject} (#{email.message_id})&quot; if email</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="189">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="190">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="191">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="192">
            
            

            

            <code class="ruby">      # Returns the plain-text version of an email, or strips html tags</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="193">
            
            

            

            <code class="ruby">      # if only html is present.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="194">
            
            

            

            <code class="ruby">      #--------------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="195">
            <span class="hits">1</span>
            

            

            <code class="ruby">      def plain_text_body(email)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="196">
            
            

            

            <code class="ruby">        # Extract all parts including nested</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="47" data-linenumber="197">
            <span class="hits">47</span>
            

            

            <code class="ruby">        parts = if email.multipart?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="198">
            <span class="hits">3</span>
            

            

            <code class="ruby">                  email.parts.map { |p| p.multipart? ? p.parts : p }.flatten</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="199">
            
            

            

            <code class="ruby">                else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="46" data-linenumber="200">
            <span class="hits">46</span>
            

            

            <code class="ruby">                  charset = email.charset</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="46" data-linenumber="201">
            <span class="hits">46</span>
            

            

            <code class="ruby">                  [email]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="202">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="203">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="95" data-linenumber="204">
            <span class="hits">95</span>
            

            

            <code class="ruby">        if text_part = parts.detect { |p| p.content_type.include?(&#39;text/plain&#39;) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="45" data-linenumber="205">
            <span class="hits">45</span>
            

            

            <code class="ruby">          text_body = text_part.body.to_s</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="45" data-linenumber="206">
            <span class="hits">45</span>
            

            

            <code class="ruby">          charset = text_part.charset if email.multipart?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="207">
            
            

            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="208">
            <span class="hits">4</span>
            

            

            <code class="ruby">          html_part = parts.detect { |p| p.content_type.include?(&#39;text/html&#39;) } || email</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="209">
            <span class="hits">2</span>
            

            

            <code class="ruby">          text_body = Premailer.new(html_part.body.to_s, with_html_string: true).to_plain_text</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="210">
            <span class="hits">2</span>
            

            

            <code class="ruby">          charset = html_part.charset if email.multipart?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="211">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="212">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="213">
            
            

            

            <code class="ruby">        # Convert to UTF8 and standardize newline</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="47" data-linenumber="214">
            <span class="hits">47</span>
            

            

            <code class="ruby">        clean_invalid_utf8_bytes(text_body.strip.gsub(&quot;\r\n&quot;, &quot;\n&quot;), charset)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="215">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="216">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="217">
            
            

            

            <code class="ruby">      # Forces the encoding of the given string to UTF8 and replaces invalid characters. This is</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="218">
            
            

            

            <code class="ruby">      # necessary as emails sometimes have invalid characters like MS &quot;Smart Quotes.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="219">
            <span class="hits">1</span>
            

            

            <code class="ruby">      def clean_invalid_utf8_bytes(text, src_encoding)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="47" data-linenumber="220">
            <span class="hits">47</span>
            

            

            <code class="ruby">        text.encode(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="221">
            
            

            

            <code class="ruby">          &#39;UTF-8&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="222">
            
            

            

            <code class="ruby">          src_encoding,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="223">
            
            

            

            <code class="ruby">          invalid: :replace,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="224">
            
            

            

            <code class="ruby">          undef: :replace,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="225">
            
            

            

            <code class="ruby">          replace: &#39;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="226">
            
            

            

            <code class="ruby">        )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="227">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="228">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="229">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="230">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="6ac460522ef46880505eedc0d4cfa80f3e729b1d">
  <div class="header">
    <h3>lib/fat_free_crm/mail_processor/comment_replies.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>25</b> relevant lines.
      <span class="green"><b>25</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            <span class="hits">1</span>
            

            

            <code class="ruby">require &#39;fat_free_crm/mail_processor/base&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            <span class="hits">1</span>
            

            

            <code class="ruby">module FatFreeCRM</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="11">
            <span class="hits">1</span>
            

            

            <code class="ruby">  module MailProcessor</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            <span class="hits">1</span>
            

            

            <code class="ruby">    class CommentReplies &lt; Base</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">      # Subject line of email can contain full entity, or shortcuts</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">      # e.g. [contact:1234] OR [co:1234]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="15">
            <span class="hits">1</span>
            

            

            <code class="ruby">      ENTITY_SHORTCUTS = {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">        &#39;ac&#39; =&gt; &#39;account&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">        &#39;ca&#39; =&gt; &#39;campaign&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">        &#39;co&#39; =&gt; &#39;contact&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">        &#39;le&#39; =&gt; &#39;lead&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">        &#39;op&#39; =&gt; &#39;opportunity&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby">        &#39;ta&#39; =&gt; &#39;task&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby">      #--------------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="25">
            <span class="hits">1</span>
            

            

            <code class="ruby">      def initialize</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="26">
            <span class="hits">2</span>
            

            

            <code class="ruby">        @settings = Setting.email_comment_replies.dup</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="27">
            <span class="hits">2</span>
            

            

            <code class="ruby">        super</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="30">
            <span class="hits">1</span>
            

            

            <code class="ruby">      private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby">      # Email processing pipeline</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            
            

            

            <code class="ruby">      #--------------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            <span class="hits">1</span>
            

            

            <code class="ruby">      def process(_uid, email)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="35">
            <span class="hits">2</span>
            

            

            <code class="ruby">        with_subject_line(email) do |entity_name, entity_id|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="36">
            <span class="hits">2</span>
            

            

            <code class="ruby">          create_comment email, entity_name, entity_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            
            

            

            <code class="ruby">      # Checks the email to detect [entity:id] in the subject.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            
            

            

            <code class="ruby">      #--------------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="42">
            <span class="hits">1</span>
            

            

            <code class="ruby">      def with_subject_line(email)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="43">
            <span class="hits">2</span>
            

            

            <code class="ruby">        if /\[([^:]*):([^\]]*)\]/ =~ email.subject</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="44">
            <span class="hits">2</span>
            

            

            <code class="ruby">          entity_name = Regexp.last_match[1]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="45">
            <span class="hits">2</span>
            

            

            <code class="ruby">          entity_id = Regexp.last_match[2]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            
            

            

            <code class="ruby">          # Check that entity is a known model</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="47">
            <span class="hits">2</span>
            

            

            <code class="ruby">          if ENTITY_SHORTCUTS.values.include?(entity_name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="48">
            <span class="hits">1</span>
            

            

            <code class="ruby">            yield entity_name, entity_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            
            

            

            <code class="ruby">          # Check if entity is a 2 letter &#39;shortcut&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="50">
            <span class="hits">1</span>
            

            

            <code class="ruby">          elsif expanded_entity = ENTITY_SHORTCUTS[entity_name]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="51">
            <span class="hits">1</span>
            

            

            <code class="ruby">            yield expanded_entity, entity_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            
            

            

            <code class="ruby">      # Creates a new comment on an entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            
            

            

            <code class="ruby">      #--------------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="58">
            <span class="hits">1</span>
            

            

            <code class="ruby">      def create_comment(email, entity_name, entity_id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            
            

            

            <code class="ruby">        # Find entity from subject params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="60">
            <span class="hits">2</span>
            

            

            <code class="ruby">        if (entity = entity_name.capitalize.constantize.find_by_id(entity_id))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            
            

            

            <code class="ruby">          # Create comment if sender has permissions for entity</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="62">
            <span class="hits">2</span>
            

            

            <code class="ruby">          if sender_has_permissions_for?(entity)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="63">
            <span class="hits">2</span>
            

            

            <code class="ruby">            parsed_reply = EmailReplyParser.parse_reply(plain_text_body(email))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="64">
            <span class="hits">2</span>
            

            

            <code class="ruby">            Comment.create user:        @sender,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            
            

            

            <code class="ruby">                           commentable: entity,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            
            

            

            <code class="ruby">                           comment:     parsed_reply</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="93695a8cb6e0ec385a373c23d82bd05c176021d9">
  <div class="header">
    <h3>lib/fat_free_crm/mail_processor/dropbox.rb</h3>
    <h4>
      <span class="green">
  94.44%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>108</b> relevant lines.
      <span class="green"><b>102</b> lines covered</span> and
      <span class="red"><b>6</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            <span class="hits">1</span>
            

            

            <code class="ruby">require &#39;fat_free_crm/mail_processor/base&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            <span class="hits">1</span>
            

            

            <code class="ruby">module FatFreeCRM</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="11">
            <span class="hits">1</span>
            

            

            <code class="ruby">  module MailProcessor</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            <span class="hits">1</span>
            

            

            <code class="ruby">    class Dropbox &lt; Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            <span class="hits">1</span>
            

            

            <code class="ruby">      KEYWORDS = %w[account campaign contact lead opportunity].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">      #--------------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            <span class="hits">1</span>
            

            

            <code class="ruby">      def initialize</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">        # Models are autoloaded, so the following @@assets class variable should only be set</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">        # when Dropbox is initialized. This needs to be done so that Rake tasks such as</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">        # &#39;assets:precompile&#39; can run on Heroku without depending on a database.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">        # See: http://devcenter.heroku.com/articles/rails31_heroku_cedar#troubleshooting</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="21">
            <span class="hits">26</span>
            

            

            <code class="ruby">        @@assets = [Account, Contact, Lead].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="22">
            <span class="hits">26</span>
            

            

            <code class="ruby">        @settings = Setting.email_dropbox.dup</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="23">
            <span class="hits">26</span>
            

            

            <code class="ruby">        super</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="26">
            <span class="hits">1</span>
            

            

            <code class="ruby">      private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby">      # Email processing pipeline: each steps gets executed if previous one returns false.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby">      #--------------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="30">
            <span class="hits">1</span>
            

            

            <code class="ruby">      def process(_uid, email)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="31">
            <span class="hits">17</span>
            

            

            <code class="ruby">        with_explicit_keyword(email) do |keyword, name|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="32">
            <span class="hits">6</span>
            

            

            <code class="ruby">          data = { &quot;Type&quot; =&gt; keyword, &quot;Name&quot; =&gt; name }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="33">
            <span class="hits">6</span>
            

            

            <code class="ruby">          find_or_create_and_attach(email, data)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            
            

            

            <code class="ruby">        end &amp;&amp; return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="36">
            <span class="hits">11</span>
            

            

            <code class="ruby">        with_recipients(email) do |recipient|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="37">
            <span class="hits">4</span>
            

            

            <code class="ruby">          find_and_attach(email, recipient)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            
            

            

            <code class="ruby">        end &amp;&amp; return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="40">
            <span class="hits">10</span>
            

            

            <code class="ruby">        with_forwarded_recipient(email) do |recipient|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="41">
            <span class="hits">5</span>
            

            

            <code class="ruby">          find_and_attach(email, recipient)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            
            

            

            <code class="ruby">        end &amp;&amp; return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="44">
            <span class="hits">6</span>
            

            

            <code class="ruby">        with_recipients(email) do |recipient|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="45">
            <span class="hits">3</span>
            

            

            <code class="ruby">          create_and_attach(email, recipient)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            
            

            

            <code class="ruby">        end &amp;&amp; return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="48">
            <span class="hits">3</span>
            

            

            <code class="ruby">        with_forwarded_recipient(email) do |recipient|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="49">
            <span class="hits">1</span>
            

            

            <code class="ruby">          create_and_attach(email, recipient)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            
            

            

            <code class="ruby">      # Checks the email to detect keyword on the first line.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            
            

            

            <code class="ruby">      #--------------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="55">
            <span class="hits">1</span>
            

            

            <code class="ruby">      def with_explicit_keyword(email)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="56">
            <span class="hits">17</span>
            

            

            <code class="ruby">        first_line = plain_text_body(email).split(&quot;\n&quot;).first</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="57">
            <span class="hits">17</span>
            

            

            <code class="ruby">        yield Regexp.last_match[1].capitalize, Regexp.last_match[2].strip if first_line =~ /(#{KEYWORDS.join(&#39;|&#39;)})[^a-zA-Z0-9]+(.+)$/i</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            
            

            

            <code class="ruby">      # Checks the email to detect assets on to/bcc addresses</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            
            

            

            <code class="ruby">      #--------------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="62">
            <span class="hits">1</span>
            

            

            <code class="ruby">      def with_recipients(email, _options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="63">
            <span class="hits">15</span>
            

            

            <code class="ruby">        recipients = []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="64">
            <span class="hits">15</span>
            

            

            <code class="ruby">        recipients += email.to_addrs unless email.to.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="65">
            <span class="hits">15</span>
            

            

            <code class="ruby">        recipients += email.cc_addrs unless email.cc.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            
            

            

            <code class="ruby">        # Ignore the dropbox email address, and any address aliases</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="68">
            <span class="hits">15</span>
            

            

            <code class="ruby">        ignored_addresses = [@settings[:address]]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="69">
            <span class="hits">15</span>
            

            

            <code class="ruby">        ignored_addresses += @settings[:address_aliases] if @settings[:address_aliases].is_a?(Array)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="70">
            <span class="hits">15</span>
            

            

            <code class="ruby">        recipients -= ignored_addresses</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            
            

            

            <code class="ruby">        # Process each recipient until email has been attached</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="73">
            <span class="hits">15</span>
            

            

            <code class="ruby">        recipients.each do |recipient|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="74">
            <span class="hits">7</span>
            

            

            <code class="ruby">          return true if yield recipient</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="76">
            <span class="hits">11</span>
            

            

            <code class="ruby">        false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            
            

            

            <code class="ruby">      # Checks the email to detect valid email address in body (first email), detect forwarded emails</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            
            

            

            <code class="ruby">      #----------------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="81">
            <span class="hits">1</span>
            

            

            <code class="ruby">      def with_forwarded_recipient(email, _options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="82">
            <span class="hits">9</span>
            

            

            <code class="ruby">        yield Regexp.last_match[1] if plain_text_body(email) =~ /\b([a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4})\b/</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            
            

            

            <code class="ruby">      # Process pipe_separated_data or explicit keyword.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            
            

            

            <code class="ruby">      #--------------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="87">
            <span class="hits">1</span>
            

            

            <code class="ruby">      def find_or_create_and_attach(email, data)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="88">
            <span class="hits">6</span>
            

            

            <code class="ruby">        klass = data[&quot;Type&quot;].constantize</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="90">
            <span class="hits">6</span>
            

            

            <code class="ruby">        if data[&quot;Email&quot;] &amp;&amp; klass.new.respond_to?(:email)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            
            

            

            <code class="ruby">          conditions = [</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="92">
            
            

            

            <code class="ruby">            &quot;(lower(email) = ? OR lower(alt_email) = ?)&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            
            

            

            <code class="ruby">            data[&quot;Email&quot;].downcase,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            
            

            

            <code class="ruby">            data[&quot;Email&quot;].downcase</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            
            

            

            <code class="ruby">          ]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="96">
            <span class="hits">6</span>
            

            

            <code class="ruby">        elsif klass.new.respond_to?(:first_name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="97">
            <span class="hits">4</span>
            

            

            <code class="ruby">          first_name, *last_name = data[&quot;Name&quot;].split</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="98">
            <span class="hits">4</span>
            

            

            <code class="ruby">          conditions = if last_name.empty? # Treat single name as last name.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="99">
            
            

            

            <code class="ruby">                         [&#39;last_name LIKE ?&#39;, &quot;%#{first_name}&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            
            

            

            <code class="ruby">                       else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="101">
            <span class="hits">4</span>
            

            

            <code class="ruby">                         [&#39;first_name LIKE ? AND last_name LIKE ?&#39;, &quot;%#{first_name}&quot;, &quot;%#{last_name.join(&#39; &#39;)}&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            
            

            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="104">
            <span class="hits">2</span>
            

            

            <code class="ruby">          conditions = [&#39;name LIKE ?&#39;, &quot;%#{data[&#39;Name&#39;]}%&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            
            

            

            <code class="ruby">        # Find the asset from deduced conditions</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="108">
            <span class="hits">6</span>
            

            

            <code class="ruby">        if asset = klass.where(conditions).first</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="109">
            <span class="hits">3</span>
            

            

            <code class="ruby">          if sender_has_permissions_for?(asset)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="110">
            <span class="hits">3</span>
            

            

            <code class="ruby">            attach(email, asset, :strip_first_line)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            
            

            

            <code class="ruby">          else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="112">
            
            

            

            <code class="ruby">            log &quot;Sender does not have permissions to attach email to #{data[&#39;Type&#39;]} #{data[&#39;Email&#39;]} &lt;#{data[&#39;Name&#39;]}&gt;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            
            

            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="115">
            <span class="hits">3</span>
            

            

            <code class="ruby">          log &quot;#{data[&#39;Type&#39;]} #{data[&#39;Email&#39;]} &lt;#{data[&#39;Name&#39;]}&gt; not found, creating new one...&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="116">
            <span class="hits">3</span>
            

            

            <code class="ruby">          asset = klass.create!(default_values(klass, data))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="117">
            <span class="hits">3</span>
            

            

            <code class="ruby">          attach(email, asset, :strip_first_line)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="119">
            <span class="hits">6</span>
            

            

            <code class="ruby">        true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            
            

            

            <code class="ruby">      #----------------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="123">
            <span class="hits">1</span>
            

            

            <code class="ruby">      def find_and_attach(email, recipient)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="124">
            <span class="hits">9</span>
            

            

            <code class="ruby">        attached = false</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="125">
            <span class="hits">9</span>
            

            

            <code class="ruby">        @@assets.each do |klass|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="27" data-linenumber="126">
            <span class="hits">27</span>
            

            

            <code class="ruby">          asset = klass.where([&quot;(lower(email) = ?)&quot;, recipient.downcase]).first</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            
            

            

            <code class="ruby">          # Leads and Contacts have an alt_email: try it if lookup by primary email has failed.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="27" data-linenumber="129">
            <span class="hits">27</span>
            

            

            <code class="ruby">          asset = klass.where([&quot;(lower(alt_email) = ?)&quot;, recipient.downcase]).first if !asset &amp;&amp; klass.column_names.include?(&quot;alt_email&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="27" data-linenumber="131">
            <span class="hits">27</span>
            

            

            <code class="ruby">          if asset &amp;&amp; sender_has_permissions_for?(asset)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="132">
            <span class="hits">5</span>
            

            

            <code class="ruby">            attach(email, asset)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="133">
            <span class="hits">5</span>
            

            

            <code class="ruby">            attached = true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="136">
            <span class="hits">9</span>
            

            

            <code class="ruby">        attached</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            
            

            

            <code class="ruby">      #----------------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="140">
            <span class="hits">1</span>
            

            

            <code class="ruby">      def create_and_attach(email, recipient)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="141">
            <span class="hits">4</span>
            

            

            <code class="ruby">        contact = Contact.create!(default_values_for_contact(email, recipient))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="142">
            <span class="hits">4</span>
            

            

            <code class="ruby">        attach(email, contact)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            
            

            

            <code class="ruby">      #----------------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="146">
            <span class="hits">1</span>
            

            

            <code class="ruby">      def attach(email, asset, strip_first_line = false)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            
            

            

            <code class="ruby">        # If &#39;sent_to&#39; email cannot be found, default to Dropbox email address</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="148">
            <span class="hits">15</span>
            

            

            <code class="ruby">        to = email.to.blank? ? @settings[:address] : email.to.join(&quot;, &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="149">
            <span class="hits">15</span>
            

            

            <code class="ruby">        cc = email.cc.blank? ? nil : email.cc.join(&quot;, &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="151">
            <span class="hits">15</span>
            

            

            <code class="ruby">        email_body = if strip_first_line</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="152">
            <span class="hits">6</span>
            

            

            <code class="ruby">                       plain_text_body(email).split(&quot;\n&quot;)[1..-1].join(&quot;\n&quot;).strip</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            
            

            

            <code class="ruby">                     else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="154">
            <span class="hits">9</span>
            

            

            <code class="ruby">                       plain_text_body(email)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="157">
            <span class="hits">15</span>
            

            

            <code class="ruby">        Email.create(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            
            

            

            <code class="ruby">          imap_message_id: email.message_id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            
            

            

            <code class="ruby">          user:            @sender,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            
            

            

            <code class="ruby">          mediator:        asset,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="161">
            
            

            

            <code class="ruby">          sent_from:       email.from.first,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            
            

            

            <code class="ruby">          sent_to:         to,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="163">
            
            

            

            <code class="ruby">          cc:              cc,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            
            

            

            <code class="ruby">          subject:         email.subject,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="165">
            
            

            

            <code class="ruby">          body:            email_body,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="166">
            
            

            

            <code class="ruby">          received_at:     email.date,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="167">
            
            

            

            <code class="ruby">          sent_at:         email.date</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="168">
            
            

            

            <code class="ruby">        )</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="169">
            <span class="hits">15</span>
            

            

            <code class="ruby">        asset.touch</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="171">
            <span class="hits">15</span>
            

            

            <code class="ruby">        asset.update_attribute(:status, &quot;contacted&quot;) if asset.is_a?(Lead) &amp;&amp; asset.status == &quot;new&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="173">
            <span class="hits">15</span>
            

            

            <code class="ruby">        if @settings[:attach_to_account] &amp;&amp; asset.respond_to?(:account) &amp;&amp; asset.account</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="174">
            <span class="hits">4</span>
            

            

            <code class="ruby">          Email.create(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="175">
            
            

            

            <code class="ruby">            imap_message_id: email.message_id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="176">
            
            

            

            <code class="ruby">            user:            @sender,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="177">
            
            

            

            <code class="ruby">            mediator:        asset.account,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="178">
            
            

            

            <code class="ruby">            sent_from:       email.from.first,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="179">
            
            

            

            <code class="ruby">            sent_to:         to,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            
            

            

            <code class="ruby">            cc:              cc,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="181">
            
            

            

            <code class="ruby">            subject:         email.subject,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="182">
            
            

            

            <code class="ruby">            body:            email_body,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="183">
            
            

            

            <code class="ruby">            received_at:     email.date,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="184">
            
            

            

            <code class="ruby">            sent_at:         email.date</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="185">
            
            

            

            <code class="ruby">          )</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="186">
            <span class="hits">4</span>
            

            

            <code class="ruby">          asset.account.touch</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="187">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="188">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="189">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="190">
            
            

            

            <code class="ruby">      #----------------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="191">
            <span class="hits">1</span>
            

            

            <code class="ruby">      def default_values(klass, data)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="192">
            <span class="hits">3</span>
            

            

            <code class="ruby">        data = data.dup</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="193">
            <span class="hits">3</span>
            

            

            <code class="ruby">        keyword = data.delete(&quot;Type&quot;).capitalize</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="194">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="195">
            
            

            

            <code class="ruby">        defaults = {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="196">
            <span class="hits">3</span>
            

            

            <code class="ruby">          user:   @sender,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="197">
            
            

            

            <code class="ruby">          access: default_access</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="198">
            
            

            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="199">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="200">
            <span class="hits">3</span>
            

            

            <code class="ruby">        case keyword</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="201">
            
            

            

            <code class="ruby">        when &quot;Account&quot;, &quot;Campaign&quot;, &quot;Opportunity&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="202">
            <span class="hits">1</span>
            

            

            <code class="ruby">          defaults[:status] = &quot;planned&quot; if keyword == &quot;Campaign&quot; # TODO: I18n</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="203">
            <span class="hits">1</span>
            

            

            <code class="ruby">          defaults[:stage] = Opportunity.default_stage if keyword == &quot;Opportunity&quot; # TODO: I18n</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="204">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="205">
            
            

            

            <code class="ruby">        when &quot;Contact&quot;, &quot;Lead&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="206">
            <span class="hits">2</span>
            

            

            <code class="ruby">          first_name, *last_name = data.delete(&quot;Name&quot;).split(&#39; &#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="207">
            <span class="hits">2</span>
            

            

            <code class="ruby">          defaults[:first_name] = first_name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="208">
            <span class="hits">2</span>
            

            

            <code class="ruby">          defaults[:last_name] = (last_name.any? ? last_name.join(&quot; &quot;) : &quot;(unknown)&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="209">
            <span class="hits">2</span>
            

            

            <code class="ruby">          defaults[:status] = &quot;contacted&quot; if keyword == &quot;Lead&quot; # TODO: I18n</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="210">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="211">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="212">
            <span class="hits">3</span>
            

            

            <code class="ruby">        data.each do |key, value|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="213">
            <span class="hits">1</span>
            

            

            <code class="ruby">          key = key.downcase</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="214">
            <span class="hits">1</span>
            

            

            <code class="ruby">          defaults[key.to_sym] = value if klass.new.respond_to?(key + &#39;=&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="215">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="216">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="217">
            <span class="hits">3</span>
            

            

            <code class="ruby">        defaults</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="218">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="219">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="220">
            
            

            

            <code class="ruby">      #----------------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="221">
            <span class="hits">1</span>
            

            

            <code class="ruby">      def default_values_for_contact(_email, recipient)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="222">
            <span class="hits">4</span>
            

            

            <code class="ruby">        recipient_local, recipient_domain = recipient.split(&#39;@&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="223">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="224">
            
            

            

            <code class="ruby">        defaults = {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="225">
            <span class="hits">4</span>
            

            

            <code class="ruby">          user:       @sender,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="226">
            
            

            

            <code class="ruby">          first_name: recipient_local.capitalize,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="227">
            
            

            

            <code class="ruby">          last_name:  &quot;(unknown)&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="228">
            
            

            

            <code class="ruby">          email:      recipient,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="229">
            
            

            

            <code class="ruby">          access:     default_access</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="230">
            
            

            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="231">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="232">
            
            

            

            <code class="ruby">        # Search for domain name in Accounts.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="233">
            <span class="hits">4</span>
            

            

            <code class="ruby">        account = Account.where(&#39;(lower(email) like ? OR lower(website) like ?)&#39;, &quot;%#{recipient_domain.downcase}&quot;, &quot;%#{recipient_domain.downcase}%&quot;).first</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="234">
            <span class="hits">4</span>
            

            

            <code class="ruby">        if account</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="235">
            
            

            

            <code class="ruby">          log &quot;asociating new contact #{recipient} with the account #{account.name}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="236">
            
            

            

            <code class="ruby">          defaults[:account] = account</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="237">
            
            

            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="238">
            <span class="hits">4</span>
            

            

            <code class="ruby">          log &quot;creating new account #{recipient_domain.capitalize} for the contact #{recipient}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="239">
            <span class="hits">4</span>
            

            

            <code class="ruby">          defaults[:account] = Account.create!(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="240">
            
            

            

            <code class="ruby">            user:   @sender,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="241">
            
            

            

            <code class="ruby">            email:  recipient,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="242">
            
            

            

            <code class="ruby">            name:   recipient_domain.capitalize,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="243">
            
            

            

            <code class="ruby">            access: default_access</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="244">
            
            

            

            <code class="ruby">          )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="245">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="246">
            <span class="hits">4</span>
            

            

            <code class="ruby">        defaults</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="247">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="248">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="249">
            
            

            

            <code class="ruby">      # If default access is &#39;Shared&#39; then change it to &#39;Private&#39; because we don&#39;t know how</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="250">
            
            

            

            <code class="ruby">      # to choose anyone to share it with here.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="251">
            
            

            

            <code class="ruby">      #--------------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="252">
            <span class="hits">1</span>
            

            

            <code class="ruby">      def default_access</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="253">
            <span class="hits">14</span>
            

            

            <code class="ruby">        Setting.default_access == &quot;Shared&quot; ? &#39;Private&#39; : Setting.default_access</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="254">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="255">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="256">
            
            

            

            <code class="ruby">      # Notify users with the results of the operations</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="257">
            
            

            

            <code class="ruby">      #--------------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="258">
            <span class="hits">1</span>
            

            

            <code class="ruby">      def notify(email, mediator_links)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="259">
            
            

            

            <code class="ruby">        DropboxMailer.create_dropbox_notification(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="260">
            
            

            

            <code class="ruby">          @sender, @settings[:address], email, mediator_links</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="261">
            
            

            

            <code class="ruby">        ).deliver_later</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="262">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="263">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="264">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="265">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="1014b6cd8b7647688a9e96c38b95ef852ff4f788">
  <div class="header">
    <h3>lib/fat_free_crm/permissions.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>63</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>63</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module FatFreeCRM</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  module Permissions</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">    def self.included(base)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">      base.extend(ClassMethods)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">    module ClassMethods</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">      def uses_user_permissions</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">        unless included_modules.include?(InstanceMethods)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">          #</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">          # NOTE: we&#39;re deliberately omitting :dependent =&gt; :destroy to preserve</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">          # permissions of deleted objects. This serves two purposes: 1) to be able</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">          # to implement Recycle Bin/Restore and 2) to honor permissions when</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby">          # displaying &quot;object deleted...&quot; in the activity log.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby">          #</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">          has_many :permissions, as: :asset</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            
            

            

            <code class="ruby">          scope :my, -&gt;(current_user) { accessible_by(current_user.ability) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            
            

            

            <code class="ruby">          include FatFreeCRM::Permissions::InstanceMethods</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">          extend FatFreeCRM::Permissions::SingletonMethods</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            
            

            

            <code class="ruby">    module InstanceMethods</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            
            

            

            <code class="ruby">      # Save shared permissions to the model, if any.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            
            

            

            <code class="ruby">      #--------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="36">
            
            

            

            <code class="ruby">      %w[group user].each do |model|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="37">
            
            

            

            <code class="ruby">        class_eval(%{</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="38">
            
            

            

            <code class="ruby">          def #{model}_ids=(value)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            
            

            

            <code class="ruby">            if access != &#39;Shared&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            
            

            

            <code class="ruby">              remove_permissions</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            
            

            

            <code class="ruby">            else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="42">
            
            

            

            <code class="ruby">              value = value.flatten.reject(&amp;:blank?).uniq.map(&amp;:to_i)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="43">
            
            

            

            <code class="ruby">              permissions_to_remove = Permission.where(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            
            

            

            <code class="ruby">                #{model}_id: self.#{model}_ids - value,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="45">
            
            

            

            <code class="ruby">                asset_id: self.id,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            
            

            

            <code class="ruby">                asset_type: self.class.name</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="47">
            
            

            

            <code class="ruby">              )</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="48">
            
            

            

            <code class="ruby">              permissions_to_remove.each {|p| (permissions.delete(p); p.destroy)}</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="49">
            
            

            

            <code class="ruby">              (value - self.#{model}_ids).each {|id| permissions.build(:#{model}_id =&gt; id)}</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="50">
            
            

            

            <code class="ruby">            end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="53">
            
            

            

            <code class="ruby">          def #{model}_ids</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="54">
            
            

            

            <code class="ruby">            permissions.map(&amp;:#{model}_id).compact</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="55">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="56">
            
            

            

            <code class="ruby">        }, __FILE__, __LINE__ - 19)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="57">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            
            

            

            <code class="ruby">      # Remove all shared permissions if no longer shared</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            
            

            

            <code class="ruby">      #--------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="61">
            
            

            

            <code class="ruby">      def access=(value)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="62">
            
            

            

            <code class="ruby">        remove_permissions unless value == &#39;Shared&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="63">
            
            

            

            <code class="ruby">        super(value)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="64">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            
            

            

            <code class="ruby">      # Removes all permissions on an object</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            
            

            

            <code class="ruby">      #--------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="68">
            
            

            

            <code class="ruby">      def remove_permissions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            
            

            

            <code class="ruby">        # we don&#39;t use dependent =&gt; :destroy so must manually remove</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="70">
            
            

            

            <code class="ruby">        permissions_to_remove = if id &amp;&amp; self.class</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="71">
            
            

            

            <code class="ruby">                                  Permission.where(asset_id: id, asset_type: self.class.name).to_a</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="72">
            
            

            

            <code class="ruby">                                else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="73">
            
            

            

            <code class="ruby">                                  []</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="74">
            
            

            

            <code class="ruby">                                end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="76">
            
            

            

            <code class="ruby">        permissions_to_remove.each do |p|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="77">
            
            

            

            <code class="ruby">          permissions.delete(p)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="78">
            
            

            

            <code class="ruby">          p.destroy</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="79">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="80">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            
            

            

            <code class="ruby">      # Save the model copying other model&#39;s permissions.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            
            

            

            <code class="ruby">      #--------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="84">
            
            

            

            <code class="ruby">      def save_with_model_permissions(model)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="85">
            
            

            

            <code class="ruby">        self.access    = model.access</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="86">
            
            

            

            <code class="ruby">        self.user_ids  = model.user_ids</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="87">
            
            

            

            <code class="ruby">        self.group_ids = model.group_ids</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="88">
            
            

            

            <code class="ruby">        save</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="89">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="90">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="92">
            
            

            

            <code class="ruby">    module SingletonMethods</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="93">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="94">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="95">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="97">
            
            

            

            <code class="ruby">ActiveRecord::Base.include FatFreeCRM::Permissions</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="084273e394b2d1ab056a3a4104b8e4fe1e9edaaa">
  <div class="header">
    <h3>lib/fat_free_crm/renderers.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>6</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>6</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">ActionController::Renderers.add :csv do |objects, options|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  filename = options[:filename] || controller_name || &#39;data&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">  str = FatFreeCRM::ExportCSV.from_array(objects)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">  send_data str, type: :csv,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">                 disposition: &quot;attachment; filename=#{filename}.csv&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="db6abb78a47bb3596b3f632b9aad9284e91ee632">
  <div class="header">
    <h3>lib/fat_free_crm/secret_token_generator.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>35</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>35</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2014 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">require &#39;securerandom&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">module FatFreeCRM</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">  class SecretTokenGenerator</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">    class &lt;&lt; self</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">      #</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">      # If there is no secret token defined, we generate one and save it as a setting</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">      # If a token has been already been saved, we tell Rails to use it and move on.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">      def setup!</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">        unless token_exists?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">          Rails.logger.info(&quot;No secret key defined yet... generating and saving to Setting.secret_token&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">          new_token!</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby">        # If db isn&#39;t setup yet, token will return nil, provide a randomly generated one for now.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">        FatFreeCRM::Application.config.secret_key_base = (token || generate_token)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            
            

            

            <code class="ruby">      private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">      def token_exists?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            
            

            

            <code class="ruby">        Setting.secret_token.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby">      #</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            
            

            

            <code class="ruby">      # Read the current token from settings</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            
            

            

            <code class="ruby">      def token</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            
            

            

            <code class="ruby">        Setting.secret_token</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="36">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            
            

            

            <code class="ruby">      #</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            
            

            

            <code class="ruby">      # Create a new secret token and save it as a setting.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            
            

            

            <code class="ruby">      def new_token!</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            
            

            

            <code class="ruby">        quietly do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="42">
            
            

            

            <code class="ruby">          Setting.secret_token = generate_token</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="43">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="44">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            
            

            

            <code class="ruby">      def generate_token</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="47">
            
            

            

            <code class="ruby">        SecureRandom.hex(64)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="48">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            
            

            

            <code class="ruby">      #</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            
            

            

            <code class="ruby">      # Yields to a block that executes with the logging turned off</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            
            

            

            <code class="ruby">      # This stops the secret token from being appended to the log</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="53">
            
            

            

            <code class="ruby">      def quietly(&amp;_block)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="54">
            
            

            

            <code class="ruby">        temp_logger = ActiveRecord::Base.logger</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="55">
            
            

            

            <code class="ruby">        ActiveRecord::Base.logger = nil</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="56">
            
            

            

            <code class="ruby">        yield</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="57">
            
            

            

            <code class="ruby">        ActiveRecord::Base.logger = temp_logger</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="58">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="59">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="60">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="61">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="aef9aa5ef9133724b554da227999886872c593f9">
  <div class="header">
    <h3>lib/fat_free_crm/sortable.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>25</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>25</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module FatFreeCRM</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  module Sortable</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">    def self.included(base)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">      base.extend(ClassMethods)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">    module ClassMethods</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">      # Model class method to define sort options, for example:</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">      #   sortable :by =&gt; &quot;first_name ASC&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">      #   sortable :by =&gt; [ &quot;first_name ASC&quot;, &quot;last_name ASC&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">      #   sortable :by =&gt; [ &quot;first_name ASC&quot;, &quot;last_name ASC&quot; ], :default =&gt; &quot;last_name ASC&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">      #--------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">      def sortable(options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">        cattr_accessor :sort_by,            # Default sort order with prepended table name.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">                       :sort_by_fields,     # Array of fields to sort by without ASC/DESC.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">                       :sort_by_clauses     # A copy of sortable :by =&gt; ... stored as array.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            
            

            

            <code class="ruby">        self.sort_by_clauses = [options[:by]].flatten</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            
            

            

            <code class="ruby">        self.sort_by_fields = sort_by_clauses.map(&amp;:split).map(&amp;:first)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            
            

            

            <code class="ruby">        self.sort_by = name.tableize + &quot;.&quot; + (options[:default] || options[:by].first)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby">      # Return hash that maps sort options to the actual :order strings, for example:</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby">      #   &quot;first_name&quot; =&gt; &quot;leads.first_name ASC&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby">      #   &quot;last_name&quot;  =&gt; &quot;leads.last_name ASC&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            
            

            

            <code class="ruby">      #--------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            
            

            

            <code class="ruby">      def sort_by_map</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            
            

            

            <code class="ruby">        Hash[</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="36">
            
            

            

            <code class="ruby">          sort_by_fields.zip(sort_by_clauses).map do |field, clause|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="37">
            
            

            

            <code class="ruby">            [field, name.tableize + &quot;.&quot; + clause]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="38">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            
            

            

            <code class="ruby">        ]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="42">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="43">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="45">
            
            

            

            <code class="ruby">ActiveRecord::Base.include FatFreeCRM::Sortable</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="7ed19853aaad3a9eba50907f7f698c735bd9f604">
  <div class="header">
    <h3>lib/fat_free_crm/tabs.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>14</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>14</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module FatFreeCRM</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  class Tabs</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">    cattr_accessor :main</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">    cattr_accessor :admin</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">    # Class methods.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">    #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">    class &lt;&lt; self</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">      def main</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">        @@main ||= Setting[:tabs]&amp;.dup</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">      def admin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">        @@admin ||= Setting[:admin_tabs]&amp;.dup</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="356957b8f9616bf57c328b3ac532c34083832ee0">
  <div class="header">
    <h3>lib/fat_free_crm/version.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>9</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>9</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">module FatFreeCRM</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  module VERSION # :nodoc:</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">    MAJOR = 0</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">    MINOR = 22</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">    TINY  = 0</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">    PRE   = nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">    STRING = [MAJOR, MINOR, TINY, PRE].compact.join(&#39;.&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="b943c4a0d54efd0a691865a504111d9ca93b1838">
  <div class="header">
    <h3>lib/fat_free_crm/view_factory.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>42</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>42</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Copyright (c) 2008-2013 Michael Dvorkin and contributors.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">#</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Fat Free CRM is freely distributable under the terms of MIT license.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># See MIT-LICENSE file or http://www.opensource.org/licenses/mit-license.php</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">#------------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">module FatFreeCRM</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby">  # A view factory keeps track of views and the contexts in which they are available.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">  #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">  #</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">  # The context that a view is available for is defined by &#39;controllers&#39; and &#39;actions&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">  #   controllers =&gt; [&#39;contacts&#39;] means that the view is available when the contacts controller is used</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">  #   actions =&gt; [:index, show] means that the view is available for search listings AND individual records</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">  #   template =&gt; &#39;contacts/index_full&#39; is the partial that is rendered for this view</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">  # Icon is optional. If specified, it will be passed to asset_path.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">  #</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">  class ViewFactory</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">    include Comparable</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">    @@views = []</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">    attr_accessor :id, :name, :icon, :title, :controllers, :actions, :template</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">    # Class methods</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby">    #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            
            

            

            <code class="ruby">    class &lt;&lt; self</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby">      # Register with the view factory</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby">      #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            
            

            

            <code class="ruby">      def register(view)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            
            

            

            <code class="ruby">        @@views &lt;&lt; view unless @@views.map(&amp;:id).include?(view.id)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            
            

            

            <code class="ruby">      # Return views that are available based on context</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            
            

            

            <code class="ruby">      #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="36">
            
            

            

            <code class="ruby">      def views_for(options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="37">
            
            

            

            <code class="ruby">        controller = options[:controller]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="38">
            
            

            

            <code class="ruby">        action = options[:action]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            
            

            

            <code class="ruby">        name = options[:name] # optional</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            
            

            

            <code class="ruby">        @@views.select do |view|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            
            

            

            <code class="ruby">          view.controllers.include?(controller) &amp;&amp; view.actions.include?(action) &amp;&amp; (name.present? ? view.name == name : true)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="42">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="43">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            
            

            

            <code class="ruby">      # Return template name of the current view</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            
            

            

            <code class="ruby">      # pass in options[:name] to specify view name</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            
            

            

            <code class="ruby">      #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="48">
            
            

            

            <code class="ruby">      def template_for_current_view(options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="49">
            
            

            

            <code class="ruby">        view = views_for(options).first</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="50">
            
            

            

            <code class="ruby">        view&amp;.template</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="52">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            
            

            

            <code class="ruby">    # Instance methods</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            
            

            

            <code class="ruby">    #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="56">
            
            

            

            <code class="ruby">    def initialize(options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="57">
            
            

            

            <code class="ruby">      self.name = options[:name]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="58">
            
            

            

            <code class="ruby">      self.title = options[:title]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="59">
            
            

            

            <code class="ruby">      self.icon = options[:icon] # optional</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="60">
            
            

            

            <code class="ruby">      self.controllers = options[:controllers] || []</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="61">
            
            

            

            <code class="ruby">      self.actions = options[:actions] || []</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="62">
            
            

            

            <code class="ruby">      self.template = options[:template]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="63">
            
            

            

            <code class="ruby">      self.id = generate_id</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="64">
            
            

            

            <code class="ruby">      self.class.register(self)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="65">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            
            

            

            <code class="ruby">    # Define view equivalence. They are the same if they have the same id.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            
            

            

            <code class="ruby">    #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="69">
            
            

            

            <code class="ruby">    def &lt;=&gt;(other)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="70">
            
            

            

            <code class="ruby">      id &lt;=&gt; other.id</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="71">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="73">
            
            

            

            <code class="ruby">    private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            
            

            

            <code class="ruby">    # This defines what it means for one view to be different to another</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            
            

            

            <code class="ruby">    #----------------------------------------------------------------------------</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="77">
            
            

            

            <code class="ruby">    def generate_id</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="78">
            
            

            

            <code class="ruby">      [name, controllers.sort, actions.sort].flatten.map(&amp;:to_s).map(&amp;:underscore).join(&#39;_&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="79">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="81">
            
            

            

            <code class="ruby">    ActiveSupport.run_load_hooks(:fat_free_crm_view_factory, self)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="82">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="83">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="3b574877c1cb7cff079514fb8bd5528a8c951700">
  <div class="header">
    <h3>lib/gravatar_image_tag.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>46</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>46</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="3">
            
            

            

            <code class="ruby">module GravatarImageTag</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="4">
            
            

            

            <code class="ruby">  class &lt;&lt; self</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="5">
            
            

            

            <code class="ruby">    attr_accessor :configuration</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="6">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">  def self.configuration</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">    @configuration ||= Configuration.new</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">  def self.configure</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">    yield(configuration)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">  class Configuration</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">    attr_accessor :default_image, :filetype, :rating, :size</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">   end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">  def self.included(base)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">    GravatarImageTag.configure { |_c| nil }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">    base.send :include, InstanceMethods</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            
            

            

            <code class="ruby">  module InstanceMethods</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            
            

            

            <code class="ruby">    def gravatar_image_tag(email, options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            
            

            

            <code class="ruby">      raise ArgumentError, &quot;Options must be a hash, got #{options.inspect}&quot; unless options.is_a? Hash</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            
            

            

            <code class="ruby">      options[:alt] ||= &#39;Gravatar&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            
            

            

            <code class="ruby">      image_tag(GravatarImageTag.gravatar_url(email, options.delete(:gravatar)), options)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            
            

            

            <code class="ruby">  def self.gravatar_url(email, overrides = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            
            

            

            <code class="ruby">    overrides ||= {}</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="36">
            
            

            

            <code class="ruby">    gravatar_params = {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="37">
            
            

            

            <code class="ruby">      default:     GravatarImageTag.configuration.default_image,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="38">
            
            

            

            <code class="ruby">      filetype:    GravatarImageTag.configuration.filetype,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            
            

            

            <code class="ruby">      rating:      GravatarImageTag.configuration.rating,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            
            

            

            <code class="ruby">      size:        GravatarImageTag.configuration.size</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            
            

            

            <code class="ruby">    }.merge(overrides).delete_if { |_key, value| value.nil? }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="42">
            
            

            

            <code class="ruby">    &quot;#{gravatar_url_base}/#{gravatar_id(email, gravatar_params.delete(:filetype))}#{url_params(gravatar_params)}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="43">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="45">
            
            

            

            <code class="ruby">  def self.gravatar_url_base</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            
            

            

            <code class="ruby">    &#39;https://gravatar.com/avatar&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="47">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="49">
            
            

            

            <code class="ruby">  def self.gravatar_id(email, filetype = nil)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="50">
            
            

            

            <code class="ruby">    &quot;#{Digest::MD5.hexdigest(email)}#{&quot;.#{filetype}&quot; unless filetype.nil?}&quot; unless email.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="53">
            
            

            

            <code class="ruby">  def self.url_params(gravatar_params)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="54">
            
            

            

            <code class="ruby">    return nil if gravatar_params.keys.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="56">
            
            

            

            <code class="ruby">    &quot;?#{gravatar_params.map { |key, value| &quot;#{key}=#{CGI.escape(value.is_a?(String) ? value : value.to_s)}&quot; }.join(&#39;&amp;amp;&#39;)}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="57">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="58">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="60">
            
            

            

            <code class="ruby">ActionView::Base.include GravatarImageTag if defined?(ActionView::Base)</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="f7e9bd413e4a51cdb4fff313c0b2e0dbe2f5aed9">
  <div class="header">
    <h3>lib/missing_translation_detector.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>35</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>35</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># Compares two locale files and detects missing translations.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="4">
            
            

            

            <code class="ruby">class MissingTranslationDetector</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="5">
            
            

            

            <code class="ruby">  attr_reader :missing_translations</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">  # @params [String] base_file_name File name of the base locale is i.e. en-US</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby">  # @params [String] target_file_name File name of a locale with missing translations is i.e. de</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  def initialize(base_file_name, target_file_name)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">    @base = yml_load base_file_name</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">    @target = yml_load target_file_name</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">    @missing_translations = []</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">  # Detects missing translations within the target locale file</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">  # and stores it in &quot;missing_translations&quot;.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">  def detect(h = @base, keys = [])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">    h.each_key do |key|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">      key_path = keys.clone.push key</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">      if h[key].is_a?(Hash)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">        detect h[key], key_path</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">      elsif blank?(key_path)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            
            

            

            <code class="ruby">        missing_translations &lt;&lt; OpenStruct.new(key_path: key_path,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            
            

            

            <code class="ruby">                                               value: h[key])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby">  # @returns [Boolean] true if missing translations are detected, otherwise false is returned.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            
            

            

            <code class="ruby">  def missing_translations?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            
            

            

            <code class="ruby">    !@missing_translations.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="37">
            
            

            

            <code class="ruby">  def blank?(keys)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="38">
            
            

            

            <code class="ruby">    h = @target</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            
            

            

            <code class="ruby">    keys.each do |key|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            
            

            

            <code class="ruby">      return true if !h.is_a?(Hash) || !h.key?(key)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="43">
            
            

            

            <code class="ruby">      h = h[key]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="44">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            
            

            

            <code class="ruby">    h.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="47">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="49">
            
            

            

            <code class="ruby">  def yml_load(file_name)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="50">
            
            

            

            <code class="ruby">    h = YAML.load_file &quot;#{Rails.root}/config/locales/#{file_name}.yml&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            
            

            

            <code class="ruby">    h[h.keys.first]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="52">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="53">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
      </div>
    </div>
  </body>
</html>
